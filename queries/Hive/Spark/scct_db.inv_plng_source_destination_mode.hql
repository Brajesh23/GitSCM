---jobname:scct-jda-hive-stg1-scct_db.inv_plng_source_destination_mode -------------------------------------------------------------------------- ---target: stage1 table: scct_db.inv_plng_source_destination_mode  ---source: manu_stage0 table : stsc_network , jdfi_stage0 table : stsc_network ---load type: delta ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 25sep18 ryadav initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length -- 00.00.00.03 11nov20 mbds-1347 bgope date fields are converted (shifting 5 hours) and logic for trans_mode,load_time,unload_time got changed    ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading inv_plng_source_destination_mode stage 1 base data -------------------------  set tez.job.name=stage1:inv_plng_source_destination_mode :load target table inv_plng_source_destination_mode ;
! echo started loading into scct_db.inv_plng_source_destination_mode ;
insert overwrite table scct_db.inv_plng_source_destination_mode partition (snapshot_dt) select coalesce(l1.location_number,dn.source,'n/a') as src_loc_nbr ,coalesce(l2.location_number,dn.dest,'n/a') as dst_loc_nbr ,coalesce((case when trim(dn.transmode)='' then null else trim(dn.transmode) end),'n/a') as trans_mode ,coalesce(dn.transleadtime/1440,0.00) as trans_lead_time ,coalesce(dn.loadtime/1440,0.00) as load_time ,coalesce((case when trim(dn.carrier)='' then null else trim(dn.carrier) end),'n/a') as carrier ,coalesce((case when trim(dn.transmodename)='' then null else trim(dn.transmodename) end),'n/a') as trans_mode_name ,coalesce((case when dn.rank='' then null else dn.rank end),0) as rank ,coalesce((case when dn.lookaheaddays='' then null else dn.lookaheaddays end),0) as look_ahead_days ,coalesce((case when dn.mustgodays='' then null else dn.mustgodays end),0) as must_go_days ,coalesce((case when dn.ratepercwt='' then null else dn.ratepercwt end),0.00) as rate_per_cwt ,coalesce(dn.unloadtime/1440,0.00) as unload_time ,coalesce((case when dn.ff_trigger_control='' then null else dn.ff_trigger_control end),0) as ff_trigger_control ,coalesce((case when dn.primarylsdur='' then null else dn.primarylsdur end),0) as primary_ls_dur ,coalesce((case when dn.primarylsrule='' then null else dn.primarylsrule end),0) as primary_ls_rule ,coalesce((case when dn.secondarylsrule='' then null else dn.secondarylsrule end),0) as secondary_ls_rule ,coalesce((case when dn.vendorminrule='' then null else dn.vendorminrule end),0) as vendor_min_rule ,coalesce((case when trim(dn.transcal)='' then null else trim(dn.transcal) end),'n/a') as trans_cal ,coalesce((case when dn.transmodeminrule='' then null else dn.transmodeminrule end),0) as trans_mode_min_rule ,coalesce((case when trim(dn.lanegroupid)='' then null else trim(dn.lanegroupid) end),'n/a') as lane_group_id ,coalesce((case when dn.usealttransmodesw='' then null else dn.usealttransmodesw end),0) as use_alt_trans_mode_switch ,coalesce((case when dn.loadtolerance='' then null else dn.loadtolerance end),0.00) as load_tolerance ,coalesce((case when dn.transleadtimesd='' then null else dn.transleadtimesd end),0) as trans_lead_time_sd ,coalesce((case when trim(dn.shipcal)='' then null else trim(dn.shipcal) end),'n/a') as ship_cal ,coalesce((case when trim(dn.arrivcal)='' then null else trim(dn.arrivcal) end),'n/a') as arriv_cal ,coalesce((case when trim(dn.orderreviewcal)='' then null else trim(dn.orderreviewcal) end),'n/a') as order_review_cal ,coalesce((case when dn.covduradjtolerance='' then null else dn.covduradjtolerance end),0) as cvrge_dur_adj_tolerance ,coalesce((case when dn.loadbuildrule='' then null else dn.loadbuildrule end),0) as load_build_rule ,coalesce((case when dn.loadminimumrule='' then null else dn.loadminimumrule end),0) as loadminimumrule ,coalesce((case when dn.loadbuildadjuptolerance='' then null else dn.loadbuildadjuptolerance end),0.00) as load_build_adj_up_tolerance ,coalesce((case when dn.loadbuildadjdowntolerance='' then null else dn.loadbuildadjdowntolerance end),0.00) as load_build_adj_down_tolerance ,coalesce((case when dn.loadseqrule='' then null else dn.loadseqrule end),0) as load_seq_rule ,coalesce((case when dn.fwdbuyactivedur='' then null else dn.fwdbuyactivedur end),0) as fwd_buy_active_dur ,coalesce((case when dn.fwdbuyeffectpct='' then null else dn.fwdbuyeffectpct end),0.00) as fwd_buy_effect_pct ,coalesce((case when dn.autoapprovalsw='' then null else dn.autoapprovalsw end),0) as auto_approval_switch ,coalesce((case when dn.distance='' then null else dn.distance end),0) as distance ,coalesce((case when dn.distanceuom='' then null else dn.distanceuom end),0) as distance_uom ,coalesce((case when dn.projorderdur='' then null else dn.projorderdur end),0) as proj_order_dur ,coalesce((case when dn.rioselectsw='' then null else dn.rioselectsw end),0) as rio_select_switch ,coalesce((case when dn.riomincovdur='' then null else dn.riomincovdur end),0) as rio_min_cvrge_dur ,coalesce((case when dn.riomaxcovdur='' then null else dn.riomaxcovdur end),0) as rio_max_cvrge_dur ,coalesce((case when dn.ordercost='' then null else dn.ordercost end),0.00) as order_cost ,coalesce((case when dn.skuperpalletsw='' then null else dn.skuperpalletsw end),0) as sku_per_pallet_switch ,coalesce((case when trim(dn.leadtimeeffcncycal)='' then null else trim(dn.leadtimeeffcncycal) end),'n/a') as lead_time_efficiency_cal ,coalesce((case when dn.supplygroupid='' then null else dn.supplygroupid end),0) as supply_grou_pid ,coalesce((case when dn.riolastplandate = 0 then null else to_date(to_utc_timestamp(from_unixtime(dn.riolastplandate div 1000),'est5edt')) end),'9999-12-31') as rio_last_plan_date ,coalesce((case when dn.riolastmodifieddate = 0 then null else to_date(to_utc_timestamp(from_unixtime(dn.riolastmodifieddate div 1000),'est5edt')) end),'9999-12-31') as rio_last_modified_date ,coalesce((case when dn.riolastpublishdate = 0 then null else to_date(to_utc_timestamp(from_unixtime(dn.riolastpublishdate div 1000),'est5edt')) end),'9999-12-31') as rio_last_publish_date ,coalesce((case when dn.rioloaduomcategory='' then null else dn.rioloaduomcategory end),0) as rio_load_uom_category ,coalesce((case when trim(dn.u_lane_status)='' then null else trim(dn.u_lane_status) end),'n/a') as lane_status ,coalesce((case when dn.u_new_lane_flag='' then null else dn.u_new_lane_flag end),0) as new_lane_flag ,'srp' as srp_intl_id ,date_sub(current_date,1) as snapshot_date from manu_stage0.stsc_network dn left outer join (select location_number from analytics_db.location where location_type_code = '04')l1 on lpad(dn.source,10,0) = l1.location_number left outer join (select location_number from analytics_db.location where location_type_code = '04')l2 on lpad(dn.dest,10,0) = l2.location_number union select coalesce(l1.location_number,inwt.source,0) as src_loc_nbr ,coalesce(l2.location_number,inwt.dest,0) as dst_loc_nbr ,coalesce((case when trim(inwt.transmode)='' then null else trim(inwt.transmode) end),'n/a') as trans_mode ,coalesce(inwt.transleadtime/1440,0.00) as trans_lead_time ,coalesce(inwt.loadtime/1440,0.00) as load_time ,coalesce((case when trim(inwt.carrier)='' then null else trim(inwt.carrier) end),'n/a') as carrier ,coalesce((case when trim(inwt.transmodename)='' then null else trim(inwt.transmodename) end),'n/a') as trans_mode_name ,coalesce((case when inwt.rank='' then null else inwt.rank end),0) as rank ,coalesce((case when inwt.lookaheaddays='' then null else inwt.lookaheaddays end),0) as look_ahead_days ,coalesce((case when inwt.mustgodays='' then null else inwt.mustgodays end),0) as must_go_days ,coalesce((case when inwt.ratepercwt='' then null else inwt.ratepercwt end),0.00) as rate_per_cwt ,coalesce(inwt.unloadtime/1440,0.00) as unload_time ,coalesce((case when inwt.ff_trigger_control='' then null else inwt.ff_trigger_control end),0) as ff_trigger_control ,coalesce((case when inwt.primarylsdur='' then null else inwt.primarylsdur end),0) as primary_ls_dur ,coalesce((case when inwt.primarylsrule='' then null else inwt.primarylsrule end),0) as primary_ls_rule ,coalesce((case when inwt.secondarylsrule='' then null else inwt.secondarylsrule end),0) as secondary_ls_rule ,coalesce((case when inwt.vendorminrule='' then null else inwt.vendorminrule end),0) as vendor_min_rule ,coalesce((case when trim(inwt.transcal)='' then null else trim(inwt.transcal) end),'n/a') as trans_cal ,coalesce((case when inwt.transmodeminrule='' then null else inwt.transmodeminrule end),0) as trans_mode_min_rule ,coalesce((case when trim(inwt.lanegroupid)='' then null else trim(inwt.lanegroupid) end),'n/a') as lane_group_id ,coalesce((case when inwt.usealttransmodesw='' then null else inwt.usealttransmodesw end),0) as use_alt_trans_mode_switch ,coalesce((case when inwt.loadtolerance='' then null else inwt.loadtolerance end),0.00) as load_tolerance ,coalesce((case when inwt.transleadtimesd='' then null else inwt.transleadtimesd end),0) as trans_lead_time_sd ,coalesce((case when trim(inwt.shipcal)='' then null else trim(inwt.shipcal) end),'n/a') as ship_cal ,coalesce((case when trim(inwt.arrivcal)='' then null else trim(inwt.arrivcal) end),'n/a') as arriv_cal ,coalesce((case when trim(inwt.orderreviewcal)='' then null else trim(inwt.orderreviewcal) end),'n/a') as order_review_cal ,coalesce((case when inwt.covduradjtolerance='' then null else inwt.covduradjtolerance end),0) as cvrge_dur_adj_tolerance ,coalesce((case when inwt.loadbuildrule='' then null else inwt.loadbuildrule end),0) as load_build_rule ,coalesce((case when inwt.loadminimumrule='' then null else inwt.loadminimumrule end),0) as loadminimumrule ,coalesce((case when inwt.loadbuildadjuptolerance='' then null else inwt.loadbuildadjuptolerance end),0.00) as load_build_adj_up_tolerance ,coalesce((case when inwt.loadbuildadjdowntolerance='' then null else inwt.loadbuildadjdowntolerance end),0.00) as load_build_adj_down_tolerance ,coalesce((case when inwt.loadseqrule='' then null else inwt.loadseqrule end),0) as load_seq_rule ,coalesce((case when inwt.fwdbuyactivedur='' then null else inwt.fwdbuyactivedur end),0) as fwd_buy_active_dur ,coalesce((case when inwt.fwdbuyeffectpct='' then null else inwt.fwdbuyeffectpct end),0.00) as fwd_buy_effect_pct ,coalesce((case when inwt.autoapprovalsw='' then null else inwt.autoapprovalsw end),0) as auto_approval_switch ,coalesce((case when inwt.distance='' then null else inwt.distance end),0) as distance ,coalesce((case when inwt.distanceuom='' then null else inwt.distanceuom end),0) as distance_uom ,coalesce((case when inwt.projorderdur='' then null else inwt.projorderdur end),0) as proj_order_dur ,coalesce((case when inwt.rioselectsw='' then null else inwt.rioselectsw end),0) as rio_select_switch ,coalesce((case when inwt.riomincovdur='' then null else inwt.riomincovdur end),0) as rio_min_cvrge_dur ,coalesce((case when inwt.riomaxcovdur='' then null else inwt.riomaxcovdur end),0) as rio_max_cvrge_dur ,coalesce((case when inwt.ordercost='' then null else inwt.ordercost end),0.00) as order_cost ,coalesce((case when inwt.skuperpalletsw='' then null else inwt.skuperpalletsw end),0) as sku_per_pallet_switch ,coalesce((case when trim(inwt.leadtimeeffcncycal)='' then null else trim(inwt.leadtimeeffcncycal) end),'n/a') as lead_time_efficiency_cal ,coalesce((case when inwt.supplygroupid='' then null else inwt.supplygroupid end),0) as supply_grou_pid ,coalesce((case when inwt.riolastplandate = 0 then null else to_date(to_utc_timestamp(from_unixtime(inwt.riolastplandate div 1000),'est5edt')) end),'9999-12-31') as rio_last_plan_date ,coalesce((case when inwt.riolastmodifieddate = 0 then null else to_date(to_utc_timestamp(from_unixtime(inwt.riolastmodifieddate div 1000),'est5edt')) end),'9999-12-31') as rio_last_modified_date ,coalesce((case when inwt.riolastpublishdate = 0 then null else to_date(to_utc_timestamp(from_unixtime(inwt.riolastpublishdate div 1000),'est5edt')) end),'9999-12-31') as rio_last_publish_date ,coalesce((case when inwt.rioloaduomcategory='' then null else inwt.rioloaduomcategory end),0) as rio_load_uom_category ,'n/a' as lane_status ,'0' as new_lane_flag ,'intl' as srp_intl_id ,date_sub(current_date,1) as snapshot_date from jdfi_stage0.stsc_network inwt left outer join (select location_number from analytics_db.location where location_type_code = '04')l1 on lpad(inwt.source,10,0) = l1.location_number left outer join (select location_number from analytics_db.location where location_type_code = '04')l2 on lpad(inwt.dest,10,0) = l2.location_number;;
! echo completed loading into scct_db.inv_plng_source_destination_mode ;
