<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!----><SnowBlocks>
<SnowBlock id="1">
<Step id="po_so_dd_hu_details_1">
<Print><![CDATA[completed po_so_dd_hu_details data load;]]></Print>
<Sql><![CDATA[INSERT
  OVERWRITE INTO SCCT_DB.PO_SO_DD_HU_DETAILS (
    SELECT
      'dc' AS SPPLY_CHN_ND,
      'dc_brand' AS FROM_NODE,
      PO.PURCH_ORD_NBR,
      PO.PURCH_ORD_ITM_NBR,
      COALESCE(PO.DEL_IND, DM.DEL_IND, 'n/a') AS DEL_IND,
      COALESCE(PO.ITM_NBR, DM.ITM_NBR, HM.ITM_NBR, '0') AS ITM_NBR,
      COALESCE(PO.CO_CD, 'n/a'),
      COALESCE(PO.LOC_NBR, 'n/a'),
      COALESCE(PO.PURCH_ORD_QTY, 0.000),
      COALESCE(PO.PURCH_ORD_QTY_UOM, 'n/a'),
      COALESCE(PO.ORD_UNT_NMRTR_CONVN_NBR, 0),
      COALESCE(PO.BASE_UNT_NMRTR_CONVN_NBR, 0),
      COALESCE(PO.NET_ORD_VAL_CURCY, 0.00),
      COALESCE(PO.DELV_COMPLN_IND, 'n/a'),
      COALESCE(PO.BASE_UOM_CD, 'n/a'),
      COALESCE(
        PO.PURCH_ORD_QTY * PO.BASE_UNT_NMRTR_CONVN_NBR / PO.BASE_UNT_DNMNTR_CONVN_NBR,
        0.000
      ),
      COALESCE(PO.MAST_OWNSHP_DT, '9999-12-31'),
      COALESCE(PO.ORIG_MAST_OWNSHP_DT, '9999-12-31'),
      COALESCE(PO.PURCH_DOC_TYPE_CD, 'n/a'),
      COALESCE(
        CASE
          WHEN TRIM(PO.VEND_ACCT_ID) = '' THEN NULL
          ELSE TRIM(PO.VEND_ACCT_ID)
        END,
        'n/a'
      ),
      COALESCE(PO.PURCHG_ORG_CD, 'n/a'),
      COALESCE(PO.PURCHG_GRP_CD, 'n/a'),
      COALESCE(PO.CUST_NBR, 'n/a'),
      COALESCE(PO.INCTRM_1, DM.INCTRM_1, 'n/a'),
      COALESCE(PO.INCTRM_2, DM.INCTRM_2, 'n/a'),
      COALESCE(PO.OUR_REF, 'n/a'),
      COALESCE(PO.TRANSP_MODE, 'n/a'),
      COALESCE(PO.SLS_ORD_NBR, 'n/a'),
      COALESCE(PO.SLS_ORD_ITM_NBR, 0),
      COALESCE(PO.COORIG, 'n/a'),
      COALESCE(PO.NDC_DT, '9999-12-31'),
      COALESCE(PO.STAT_NDC_DT, '9999-12-31'),
      COALESCE(PO.PO_CREATE_DT, '9999-12-31'),
      COALESCE(PO.SHIP_TO_LOC_NBR, 'n/a'),
      COALESCE(PO.REC_CRTD_DT, HM.REC_CRTD_DT, '9999-12-31') AS REC_CRTD_DT,
      COALESCE(PO.FLOORSET_DT, '9999-12-31'),
      'n/a' AS SO_SLS_ORD_NBR,
      0 AS SO_SLS_ORD_ITM_NBR,
      'n/a' AS SO_ITM_NBR,
      0.00 AS SO_NET_VAL,
      0.000 AS SO_ORD_QTY_SLS_UNT,
      'n/a' AS SO_RECV_LOC_NBR,
      '9999-12-31' AS SO_REC_CRTD_DT,
      'n/a' AS SO_REC_CRTD_ID,
      0.00 AS SO_COST,
      '9999-12-31' AS SO_REQSTD_DT,
      'n/a' AS SO_CUST_PRCH_NBR,
      'n/a' AS SO_SHIP_TO_LOC_NBR,
      'n/a' AS SO_CNTRY_CD,
      'n/a' AS SO_SLS_DOC_TYPE,
      COALESCE(DM.DELV_DOC_NBR, HM.DELV_DOC_NBR, 'n/a') AS DELV_DOC_NBR,
      COALESCE(DM.DELV_DOC_ITM_NBR, HM.DELV_DOC_ITM_NBR, 0) AS DELV_DOC_ITM_NBR,
      COALESCE(DM.DEL_TYPE, 'n/a'),
      COALESCE(DM.ACT_DELV_QTY, 0.000),
      COALESCE(DM.ACTL_GDS_MOVMT_DT, '9999-12-31'),
      COALESCE(DM.DELV_PRTY, 0),
      COALESCE(DM.DELV_QTY, 0.000),
      COALESCE(DM.GDS_ISS_DATE, '9999-12-31'),
      COALESCE(DM.RCVG_STE_DELV, 'n/a'),
      COALESCE(DM.HDR_REC_CRTD_DT, '9999-12-31'),
      COALESCE(DM.REF_DOC_ITM_NBR, 0),
      COALESCE(DM.REF_DOC_NBR, 'n/a'),
      COALESCE(DM.SHP_RCVG_PT, 'n/a'),
      COALESCE(DM.GDS_MOVMT_CNTL, 'n/a'),
      COALESCE(DM.MOVMT_IND, 'n/a'),
      COALESCE(DM.POD_IND, 'n/a'),
      COALESCE(DM.POD_RLSE_IND, 'n/a'),
      COALESCE(DM.RECV_LOC_NBR, 'n/a'),
      COALESCE(DM.TRANSP_TYPE, 'n/a'),
      COALESCE(DM.TRANSP_ID, 'n/a'),
      COALESCE(HM.INTL_HNDLG_UNT_NBR, 'n/a'),
      COALESCE(HM.EXT_HNDLG_UNT_NBR, 'n/a'),
      COALESCE(HM.EXT_HNDLG_UNT_NBR_2, 'n/a'),
      COALESCE(HM.EXT_HNDLG_UNT_TYPE, 'n/a'),
      COALESCE(HM.PCKG_MAT_TYPE, 'n/a'),
      COALESCE(HM.PCKD_QTY, 0.000),
      COALESCE(HM.PCKD_UOM, 'n/a'),
      COALESCE(IUM.NUMERATOR, 0.00),
      COALESCE(HM.GRS_WGT, 0.000),
      COALESCE(HM.WGT_UNT, 'n/a'),
      COALESCE(HM.LEN, 0.000),
      COALESCE(HM.WDT, 0.000),
      COALESCE(HM.HGT, 0.000),
      COALESCE(HM.DIM_UOM, 'n/a'),
      COALESCE(HM.REC_CHGD_DT, '9999-12-31'),
      COALESCE(HM.HNDLG_UNT_STAT, 'n/a'),
      COALESCE(HM.BOL_DT, '9999-12-31'),
      COALESCE(HM.STR_DT, '9999-12-31'),
      COALESCE(HM.DA_SCAN_DT, '9999-12-31'),
      COALESCE(HM.LOAD_NBR, 0),
      COALESCE(
        CASE
          WHEN TRIM(PO.VEND_ACCT_ID) = '' THEN NULL
          ELSE TRIM(PO.VEND_ACCT_ID)
        END,
        'n/a'
      ) AS SUPL_LOC_NBR,
      COALESCE(PO.LOC_NBR, 'n/a') AS RECV_LOC_NBR,
      'stock_transfer_intra_company' AS BUSINESS_PROCESS,
      'dc_brand' AS TO_NODE,
      PO.PURCH_DOC_TYPE_CD AS PO_DOC_TYP
    FROM
      (
        SELECT
          *
        FROM
          SCCT_DB.PO_MASTER
        WHERE
          PURCH_DOC_TYPE_CD = 'ub'
          AND (
            DEL_IND <> 'l'
            OR DEL_IND = 'l'
            AND GR_QTY > 0
          )
          AND VEND_ACCT_ID <> 'n/a'
          AND LOC_NBR <> 'n/a'
      ) AS PO
      INNER JOIN (
        SELECT
          *
        FROM
          SCCT_DB.LOCATION_MASTER
        WHERE
          LOC_TYP_CD = '01'
      ) AS A ON PO.VEND_ACCT_ID = A.LOC_NBR
      INNER JOIN (
        SELECT
          *
        FROM
          SCCT_DB.LOCATION_MASTER
        WHERE
          LOC_TYP_CD = '01'
      ) AS B ON PO.LOC_NBR = B.LOC_NBR
      LEFT JOIN (
        SELECT
          *
        FROM
          SCCT_DB.DELIVERY_MASTER
        WHERE
          DEL_IND <> 'd'
          AND DEL_TYPE NOT IN ('el', 'elst')
          AND ITM_NBR <> '0'
      ) AS DM ON PO.PURCH_ORD_NBR = DM.REF_DOC_NBR
      AND PO.PURCH_ORD_ITM_NBR = DM.REF_DOC_ITM_NBR
      AND PO.ITM_NBR = DM.ITM_NBR
      LEFT JOIN (
        SELECT
          *
        FROM
          SCCT_DB.HANDLING_MASTER
        WHERE
          ITM_NBR <> '0'
      ) AS HM ON DM.DELV_DOC_ITM_NBR = HM.DELV_DOC_ITM_NBR
      AND DM.DELV_DOC_NBR = HM.DELV_DOC_NBR
      AND PO.ITM_NBR = HM.ITM_NBR
      LEFT JOIN (
        SELECT
          *
        FROM
          SCCT_DB.ITEM_UNIT_MEASURE_MASTERWHERE TRIM(ITM_NBR) <> ''
      ) AS IUM ON DM.ITM_NBR = IUM.ITM_NBR
      AND HM.PCKD_UOM = IUM.ALT_UOM
  );]]></Sql>
<Condition action="exit" if="ERRORCODE != 0" value="ERRORCODE"/>
<Print><![CDATA[completed po_so_dd_hu_details data load;]]></Print>
</Step>
</SnowBlock>
<SnowBlock id="2">
<Step id="po_so_dd_hu_details_2">
<Sql><![CDATA[INSERT
  OVERWRITE INTO SCCT_DB.PO_SO_DD_HU_DETAILS (
    SELECT
      'dc' AS SPPLY_CHN_ND,
      'dc_brand' AS FROM_NODE,
      PO.PURCH_ORD_NBR,
      PO.PURCH_ORD_ITM_NBR,
      COALESCE(PO.DEL_IND, DM.DEL_IND, 'n/a') AS DEL_IND,
      COALESCE(PO.ITM_NBR, DM.ITM_NBR, HM.ITM_NBR, '0') AS ITM_NBR,
      COALESCE(PO.CO_CD, 'n/a'),
      COALESCE(PO.LOC_NBR, 'n/a'),
      COALESCE(PO.PURCH_ORD_QTY, 0.000),
      COALESCE(PO.PURCH_ORD_QTY_UOM, 'n/a'),
      COALESCE(PO.ORD_UNT_NMRTR_CONVN_NBR, 0),
      COALESCE(PO.BASE_UNT_NMRTR_CONVN_NBR, 0),
      COALESCE(PO.NET_ORD_VAL_CURCY, 0.00),
      COALESCE(PO.DELV_COMPLN_IND, 'n/a'),
      COALESCE(PO.BASE_UOM_CD, 'n/a'),
      COALESCE(
        PO.PURCH_ORD_QTY * PO.BASE_UNT_NMRTR_CONVN_NBR / PO.BASE_UNT_DNMNTR_CONVN_NBR,
        0.000
      ),
      COALESCE(PO.MAST_OWNSHP_DT, '9999-12-31'),
      COALESCE(PO.ORIG_MAST_OWNSHP_DT, '9999-12-31'),
      COALESCE(PO.PURCH_DOC_TYPE_CD, 'n/a'),
      COALESCE(
        CASE
          WHEN TRIM(PO.VEND_ACCT_ID) = '' THEN NULL
          ELSE TRIM(PO.VEND_ACCT_ID)
        END,
        'n/a'
      ),
      COALESCE(PO.PURCHG_ORG_CD, 'n/a'),
      COALESCE(PO.PURCHG_GRP_CD, 'n/a'),
      COALESCE(PO.CUST_NBR, 'n/a'),
      COALESCE(PO.INCTRM_1, DM.INCTRM_1, 'n/a'),
      COALESCE(PO.INCTRM_2, DM.INCTRM_2, 'n/a'),
      COALESCE(PO.OUR_REF, 'n/a'),
      COALESCE(PO.TRANSP_MODE, 'n/a'),
      COALESCE(PO.SLS_ORD_NBR, 'n/a'),
      COALESCE(PO.SLS_ORD_ITM_NBR, 0),
      COALESCE(PO.COORIG, 'n/a'),
      COALESCE(PO.NDC_DT, '9999-12-31'),
      COALESCE(PO.STAT_NDC_DT, '9999-12-31'),
      COALESCE(PO.PO_CREATE_DT, '9999-12-31'),
      COALESCE(PO.SHIP_TO_LOC_NBR, 'n/a'),
      COALESCE(PO.REC_CRTD_DT, HM.REC_CRTD_DT, '9999-12-31') AS REC_CRTD_DT,
      COALESCE(PO.FLOORSET_DT, '9999-12-31'),
      'n/a' AS SO_SLS_ORD_NBR,
      0 AS SO_SLS_ORD_ITM_NBR,
      'n/a' AS SO_ITM_NBR,
      0.00 AS SO_NET_VAL,
      0.000 AS SO_ORD_QTY_SLS_UNT,
      'n/a' AS SO_RECV_LOC_NBR,
      '9999-12-31' AS SO_REC_CRTD_DT,
      'n/a' AS SO_REC_CRTD_ID,
      0.00 AS SO_COST,
      '9999-12-31' AS SO_REQSTD_DT,
      'n/a' AS SO_CUST_PRCH_NBR,
      'n/a' AS SO_SHIP_TO_LOC_NBR,
      'n/a' AS SO_CNTRY_CD,
      'n/a' AS SO_SLS_DOC_TYPE,
      COALESCE(DM.DELV_DOC_NBR, HM.DELV_DOC_NBR, 'n/a') AS DELV_DOC_NBR,
      COALESCE(DM.DELV_DOC_ITM_NBR, HM.DELV_DOC_ITM_NBR, 0) AS DELV_DOC_ITM_NBR,
      COALESCE(DM.DEL_TYPE, 'n/a'),
      COALESCE(DM.ACT_DELV_QTY, 0.000),
      COALESCE(DM.ACTL_GDS_MOVMT_DT, '9999-12-31'),
      COALESCE(DM.DELV_PRTY, 0),
      COALESCE(DM.DELV_QTY, 0.000),
      COALESCE(DM.GDS_ISS_DATE, '9999-12-31'),
      COALESCE(DM.RCVG_STE_DELV, 'n/a'),
      COALESCE(DM.HDR_REC_CRTD_DT, '9999-12-31'),
      COALESCE(DM.REF_DOC_ITM_NBR, 0),
      COALESCE(DM.REF_DOC_NBR, 'n/a'),
      COALESCE(DM.SHP_RCVG_PT, 'n/a'),
      COALESCE(DM.GDS_MOVMT_CNTL, 'n/a'),
      COALESCE(DM.MOVMT_IND, 'n/a'),
      COALESCE(DM.POD_IND, 'n/a'),
      COALESCE(DM.POD_RLSE_IND, 'n/a'),
      COALESCE(DM.RECV_LOC_NBR, 'n/a'),
      COALESCE(DM.TRANSP_TYPE, 'n/a'),
      COALESCE(DM.TRANSP_ID, 'n/a'),
      COALESCE(HM.INTL_HNDLG_UNT_NBR, 'n/a'),
      COALESCE(HM.EXT_HNDLG_UNT_NBR, 'n/a'),
      COALESCE(HM.EXT_HNDLG_UNT_NBR_2, 'n/a'),
      COALESCE(HM.EXT_HNDLG_UNT_TYPE, 'n/a'),
      COALESCE(HM.PCKG_MAT_TYPE, 'n/a'),
      COALESCE(HM.PCKD_QTY, 0.000),
      COALESCE(HM.PCKD_UOM, 'n/a'),
      COALESCE(IUM.NUMERATOR, 0.00),
      COALESCE(HM.GRS_WGT, 0.000),
      COALESCE(HM.WGT_UNT, 'n/a'),
      COALESCE(HM.LEN, 0.000),
      COALESCE(HM.WDT, 0.000),
      COALESCE(HM.HGT, 0.000),
      COALESCE(HM.DIM_UOM, 'n/a'),
      COALESCE(HM.REC_CHGD_DT, '9999-12-31'),
      COALESCE(HM.HNDLG_UNT_STAT, 'n/a'),
      COALESCE(HM.BOL_DT, '9999-12-31'),
      COALESCE(HM.STR_DT, '9999-12-31'),
      COALESCE(HM.DA_SCAN_DT, '9999-12-31'),
      COALESCE(HM.LOAD_NBR, 0),
      COALESCE(
        CASE
          WHEN TRIM(PO.VEND_ACCT_ID) = '' THEN NULL
          ELSE TRIM(PO.VEND_ACCT_ID)
        END,
        'n/a'
      ) AS SUPL_LOC_NBR,
      COALESCE(PO.LOC_NBR, 'n/a') AS RECV_LOC_NBR,
      'stock_transfer_intra_company' AS BUSINESS_PROCESS,
      'dc_brand' AS TO_NODE,
      PO.PURCH_DOC_TYPE_CD AS PO_DOC_TYP
    FROM
      (
        SELECT
          *
        FROM
          SCCT_DB.PO_MASTER
        WHERE
          PURCH_DOC_TYPE_CD = 'ub'
          AND (
            DEL_IND <> 'l'
            OR DEL_IND = 'l'
            AND GR_QTY > 0
          )
          AND VEND_ACCT_ID <> 'n/a'
          AND LOC_NBR <> 'n/a'
      ) AS PO
      INNER JOIN (
        SELECT
          *
        FROM
          SCCT_DB.LOCATION_MASTER
        WHERE
          LOC_TYP_CD = '01'
      ) AS A ON PO.VEND_ACCT_ID = A.LOC_NBR
      INNER JOIN (
        SELECT
          *
        FROM
          SCCT_DB.LOCATION_MASTER
        WHERE
          LOC_TYP_CD = '01'
      ) AS B ON PO.LOC_NBR = B.LOC_NBR
      LEFT JOIN (
        SELECT
          *
        FROM
          SCCT_DB.DELIVERY_MASTER
        WHERE
          DEL_IND <> 'd'
          AND DEL_TYPE NOT IN ('el', 'elst')
          AND ITM_NBR <> '0'
      ) AS DM ON PO.PURCH_ORD_NBR = DM.REF_DOC_NBR
      AND PO.PURCH_ORD_ITM_NBR = DM.REF_DOC_ITM_NBR
      AND PO.ITM_NBR = DM.ITM_NBR
      LEFT JOIN (
        SELECT
          *
        FROM
          SCCT_DB.HANDLING_MASTER
        WHERE
          ITM_NBR <> '0'
      ) AS HM ON DM.DELV_DOC_ITM_NBR = HM.DELV_DOC_ITM_NBR
      AND DM.DELV_DOC_NBR = HM.DELV_DOC_NBR
      AND PO.ITM_NBR = HM.ITM_NBR
      LEFT JOIN (
        SELECT
          *
        FROM
          SCCT_DB.ITEM_UNIT_MEASURE_MASTERWHERE TRIM(ITM_NBR) <> ''
      ) AS IUM ON DM.ITM_NBR = IUM.ITM_NBR
      AND HM.PCKD_UOM = IUM.ALT_UOM
  );]]></Sql>
<Condition action="exit" if="ERRORCODE != 0" value="ERRORCODE"/>
<Print><![CDATA[completed po_so_dd_hu_details data load;]]></Print>
</Step>
</SnowBlock>
<SnowBlock id="3">
<Step id="po_so_dd_hu_details_3">
<Sql><![CDATA[INSERT
  OVERWRITE INTO SCCT_DB.PO_SO_DD_HU_DETAILS (
    SELECT
      'dc' AS SPPLY_CHN_ND,
      'dc_brand' AS FROM_NODE,
      PO.PURCH_ORD_NBR,
      PO.PURCH_ORD_ITM_NBR,
      COALESCE(PO.DEL_IND, DM.DEL_IND, 'n/a') AS DEL_IND,
      COALESCE(PO.ITM_NBR, DM.ITM_NBR, HM.ITM_NBR, '0') AS ITM_NBR,
      COALESCE(PO.CO_CD, 'n/a'),
      COALESCE(PO.LOC_NBR, 'n/a'),
      COALESCE(PO.PURCH_ORD_QTY, 0.000),
      COALESCE(PO.PURCH_ORD_QTY_UOM, 'n/a'),
      COALESCE(PO.ORD_UNT_NMRTR_CONVN_NBR, 0),
      COALESCE(PO.BASE_UNT_NMRTR_CONVN_NBR, 0),
      COALESCE(PO.NET_ORD_VAL_CURCY, 0.00),
      COALESCE(PO.DELV_COMPLN_IND, 'n/a'),
      COALESCE(PO.BASE_UOM_CD, 'n/a'),
      COALESCE(
        PO.PURCH_ORD_QTY * PO.BASE_UNT_NMRTR_CONVN_NBR / PO.BASE_UNT_DNMNTR_CONVN_NBR,
        0.000
      ),
      COALESCE(PO.MAST_OWNSHP_DT, '9999-12-31'),
      COALESCE(PO.ORIG_MAST_OWNSHP_DT, '9999-12-31'),
      COALESCE(PO.PURCH_DOC_TYPE_CD, 'n/a'),
      COALESCE(
        CASE
          WHEN TRIM(PO.VEND_ACCT_ID) = '' THEN NULL
          ELSE TRIM(PO.VEND_ACCT_ID)
        END,
        'n/a'
      ),
      COALESCE(PO.PURCHG_ORG_CD, 'n/a'),
      COALESCE(PO.PURCHG_GRP_CD, 'n/a'),
      COALESCE(PO.CUST_NBR, 'n/a'),
      COALESCE(PO.INCTRM_1, DM.INCTRM_1, 'n/a'),
      COALESCE(PO.INCTRM_2, DM.INCTRM_2, 'n/a'),
      COALESCE(PO.OUR_REF, 'n/a'),
      COALESCE(PO.TRANSP_MODE, 'n/a'),
      COALESCE(PO.SLS_ORD_NBR, 'n/a'),
      COALESCE(PO.SLS_ORD_ITM_NBR, 0),
      COALESCE(PO.COORIG, 'n/a'),
      COALESCE(PO.NDC_DT, '9999-12-31'),
      COALESCE(PO.STAT_NDC_DT, '9999-12-31'),
      COALESCE(PO.PO_CREATE_DT, '9999-12-31'),
      COALESCE(PO.SHIP_TO_LOC_NBR, 'n/a'),
      COALESCE(PO.REC_CRTD_DT, HM.REC_CRTD_DT, '9999-12-31') AS REC_CRTD_DT,
      COALESCE(PO.FLOORSET_DT, '9999-12-31'),
      'n/a' AS SO_SLS_ORD_NBR,
      0 AS SO_SLS_ORD_ITM_NBR,
      'n/a' AS SO_ITM_NBR,
      0.00 AS SO_NET_VAL,
      0.000 AS SO_ORD_QTY_SLS_UNT,
      'n/a' AS SO_RECV_LOC_NBR,
      '9999-12-31' AS SO_REC_CRTD_DT,
      'n/a' AS SO_REC_CRTD_ID,
      0.00 AS SO_COST,
      '9999-12-31' AS SO_REQSTD_DT,
      'n/a' AS SO_CUST_PRCH_NBR,
      'n/a' AS SO_SHIP_TO_LOC_NBR,
      'n/a' AS SO_CNTRY_CD,
      'n/a' AS SO_SLS_DOC_TYPE,
      COALESCE(DM.DELV_DOC_NBR, HM.DELV_DOC_NBR, 'n/a') AS DELV_DOC_NBR,
      COALESCE(DM.DELV_DOC_ITM_NBR, HM.DELV_DOC_ITM_NBR, 0) AS DELV_DOC_ITM_NBR,
      COALESCE(DM.DEL_TYPE, 'n/a'),
      COALESCE(DM.ACT_DELV_QTY, 0.000),
      COALESCE(DM.ACTL_GDS_MOVMT_DT, '9999-12-31'),
      COALESCE(DM.DELV_PRTY, 0),
      COALESCE(DM.DELV_QTY, 0.000),
      COALESCE(DM.GDS_ISS_DATE, '9999-12-31'),
      COALESCE(DM.RCVG_STE_DELV, 'n/a'),
      COALESCE(DM.HDR_REC_CRTD_DT, '9999-12-31'),
      COALESCE(DM.REF_DOC_ITM_NBR, 0),
      COALESCE(DM.REF_DOC_NBR, 'n/a'),
      COALESCE(DM.SHP_RCVG_PT, 'n/a'),
      COALESCE(DM.GDS_MOVMT_CNTL, 'n/a'),
      COALESCE(DM.MOVMT_IND, 'n/a'),
      COALESCE(DM.POD_IND, 'n/a'),
      COALESCE(DM.POD_RLSE_IND, 'n/a'),
      COALESCE(DM.RECV_LOC_NBR, 'n/a'),
      COALESCE(DM.TRANSP_TYPE, 'n/a'),
      COALESCE(DM.TRANSP_ID, 'n/a'),
      COALESCE(HM.INTL_HNDLG_UNT_NBR, 'n/a'),
      COALESCE(HM.EXT_HNDLG_UNT_NBR, 'n/a'),
      COALESCE(HM.EXT_HNDLG_UNT_NBR_2, 'n/a'),
      COALESCE(HM.EXT_HNDLG_UNT_TYPE, 'n/a'),
      COALESCE(HM.PCKG_MAT_TYPE, 'n/a'),
      COALESCE(HM.PCKD_QTY, 0.000),
      COALESCE(HM.PCKD_UOM, 'n/a'),
      COALESCE(IUM.NUMERATOR, 0.00),
      COALESCE(HM.GRS_WGT, 0.000),
      COALESCE(HM.WGT_UNT, 'n/a'),
      COALESCE(HM.LEN, 0.000),
      COALESCE(HM.WDT, 0.000),
      COALESCE(HM.HGT, 0.000),
      COALESCE(HM.DIM_UOM, 'n/a'),
      COALESCE(HM.REC_CHGD_DT, '9999-12-31'),
      COALESCE(HM.HNDLG_UNT_STAT, 'n/a'),
      COALESCE(HM.BOL_DT, '9999-12-31'),
      COALESCE(HM.STR_DT, '9999-12-31'),
      COALESCE(HM.DA_SCAN_DT, '9999-12-31'),
      COALESCE(HM.LOAD_NBR, 0),
      COALESCE(
        CASE
          WHEN TRIM(PO.VEND_ACCT_ID) = '' THEN NULL
          ELSE TRIM(PO.VEND_ACCT_ID)
        END,
        'n/a'
      ) AS SUPL_LOC_NBR,
      COALESCE(PO.LOC_NBR, 'n/a') AS RECV_LOC_NBR,
      'stock_transfer_intra_company' AS BUSINESS_PROCESS,
      'dc_brand' AS TO_NODE,
      PO.PURCH_DOC_TYPE_CD AS PO_DOC_TYP
    FROM
      (
        SELECT
          *
        FROM
          SCCT_DB.PO_MASTER
        WHERE
          PURCH_DOC_TYPE_CD = 'ub'
          AND (
            DEL_IND <> 'l'
            OR DEL_IND = 'l'
            AND GR_QTY > 0
          )
          AND VEND_ACCT_ID <> 'n/a'
          AND LOC_NBR <> 'n/a'
      ) AS PO
      INNER JOIN (
        SELECT
          *
        FROM
          SCCT_DB.LOCATION_MASTER
        WHERE
          LOC_TYP_CD = '01'
      ) AS A ON PO.VEND_ACCT_ID = A.LOC_NBR
      INNER JOIN (
        SELECT
          *
        FROM
          SCCT_DB.LOCATION_MASTER
        WHERE
          LOC_TYP_CD = '01'
      ) AS B ON PO.LOC_NBR = B.LOC_NBR
      LEFT JOIN (
        SELECT
          *
        FROM
          SCCT_DB.DELIVERY_MASTER
        WHERE
          DEL_IND <> 'd'
          AND DEL_TYPE NOT IN ('el', 'elst')
          AND ITM_NBR <> '0'
      ) AS DM ON PO.PURCH_ORD_NBR = DM.REF_DOC_NBR
      AND PO.PURCH_ORD_ITM_NBR = DM.REF_DOC_ITM_NBR
      AND PO.ITM_NBR = DM.ITM_NBR
      LEFT JOIN (
        SELECT
          *
        FROM
          SCCT_DB.HANDLING_MASTER
        WHERE
          ITM_NBR <> '0'
      ) AS HM ON DM.DELV_DOC_ITM_NBR = HM.DELV_DOC_ITM_NBR
      AND DM.DELV_DOC_NBR = HM.DELV_DOC_NBR
      AND PO.ITM_NBR = HM.ITM_NBR
      LEFT JOIN (
        SELECT
          *
        FROM
          SCCT_DB.ITEM_UNIT_MEASURE_MASTERWHERE TRIM(ITM_NBR) <> ''
      ) AS IUM ON DM.ITM_NBR = IUM.ITM_NBR
      AND HM.PCKD_UOM = IUM.ALT_UOM
  );]]></Sql>
<Condition action="exit" if="ERRORCODE != 0" value="ERRORCODE"/>
<Print><![CDATA[completed po_so_dd_hu_details data load;]]></Print>
</Step>
</SnowBlock>
<SnowBlock id="4">
<Step id="po_so_dd_hu_details_4">
<Sql><![CDATA[INSERT
  OVERWRITE INTO SCCT_DB.PO_SO_DD_HU_DETAILS (
    SELECT
      'dc' AS SPPLY_CHN_ND,
      'dc_brand' AS FROM_NODE,
      PO.PURCH_ORD_NBR,
      PO.PURCH_ORD_ITM_NBR,
      COALESCE(PO.DEL_IND, DM.DEL_IND, 'n/a') AS DEL_IND,
      COALESCE(PO.ITM_NBR, DM.ITM_NBR, HM.ITM_NBR, '0') AS ITM_NBR,
      COALESCE(PO.CO_CD, 'n/a'),
      COALESCE(PO.LOC_NBR, 'n/a'),
      COALESCE(PO.PURCH_ORD_QTY, 0.000),
      COALESCE(PO.PURCH_ORD_QTY_UOM, 'n/a'),
      COALESCE(PO.ORD_UNT_NMRTR_CONVN_NBR, 0),
      COALESCE(PO.BASE_UNT_NMRTR_CONVN_NBR, 0),
      COALESCE(PO.NET_ORD_VAL_CURCY, 0.00),
      COALESCE(PO.DELV_COMPLN_IND, 'n/a'),
      COALESCE(PO.BASE_UOM_CD, 'n/a'),
      COALESCE(
        PO.PURCH_ORD_QTY * PO.BASE_UNT_NMRTR_CONVN_NBR / PO.BASE_UNT_DNMNTR_CONVN_NBR,
        0.000
      ),
      COALESCE(PO.MAST_OWNSHP_DT, '9999-12-31'),
      COALESCE(PO.ORIG_MAST_OWNSHP_DT, '9999-12-31'),
      COALESCE(PO.PURCH_DOC_TYPE_CD, 'n/a'),
      COALESCE(
        CASE
          WHEN TRIM(PO.VEND_ACCT_ID) = '' THEN NULL
          ELSE TRIM(PO.VEND_ACCT_ID)
        END,
        'n/a'
      ),
      COALESCE(PO.PURCHG_ORG_CD, 'n/a'),
      COALESCE(PO.PURCHG_GRP_CD, 'n/a'),
      COALESCE(PO.CUST_NBR, 'n/a'),
      COALESCE(PO.INCTRM_1, DM.INCTRM_1, 'n/a'),
      COALESCE(PO.INCTRM_2, DM.INCTRM_2, 'n/a'),
      COALESCE(PO.OUR_REF, 'n/a'),
      COALESCE(PO.TRANSP_MODE, 'n/a'),
      COALESCE(PO.SLS_ORD_NBR, 'n/a'),
      COALESCE(PO.SLS_ORD_ITM_NBR, 0),
      COALESCE(PO.COORIG, 'n/a'),
      COALESCE(PO.NDC_DT, '9999-12-31'),
      COALESCE(PO.STAT_NDC_DT, '9999-12-31'),
      COALESCE(PO.PO_CREATE_DT, '9999-12-31'),
      COALESCE(PO.SHIP_TO_LOC_NBR, 'n/a'),
      COALESCE(PO.REC_CRTD_DT, HM.REC_CRTD_DT, '9999-12-31') AS REC_CRTD_DT,
      COALESCE(PO.FLOORSET_DT, '9999-12-31'),
      'n/a' AS SO_SLS_ORD_NBR,
      0 AS SO_SLS_ORD_ITM_NBR,
      'n/a' AS SO_ITM_NBR,
      0.00 AS SO_NET_VAL,
      0.000 AS SO_ORD_QTY_SLS_UNT,
      'n/a' AS SO_RECV_LOC_NBR,
      '9999-12-31' AS SO_REC_CRTD_DT,
      'n/a' AS SO_REC_CRTD_ID,
      0.00 AS SO_COST,
      '9999-12-31' AS SO_REQSTD_DT,
      'n/a' AS SO_CUST_PRCH_NBR,
      'n/a' AS SO_SHIP_TO_LOC_NBR,
      'n/a' AS SO_CNTRY_CD,
      'n/a' AS SO_SLS_DOC_TYPE,
      COALESCE(DM.DELV_DOC_NBR, HM.DELV_DOC_NBR, 'n/a') AS DELV_DOC_NBR,
      COALESCE(DM.DELV_DOC_ITM_NBR, HM.DELV_DOC_ITM_NBR, 0) AS DELV_DOC_ITM_NBR,
      COALESCE(DM.DEL_TYPE, 'n/a'),
      COALESCE(DM.ACT_DELV_QTY, 0.000),
      COALESCE(DM.ACTL_GDS_MOVMT_DT, '9999-12-31'),
      COALESCE(DM.DELV_PRTY, 0),
      COALESCE(DM.DELV_QTY, 0.000),
      COALESCE(DM.GDS_ISS_DATE, '9999-12-31'),
      COALESCE(DM.RCVG_STE_DELV, 'n/a'),
      COALESCE(DM.HDR_REC_CRTD_DT, '9999-12-31'),
      COALESCE(DM.REF_DOC_ITM_NBR, 0),
      COALESCE(DM.REF_DOC_NBR, 'n/a'),
      COALESCE(DM.SHP_RCVG_PT, 'n/a'),
      COALESCE(DM.GDS_MOVMT_CNTL, 'n/a'),
      COALESCE(DM.MOVMT_IND, 'n/a'),
      COALESCE(DM.POD_IND, 'n/a'),
      COALESCE(DM.POD_RLSE_IND, 'n/a'),
      COALESCE(DM.RECV_LOC_NBR, 'n/a'),
      COALESCE(DM.TRANSP_TYPE, 'n/a'),
      COALESCE(DM.TRANSP_ID, 'n/a'),
      COALESCE(HM.INTL_HNDLG_UNT_NBR, 'n/a'),
      COALESCE(HM.EXT_HNDLG_UNT_NBR, 'n/a'),
      COALESCE(HM.EXT_HNDLG_UNT_NBR_2, 'n/a'),
      COALESCE(HM.EXT_HNDLG_UNT_TYPE, 'n/a'),
      COALESCE(HM.PCKG_MAT_TYPE, 'n/a'),
      COALESCE(HM.PCKD_QTY, 0.000),
      COALESCE(HM.PCKD_UOM, 'n/a'),
      COALESCE(IUM.NUMERATOR, 0.00),
      COALESCE(HM.GRS_WGT, 0.000),
      COALESCE(HM.WGT_UNT, 'n/a'),
      COALESCE(HM.LEN, 0.000),
      COALESCE(HM.WDT, 0.000),
      COALESCE(HM.HGT, 0.000),
      COALESCE(HM.DIM_UOM, 'n/a'),
      COALESCE(HM.REC_CHGD_DT, '9999-12-31'),
      COALESCE(HM.HNDLG_UNT_STAT, 'n/a'),
      COALESCE(HM.BOL_DT, '9999-12-31'),
      COALESCE(HM.STR_DT, '9999-12-31'),
      COALESCE(HM.DA_SCAN_DT, '9999-12-31'),
      COALESCE(HM.LOAD_NBR, 0),
      COALESCE(
        CASE
          WHEN TRIM(PO.VEND_ACCT_ID) = '' THEN NULL
          ELSE TRIM(PO.VEND_ACCT_ID)
        END,
        'n/a'
      ) AS SUPL_LOC_NBR,
      COALESCE(PO.LOC_NBR, 'n/a') AS RECV_LOC_NBR,
      'stock_transfer_intra_company' AS BUSINESS_PROCESS,
      'dc_brand' AS TO_NODE,
      PO.PURCH_DOC_TYPE_CD AS PO_DOC_TYP
    FROM
      (
        SELECT
          *
        FROM
          SCCT_DB.PO_MASTER
        WHERE
          PURCH_DOC_TYPE_CD = 'ub'
          AND (
            DEL_IND <> 'l'
            OR DEL_IND = 'l'
            AND GR_QTY > 0
          )
          AND VEND_ACCT_ID <> 'n/a'
          AND LOC_NBR <> 'n/a'
      ) AS PO
      INNER JOIN (
        SELECT
          *
        FROM
          SCCT_DB.LOCATION_MASTER
        WHERE
          LOC_TYP_CD = '01'
      ) AS A ON PO.VEND_ACCT_ID = A.LOC_NBR
      INNER JOIN (
        SELECT
          *
        FROM
          SCCT_DB.LOCATION_MASTER
        WHERE
          LOC_TYP_CD = '01'
      ) AS B ON PO.LOC_NBR = B.LOC_NBR
      LEFT JOIN (
        SELECT
          *
        FROM
          SCCT_DB.DELIVERY_MASTER
        WHERE
          DEL_IND <> 'd'
          AND DEL_TYPE NOT IN ('el', 'elst')
          AND ITM_NBR <> '0'
      ) AS DM ON PO.PURCH_ORD_NBR = DM.REF_DOC_NBR
      AND PO.PURCH_ORD_ITM_NBR = DM.REF_DOC_ITM_NBR
      AND PO.ITM_NBR = DM.ITM_NBR
      LEFT JOIN (
        SELECT
          *
        FROM
          SCCT_DB.HANDLING_MASTER
        WHERE
          ITM_NBR <> '0'
      ) AS HM ON DM.DELV_DOC_ITM_NBR = HM.DELV_DOC_ITM_NBR
      AND DM.DELV_DOC_NBR = HM.DELV_DOC_NBR
      AND PO.ITM_NBR = HM.ITM_NBR
      LEFT JOIN (
        SELECT
          *
        FROM
          SCCT_DB.ITEM_UNIT_MEASURE_MASTERWHERE TRIM(ITM_NBR) <> ''
      ) AS IUM ON DM.ITM_NBR = IUM.ITM_NBR
      AND HM.PCKD_UOM = IUM.ALT_UOM
  );]]></Sql>
<Condition action="exit" if="ERRORCODE != 0" value="ERRORCODE"/>
</Step>
<Step id="po_so_dd_hu_details_5"><![CDATA[end script]]></Step>
</SnowBlock>
</SnowBlocks>
