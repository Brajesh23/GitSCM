<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<SnowBlocks>
<SnowBlock id="1">
<Step id="po_so_dd_hu_details_1">
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Sql>![CDATA[---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_store -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2922 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  -- 01.00.00.04 17jan21 scctp-601 kaali m replaced handling_master table with handling_master_poso  ----------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;]]</Sql>
<Condition if="ERRORCODE != 0 action=exit value=ERRORCODE"/>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
</Step>
</SnowBlock>
<SnowBlock id="2">
<Step id="po_so_dd_hu_details_2">
<Sql>![CDATA[---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_store_intra -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-3287 ssoma dc to store intra initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  -- 01.00.00.04 17jan21 scctp-601 kaali m replaced handling_master table with handling_master_poso  ----------------------------------------------------------------------------   ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;]]</Sql>
<Condition if="ERRORCODE != 0 action=exit value=ERRORCODE"/>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details for mast beauty production;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_kpi_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_kpi_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_kpi_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_kpi_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_kpi_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_kpi_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_kpi_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_kpi_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.prepack_component ;]]</Print>
</Step>
</SnowBlock>
<SnowBlock id="3">
<Step id="po_so_dd_hu_details_3">
<Sql>![CDATA[INSERT
  OVERWRITE INTO SCCT_DB.PREPACK_COMPONENT (
    SELECT
      COALESCE(
        CASE
          WHEN TRIM(A.BOM_ITEM_NBR) = '' THEN NULL
          ELSE TRIM(A.BOM_ITEM_NBR)
        END,
        'n/a'
      ) AS PPCK_ITM_NBR,
      COALESCE(
        CASE
          WHEN TRIM(B.BOM_CPNT_ITEM_NBR) = '' THEN NULL
          ELSE TRIM(B.BOM_CPNT_ITEM_NBR)
        END,
        'n/a'
      ) AS PPCK_CPNT_ITM_NBR,
      COALESCE(
        CASE
          WHEN B.BOM_CPNT_QTY = '' THEN NULL
          ELSE B.BOM_CPNT_QTY
        END,
        0.00
      ) AS PPCK_CPNT_ITEM_QTY,
      COALESCE(
        CASE
          WHEN TRIM(B.BOM_CPNT_UNT_OF_MEAS_CD) = '' THEN NULL
          ELSE TRIM(B.BOM_CPNT_UNT_OF_MEAS_CD)
        END,
        'n/a'
      ) AS PPCK_CPNT_UNT_OF_MEAS
    FROM
      SCCT_DB.BOM_ITEM AS A
      INNER JOIN SCCT_DB.BOM_DETAIL AS B ON A.BOM_NBR = B.BOM_NBR
      INNER JOIN ANALYTICS_VIEW.ITEM AS C ON A.BOM_ITEM_NBR = C.ITEM_NUMBER
    WHERE
      C.ITEM_TYPE_CODE = 'zpre'
    GROUP BY
      A.BOM_ITEM_NBR,
      B.BOM_CPNT_ITEM_NBR,
      B.BOM_CPNT_QTY,
      B.BOM_CPNT_UNT_OF_MEAS_CD
  );]]</Sql>
<Condition if="ERRORCODE != 0 action=exit value=ERRORCODE"/>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
</Step>
</SnowBlock>
<SnowBlock id="4">
<Step id="po_so_dd_hu_details_4">
<Sql>![CDATA[---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_store -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2922 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  -- 01.00.00.04 17jan21 scctp-601 kaali m replaced handling_master table with handling_master_poso  ----------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;]]</Sql>
<Condition if="ERRORCODE != 0 action=exit value=ERRORCODE"/>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
</Step>
</SnowBlock>
<SnowBlock id="5">
<Step id="po_so_dd_hu_details_5">
<Sql>![CDATA[---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_store_intra -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-3287 ssoma dc to store intra initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  -- 01.00.00.04 17jan21 scctp-601 kaali m replaced handling_master table with handling_master_poso  ----------------------------------------------------------------------------   ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;]]</Sql>
<Condition if="ERRORCODE != 0 action=exit value=ERRORCODE"/>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details for mast beauty production;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_kpi_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_kpi_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_kpi_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_kpi_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_kpi_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_kpi_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.po_so_dd_hu_kpi_details;]]</Print>
<Print>![CDATA[completed po_so_dd_hu_kpi_details data load;]]</Print>
<Print>![CDATA[started loading into scct_db.prepack_component ;]]</Print>
</Step>
</SnowBlock>
<SnowBlock id="6">
<Step id="po_so_dd_hu_details_6">
<Sql>![CDATA[INSERT
  OVERWRITE INTO SCCT_DB.PREPACK_COMPONENT (
    SELECT
      COALESCE(
        CASE
          WHEN TRIM(A.BOM_ITEM_NBR) = '' THEN NULL
          ELSE TRIM(A.BOM_ITEM_NBR)
        END,
        'n/a'
      ) AS PPCK_ITM_NBR,
      COALESCE(
        CASE
          WHEN TRIM(B.BOM_CPNT_ITEM_NBR) = '' THEN NULL
          ELSE TRIM(B.BOM_CPNT_ITEM_NBR)
        END,
        'n/a'
      ) AS PPCK_CPNT_ITM_NBR,
      COALESCE(
        CASE
          WHEN B.BOM_CPNT_QTY = '' THEN NULL
          ELSE B.BOM_CPNT_QTY
        END,
        0.00
      ) AS PPCK_CPNT_ITEM_QTY,
      COALESCE(
        CASE
          WHEN TRIM(B.BOM_CPNT_UNT_OF_MEAS_CD) = '' THEN NULL
          ELSE TRIM(B.BOM_CPNT_UNT_OF_MEAS_CD)
        END,
        'n/a'
      ) AS PPCK_CPNT_UNT_OF_MEAS
    FROM
      SCCT_DB.BOM_ITEM AS A
      INNER JOIN SCCT_DB.BOM_DETAIL AS B ON A.BOM_NBR = B.BOM_NBR
      INNER JOIN ANALYTICS_VIEW.ITEM AS C ON A.BOM_ITEM_NBR = C.ITEM_NUMBER
    WHERE
      C.ITEM_TYPE_CODE = 'zpre'
    GROUP BY
      A.BOM_ITEM_NBR,
      B.BOM_CPNT_ITEM_NBR,
      B.BOM_CPNT_QTY,
      B.BOM_CPNT_UNT_OF_MEAS_CD
  );]]</Sql>
<Condition if="ERRORCODE != 0 action=exit value=ERRORCODE"/>
</Step>
<Step id="po_so_dd_hu_details_7">
<Comment>![CDATA[end script]]</Comment>
</Step>
</SnowBlock>
</SnowBlocks>
