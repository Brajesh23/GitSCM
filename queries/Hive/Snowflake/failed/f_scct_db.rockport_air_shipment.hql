! echo entry into job control table completed;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_air_shipment -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_air_shipment ---source: rockport_stage0 table : trader_shipping_hdr, trader_shipping_dtl, trader_party, trader_plci3225 --- trader_packing, trader_delivery_dtl and trader_matrix_hdr;
---load type: full ---back posting: no ---author: ssoma ---created date: 02/05/2019 --------------------------------------------------------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading work table scct_db.trader_plci3225_work  -------------------------  set tez.job.name=work:trader_plci3225_work:load work table trader_plci3225_work;
! echo started loading into scct_work_db.trader_plci3225_work;
insert overwrite table scct_work_db.trader_plci3225_work  select owner ,place_code ,place_name from ( select owner ,place_code ,place_name ,row_number () over (partition by trim(owner), trim(place_code) order by from_unixtime(last_update div 1000, 'yyyy-mm-dd hh:mm:ss') desc ) row_num from rockport_stage0.trader_plci3225 ) a where a.row_num=1
! echo completed loading into scct_work_db.trader_plci3225_work;
------------------------- ---loading stage1 table scct_db.rockport_air_shipment  -------------------------  set tez.job.name=stage1:rockport_air_shipment_work:load work table rockport_air_shipment_work;
! echo started loading into scct_work_db.rockport_air_shipment_work;
insert overwrite table scct_work_db.rockport_air_shipment_work select coalesce(case when trim(sh.bill_of_lading_no)='' then null else trim(sh.bill_of_lading_no) end, 'n/a') as mawb_nbr ,coalesce(case when trim(sd.equip_id)='' then null else trim(sd.equip_id) end, 'n/a') as hawb_nbr ,coalesce(case when trim(sd.ref_no)='' then null else trim(sd.ref_no) end, 'n/a') as ref_nbr ,coalesce(case when trim(sd.item)='' then null else trim(sd.item) end, 'n/a') as itm_nbr ,coalesce(case when trim(sh.transport_mode)='' then null else trim(sh.transport_mode) end, 'n/a') as shipping_method ,coalesce(case when trim(sh.id_means_of_transp)='' then null else trim(sh.id_means_of_transp) end, 'n/a') as flight_nbr ,coalesce(case when trim(sh.owner)='' then null else trim(sh.owner) end, 'n/a') as forwarder_id ,coalesce(case when trim(pa1.party_name_line1)='' then null else trim(pa1.party_name_line1) end, 'n/a') as forwarder_name ,coalesce(case when trim(sh.carrier)='' then null else trim(sh.carrier) end, 'n/a') as carrier_cd ,coalesce(case when trim(sh.load_point)='' then null else trim(sh.load_point) end, 'n/a') as port_of_lading_id ,coalesce(case when trim(pc1.place_name)='' then null else trim(pc1.place_name) end, 'n/a') as port_of_lading_name ,coalesce(case when trim(sh.state_province)='' then null else trim(sh.state_province) end, 'n/a') as port_of_discharge_id ,coalesce(case when trim(pc2.place_name)='' then null else trim(pc2.place_name) end, 'n/a') as port_of_discharge_name ,coalesce(case when trim(sh.final_dest)='' then null else trim(sh.final_dest) end, 'n/a') as destination_id ,coalesce(case when trim(pc3.place_name)='' then null else trim(pc3.place_name) end, 'n/a') as destination_name ,coalesce(case when trim(sd.measurement_val)='' then null else trim(sd.measurement_val) end, 0.00) as dim_wgt  ,coalesce(case when trim(sd.equip_meas_um)='' then null else trim(sd.equip_meas_um) end, 'n/a') as dim_wgt_uom ,coalesce(case when trim(sd.equip_weight_val)='' then null else trim(sd.equip_weight_val) end, 0.00) as gross_wgt ,coalesce(case when trim(sd.equip_weight_um)='' then null else trim(sd.equip_weight_um) end, 'n/a') as gross_wgt_uom ,coalesce(case when trim(p1.qty_per_pack)='' then null else trim(p1.qty_per_pack) end, 0.00) as total_cartons ,coalesce(to_utc_timestamp(from_unixtime(sh.export_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as actual_depart_dtm ,coalesce(to_utc_timestamp(from_unixtime(sh.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as transmission_dtm ,coalesce(to_utc_timestamp(from_unixtime(sh.act_arrive_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as eta_dtm ,coalesce(to_utc_timestamp(from_unixtime(dd1.recd_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as cargo_receipt_dtm ,coalesce(to_utc_timestamp(from_unixtime(dd2.last_delivery_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as docs_available_dtm ,coalesce(case when trim(sd.status)='' then null else trim(sd.status) end, 'n/a') as brand ,coalesce(case when trim(sd.deliver_to)='' then null else trim(sd.deliver_to) end, 'n/a') as deliver_to ,coalesce(coalesce(sd.contract_no,sd.order_no), 'n/a') as po_nbr ,coalesce(case when trim(sd.contract_no)='' then null else trim(sd.contract_no) end, 'n/a') as contract_nbr ,coalesce(case when trim(sd.order_no)='' then null else trim(sd.order_no) end, 'n/a') as order_nbr ,coalesce(case when trim(mh.matrix_total)='' then null else trim(mh.matrix_total) end, 0.00) as po_unit  ,coalesce(case when trim(p2.pack_id_qty)='' then null else trim(p2.pack_id_qty) end, 0.00) as po_cartons_qty  ,coalesce(case when trim(p2.total_wgt_pack_id)='' then null else trim(p2.total_wgt_pack_id) end, 0.00) as po_gross_wgt  ,coalesce(case when trim(p2.total_wgt_um)='' then null else trim(p2.total_wgt_um)end, 'n/a') as po_gross_wgt_uom  ,coalesce(case when trim(p2.line_wgt)='' then null else trim(p2.line_wgt) end, 0.00) as po_dim_wgt  ,coalesce(case when trim(p2.line_wgt_um)='' then null else trim(p2.line_wgt_um) end, 'n/a') as po_dim_wgt_uom  ,coalesce(case when trim(p2.net_wgt_unit)='' then null else trim(p2.net_wgt_unit) end, 0.00) as po_chargeable_wgt  ,coalesce(case when trim(p2.net_wgt_unit_um)='' then null else trim(p2.net_wgt_unit_um)end, 'n/a') as po_chargeable_wgt_uom  ,coalesce(case when trim(p2.pkg_type)='' then null else trim(p2.pkg_type) end, 'n/a') as garment_pack ,coalesce(case when trim(p3.sample_carton)='' then null else trim(p3.sample_carton) end, 'n/a') as pre_tkt ,coalesce(to_utc_timestamp(from_unixtime(sh.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(from_unixtime(sd.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm from rockport_stage0.trader_shipping_hdr sh left join rockport_stage0.trader_shipping_dtl sd on sh.owner=sd.owner and sh.bill_of_lading_no=sd.bill_of_lading_no left join rockport_stage0.trader_party pa1 on pa1.party_id=sh.owner left join scct_work_db.trader_plci3225_work pc1 on pc1.place_code=sh.load_point left join scct_work_db.trader_plci3225_work pc2 on pc2.place_code=sh.state_province left join scct_work_db.trader_plci3225_work pc3 on pc3.place_code=sh.final_dest left join rockport_stage0.trader_packing p1 on p1.owner=sh.owner and p1.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and p1.pack_id=sd.equip_id left join rockport_stage0.trader_packing p2 on p2.owner=sh.owner and p2.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and p2.pack_id=coalesce(sd.contract_no,sd.order_no) left join rockport_stage0.trader_packing p3 on p3.owner=sh.owner and p3.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no,' + ',sd.item,' + ',sd.item) and p3.pack_id=sd.item left join rockport_stage0.trader_delivery_dtl dd1 on dd1.owner=sh.owner and dd1.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and dd1.delivery_id=sd.equip_id and dd1.delivery_no='e1' left join rockport_stage0.trader_delivery_dtl dd2 on dd2.owner=sh.owner and dd2.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no) left join rockport_stage0.trader_matrix_hdr mh on mh.owner=sd.owner and mh.link_key_val=concat(sd.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no,' + ',sd.item,' + ',sd.item,' + ',sd.item) where sh.transport_mode='a' and sh.owner not like 'cfs%'
! echo completed loading into scct_work_db.rockport_air_shipment_work;
! echo started loading into scct_work_db.rockport_air_shipment_work1;
insert overwrite table scct_work_db.rockport_air_shipment_work1 select  rasw1.mawb_nbr ,rasw1.hawb_nbr ,rasw1.ref_nbr ,coalesce(i.item_number,rasw1.itm_nbr) ,rasw1.shipping_method ,rasw1.flight_nbr ,rasw1.forwarder_id ,rasw1.forwarder_name ,rasw1.carrier_cd ,rasw1.port_of_lading_id ,rasw1.port_of_lading_name ,rasw1.port_of_discharge_id ,rasw1.port_of_discharge_name ,rasw1.destination_id ,rasw1.destination_name ,rasw1.dim_wgt ,rasw1.dim_wgt_uom ,rasw1.gross_wgt ,rasw1.gross_wgt_uom ,rasw1.total_cartons ,rasw1.actual_depart_dtm ,rasw1.transmission_dtm ,rasw1.eta_dtm ,rasw1.cargo_receipt_dtm ,rasw1.docs_available_dtm ,rasw1.brand ,rasw1.deliver_to ,rasw1.po_nbr ,rasw1.contract_nbr ,rasw1.order_nbr ,rasw1.po_unit ,rasw1.po_cartons_qty ,rasw1.po_gross_wgt ,rasw1.po_gross_wgt_uom ,rasw1.po_dim_wgt ,rasw1.po_dim_wgt_uom ,rasw1.po_chargeable_wgt ,rasw1.po_chargeable_wgt_uom ,rasw1.garment_pack ,rasw1.pre_tkt ,rasw1.header_last_upd_dtm ,rasw1.detail_last_upd_dtm from  (select  rasw.mawb_nbr ,rasw.hawb_nbr ,rasw.ref_nbr ,rasw.itm_nbr ,rasw.shipping_method ,rasw.flight_nbr ,rasw.forwarder_id ,rasw.forwarder_name ,rasw.carrier_cd ,rasw.port_of_lading_id ,rasw.port_of_lading_name ,rasw.port_of_discharge_id ,rasw.port_of_discharge_name ,rasw.destination_id ,rasw.destination_name ,rasw.dim_wgt ,rasw.dim_wgt_uom ,rasw.gross_wgt ,rasw.gross_wgt_uom ,rasw.total_cartons ,rasw.actual_depart_dtm ,rasw.transmission_dtm ,rasw.eta_dtm ,rasw.cargo_receipt_dtm ,rasw.docs_available_dtm ,rasw.brand ,rasw.deliver_to ,rasw.po_nbr ,rasw.contract_nbr ,rasw.order_nbr ,rasw.po_unit ,rasw.po_cartons_qty ,rasw.po_gross_wgt ,rasw.po_gross_wgt_uom ,rasw.po_dim_wgt ,rasw.po_dim_wgt_uom ,rasw.po_chargeable_wgt ,rasw.po_chargeable_wgt_uom ,rasw.garment_pack ,rasw.pre_tkt ,rasw.header_last_upd_dtm ,rasw.detail_last_upd_dtm from  (select mawb_nbr ,hawb_nbr ,ref_nbr ,itm_nbr ,shipping_method ,flight_nbr ,forwarder_id ,forwarder_name ,carrier_cd ,port_of_lading_id ,port_of_lading_name ,port_of_discharge_id ,port_of_discharge_name ,destination_id ,destination_name ,dim_wgt ,dim_wgt_uom ,gross_wgt ,gross_wgt_uom ,total_cartons ,actual_depart_dtm ,transmission_dtm ,eta_dtm ,cargo_receipt_dtm ,docs_available_dtm ,brand ,deliver_to ,po_nbr ,contract_nbr ,order_nbr ,po_unit ,po_cartons_qty ,po_gross_wgt ,po_gross_wgt_uom ,po_dim_wgt ,po_dim_wgt_uom ,po_chargeable_wgt ,po_chargeable_wgt_uom ,garment_pack ,pre_tkt ,header_last_upd_dtm ,detail_last_upd_dtm ,row_number() over(partition by mawb_nbr,hawb_nbr,forwarder_id,contract_nbr,order_nbr,ref_nbr,itm_nbr order by detail_last_upd_dtm desc ) row_num from scct_work_db.rockport_air_shipment_work ) rasw where rasw.row_num=1)rasw1 left outer join analytics_view.item i on trim(rasw1.itm_nbr) = trim(substring(i.item_number,-8))
! echo completed loading into scct_work_db.rockport_air_shipment_work1;
! echo started loading into scct_db.rockport_air_shipment;
insert overwrite table scct_db.rockport_air_shipment select coalesce(rasw.mawb_nbr, ras.mawb_nbr) ,coalesce(rasw.hawb_nbr, ras.hawb_nbr) ,coalesce(rasw.ref_nbr, ras.ref_nbr) ,coalesce(rasw.itm_nbr, ras.itm_nbr) ,coalesce(rasw.shipping_method, ras.shipping_method) ,coalesce(rasw.flight_nbr, ras.flight_nbr) ,coalesce(rasw.forwarder_id, ras.forwarder_id) ,coalesce(rasw.forwarder_name, ras.forwarder_name) ,coalesce(rasw.carrier_cd, ras.carrier_cd) ,coalesce(rasw.port_of_lading_id, ras.port_of_lading_id) ,coalesce(rasw.port_of_lading_name, ras.port_of_lading_name) ,coalesce(rasw.port_of_discharge_id, ras.port_of_discharge_id) ,coalesce(rasw.port_of_discharge_name, ras.port_of_discharge_name) ,coalesce(rasw.destination_id, ras.destination_id) ,coalesce(rasw.destination_name, ras.destination_name) ,coalesce(rasw.dim_wgt, ras.dim_wgt) ,coalesce(rasw.dim_wgt_uom, ras.dim_wgt_uom) ,coalesce(rasw.gross_wgt, ras.gross_wgt) ,coalesce(rasw.gross_wgt_uom, ras.gross_wgt_uom) ,coalesce(rasw.total_cartons, ras.total_cartons) ,coalesce(rasw.actual_depart_dtm, ras.actual_depart_dtm) ,coalesce(rasw.transmission_dtm, ras.transmission_dtm) ,coalesce(rasw.eta_dtm, ras.eta_dtm) ,coalesce(rasw.cargo_receipt_dtm, ras.cargo_receipt_dtm) ,coalesce(rasw.docs_available_dtm, ras.docs_available_dtm) ,coalesce(rasw.brand, ras.brand) ,coalesce(rasw.deliver_to, ras.deliver_to) ,coalesce(rasw.po_nbr, ras.po_nbr) ,coalesce(rasw.contract_nbr, ras.contract_nbr) ,coalesce(rasw.order_nbr, ras.order_nbr) ,coalesce(rasw.po_unit, ras.po_unit) ,coalesce(rasw.po_cartons_qty, ras.po_cartons_qty) ,coalesce(rasw.po_gross_wgt, ras.po_gross_wgt) ,coalesce(rasw.po_gross_wgt_uom, ras.po_gross_wgt_uom) ,coalesce(rasw.po_dim_wgt, ras.po_dim_wgt) ,coalesce(rasw.po_dim_wgt_uom, ras.po_dim_wgt_uom) ,coalesce(rasw.po_chargeable_wgt, ras.po_chargeable_wgt) ,coalesce(rasw.po_chargeable_wgt_uom, ras.po_chargeable_wgt_uom) ,coalesce(rasw.garment_pack, ras.garment_pack) ,coalesce(rasw.pre_tkt, ras.pre_tkt) ,coalesce(rasw.header_last_upd_dtm, ras.header_last_upd_dtm) ,coalesce(rasw.detail_last_upd_dtm, ras.detail_last_upd_dtm) from scct_work_db.rockport_air_shipment_work1 rasw full join scct_db.rockport_air_shipment ras  on rasw.mawb_nbr=ras.mawb_nbr  and rasw.forwarder_id=ras.forwarder_id and rasw.hawb_nbr=ras.hawb_nbr and rasw.contract_nbr=ras.contract_nbr and rasw.order_nbr=ras.order_nbr and rasw.ref_nbr=ras.ref_nbr and rasw.itm_nbr=ras.itm_nbr
! echo completed loading into scct_db.rockport_air_shipment;
! echo entry into job control table completed;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_air_shipment -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_air_shipment ---source: rockport_stage0 table : trader_shipping_hdr, trader_shipping_dtl, trader_party, trader_plci3225 --- trader_packing, trader_delivery_dtl and trader_matrix_hdr;
---load type: full ---back posting: no ---author: ssoma ---created date: 02/05/2019 --------------------------------------------------------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading work table scct_db.trader_plci3225_work  -------------------------  set tez.job.name=work:trader_plci3225_work:load work table trader_plci3225_work;
! echo started loading into scct_work_db.trader_plci3225_work;
insert overwrite table scct_work_db.trader_plci3225_work  select owner ,place_code ,place_name from ( select owner ,place_code ,place_name ,row_number () over (partition by trim(owner), trim(place_code) order by from_unixtime(last_update div 1000, 'yyyy-mm-dd hh:mm:ss') desc ) row_num from rockport_stage0.trader_plci3225 ) a where a.row_num=1
! echo completed loading into scct_work_db.trader_plci3225_work;
------------------------- ---loading stage1 table scct_db.rockport_air_shipment  -------------------------  set tez.job.name=stage1:rockport_air_shipment_work:load work table rockport_air_shipment_work;
! echo started loading into scct_work_db.rockport_air_shipment_work;
insert overwrite table scct_work_db.rockport_air_shipment_work select coalesce(case when trim(sh.bill_of_lading_no)='' then null else trim(sh.bill_of_lading_no) end, 'n/a') as mawb_nbr ,coalesce(case when trim(sd.equip_id)='' then null else trim(sd.equip_id) end, 'n/a') as hawb_nbr ,coalesce(case when trim(sd.ref_no)='' then null else trim(sd.ref_no) end, 'n/a') as ref_nbr ,coalesce(case when trim(sd.item)='' then null else trim(sd.item) end, 'n/a') as itm_nbr ,coalesce(case when trim(sh.transport_mode)='' then null else trim(sh.transport_mode) end, 'n/a') as shipping_method ,coalesce(case when trim(sh.id_means_of_transp)='' then null else trim(sh.id_means_of_transp) end, 'n/a') as flight_nbr ,coalesce(case when trim(sh.owner)='' then null else trim(sh.owner) end, 'n/a') as forwarder_id ,coalesce(case when trim(pa1.party_name_line1)='' then null else trim(pa1.party_name_line1) end, 'n/a') as forwarder_name ,coalesce(case when trim(sh.carrier)='' then null else trim(sh.carrier) end, 'n/a') as carrier_cd ,coalesce(case when trim(sh.load_point)='' then null else trim(sh.load_point) end, 'n/a') as port_of_lading_id ,coalesce(case when trim(pc1.place_name)='' then null else trim(pc1.place_name) end, 'n/a') as port_of_lading_name ,coalesce(case when trim(sh.state_province)='' then null else trim(sh.state_province) end, 'n/a') as port_of_discharge_id ,coalesce(case when trim(pc2.place_name)='' then null else trim(pc2.place_name) end, 'n/a') as port_of_discharge_name ,coalesce(case when trim(sh.final_dest)='' then null else trim(sh.final_dest) end, 'n/a') as destination_id ,coalesce(case when trim(pc3.place_name)='' then null else trim(pc3.place_name) end, 'n/a') as destination_name ,coalesce(case when trim(sd.measurement_val)='' then null else trim(sd.measurement_val) end, 0.00) as dim_wgt  ,coalesce(case when trim(sd.equip_meas_um)='' then null else trim(sd.equip_meas_um) end, 'n/a') as dim_wgt_uom ,coalesce(case when trim(sd.equip_weight_val)='' then null else trim(sd.equip_weight_val) end, 0.00) as gross_wgt ,coalesce(case when trim(sd.equip_weight_um)='' then null else trim(sd.equip_weight_um) end, 'n/a') as gross_wgt_uom ,coalesce(case when trim(p1.qty_per_pack)='' then null else trim(p1.qty_per_pack) end, 0.00) as total_cartons ,coalesce(to_utc_timestamp(from_unixtime(sh.export_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as actual_depart_dtm ,coalesce(to_utc_timestamp(from_unixtime(sh.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as transmission_dtm ,coalesce(to_utc_timestamp(from_unixtime(sh.act_arrive_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as eta_dtm ,coalesce(to_utc_timestamp(from_unixtime(dd1.recd_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as cargo_receipt_dtm ,coalesce(to_utc_timestamp(from_unixtime(dd2.last_delivery_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as docs_available_dtm ,coalesce(case when trim(sd.status)='' then null else trim(sd.status) end, 'n/a') as brand ,coalesce(case when trim(sd.deliver_to)='' then null else trim(sd.deliver_to) end, 'n/a') as deliver_to ,coalesce(coalesce(sd.contract_no,sd.order_no), 'n/a') as po_nbr ,coalesce(case when trim(sd.contract_no)='' then null else trim(sd.contract_no) end, 'n/a') as contract_nbr ,coalesce(case when trim(sd.order_no)='' then null else trim(sd.order_no) end, 'n/a') as order_nbr ,coalesce(case when trim(mh.matrix_total)='' then null else trim(mh.matrix_total) end, 0.00) as po_unit  ,coalesce(case when trim(p2.pack_id_qty)='' then null else trim(p2.pack_id_qty) end, 0.00) as po_cartons_qty  ,coalesce(case when trim(p2.total_wgt_pack_id)='' then null else trim(p2.total_wgt_pack_id) end, 0.00) as po_gross_wgt  ,coalesce(case when trim(p2.total_wgt_um)='' then null else trim(p2.total_wgt_um)end, 'n/a') as po_gross_wgt_uom  ,coalesce(case when trim(p2.line_wgt)='' then null else trim(p2.line_wgt) end, 0.00) as po_dim_wgt  ,coalesce(case when trim(p2.line_wgt_um)='' then null else trim(p2.line_wgt_um) end, 'n/a') as po_dim_wgt_uom  ,coalesce(case when trim(p2.net_wgt_unit)='' then null else trim(p2.net_wgt_unit) end, 0.00) as po_chargeable_wgt  ,coalesce(case when trim(p2.net_wgt_unit_um)='' then null else trim(p2.net_wgt_unit_um)end, 'n/a') as po_chargeable_wgt_uom  ,coalesce(case when trim(p2.pkg_type)='' then null else trim(p2.pkg_type) end, 'n/a') as garment_pack ,coalesce(case when trim(p3.sample_carton)='' then null else trim(p3.sample_carton) end, 'n/a') as pre_tkt ,coalesce(to_utc_timestamp(from_unixtime(sh.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(from_unixtime(sd.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm from rockport_stage0.trader_shipping_hdr sh left join rockport_stage0.trader_shipping_dtl sd on sh.owner=sd.owner and sh.bill_of_lading_no=sd.bill_of_lading_no left join rockport_stage0.trader_party pa1 on pa1.party_id=sh.owner left join scct_work_db.trader_plci3225_work pc1 on pc1.place_code=sh.load_point left join scct_work_db.trader_plci3225_work pc2 on pc2.place_code=sh.state_province left join scct_work_db.trader_plci3225_work pc3 on pc3.place_code=sh.final_dest left join rockport_stage0.trader_packing p1 on p1.owner=sh.owner and p1.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and p1.pack_id=sd.equip_id left join rockport_stage0.trader_packing p2 on p2.owner=sh.owner and p2.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and p2.pack_id=coalesce(sd.contract_no,sd.order_no) left join rockport_stage0.trader_packing p3 on p3.owner=sh.owner and p3.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no,' + ',sd.item,' + ',sd.item) and p3.pack_id=sd.item left join rockport_stage0.trader_delivery_dtl dd1 on dd1.owner=sh.owner and dd1.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and dd1.delivery_id=sd.equip_id and dd1.delivery_no='e1' left join rockport_stage0.trader_delivery_dtl dd2 on dd2.owner=sh.owner and dd2.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no) left join rockport_stage0.trader_matrix_hdr mh on mh.owner=sd.owner and mh.link_key_val=concat(sd.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no,' + ',sd.item,' + ',sd.item,' + ',sd.item) where sh.transport_mode='a' and sh.owner not like 'cfs%'
! echo completed loading into scct_work_db.rockport_air_shipment_work;
! echo started loading into scct_work_db.rockport_air_shipment_work1;
insert overwrite table scct_work_db.rockport_air_shipment_work1 select  rasw1.mawb_nbr ,rasw1.hawb_nbr ,rasw1.ref_nbr ,coalesce(i.item_number,rasw1.itm_nbr) ,rasw1.shipping_method ,rasw1.flight_nbr ,rasw1.forwarder_id ,rasw1.forwarder_name ,rasw1.carrier_cd ,rasw1.port_of_lading_id ,rasw1.port_of_lading_name ,rasw1.port_of_discharge_id ,rasw1.port_of_discharge_name ,rasw1.destination_id ,rasw1.destination_name ,rasw1.dim_wgt ,rasw1.dim_wgt_uom ,rasw1.gross_wgt ,rasw1.gross_wgt_uom ,rasw1.total_cartons ,rasw1.actual_depart_dtm ,rasw1.transmission_dtm ,rasw1.eta_dtm ,rasw1.cargo_receipt_dtm ,rasw1.docs_available_dtm ,rasw1.brand ,rasw1.deliver_to ,rasw1.po_nbr ,rasw1.contract_nbr ,rasw1.order_nbr ,rasw1.po_unit ,rasw1.po_cartons_qty ,rasw1.po_gross_wgt ,rasw1.po_gross_wgt_uom ,rasw1.po_dim_wgt ,rasw1.po_dim_wgt_uom ,rasw1.po_chargeable_wgt ,rasw1.po_chargeable_wgt_uom ,rasw1.garment_pack ,rasw1.pre_tkt ,rasw1.header_last_upd_dtm ,rasw1.detail_last_upd_dtm from  (select  rasw.mawb_nbr ,rasw.hawb_nbr ,rasw.ref_nbr ,rasw.itm_nbr ,rasw.shipping_method ,rasw.flight_nbr ,rasw.forwarder_id ,rasw.forwarder_name ,rasw.carrier_cd ,rasw.port_of_lading_id ,rasw.port_of_lading_name ,rasw.port_of_discharge_id ,rasw.port_of_discharge_name ,rasw.destination_id ,rasw.destination_name ,rasw.dim_wgt ,rasw.dim_wgt_uom ,rasw.gross_wgt ,rasw.gross_wgt_uom ,rasw.total_cartons ,rasw.actual_depart_dtm ,rasw.transmission_dtm ,rasw.eta_dtm ,rasw.cargo_receipt_dtm ,rasw.docs_available_dtm ,rasw.brand ,rasw.deliver_to ,rasw.po_nbr ,rasw.contract_nbr ,rasw.order_nbr ,rasw.po_unit ,rasw.po_cartons_qty ,rasw.po_gross_wgt ,rasw.po_gross_wgt_uom ,rasw.po_dim_wgt ,rasw.po_dim_wgt_uom ,rasw.po_chargeable_wgt ,rasw.po_chargeable_wgt_uom ,rasw.garment_pack ,rasw.pre_tkt ,rasw.header_last_upd_dtm ,rasw.detail_last_upd_dtm from  (select mawb_nbr ,hawb_nbr ,ref_nbr ,itm_nbr ,shipping_method ,flight_nbr ,forwarder_id ,forwarder_name ,carrier_cd ,port_of_lading_id ,port_of_lading_name ,port_of_discharge_id ,port_of_discharge_name ,destination_id ,destination_name ,dim_wgt ,dim_wgt_uom ,gross_wgt ,gross_wgt_uom ,total_cartons ,actual_depart_dtm ,transmission_dtm ,eta_dtm ,cargo_receipt_dtm ,docs_available_dtm ,brand ,deliver_to ,po_nbr ,contract_nbr ,order_nbr ,po_unit ,po_cartons_qty ,po_gross_wgt ,po_gross_wgt_uom ,po_dim_wgt ,po_dim_wgt_uom ,po_chargeable_wgt ,po_chargeable_wgt_uom ,garment_pack ,pre_tkt ,header_last_upd_dtm ,detail_last_upd_dtm ,row_number() over(partition by mawb_nbr,hawb_nbr,forwarder_id,contract_nbr,order_nbr,ref_nbr,itm_nbr order by detail_last_upd_dtm desc ) row_num from scct_work_db.rockport_air_shipment_work ) rasw where rasw.row_num=1)rasw1 left outer join analytics_view.item i on trim(rasw1.itm_nbr) = trim(substring(i.item_number,-8))
! echo completed loading into scct_work_db.rockport_air_shipment_work1;
! echo started loading into scct_db.rockport_air_shipment;
insert overwrite table scct_db.rockport_air_shipment select coalesce(rasw.mawb_nbr, ras.mawb_nbr) ,coalesce(rasw.hawb_nbr, ras.hawb_nbr) ,coalesce(rasw.ref_nbr, ras.ref_nbr) ,coalesce(rasw.itm_nbr, ras.itm_nbr) ,coalesce(rasw.shipping_method, ras.shipping_method) ,coalesce(rasw.flight_nbr, ras.flight_nbr) ,coalesce(rasw.forwarder_id, ras.forwarder_id) ,coalesce(rasw.forwarder_name, ras.forwarder_name) ,coalesce(rasw.carrier_cd, ras.carrier_cd) ,coalesce(rasw.port_of_lading_id, ras.port_of_lading_id) ,coalesce(rasw.port_of_lading_name, ras.port_of_lading_name) ,coalesce(rasw.port_of_discharge_id, ras.port_of_discharge_id) ,coalesce(rasw.port_of_discharge_name, ras.port_of_discharge_name) ,coalesce(rasw.destination_id, ras.destination_id) ,coalesce(rasw.destination_name, ras.destination_name) ,coalesce(rasw.dim_wgt, ras.dim_wgt) ,coalesce(rasw.dim_wgt_uom, ras.dim_wgt_uom) ,coalesce(rasw.gross_wgt, ras.gross_wgt) ,coalesce(rasw.gross_wgt_uom, ras.gross_wgt_uom) ,coalesce(rasw.total_cartons, ras.total_cartons) ,coalesce(rasw.actual_depart_dtm, ras.actual_depart_dtm) ,coalesce(rasw.transmission_dtm, ras.transmission_dtm) ,coalesce(rasw.eta_dtm, ras.eta_dtm) ,coalesce(rasw.cargo_receipt_dtm, ras.cargo_receipt_dtm) ,coalesce(rasw.docs_available_dtm, ras.docs_available_dtm) ,coalesce(rasw.brand, ras.brand) ,coalesce(rasw.deliver_to, ras.deliver_to) ,coalesce(rasw.po_nbr, ras.po_nbr) ,coalesce(rasw.contract_nbr, ras.contract_nbr) ,coalesce(rasw.order_nbr, ras.order_nbr) ,coalesce(rasw.po_unit, ras.po_unit) ,coalesce(rasw.po_cartons_qty, ras.po_cartons_qty) ,coalesce(rasw.po_gross_wgt, ras.po_gross_wgt) ,coalesce(rasw.po_gross_wgt_uom, ras.po_gross_wgt_uom) ,coalesce(rasw.po_dim_wgt, ras.po_dim_wgt) ,coalesce(rasw.po_dim_wgt_uom, ras.po_dim_wgt_uom) ,coalesce(rasw.po_chargeable_wgt, ras.po_chargeable_wgt) ,coalesce(rasw.po_chargeable_wgt_uom, ras.po_chargeable_wgt_uom) ,coalesce(rasw.garment_pack, ras.garment_pack) ,coalesce(rasw.pre_tkt, ras.pre_tkt) ,coalesce(rasw.header_last_upd_dtm, ras.header_last_upd_dtm) ,coalesce(rasw.detail_last_upd_dtm, ras.detail_last_upd_dtm) from scct_work_db.rockport_air_shipment_work1 rasw full join scct_db.rockport_air_shipment ras  on rasw.mawb_nbr=ras.mawb_nbr  and rasw.forwarder_id=ras.forwarder_id and rasw.hawb_nbr=ras.hawb_nbr and rasw.contract_nbr=ras.contract_nbr and rasw.order_nbr=ras.order_nbr and rasw.ref_nbr=ras.ref_nbr and rasw.itm_nbr=ras.itm_nbr
! echo completed loading into scct_db.rockport_air_shipment;
! echo entry into job control table completed;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_air_shipment -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_air_shipment ---source: rockport_stage0 table : trader_shipping_hdr, trader_shipping_dtl, trader_party, trader_plci3225 --- trader_packing, trader_delivery_dtl and trader_matrix_hdr;
---load type: full ---back posting: no ---author: ssoma ---created date: 02/05/2019 --------------------------------------------------------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading work table scct_db.trader_plci3225_work  -------------------------  set tez.job.name=work:trader_plci3225_work:load work table trader_plci3225_work;
! echo started loading into scct_work_db.trader_plci3225_work;
insert overwrite table scct_work_db.trader_plci3225_work  select owner ,place_code ,place_name from ( select owner ,place_code ,place_name ,row_number () over (partition by trim(owner), trim(place_code) order by from_unixtime(last_update div 1000, 'yyyy-mm-dd hh:mm:ss') desc ) row_num from rockport_stage0.trader_plci3225 ) a where a.row_num=1
! echo completed loading into scct_work_db.trader_plci3225_work;
------------------------- ---loading stage1 table scct_db.rockport_air_shipment  -------------------------  set tez.job.name=stage1:rockport_air_shipment_work:load work table rockport_air_shipment_work;
! echo started loading into scct_work_db.rockport_air_shipment_work;
insert overwrite table scct_work_db.rockport_air_shipment_work select coalesce(case when trim(sh.bill_of_lading_no)='' then null else trim(sh.bill_of_lading_no) end, 'n/a') as mawb_nbr ,coalesce(case when trim(sd.equip_id)='' then null else trim(sd.equip_id) end, 'n/a') as hawb_nbr ,coalesce(case when trim(sd.ref_no)='' then null else trim(sd.ref_no) end, 'n/a') as ref_nbr ,coalesce(case when trim(sd.item)='' then null else trim(sd.item) end, 'n/a') as itm_nbr ,coalesce(case when trim(sh.transport_mode)='' then null else trim(sh.transport_mode) end, 'n/a') as shipping_method ,coalesce(case when trim(sh.id_means_of_transp)='' then null else trim(sh.id_means_of_transp) end, 'n/a') as flight_nbr ,coalesce(case when trim(sh.owner)='' then null else trim(sh.owner) end, 'n/a') as forwarder_id ,coalesce(case when trim(pa1.party_name_line1)='' then null else trim(pa1.party_name_line1) end, 'n/a') as forwarder_name ,coalesce(case when trim(sh.carrier)='' then null else trim(sh.carrier) end, 'n/a') as carrier_cd ,coalesce(case when trim(sh.load_point)='' then null else trim(sh.load_point) end, 'n/a') as port_of_lading_id ,coalesce(case when trim(pc1.place_name)='' then null else trim(pc1.place_name) end, 'n/a') as port_of_lading_name ,coalesce(case when trim(sh.state_province)='' then null else trim(sh.state_province) end, 'n/a') as port_of_discharge_id ,coalesce(case when trim(pc2.place_name)='' then null else trim(pc2.place_name) end, 'n/a') as port_of_discharge_name ,coalesce(case when trim(sh.final_dest)='' then null else trim(sh.final_dest) end, 'n/a') as destination_id ,coalesce(case when trim(pc3.place_name)='' then null else trim(pc3.place_name) end, 'n/a') as destination_name ,coalesce(case when trim(sd.measurement_val)='' then null else trim(sd.measurement_val) end, 0.00) as dim_wgt  ,coalesce(case when trim(sd.equip_meas_um)='' then null else trim(sd.equip_meas_um) end, 'n/a') as dim_wgt_uom ,coalesce(case when trim(sd.equip_weight_val)='' then null else trim(sd.equip_weight_val) end, 0.00) as gross_wgt ,coalesce(case when trim(sd.equip_weight_um)='' then null else trim(sd.equip_weight_um) end, 'n/a') as gross_wgt_uom ,coalesce(case when trim(p1.qty_per_pack)='' then null else trim(p1.qty_per_pack) end, 0.00) as total_cartons ,coalesce(to_utc_timestamp(from_unixtime(sh.export_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as actual_depart_dtm ,coalesce(to_utc_timestamp(from_unixtime(sh.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as transmission_dtm ,coalesce(to_utc_timestamp(from_unixtime(sh.act_arrive_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as eta_dtm ,coalesce(to_utc_timestamp(from_unixtime(dd1.recd_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as cargo_receipt_dtm ,coalesce(to_utc_timestamp(from_unixtime(dd2.last_delivery_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as docs_available_dtm ,coalesce(case when trim(sd.status)='' then null else trim(sd.status) end, 'n/a') as brand ,coalesce(case when trim(sd.deliver_to)='' then null else trim(sd.deliver_to) end, 'n/a') as deliver_to ,coalesce(coalesce(sd.contract_no,sd.order_no), 'n/a') as po_nbr ,coalesce(case when trim(sd.contract_no)='' then null else trim(sd.contract_no) end, 'n/a') as contract_nbr ,coalesce(case when trim(sd.order_no)='' then null else trim(sd.order_no) end, 'n/a') as order_nbr ,coalesce(case when trim(mh.matrix_total)='' then null else trim(mh.matrix_total) end, 0.00) as po_unit  ,coalesce(case when trim(p2.pack_id_qty)='' then null else trim(p2.pack_id_qty) end, 0.00) as po_cartons_qty  ,coalesce(case when trim(p2.total_wgt_pack_id)='' then null else trim(p2.total_wgt_pack_id) end, 0.00) as po_gross_wgt  ,coalesce(case when trim(p2.total_wgt_um)='' then null else trim(p2.total_wgt_um)end, 'n/a') as po_gross_wgt_uom  ,coalesce(case when trim(p2.line_wgt)='' then null else trim(p2.line_wgt) end, 0.00) as po_dim_wgt  ,coalesce(case when trim(p2.line_wgt_um)='' then null else trim(p2.line_wgt_um) end, 'n/a') as po_dim_wgt_uom  ,coalesce(case when trim(p2.net_wgt_unit)='' then null else trim(p2.net_wgt_unit) end, 0.00) as po_chargeable_wgt  ,coalesce(case when trim(p2.net_wgt_unit_um)='' then null else trim(p2.net_wgt_unit_um)end, 'n/a') as po_chargeable_wgt_uom  ,coalesce(case when trim(p2.pkg_type)='' then null else trim(p2.pkg_type) end, 'n/a') as garment_pack ,coalesce(case when trim(p3.sample_carton)='' then null else trim(p3.sample_carton) end, 'n/a') as pre_tkt ,coalesce(to_utc_timestamp(from_unixtime(sh.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(from_unixtime(sd.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm from rockport_stage0.trader_shipping_hdr sh left join rockport_stage0.trader_shipping_dtl sd on sh.owner=sd.owner and sh.bill_of_lading_no=sd.bill_of_lading_no left join rockport_stage0.trader_party pa1 on pa1.party_id=sh.owner left join scct_work_db.trader_plci3225_work pc1 on pc1.place_code=sh.load_point left join scct_work_db.trader_plci3225_work pc2 on pc2.place_code=sh.state_province left join scct_work_db.trader_plci3225_work pc3 on pc3.place_code=sh.final_dest left join rockport_stage0.trader_packing p1 on p1.owner=sh.owner and p1.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and p1.pack_id=sd.equip_id left join rockport_stage0.trader_packing p2 on p2.owner=sh.owner and p2.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and p2.pack_id=coalesce(sd.contract_no,sd.order_no) left join rockport_stage0.trader_packing p3 on p3.owner=sh.owner and p3.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no,' + ',sd.item,' + ',sd.item) and p3.pack_id=sd.item left join rockport_stage0.trader_delivery_dtl dd1 on dd1.owner=sh.owner and dd1.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and dd1.delivery_id=sd.equip_id and dd1.delivery_no='e1' left join rockport_stage0.trader_delivery_dtl dd2 on dd2.owner=sh.owner and dd2.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no) left join rockport_stage0.trader_matrix_hdr mh on mh.owner=sd.owner and mh.link_key_val=concat(sd.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no,' + ',sd.item,' + ',sd.item,' + ',sd.item) where sh.transport_mode='a' and sh.owner not like 'cfs%'
! echo completed loading into scct_work_db.rockport_air_shipment_work;
! echo started loading into scct_work_db.rockport_air_shipment_work1;
insert overwrite table scct_work_db.rockport_air_shipment_work1 select  rasw1.mawb_nbr ,rasw1.hawb_nbr ,rasw1.ref_nbr ,coalesce(i.item_number,rasw1.itm_nbr) ,rasw1.shipping_method ,rasw1.flight_nbr ,rasw1.forwarder_id ,rasw1.forwarder_name ,rasw1.carrier_cd ,rasw1.port_of_lading_id ,rasw1.port_of_lading_name ,rasw1.port_of_discharge_id ,rasw1.port_of_discharge_name ,rasw1.destination_id ,rasw1.destination_name ,rasw1.dim_wgt ,rasw1.dim_wgt_uom ,rasw1.gross_wgt ,rasw1.gross_wgt_uom ,rasw1.total_cartons ,rasw1.actual_depart_dtm ,rasw1.transmission_dtm ,rasw1.eta_dtm ,rasw1.cargo_receipt_dtm ,rasw1.docs_available_dtm ,rasw1.brand ,rasw1.deliver_to ,rasw1.po_nbr ,rasw1.contract_nbr ,rasw1.order_nbr ,rasw1.po_unit ,rasw1.po_cartons_qty ,rasw1.po_gross_wgt ,rasw1.po_gross_wgt_uom ,rasw1.po_dim_wgt ,rasw1.po_dim_wgt_uom ,rasw1.po_chargeable_wgt ,rasw1.po_chargeable_wgt_uom ,rasw1.garment_pack ,rasw1.pre_tkt ,rasw1.header_last_upd_dtm ,rasw1.detail_last_upd_dtm from  (select  rasw.mawb_nbr ,rasw.hawb_nbr ,rasw.ref_nbr ,rasw.itm_nbr ,rasw.shipping_method ,rasw.flight_nbr ,rasw.forwarder_id ,rasw.forwarder_name ,rasw.carrier_cd ,rasw.port_of_lading_id ,rasw.port_of_lading_name ,rasw.port_of_discharge_id ,rasw.port_of_discharge_name ,rasw.destination_id ,rasw.destination_name ,rasw.dim_wgt ,rasw.dim_wgt_uom ,rasw.gross_wgt ,rasw.gross_wgt_uom ,rasw.total_cartons ,rasw.actual_depart_dtm ,rasw.transmission_dtm ,rasw.eta_dtm ,rasw.cargo_receipt_dtm ,rasw.docs_available_dtm ,rasw.brand ,rasw.deliver_to ,rasw.po_nbr ,rasw.contract_nbr ,rasw.order_nbr ,rasw.po_unit ,rasw.po_cartons_qty ,rasw.po_gross_wgt ,rasw.po_gross_wgt_uom ,rasw.po_dim_wgt ,rasw.po_dim_wgt_uom ,rasw.po_chargeable_wgt ,rasw.po_chargeable_wgt_uom ,rasw.garment_pack ,rasw.pre_tkt ,rasw.header_last_upd_dtm ,rasw.detail_last_upd_dtm from  (select mawb_nbr ,hawb_nbr ,ref_nbr ,itm_nbr ,shipping_method ,flight_nbr ,forwarder_id ,forwarder_name ,carrier_cd ,port_of_lading_id ,port_of_lading_name ,port_of_discharge_id ,port_of_discharge_name ,destination_id ,destination_name ,dim_wgt ,dim_wgt_uom ,gross_wgt ,gross_wgt_uom ,total_cartons ,actual_depart_dtm ,transmission_dtm ,eta_dtm ,cargo_receipt_dtm ,docs_available_dtm ,brand ,deliver_to ,po_nbr ,contract_nbr ,order_nbr ,po_unit ,po_cartons_qty ,po_gross_wgt ,po_gross_wgt_uom ,po_dim_wgt ,po_dim_wgt_uom ,po_chargeable_wgt ,po_chargeable_wgt_uom ,garment_pack ,pre_tkt ,header_last_upd_dtm ,detail_last_upd_dtm ,row_number() over(partition by mawb_nbr,hawb_nbr,forwarder_id,contract_nbr,order_nbr,ref_nbr,itm_nbr order by detail_last_upd_dtm desc ) row_num from scct_work_db.rockport_air_shipment_work ) rasw where rasw.row_num=1)rasw1 left outer join analytics_view.item i on trim(rasw1.itm_nbr) = trim(substring(i.item_number,-8))
! echo completed loading into scct_work_db.rockport_air_shipment_work1;
! echo started loading into scct_db.rockport_air_shipment;
insert overwrite table scct_db.rockport_air_shipment select coalesce(rasw.mawb_nbr, ras.mawb_nbr) ,coalesce(rasw.hawb_nbr, ras.hawb_nbr) ,coalesce(rasw.ref_nbr, ras.ref_nbr) ,coalesce(rasw.itm_nbr, ras.itm_nbr) ,coalesce(rasw.shipping_method, ras.shipping_method) ,coalesce(rasw.flight_nbr, ras.flight_nbr) ,coalesce(rasw.forwarder_id, ras.forwarder_id) ,coalesce(rasw.forwarder_name, ras.forwarder_name) ,coalesce(rasw.carrier_cd, ras.carrier_cd) ,coalesce(rasw.port_of_lading_id, ras.port_of_lading_id) ,coalesce(rasw.port_of_lading_name, ras.port_of_lading_name) ,coalesce(rasw.port_of_discharge_id, ras.port_of_discharge_id) ,coalesce(rasw.port_of_discharge_name, ras.port_of_discharge_name) ,coalesce(rasw.destination_id, ras.destination_id) ,coalesce(rasw.destination_name, ras.destination_name) ,coalesce(rasw.dim_wgt, ras.dim_wgt) ,coalesce(rasw.dim_wgt_uom, ras.dim_wgt_uom) ,coalesce(rasw.gross_wgt, ras.gross_wgt) ,coalesce(rasw.gross_wgt_uom, ras.gross_wgt_uom) ,coalesce(rasw.total_cartons, ras.total_cartons) ,coalesce(rasw.actual_depart_dtm, ras.actual_depart_dtm) ,coalesce(rasw.transmission_dtm, ras.transmission_dtm) ,coalesce(rasw.eta_dtm, ras.eta_dtm) ,coalesce(rasw.cargo_receipt_dtm, ras.cargo_receipt_dtm) ,coalesce(rasw.docs_available_dtm, ras.docs_available_dtm) ,coalesce(rasw.brand, ras.brand) ,coalesce(rasw.deliver_to, ras.deliver_to) ,coalesce(rasw.po_nbr, ras.po_nbr) ,coalesce(rasw.contract_nbr, ras.contract_nbr) ,coalesce(rasw.order_nbr, ras.order_nbr) ,coalesce(rasw.po_unit, ras.po_unit) ,coalesce(rasw.po_cartons_qty, ras.po_cartons_qty) ,coalesce(rasw.po_gross_wgt, ras.po_gross_wgt) ,coalesce(rasw.po_gross_wgt_uom, ras.po_gross_wgt_uom) ,coalesce(rasw.po_dim_wgt, ras.po_dim_wgt) ,coalesce(rasw.po_dim_wgt_uom, ras.po_dim_wgt_uom) ,coalesce(rasw.po_chargeable_wgt, ras.po_chargeable_wgt) ,coalesce(rasw.po_chargeable_wgt_uom, ras.po_chargeable_wgt_uom) ,coalesce(rasw.garment_pack, ras.garment_pack) ,coalesce(rasw.pre_tkt, ras.pre_tkt) ,coalesce(rasw.header_last_upd_dtm, ras.header_last_upd_dtm) ,coalesce(rasw.detail_last_upd_dtm, ras.detail_last_upd_dtm) from scct_work_db.rockport_air_shipment_work1 rasw full join scct_db.rockport_air_shipment ras  on rasw.mawb_nbr=ras.mawb_nbr  and rasw.forwarder_id=ras.forwarder_id and rasw.hawb_nbr=ras.hawb_nbr and rasw.contract_nbr=ras.contract_nbr and rasw.order_nbr=ras.order_nbr and rasw.ref_nbr=ras.ref_nbr and rasw.itm_nbr=ras.itm_nbr
! echo completed loading into scct_db.rockport_air_shipment;
! echo entry into job control table completed;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_air_shipment -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_air_shipment ---source: rockport_stage0 table : trader_shipping_hdr, trader_shipping_dtl, trader_party, trader_plci3225 --- trader_packing, trader_delivery_dtl and trader_matrix_hdr;
---load type: full ---back posting: no ---author: ssoma ---created date: 02/05/2019 --------------------------------------------------------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading work table scct_db.trader_plci3225_work  -------------------------  set tez.job.name=work:trader_plci3225_work:load work table trader_plci3225_work;
! echo started loading into scct_work_db.trader_plci3225_work;
insert overwrite table scct_work_db.trader_plci3225_work  select owner ,place_code ,place_name from ( select owner ,place_code ,place_name ,row_number () over (partition by trim(owner), trim(place_code) order by from_unixtime(last_update div 1000, 'yyyy-mm-dd hh:mm:ss') desc ) row_num from rockport_stage0.trader_plci3225 ) a where a.row_num=1
! echo completed loading into scct_work_db.trader_plci3225_work;
------------------------- ---loading stage1 table scct_db.rockport_air_shipment  -------------------------  set tez.job.name=stage1:rockport_air_shipment_work:load work table rockport_air_shipment_work;
! echo started loading into scct_work_db.rockport_air_shipment_work;
insert overwrite table scct_work_db.rockport_air_shipment_work select coalesce(case when trim(sh.bill_of_lading_no)='' then null else trim(sh.bill_of_lading_no) end, 'n/a') as mawb_nbr ,coalesce(case when trim(sd.equip_id)='' then null else trim(sd.equip_id) end, 'n/a') as hawb_nbr ,coalesce(case when trim(sd.ref_no)='' then null else trim(sd.ref_no) end, 'n/a') as ref_nbr ,coalesce(case when trim(sd.item)='' then null else trim(sd.item) end, 'n/a') as itm_nbr ,coalesce(case when trim(sh.transport_mode)='' then null else trim(sh.transport_mode) end, 'n/a') as shipping_method ,coalesce(case when trim(sh.id_means_of_transp)='' then null else trim(sh.id_means_of_transp) end, 'n/a') as flight_nbr ,coalesce(case when trim(sh.owner)='' then null else trim(sh.owner) end, 'n/a') as forwarder_id ,coalesce(case when trim(pa1.party_name_line1)='' then null else trim(pa1.party_name_line1) end, 'n/a') as forwarder_name ,coalesce(case when trim(sh.carrier)='' then null else trim(sh.carrier) end, 'n/a') as carrier_cd ,coalesce(case when trim(sh.load_point)='' then null else trim(sh.load_point) end, 'n/a') as port_of_lading_id ,coalesce(case when trim(pc1.place_name)='' then null else trim(pc1.place_name) end, 'n/a') as port_of_lading_name ,coalesce(case when trim(sh.state_province)='' then null else trim(sh.state_province) end, 'n/a') as port_of_discharge_id ,coalesce(case when trim(pc2.place_name)='' then null else trim(pc2.place_name) end, 'n/a') as port_of_discharge_name ,coalesce(case when trim(sh.final_dest)='' then null else trim(sh.final_dest) end, 'n/a') as destination_id ,coalesce(case when trim(pc3.place_name)='' then null else trim(pc3.place_name) end, 'n/a') as destination_name ,coalesce(case when trim(sd.measurement_val)='' then null else trim(sd.measurement_val) end, 0.00) as dim_wgt  ,coalesce(case when trim(sd.equip_meas_um)='' then null else trim(sd.equip_meas_um) end, 'n/a') as dim_wgt_uom ,coalesce(case when trim(sd.equip_weight_val)='' then null else trim(sd.equip_weight_val) end, 0.00) as gross_wgt ,coalesce(case when trim(sd.equip_weight_um)='' then null else trim(sd.equip_weight_um) end, 'n/a') as gross_wgt_uom ,coalesce(case when trim(p1.qty_per_pack)='' then null else trim(p1.qty_per_pack) end, 0.00) as total_cartons ,coalesce(to_utc_timestamp(from_unixtime(sh.export_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as actual_depart_dtm ,coalesce(to_utc_timestamp(from_unixtime(sh.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as transmission_dtm ,coalesce(to_utc_timestamp(from_unixtime(sh.act_arrive_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as eta_dtm ,coalesce(to_utc_timestamp(from_unixtime(dd1.recd_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as cargo_receipt_dtm ,coalesce(to_utc_timestamp(from_unixtime(dd2.last_delivery_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as docs_available_dtm ,coalesce(case when trim(sd.status)='' then null else trim(sd.status) end, 'n/a') as brand ,coalesce(case when trim(sd.deliver_to)='' then null else trim(sd.deliver_to) end, 'n/a') as deliver_to ,coalesce(coalesce(sd.contract_no,sd.order_no), 'n/a') as po_nbr ,coalesce(case when trim(sd.contract_no)='' then null else trim(sd.contract_no) end, 'n/a') as contract_nbr ,coalesce(case when trim(sd.order_no)='' then null else trim(sd.order_no) end, 'n/a') as order_nbr ,coalesce(case when trim(mh.matrix_total)='' then null else trim(mh.matrix_total) end, 0.00) as po_unit  ,coalesce(case when trim(p2.pack_id_qty)='' then null else trim(p2.pack_id_qty) end, 0.00) as po_cartons_qty  ,coalesce(case when trim(p2.total_wgt_pack_id)='' then null else trim(p2.total_wgt_pack_id) end, 0.00) as po_gross_wgt  ,coalesce(case when trim(p2.total_wgt_um)='' then null else trim(p2.total_wgt_um)end, 'n/a') as po_gross_wgt_uom  ,coalesce(case when trim(p2.line_wgt)='' then null else trim(p2.line_wgt) end, 0.00) as po_dim_wgt  ,coalesce(case when trim(p2.line_wgt_um)='' then null else trim(p2.line_wgt_um) end, 'n/a') as po_dim_wgt_uom  ,coalesce(case when trim(p2.net_wgt_unit)='' then null else trim(p2.net_wgt_unit) end, 0.00) as po_chargeable_wgt  ,coalesce(case when trim(p2.net_wgt_unit_um)='' then null else trim(p2.net_wgt_unit_um)end, 'n/a') as po_chargeable_wgt_uom  ,coalesce(case when trim(p2.pkg_type)='' then null else trim(p2.pkg_type) end, 'n/a') as garment_pack ,coalesce(case when trim(p3.sample_carton)='' then null else trim(p3.sample_carton) end, 'n/a') as pre_tkt ,coalesce(to_utc_timestamp(from_unixtime(sh.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(from_unixtime(sd.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm from rockport_stage0.trader_shipping_hdr sh left join rockport_stage0.trader_shipping_dtl sd on sh.owner=sd.owner and sh.bill_of_lading_no=sd.bill_of_lading_no left join rockport_stage0.trader_party pa1 on pa1.party_id=sh.owner left join scct_work_db.trader_plci3225_work pc1 on pc1.place_code=sh.load_point left join scct_work_db.trader_plci3225_work pc2 on pc2.place_code=sh.state_province left join scct_work_db.trader_plci3225_work pc3 on pc3.place_code=sh.final_dest left join rockport_stage0.trader_packing p1 on p1.owner=sh.owner and p1.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and p1.pack_id=sd.equip_id left join rockport_stage0.trader_packing p2 on p2.owner=sh.owner and p2.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and p2.pack_id=coalesce(sd.contract_no,sd.order_no) left join rockport_stage0.trader_packing p3 on p3.owner=sh.owner and p3.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no,' + ',sd.item,' + ',sd.item) and p3.pack_id=sd.item left join rockport_stage0.trader_delivery_dtl dd1 on dd1.owner=sh.owner and dd1.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and dd1.delivery_id=sd.equip_id and dd1.delivery_no='e1' left join rockport_stage0.trader_delivery_dtl dd2 on dd2.owner=sh.owner and dd2.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no) left join rockport_stage0.trader_matrix_hdr mh on mh.owner=sd.owner and mh.link_key_val=concat(sd.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no,' + ',sd.item,' + ',sd.item,' + ',sd.item) where sh.transport_mode='a' and sh.owner not like 'cfs%'
! echo completed loading into scct_work_db.rockport_air_shipment_work;
! echo started loading into scct_work_db.rockport_air_shipment_work1;
insert overwrite table scct_work_db.rockport_air_shipment_work1 select  rasw1.mawb_nbr ,rasw1.hawb_nbr ,rasw1.ref_nbr ,coalesce(i.item_number,rasw1.itm_nbr) ,rasw1.shipping_method ,rasw1.flight_nbr ,rasw1.forwarder_id ,rasw1.forwarder_name ,rasw1.carrier_cd ,rasw1.port_of_lading_id ,rasw1.port_of_lading_name ,rasw1.port_of_discharge_id ,rasw1.port_of_discharge_name ,rasw1.destination_id ,rasw1.destination_name ,rasw1.dim_wgt ,rasw1.dim_wgt_uom ,rasw1.gross_wgt ,rasw1.gross_wgt_uom ,rasw1.total_cartons ,rasw1.actual_depart_dtm ,rasw1.transmission_dtm ,rasw1.eta_dtm ,rasw1.cargo_receipt_dtm ,rasw1.docs_available_dtm ,rasw1.brand ,rasw1.deliver_to ,rasw1.po_nbr ,rasw1.contract_nbr ,rasw1.order_nbr ,rasw1.po_unit ,rasw1.po_cartons_qty ,rasw1.po_gross_wgt ,rasw1.po_gross_wgt_uom ,rasw1.po_dim_wgt ,rasw1.po_dim_wgt_uom ,rasw1.po_chargeable_wgt ,rasw1.po_chargeable_wgt_uom ,rasw1.garment_pack ,rasw1.pre_tkt ,rasw1.header_last_upd_dtm ,rasw1.detail_last_upd_dtm from  (select  rasw.mawb_nbr ,rasw.hawb_nbr ,rasw.ref_nbr ,rasw.itm_nbr ,rasw.shipping_method ,rasw.flight_nbr ,rasw.forwarder_id ,rasw.forwarder_name ,rasw.carrier_cd ,rasw.port_of_lading_id ,rasw.port_of_lading_name ,rasw.port_of_discharge_id ,rasw.port_of_discharge_name ,rasw.destination_id ,rasw.destination_name ,rasw.dim_wgt ,rasw.dim_wgt_uom ,rasw.gross_wgt ,rasw.gross_wgt_uom ,rasw.total_cartons ,rasw.actual_depart_dtm ,rasw.transmission_dtm ,rasw.eta_dtm ,rasw.cargo_receipt_dtm ,rasw.docs_available_dtm ,rasw.brand ,rasw.deliver_to ,rasw.po_nbr ,rasw.contract_nbr ,rasw.order_nbr ,rasw.po_unit ,rasw.po_cartons_qty ,rasw.po_gross_wgt ,rasw.po_gross_wgt_uom ,rasw.po_dim_wgt ,rasw.po_dim_wgt_uom ,rasw.po_chargeable_wgt ,rasw.po_chargeable_wgt_uom ,rasw.garment_pack ,rasw.pre_tkt ,rasw.header_last_upd_dtm ,rasw.detail_last_upd_dtm from  (select mawb_nbr ,hawb_nbr ,ref_nbr ,itm_nbr ,shipping_method ,flight_nbr ,forwarder_id ,forwarder_name ,carrier_cd ,port_of_lading_id ,port_of_lading_name ,port_of_discharge_id ,port_of_discharge_name ,destination_id ,destination_name ,dim_wgt ,dim_wgt_uom ,gross_wgt ,gross_wgt_uom ,total_cartons ,actual_depart_dtm ,transmission_dtm ,eta_dtm ,cargo_receipt_dtm ,docs_available_dtm ,brand ,deliver_to ,po_nbr ,contract_nbr ,order_nbr ,po_unit ,po_cartons_qty ,po_gross_wgt ,po_gross_wgt_uom ,po_dim_wgt ,po_dim_wgt_uom ,po_chargeable_wgt ,po_chargeable_wgt_uom ,garment_pack ,pre_tkt ,header_last_upd_dtm ,detail_last_upd_dtm ,row_number() over(partition by mawb_nbr,hawb_nbr,forwarder_id,contract_nbr,order_nbr,ref_nbr,itm_nbr order by detail_last_upd_dtm desc ) row_num from scct_work_db.rockport_air_shipment_work ) rasw where rasw.row_num=1)rasw1 left outer join analytics_view.item i on trim(rasw1.itm_nbr) = trim(substring(i.item_number,-8))
! echo completed loading into scct_work_db.rockport_air_shipment_work1;
! echo started loading into scct_db.rockport_air_shipment;
insert overwrite table scct_db.rockport_air_shipment select coalesce(rasw.mawb_nbr, ras.mawb_nbr) ,coalesce(rasw.hawb_nbr, ras.hawb_nbr) ,coalesce(rasw.ref_nbr, ras.ref_nbr) ,coalesce(rasw.itm_nbr, ras.itm_nbr) ,coalesce(rasw.shipping_method, ras.shipping_method) ,coalesce(rasw.flight_nbr, ras.flight_nbr) ,coalesce(rasw.forwarder_id, ras.forwarder_id) ,coalesce(rasw.forwarder_name, ras.forwarder_name) ,coalesce(rasw.carrier_cd, ras.carrier_cd) ,coalesce(rasw.port_of_lading_id, ras.port_of_lading_id) ,coalesce(rasw.port_of_lading_name, ras.port_of_lading_name) ,coalesce(rasw.port_of_discharge_id, ras.port_of_discharge_id) ,coalesce(rasw.port_of_discharge_name, ras.port_of_discharge_name) ,coalesce(rasw.destination_id, ras.destination_id) ,coalesce(rasw.destination_name, ras.destination_name) ,coalesce(rasw.dim_wgt, ras.dim_wgt) ,coalesce(rasw.dim_wgt_uom, ras.dim_wgt_uom) ,coalesce(rasw.gross_wgt, ras.gross_wgt) ,coalesce(rasw.gross_wgt_uom, ras.gross_wgt_uom) ,coalesce(rasw.total_cartons, ras.total_cartons) ,coalesce(rasw.actual_depart_dtm, ras.actual_depart_dtm) ,coalesce(rasw.transmission_dtm, ras.transmission_dtm) ,coalesce(rasw.eta_dtm, ras.eta_dtm) ,coalesce(rasw.cargo_receipt_dtm, ras.cargo_receipt_dtm) ,coalesce(rasw.docs_available_dtm, ras.docs_available_dtm) ,coalesce(rasw.brand, ras.brand) ,coalesce(rasw.deliver_to, ras.deliver_to) ,coalesce(rasw.po_nbr, ras.po_nbr) ,coalesce(rasw.contract_nbr, ras.contract_nbr) ,coalesce(rasw.order_nbr, ras.order_nbr) ,coalesce(rasw.po_unit, ras.po_unit) ,coalesce(rasw.po_cartons_qty, ras.po_cartons_qty) ,coalesce(rasw.po_gross_wgt, ras.po_gross_wgt) ,coalesce(rasw.po_gross_wgt_uom, ras.po_gross_wgt_uom) ,coalesce(rasw.po_dim_wgt, ras.po_dim_wgt) ,coalesce(rasw.po_dim_wgt_uom, ras.po_dim_wgt_uom) ,coalesce(rasw.po_chargeable_wgt, ras.po_chargeable_wgt) ,coalesce(rasw.po_chargeable_wgt_uom, ras.po_chargeable_wgt_uom) ,coalesce(rasw.garment_pack, ras.garment_pack) ,coalesce(rasw.pre_tkt, ras.pre_tkt) ,coalesce(rasw.header_last_upd_dtm, ras.header_last_upd_dtm) ,coalesce(rasw.detail_last_upd_dtm, ras.detail_last_upd_dtm) from scct_work_db.rockport_air_shipment_work1 rasw full join scct_db.rockport_air_shipment ras  on rasw.mawb_nbr=ras.mawb_nbr  and rasw.forwarder_id=ras.forwarder_id and rasw.hawb_nbr=ras.hawb_nbr and rasw.contract_nbr=ras.contract_nbr and rasw.order_nbr=ras.order_nbr and rasw.ref_nbr=ras.ref_nbr and rasw.itm_nbr=ras.itm_nbr
! echo completed loading into scct_db.rockport_air_shipment;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_dc -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2923 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ----------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_dc_intra -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-3287 ssoma dc to dc intra initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ----------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_store -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2922 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  -- 01.00.00.04 17jan21 scctp-601 kaali m replaced handling_master table with handling_master_poso  ----------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_store_intra -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-3287 ssoma dc to store intra initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  -- 01.00.00.04 17jan21 scctp-601 kaali m replaced handling_master table with handling_master_poso  ----------------------------------------------------------------------------   ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_gpom -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.03 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.04 04may20 scctp4-3331 ssoma hql optimization  ----------------------------------------------------------------------------  -------------------------  ------------------------- ---loading po line kpis data into po_so_dd_hu_details table for gpom model -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_mbp_nb -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 16oct19 scctp4-2523 ssoma changed partition columns and po for so model -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.04 05nov20 scctp-456 fyuan add fg filter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpis data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details for mast beauty production;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_mbp_vsd_gs -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master,location_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2931 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_tkvsd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, inventory_movement ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 27dec19 scctp4-3287 ssoma turnkey production to vsd initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_ven_rfc -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master,location_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2931 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_vendor_to_dc -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, inventory_movement ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 27dec19 scctp4-2996 ssoma component inflow initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_vsdinflow -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 06jan20 scctp4-3287 ssoma vsd inflow initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ----------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_vss_vsd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 06jan20 scctp4-2924 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  ----------------------------------------------------------------------------   ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_vtptobdc_nb -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, inventory_movement ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 27dec19 scctp4-2901 ssoma turnkey production to brand initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpis data into po_so_dd_hu_details table for vendor turnkey production -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_zdtd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug20 scctp5-327 fyuan zdtd initial version ---------------------------------------------------------------------------- ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_kpi_details_po -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_kpi_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.04 05nov20 scctp-456 fyuan add component filter  --------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_kpi_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_kpi_details;
! echo completed po_so_dd_hu_kpi_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_kpi_details_podd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_kpi_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 20aug20 scctp5-327 fyuan add zdtd  --------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_kpi_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_kpi_details;
! echo completed po_so_dd_hu_kpi_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_kpi_details_posodd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_kpi_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter --------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_kpi_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_kpi_details;
! echo completed po_so_dd_hu_kpi_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_kpi_details_sodd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_kpi_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter --------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_kpi_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_kpi_details;
! echo completed po_so_dd_hu_kpi_details data load;
---jobname:scct-e2e_dashboard-hive-stg1-scct_db.prepack_component -------------------------------------------------------------------------- ---target: stage1 table: scct_db.prepack_component  ---source: scct_db table : bom_item, bom_detail, analytics_view table : item ---load type: full ---back posting: no ---author: ryadav ---last modified date: 12/18/2018 --------------------------------------------------------------------------  ------------------------- ---loading prepack_component stage 1 base data -------------------------  ! echo started loading into scct_db.prepack_component ;
! echo completed loading into scct_db.prepack_component ;
---jobname:scct-e2e_outbound_visibility-hive-stg1-scct_db.purge_wms_outbound_e2e -------------------------------------------------------------------------- ---target: stage1 table: scct_db.wms_outbound_e2e ---source: scct_db table : scct_db.wms_outbound_e2e and operations_db.purge_tables  ---load type: incrimental ---back posting: no ---author: ssoma ---created date: 12/02/2019 --------------------------------------------------------------------------  ------------------------- ---loading worker table without str rows  -------------------------   insert overwrite table scct_work_db.wms_retail_warehouse_shipping_link_work select rs.retail_warehouse ,rs.retail_distro_nbr ,rs.retail_store_nbr ,rs.retail_season_nbr ,rs.retail_season_year_nbr ,rs.retail_style_nbr ,rs.retail_style_sfx_nbr ,rs.retail_sector ,rs.retail_sap_style ,rs.retail_sap_choice ,rs.retail_sap_size ,rs.retail_ticket_typ ,rs.retail_instore_dt ,rs.retail_distro_total_qty ,rs.retail_distro_allocated_qty ,rs.retail_distro_remaining_qty ,rs.retail_dtstor_status_flag ,rs.retail_record_expansion_fld ,rs.retail_delv_doc_nbr ,rs.retail_delv_doc_itm_nbr ,rs.retail_distro_last_modified_datetime ,rs.retail_distro_create_datetime ,rs.retail_pickticket_control_nbr ,rs.retail_pdpick_pkt_line_nbr ,rs.retail_pdpick_pick_wave_nbr ,rs.retail_wave_processing_typ ,rs.retail_inv_allocation_typ ,rs.retail_pick_determination_typ ,rs.retail_pick_loc_assignment_typ ,rs.retail_pickticket_pick_location ,rs.retail_original_pick_order_qty ,rs.retail_original_pick_qty ,rs.retail_pick_qty ,rs.retail_pick_shortage_qty ,rs.retail_pick_cancelled_qty ,rs.retail_pick_packed_qty ,rs.retail_pdpick_status_flg ,rs.retail_specl_instr_cd_1 ,rs.retail_pickticket_last_modified_datetime ,rs.retail_pdpick_user_id ,rs.retail_district ,rs.retail_shipto_name ,rs.retail_shipto_state ,rs.retail_shipto_zip ,rs.retail_shipto_country ,rs.retail_pickticket_header_created_datetime ,rs.retail_pickticket_header_last_modified_datetime ,rs.retail_phpick_user_id ,rs.retail_carton_nbr ,rs.retail_carton_line_nbr ,rs.retail_package_barcd ,rs.retail_cdcart_pkt_line_nbr ,rs.retail_cdcart_pick_wave_nbr ,rs.retail_carton_qty_to_be_packed ,rs.retail_carton_qty_packed ,rs.retail_carton_delivered_qty ,rs.retail_carton_cancelled_qty ,rs.retail_carton_pick_location ,rs.retail_cdcart_status_flag ,rs.retail_packer_id ,rs.retail_carton_line_create_datetime ,rs.retail_carton_line_last_modified_datetime ,rs.retail_cdcart_user_id ,rs.retail_misc_nbr_1 ,rs.retail_chcart_pick_wave_nbr ,rs.retail_chcart_status_flg ,rs.retail_pack_cd ,rs.retail_pack_typ ,rs.retail_single_sku_flg ,rs.retail_first_pick_location ,rs.retail_carton_typ ,rs.retail_carton_sz ,rs.retail_carton_volume ,rs.retail_estimated_weight ,rs.retail_actual_weight ,rs.retail_pallet_id ,rs.retail_product_value ,rs.retail_bill_of_lading ,rs.retail_shipment_nbr ,rs.retail_load_nbr ,rs.retail_path_nbr ,rs.retail_ship_via ,rs.retail_special_ins_cd_1 ,rs.retail_special_ins_cd_2 ,rs.retail_special_ins_cd_3 ,rs.retail_misc_10_byte_1 ,rs.retail_misc_20_byte_1 ,rs.retail_misc_20_byte_2 ,rs.retail_misc_20_byte_4 ,rs.retail_misc_20_byte_5 ,rs.retail_reference_case_nbr ,rs.retail_carton_nbr_x_of_y ,rs.retail_audit_status ,rs.retail_tms_parcel_nbr ,rs.retail_carton_length ,rs.retail_carton_width ,rs.retail_carton_height ,rs.retail_recipient_first_name ,rs.retail_carton_last_modified_datetime ,rs.retail_chcart_user_id ,rs.retail_pickticket_create_datetime ,rs.retail_carton_create_datetime ,rs.retail_carton_invoiced_datetime ,rs.retail_distro_to_wave_time_duration ,rs.retail_wave_to_invoiced_duration ,rs.retail_distro_total_reaches ,rs.retail_distro_allocated_reaches ,rs.retail_distro_remaining_reaches ,rs.retail_original_pick_order_reaches ,rs.retail_original_pick_reaches ,rs.retail_pick_reaches ,rs.retail_pick_shortage_reaches ,rs.retail_pick_cancelled_reaches ,rs.retail_pick_packed_reaches ,rs.retail_carton_reaches_to_be_packed ,rs.retail_carton_reaches_packed ,rs.retail_carton_delivered_reaches ,rs.retail_carton_cancelled_reaches ,rs.retail_fc_ltfc ,rs.retail_processing_area ,rs.shipping_misc_20_byte_3 ,rs.shipping_carton_nbr ,rs.shipping_warehouse ,rs.shipping_load_nbr ,rs.shipping_destination_typ ,rs.shipping_ship_via ,rs.shipping_master_bill_of_lading ,rs.shipping_trailer_nbr ,rs.shipping_tractor_nbr ,rs.shipping_driver ,rs.shipping_dock ,rs.shipping_door ,rs.shipping_dock_door_locn_brcd ,rs.shipping_tms_plan_nbr ,rs.shipping_status_flg ,rs.shipping_status_dt ,rs.shipping_load_closed_dt ,rs.shipping_load_closed_ts ,rs.shipping_tc_shipment_id ,rs.shipping_tpe_created_load ,rs.shipping_tpe_processing_status ,rs.shipping_misc_instruction_1 ,rs.shipping_created_dt ,rs.shipping_created_ts ,rs.shipping_last_modified_dt ,rs.shipping_last_modified_ts ,rs.shipping_user_id ,rs.shipping_record_type ,rs.shipping_trip_nbr ,rs.shipping_trip_type ,rs.shipping_dispatch_dt ,rs.shipping_dispatch_ts ,rs.shipping_carton_limit ,rs.shipping_run_nbr ,rs.shipping_thtrip_ship_via ,rs.shipping_thtrip_status_flg ,rs.shipping_delay_code ,rs.shipping_cartons_loaded ,rs.shipping_seal_nbr ,rs.shipping_date_billed ,rs.shipping_time_billed ,rs.shipping_thtrip_seal_nbr ,rs.shipping_misc1_numeric_fld ,rs.shipping_miscellaneous_20 ,rs.shipping_thtrip_created_dt ,rs.shipping_thtrip_created_ts ,rs.shipping_thtrip_last_modified_dt ,rs.shipping_thtrip_last_modified_ts ,rs.shipping_thtrip_user_id ,rs.shipping_load_create_dt_ts ,rs.shipping_load_closed_dt_ts ,rs.shipping_load_create_to_closed_duration ,rs.distro_create_date ,rs.batch_code from scct_db.wms_outbound_e2e rs join (select purge_min_dt, purge_max_dt from operations_db.purge_tables p join  (select date_sub(min(to_date(distro_create_datetime)),1) purge_max_dt from scct_db.wms_outbound_retail) r on 1=1 where p.run_ind='n') pt on 1=1 where rs.distro_create_date between pt.purge_min_dt and pt.purge_max_dt and rs.retail_pickticket_control_nbr not like 'str%';
! echo worker table load is completed;
------------------------- ---insert back to base table only not str retail_pickticket_control_nbr rows -------------------------   insert overwrite table scct_db.wms_outbound_e2e partition(distro_create_date) select retail_warehouse ,retail_distro_nbr ,retail_store_nbr ,retail_season_nbr ,retail_season_year_nbr ,retail_style_nbr ,retail_style_sfx_nbr ,retail_sector ,retail_sap_style ,retail_sap_choice ,retail_sap_size ,retail_ticket_typ ,retail_instore_dt ,retail_distro_total_qty ,retail_distro_allocated_qty ,retail_distro_remaining_qty ,retail_dtstor_status_flag ,retail_record_expansion_fld ,retail_delv_doc_nbr ,retail_delv_doc_itm_nbr ,retail_distro_last_modified_datetime ,retail_distro_create_datetime ,retail_pickticket_control_nbr ,retail_pdpick_pkt_line_nbr ,retail_pdpick_pick_wave_nbr ,retail_wave_processing_typ ,retail_inv_allocation_typ ,retail_pick_determination_typ ,retail_pick_loc_assignment_typ ,retail_pickticket_pick_location ,retail_original_pick_order_qty ,retail_original_pick_qty ,retail_pick_qty ,retail_pick_shortage_qty ,retail_pick_cancelled_qty ,retail_pick_packed_qty ,retail_pdpick_status_flg ,retail_specl_instr_cd_1 ,retail_pickticket_last_modified_datetime ,retail_pdpick_user_id ,retail_district ,retail_shipto_name ,retail_shipto_state ,retail_shipto_zip ,retail_shipto_country ,retail_pickticket_header_created_datetime ,retail_pickticket_header_last_modified_datetime ,retail_phpick_user_id ,retail_carton_nbr ,retail_carton_line_nbr ,retail_package_barcd ,retail_cdcart_pkt_line_nbr ,retail_cdcart_pick_wave_nbr ,retail_carton_qty_to_be_packed ,retail_carton_qty_packed ,retail_carton_delivered_qty ,retail_carton_cancelled_qty ,retail_carton_pick_location ,retail_cdcart_status_flag ,retail_packer_id ,retail_carton_line_create_datetime ,retail_carton_line_last_modified_datetime ,retail_cdcart_user_id ,retail_misc_nbr_1 ,retail_chcart_pick_wave_nbr ,retail_chcart_status_flg ,retail_pack_cd ,retail_pack_typ ,retail_single_sku_flg ,retail_first_pick_location ,retail_carton_typ ,retail_carton_sz ,retail_carton_volume ,retail_estimated_weight ,retail_actual_weight ,retail_pallet_id ,retail_product_value ,retail_bill_of_lading ,retail_shipment_nbr ,retail_load_nbr ,retail_path_nbr ,retail_ship_via ,retail_special_ins_cd_1 ,retail_special_ins_cd_2 ,retail_special_ins_cd_3 ,retail_misc_10_byte_1 ,retail_misc_20_byte_1 ,retail_misc_20_byte_2 ,retail_misc_20_byte_4 ,retail_misc_20_byte_5 ,retail_reference_case_nbr ,retail_carton_nbr_x_of_y ,retail_audit_status ,retail_tms_parcel_nbr ,retail_carton_length ,retail_carton_width ,retail_carton_height ,retail_recipient_first_name ,retail_carton_last_modified_datetime ,retail_chcart_user_id ,retail_pickticket_create_datetime ,retail_carton_create_datetime ,retail_carton_invoiced_datetime ,retail_distro_to_wave_time_duration ,retail_wave_to_invoiced_duration ,retail_distro_total_reaches ,retail_distro_allocated_reaches ,retail_distro_remaining_reaches ,retail_original_pick_order_reaches ,retail_original_pick_reaches ,retail_pick_reaches ,retail_pick_shortage_reaches ,retail_pick_cancelled_reaches ,retail_pick_packed_reaches ,retail_carton_reaches_to_be_packed ,retail_carton_reaches_packed ,retail_carton_delivered_reaches ,retail_carton_cancelled_reaches ,retail_fc_ltfc ,retail_processing_area ,shipping_misc_20_byte_3 ,shipping_carton_nbr ,shipping_warehouse ,shipping_load_nbr ,shipping_destination_typ ,shipping_ship_via ,shipping_master_bill_of_lading ,shipping_trailer_nbr ,shipping_tractor_nbr ,shipping_driver ,shipping_dock ,shipping_door ,shipping_dock_door_locn_brcd ,shipping_tms_plan_nbr ,shipping_status_flg ,shipping_status_dt ,shipping_load_closed_dt ,shipping_load_closed_ts ,shipping_tc_shipment_id ,shipping_tpe_created_load ,shipping_tpe_processing_status ,shipping_misc_instruction_1 ,shipping_created_dt ,shipping_created_ts ,shipping_last_modified_dt ,shipping_last_modified_ts ,shipping_user_id ,shipping_record_type ,shipping_trip_nbr ,shipping_trip_type ,shipping_dispatch_dt ,shipping_dispatch_ts ,shipping_carton_limit ,shipping_run_nbr ,shipping_thtrip_ship_via ,shipping_thtrip_status_flg ,shipping_delay_code ,shipping_cartons_loaded ,shipping_seal_nbr ,shipping_date_billed ,shipping_time_billed ,shipping_thtrip_seal_nbr ,shipping_misc1_numeric_fld ,shipping_miscellaneous_20 ,shipping_thtrip_created_dt ,shipping_thtrip_created_ts ,shipping_thtrip_last_modified_dt ,shipping_thtrip_last_modified_ts ,shipping_thtrip_user_id ,shipping_load_create_dt_ts ,shipping_load_closed_dt_ts ,shipping_load_create_to_closed_duration ,batch_code ,distro_create_date from scct_work_db.wms_retail_warehouse_shipping_link_work;
! echo purge str rows completed;
------------------------- ---update record into control table to purge str rows -------------------------   ! echo started entry into job control table;
------------------------- ---insert record into control table to purge str rows -------------------------  ! echo started entry into job control table;
! echo entry into job control table completed;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_air_shipment -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_air_shipment ---source: rockport_stage0 table : trader_shipping_hdr, trader_shipping_dtl, trader_party, trader_plci3225 --- trader_packing, trader_delivery_dtl and trader_matrix_hdr;
---load type: full ---back posting: no ---author: ssoma ---created date: 02/05/2019 --------------------------------------------------------------------------  ------------------------- ---loading work table scct_db.trader_plci3225_work  -------------------------   ! echo started loading into scct_work_db.trader_plci3225_work;
! echo completed loading into scct_work_db.trader_plci3225_work;
------------------------- ---loading stage1 table scct_db.rockport_air_shipment  -------------------------  ! echo started loading into scct_work_db.rockport_air_shipment_work;
insert overwrite table scct_work_db.rockport_air_shipment_work select coalesce(case when trim(sh.bill_of_lading_no)='' then null else trim(sh.bill_of_lading_no) end, 'n/a') as mawb_nbr ,coalesce(case when trim(sd.equip_id)='' then null else trim(sd.equip_id) end, 'n/a') as hawb_nbr ,coalesce(case when trim(sd.ref_no)='' then null else trim(sd.ref_no) end, 'n/a') as ref_nbr ,coalesce(case when trim(sd.item)='' then null else trim(sd.item) end, 'n/a') as itm_nbr ,coalesce(case when trim(sh.transport_mode)='' then null else trim(sh.transport_mode) end, 'n/a') as shipping_method ,coalesce(case when trim(sh.id_means_of_transp)='' then null else trim(sh.id_means_of_transp) end, 'n/a') as flight_nbr ,coalesce(case when trim(sh.owner)='' then null else trim(sh.owner) end, 'n/a') as forwarder_id ,coalesce(case when trim(pa1.party_name_line1)='' then null else trim(pa1.party_name_line1) end, 'n/a') as forwarder_name ,coalesce(case when trim(sh.carrier)='' then null else trim(sh.carrier) end, 'n/a') as carrier_cd ,coalesce(case when trim(sh.load_point)='' then null else trim(sh.load_point) end, 'n/a') as port_of_lading_id ,coalesce(case when trim(pc1.place_name)='' then null else trim(pc1.place_name) end, 'n/a') as port_of_lading_name ,coalesce(case when trim(sh.state_province)='' then null else trim(sh.state_province) end, 'n/a') as port_of_discharge_id ,coalesce(case when trim(pc2.place_name)='' then null else trim(pc2.place_name) end, 'n/a') as port_of_discharge_name ,coalesce(case when trim(sh.final_dest)='' then null else trim(sh.final_dest) end, 'n/a') as destination_id ,coalesce(case when trim(pc3.place_name)='' then null else trim(pc3.place_name) end, 'n/a') as destination_name ,coalesce(case when trim(sd.measurement_val)='' then null else trim(sd.measurement_val) end, 0.00) as dim_wgt  ,coalesce(case when trim(sd.equip_meas_um)='' then null else trim(sd.equip_meas_um) end, 'n/a') as dim_wgt_uom ,coalesce(case when trim(sd.equip_weight_val)='' then null else trim(sd.equip_weight_val) end, 0.00) as gross_wgt ,coalesce(case when trim(sd.equip_weight_um)='' then null else trim(sd.equip_weight_um) end, 'n/a') as gross_wgt_uom ,coalesce(case when trim(p1.qty_per_pack)='' then null else trim(p1.qty_per_pack) end, 0.00) as total_cartons ,coalesce(to_utc_timestamp(from_unixtime(sh.export_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as actual_depart_dtm ,coalesce(to_utc_timestamp(from_unixtime(sh.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as transmission_dtm ,coalesce(to_utc_timestamp(from_unixtime(sh.act_arrive_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as eta_dtm ,coalesce(to_utc_timestamp(from_unixtime(dd1.recd_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as cargo_receipt_dtm ,coalesce(to_utc_timestamp(from_unixtime(dd2.last_delivery_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as docs_available_dtm ,coalesce(case when trim(sd.status)='' then null else trim(sd.status) end, 'n/a') as brand ,coalesce(case when trim(sd.deliver_to)='' then null else trim(sd.deliver_to) end, 'n/a') as deliver_to ,coalesce(coalesce(sd.contract_no,sd.order_no), 'n/a') as po_nbr ,coalesce(case when trim(sd.contract_no)='' then null else trim(sd.contract_no) end, 'n/a') as contract_nbr ,coalesce(case when trim(sd.order_no)='' then null else trim(sd.order_no) end, 'n/a') as order_nbr ,coalesce(case when trim(mh.matrix_total)='' then null else trim(mh.matrix_total) end, 0.00) as po_unit  ,coalesce(case when trim(p2.pack_id_qty)='' then null else trim(p2.pack_id_qty) end, 0.00) as po_cartons_qty  ,coalesce(case when trim(p2.total_wgt_pack_id)='' then null else trim(p2.total_wgt_pack_id) end, 0.00) as po_gross_wgt  ,coalesce(case when trim(p2.total_wgt_um)='' then null else trim(p2.total_wgt_um)end, 'n/a') as po_gross_wgt_uom  ,coalesce(case when trim(p2.line_wgt)='' then null else trim(p2.line_wgt) end, 0.00) as po_dim_wgt  ,coalesce(case when trim(p2.line_wgt_um)='' then null else trim(p2.line_wgt_um) end, 'n/a') as po_dim_wgt_uom  ,coalesce(case when trim(p2.net_wgt_unit)='' then null else trim(p2.net_wgt_unit) end, 0.00) as po_chargeable_wgt  ,coalesce(case when trim(p2.net_wgt_unit_um)='' then null else trim(p2.net_wgt_unit_um)end, 'n/a') as po_chargeable_wgt_uom  ,coalesce(case when trim(p2.pkg_type)='' then null else trim(p2.pkg_type) end, 'n/a') as garment_pack ,coalesce(case when trim(p3.sample_carton)='' then null else trim(p3.sample_carton) end, 'n/a') as pre_tkt ,coalesce(to_utc_timestamp(from_unixtime(sh.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(from_unixtime(sd.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm from rockport_stage0.trader_shipping_hdr sh left join rockport_stage0.trader_shipping_dtl sd on sh.owner=sd.owner and sh.bill_of_lading_no=sd.bill_of_lading_no left join rockport_stage0.trader_party pa1 on pa1.party_id=sh.owner left join scct_work_db.trader_plci3225_work pc1 on pc1.place_code=sh.load_point left join scct_work_db.trader_plci3225_work pc2 on pc2.place_code=sh.state_province left join scct_work_db.trader_plci3225_work pc3 on pc3.place_code=sh.final_dest left join rockport_stage0.trader_packing p1 on p1.owner=sh.owner and p1.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and p1.pack_id=sd.equip_id left join rockport_stage0.trader_packing p2 on p2.owner=sh.owner and p2.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and p2.pack_id=coalesce(sd.contract_no,sd.order_no) left join rockport_stage0.trader_packing p3 on p3.owner=sh.owner and p3.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no,' + ',sd.item,' + ',sd.item) and p3.pack_id=sd.item left join rockport_stage0.trader_delivery_dtl dd1 on dd1.owner=sh.owner and dd1.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and dd1.delivery_id=sd.equip_id and dd1.delivery_no='e1' left join rockport_stage0.trader_delivery_dtl dd2 on dd2.owner=sh.owner and dd2.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no) left join rockport_stage0.trader_matrix_hdr mh on mh.owner=sd.owner and mh.link_key_val=concat(sd.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no,' + ',sd.item,' + ',sd.item,' + ',sd.item) where sh.transport_mode='a' and sh.owner not like 'cfs%'
! echo completed loading into scct_work_db.rockport_air_shipment_work;
! echo started loading into scct_work_db.rockport_air_shipment_work1;
! echo completed loading into scct_work_db.rockport_air_shipment_work1;
! echo started loading into scct_db.rockport_air_shipment;
! echo completed loading into scct_db.rockport_air_shipment;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_dc -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2923 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ----------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_dc_intra -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-3287 ssoma dc to dc intra initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ----------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_store -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2922 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  -- 01.00.00.04 17jan21 scctp-601 kaali m replaced handling_master table with handling_master_poso  ----------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_store_intra -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-3287 ssoma dc to store intra initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  -- 01.00.00.04 17jan21 scctp-601 kaali m replaced handling_master table with handling_master_poso  ----------------------------------------------------------------------------   ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_gpom -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.03 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.04 04may20 scctp4-3331 ssoma hql optimization  ----------------------------------------------------------------------------  -------------------------  ------------------------- ---loading po line kpis data into po_so_dd_hu_details table for gpom model -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_mbp_nb -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 16oct19 scctp4-2523 ssoma changed partition columns and po for so model -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.04 05nov20 scctp-456 fyuan add fg filter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpis data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details for mast beauty production;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_mbp_vsd_gs -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master,location_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2931 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_tkvsd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, inventory_movement ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 27dec19 scctp4-3287 ssoma turnkey production to vsd initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_ven_rfc -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master,location_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2931 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_vendor_to_dc -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, inventory_movement ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 27dec19 scctp4-2996 ssoma component inflow initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_vsdinflow -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 06jan20 scctp4-3287 ssoma vsd inflow initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ----------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_vss_vsd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 06jan20 scctp4-2924 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  ----------------------------------------------------------------------------   ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_vtptobdc_nb -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, inventory_movement ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 27dec19 scctp4-2901 ssoma turnkey production to brand initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpis data into po_so_dd_hu_details table for vendor turnkey production -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_zdtd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug20 scctp5-327 fyuan zdtd initial version ---------------------------------------------------------------------------- ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_kpi_details_po -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_kpi_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.04 05nov20 scctp-456 fyuan add component filter  --------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_kpi_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_kpi_details;
! echo completed po_so_dd_hu_kpi_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_kpi_details_podd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_kpi_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 20aug20 scctp5-327 fyuan add zdtd  --------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_kpi_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_kpi_details;
! echo completed po_so_dd_hu_kpi_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_kpi_details_posodd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_kpi_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter --------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_kpi_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_kpi_details;
! echo completed po_so_dd_hu_kpi_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_kpi_details_sodd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_kpi_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter --------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_kpi_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_kpi_details;
! echo completed po_so_dd_hu_kpi_details data load;
---jobname:scct-e2e_dashboard-hive-stg1-scct_db.prepack_component -------------------------------------------------------------------------- ---target: stage1 table: scct_db.prepack_component  ---source: scct_db table : bom_item, bom_detail, analytics_view table : item ---load type: full ---back posting: no ---author: ryadav ---last modified date: 12/18/2018 --------------------------------------------------------------------------  ------------------------- ---loading prepack_component stage 1 base data -------------------------  ! echo started loading into scct_db.prepack_component ;
! echo completed loading into scct_db.prepack_component ;
---jobname:scct-e2e_outbound_visibility-hive-stg1-scct_db.purge_wms_outbound_e2e -------------------------------------------------------------------------- ---target: stage1 table: scct_db.wms_outbound_e2e ---source: scct_db table : scct_db.wms_outbound_e2e and operations_db.purge_tables  ---load type: incrimental ---back posting: no ---author: ssoma ---created date: 12/02/2019 --------------------------------------------------------------------------  ------------------------- ---loading worker table without str rows  -------------------------   insert overwrite table scct_work_db.wms_retail_warehouse_shipping_link_work select rs.retail_warehouse ,rs.retail_distro_nbr ,rs.retail_store_nbr ,rs.retail_season_nbr ,rs.retail_season_year_nbr ,rs.retail_style_nbr ,rs.retail_style_sfx_nbr ,rs.retail_sector ,rs.retail_sap_style ,rs.retail_sap_choice ,rs.retail_sap_size ,rs.retail_ticket_typ ,rs.retail_instore_dt ,rs.retail_distro_total_qty ,rs.retail_distro_allocated_qty ,rs.retail_distro_remaining_qty ,rs.retail_dtstor_status_flag ,rs.retail_record_expansion_fld ,rs.retail_delv_doc_nbr ,rs.retail_delv_doc_itm_nbr ,rs.retail_distro_last_modified_datetime ,rs.retail_distro_create_datetime ,rs.retail_pickticket_control_nbr ,rs.retail_pdpick_pkt_line_nbr ,rs.retail_pdpick_pick_wave_nbr ,rs.retail_wave_processing_typ ,rs.retail_inv_allocation_typ ,rs.retail_pick_determination_typ ,rs.retail_pick_loc_assignment_typ ,rs.retail_pickticket_pick_location ,rs.retail_original_pick_order_qty ,rs.retail_original_pick_qty ,rs.retail_pick_qty ,rs.retail_pick_shortage_qty ,rs.retail_pick_cancelled_qty ,rs.retail_pick_packed_qty ,rs.retail_pdpick_status_flg ,rs.retail_specl_instr_cd_1 ,rs.retail_pickticket_last_modified_datetime ,rs.retail_pdpick_user_id ,rs.retail_district ,rs.retail_shipto_name ,rs.retail_shipto_state ,rs.retail_shipto_zip ,rs.retail_shipto_country ,rs.retail_pickticket_header_created_datetime ,rs.retail_pickticket_header_last_modified_datetime ,rs.retail_phpick_user_id ,rs.retail_carton_nbr ,rs.retail_carton_line_nbr ,rs.retail_package_barcd ,rs.retail_cdcart_pkt_line_nbr ,rs.retail_cdcart_pick_wave_nbr ,rs.retail_carton_qty_to_be_packed ,rs.retail_carton_qty_packed ,rs.retail_carton_delivered_qty ,rs.retail_carton_cancelled_qty ,rs.retail_carton_pick_location ,rs.retail_cdcart_status_flag ,rs.retail_packer_id ,rs.retail_carton_line_create_datetime ,rs.retail_carton_line_last_modified_datetime ,rs.retail_cdcart_user_id ,rs.retail_misc_nbr_1 ,rs.retail_chcart_pick_wave_nbr ,rs.retail_chcart_status_flg ,rs.retail_pack_cd ,rs.retail_pack_typ ,rs.retail_single_sku_flg ,rs.retail_first_pick_location ,rs.retail_carton_typ ,rs.retail_carton_sz ,rs.retail_carton_volume ,rs.retail_estimated_weight ,rs.retail_actual_weight ,rs.retail_pallet_id ,rs.retail_product_value ,rs.retail_bill_of_lading ,rs.retail_shipment_nbr ,rs.retail_load_nbr ,rs.retail_path_nbr ,rs.retail_ship_via ,rs.retail_special_ins_cd_1 ,rs.retail_special_ins_cd_2 ,rs.retail_special_ins_cd_3 ,rs.retail_misc_10_byte_1 ,rs.retail_misc_20_byte_1 ,rs.retail_misc_20_byte_2 ,rs.retail_misc_20_byte_4 ,rs.retail_misc_20_byte_5 ,rs.retail_reference_case_nbr ,rs.retail_carton_nbr_x_of_y ,rs.retail_audit_status ,rs.retail_tms_parcel_nbr ,rs.retail_carton_length ,rs.retail_carton_width ,rs.retail_carton_height ,rs.retail_recipient_first_name ,rs.retail_carton_last_modified_datetime ,rs.retail_chcart_user_id ,rs.retail_pickticket_create_datetime ,rs.retail_carton_create_datetime ,rs.retail_carton_invoiced_datetime ,rs.retail_distro_to_wave_time_duration ,rs.retail_wave_to_invoiced_duration ,rs.retail_distro_total_reaches ,rs.retail_distro_allocated_reaches ,rs.retail_distro_remaining_reaches ,rs.retail_original_pick_order_reaches ,rs.retail_original_pick_reaches ,rs.retail_pick_reaches ,rs.retail_pick_shortage_reaches ,rs.retail_pick_cancelled_reaches ,rs.retail_pick_packed_reaches ,rs.retail_carton_reaches_to_be_packed ,rs.retail_carton_reaches_packed ,rs.retail_carton_delivered_reaches ,rs.retail_carton_cancelled_reaches ,rs.retail_fc_ltfc ,rs.retail_processing_area ,rs.shipping_misc_20_byte_3 ,rs.shipping_carton_nbr ,rs.shipping_warehouse ,rs.shipping_load_nbr ,rs.shipping_destination_typ ,rs.shipping_ship_via ,rs.shipping_master_bill_of_lading ,rs.shipping_trailer_nbr ,rs.shipping_tractor_nbr ,rs.shipping_driver ,rs.shipping_dock ,rs.shipping_door ,rs.shipping_dock_door_locn_brcd ,rs.shipping_tms_plan_nbr ,rs.shipping_status_flg ,rs.shipping_status_dt ,rs.shipping_load_closed_dt ,rs.shipping_load_closed_ts ,rs.shipping_tc_shipment_id ,rs.shipping_tpe_created_load ,rs.shipping_tpe_processing_status ,rs.shipping_misc_instruction_1 ,rs.shipping_created_dt ,rs.shipping_created_ts ,rs.shipping_last_modified_dt ,rs.shipping_last_modified_ts ,rs.shipping_user_id ,rs.shipping_record_type ,rs.shipping_trip_nbr ,rs.shipping_trip_type ,rs.shipping_dispatch_dt ,rs.shipping_dispatch_ts ,rs.shipping_carton_limit ,rs.shipping_run_nbr ,rs.shipping_thtrip_ship_via ,rs.shipping_thtrip_status_flg ,rs.shipping_delay_code ,rs.shipping_cartons_loaded ,rs.shipping_seal_nbr ,rs.shipping_date_billed ,rs.shipping_time_billed ,rs.shipping_thtrip_seal_nbr ,rs.shipping_misc1_numeric_fld ,rs.shipping_miscellaneous_20 ,rs.shipping_thtrip_created_dt ,rs.shipping_thtrip_created_ts ,rs.shipping_thtrip_last_modified_dt ,rs.shipping_thtrip_last_modified_ts ,rs.shipping_thtrip_user_id ,rs.shipping_load_create_dt_ts ,rs.shipping_load_closed_dt_ts ,rs.shipping_load_create_to_closed_duration ,rs.distro_create_date ,rs.batch_code from scct_db.wms_outbound_e2e rs join (select purge_min_dt, purge_max_dt from operations_db.purge_tables p join  (select date_sub(min(to_date(distro_create_datetime)),1) purge_max_dt from scct_db.wms_outbound_retail) r on 1=1 where p.run_ind='n') pt on 1=1 where rs.distro_create_date between pt.purge_min_dt and pt.purge_max_dt and rs.retail_pickticket_control_nbr not like 'str%';
! echo worker table load is completed;
------------------------- ---insert back to base table only not str retail_pickticket_control_nbr rows -------------------------   insert overwrite table scct_db.wms_outbound_e2e partition(distro_create_date) select retail_warehouse ,retail_distro_nbr ,retail_store_nbr ,retail_season_nbr ,retail_season_year_nbr ,retail_style_nbr ,retail_style_sfx_nbr ,retail_sector ,retail_sap_style ,retail_sap_choice ,retail_sap_size ,retail_ticket_typ ,retail_instore_dt ,retail_distro_total_qty ,retail_distro_allocated_qty ,retail_distro_remaining_qty ,retail_dtstor_status_flag ,retail_record_expansion_fld ,retail_delv_doc_nbr ,retail_delv_doc_itm_nbr ,retail_distro_last_modified_datetime ,retail_distro_create_datetime ,retail_pickticket_control_nbr ,retail_pdpick_pkt_line_nbr ,retail_pdpick_pick_wave_nbr ,retail_wave_processing_typ ,retail_inv_allocation_typ ,retail_pick_determination_typ ,retail_pick_loc_assignment_typ ,retail_pickticket_pick_location ,retail_original_pick_order_qty ,retail_original_pick_qty ,retail_pick_qty ,retail_pick_shortage_qty ,retail_pick_cancelled_qty ,retail_pick_packed_qty ,retail_pdpick_status_flg ,retail_specl_instr_cd_1 ,retail_pickticket_last_modified_datetime ,retail_pdpick_user_id ,retail_district ,retail_shipto_name ,retail_shipto_state ,retail_shipto_zip ,retail_shipto_country ,retail_pickticket_header_created_datetime ,retail_pickticket_header_last_modified_datetime ,retail_phpick_user_id ,retail_carton_nbr ,retail_carton_line_nbr ,retail_package_barcd ,retail_cdcart_pkt_line_nbr ,retail_cdcart_pick_wave_nbr ,retail_carton_qty_to_be_packed ,retail_carton_qty_packed ,retail_carton_delivered_qty ,retail_carton_cancelled_qty ,retail_carton_pick_location ,retail_cdcart_status_flag ,retail_packer_id ,retail_carton_line_create_datetime ,retail_carton_line_last_modified_datetime ,retail_cdcart_user_id ,retail_misc_nbr_1 ,retail_chcart_pick_wave_nbr ,retail_chcart_status_flg ,retail_pack_cd ,retail_pack_typ ,retail_single_sku_flg ,retail_first_pick_location ,retail_carton_typ ,retail_carton_sz ,retail_carton_volume ,retail_estimated_weight ,retail_actual_weight ,retail_pallet_id ,retail_product_value ,retail_bill_of_lading ,retail_shipment_nbr ,retail_load_nbr ,retail_path_nbr ,retail_ship_via ,retail_special_ins_cd_1 ,retail_special_ins_cd_2 ,retail_special_ins_cd_3 ,retail_misc_10_byte_1 ,retail_misc_20_byte_1 ,retail_misc_20_byte_2 ,retail_misc_20_byte_4 ,retail_misc_20_byte_5 ,retail_reference_case_nbr ,retail_carton_nbr_x_of_y ,retail_audit_status ,retail_tms_parcel_nbr ,retail_carton_length ,retail_carton_width ,retail_carton_height ,retail_recipient_first_name ,retail_carton_last_modified_datetime ,retail_chcart_user_id ,retail_pickticket_create_datetime ,retail_carton_create_datetime ,retail_carton_invoiced_datetime ,retail_distro_to_wave_time_duration ,retail_wave_to_invoiced_duration ,retail_distro_total_reaches ,retail_distro_allocated_reaches ,retail_distro_remaining_reaches ,retail_original_pick_order_reaches ,retail_original_pick_reaches ,retail_pick_reaches ,retail_pick_shortage_reaches ,retail_pick_cancelled_reaches ,retail_pick_packed_reaches ,retail_carton_reaches_to_be_packed ,retail_carton_reaches_packed ,retail_carton_delivered_reaches ,retail_carton_cancelled_reaches ,retail_fc_ltfc ,retail_processing_area ,shipping_misc_20_byte_3 ,shipping_carton_nbr ,shipping_warehouse ,shipping_load_nbr ,shipping_destination_typ ,shipping_ship_via ,shipping_master_bill_of_lading ,shipping_trailer_nbr ,shipping_tractor_nbr ,shipping_driver ,shipping_dock ,shipping_door ,shipping_dock_door_locn_brcd ,shipping_tms_plan_nbr ,shipping_status_flg ,shipping_status_dt ,shipping_load_closed_dt ,shipping_load_closed_ts ,shipping_tc_shipment_id ,shipping_tpe_created_load ,shipping_tpe_processing_status ,shipping_misc_instruction_1 ,shipping_created_dt ,shipping_created_ts ,shipping_last_modified_dt ,shipping_last_modified_ts ,shipping_user_id ,shipping_record_type ,shipping_trip_nbr ,shipping_trip_type ,shipping_dispatch_dt ,shipping_dispatch_ts ,shipping_carton_limit ,shipping_run_nbr ,shipping_thtrip_ship_via ,shipping_thtrip_status_flg ,shipping_delay_code ,shipping_cartons_loaded ,shipping_seal_nbr ,shipping_date_billed ,shipping_time_billed ,shipping_thtrip_seal_nbr ,shipping_misc1_numeric_fld ,shipping_miscellaneous_20 ,shipping_thtrip_created_dt ,shipping_thtrip_created_ts ,shipping_thtrip_last_modified_dt ,shipping_thtrip_last_modified_ts ,shipping_thtrip_user_id ,shipping_load_create_dt_ts ,shipping_load_closed_dt_ts ,shipping_load_create_to_closed_duration ,batch_code ,distro_create_date from scct_work_db.wms_retail_warehouse_shipping_link_work;
! echo purge str rows completed;
------------------------- ---update record into control table to purge str rows -------------------------   ! echo started entry into job control table;
------------------------- ---insert record into control table to purge str rows -------------------------  ! echo started entry into job control table;
! echo entry into job control table completed;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_air_shipment -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_air_shipment ---source: rockport_stage0 table : trader_shipping_hdr, trader_shipping_dtl, trader_party, trader_plci3225 --- trader_packing, trader_delivery_dtl and trader_matrix_hdr;
---load type: full ---back posting: no ---author: ssoma ---created date: 02/05/2019 --------------------------------------------------------------------------  ------------------------- ---loading work table scct_db.trader_plci3225_work  -------------------------   ! echo started loading into scct_work_db.trader_plci3225_work;
! echo completed loading into scct_work_db.trader_plci3225_work;
------------------------- ---loading stage1 table scct_db.rockport_air_shipment  -------------------------  ! echo started loading into scct_work_db.rockport_air_shipment_work;
insert overwrite table scct_work_db.rockport_air_shipment_work select coalesce(case when trim(sh.bill_of_lading_no)='' then null else trim(sh.bill_of_lading_no) end, 'n/a') as mawb_nbr ,coalesce(case when trim(sd.equip_id)='' then null else trim(sd.equip_id) end, 'n/a') as hawb_nbr ,coalesce(case when trim(sd.ref_no)='' then null else trim(sd.ref_no) end, 'n/a') as ref_nbr ,coalesce(case when trim(sd.item)='' then null else trim(sd.item) end, 'n/a') as itm_nbr ,coalesce(case when trim(sh.transport_mode)='' then null else trim(sh.transport_mode) end, 'n/a') as shipping_method ,coalesce(case when trim(sh.id_means_of_transp)='' then null else trim(sh.id_means_of_transp) end, 'n/a') as flight_nbr ,coalesce(case when trim(sh.owner)='' then null else trim(sh.owner) end, 'n/a') as forwarder_id ,coalesce(case when trim(pa1.party_name_line1)='' then null else trim(pa1.party_name_line1) end, 'n/a') as forwarder_name ,coalesce(case when trim(sh.carrier)='' then null else trim(sh.carrier) end, 'n/a') as carrier_cd ,coalesce(case when trim(sh.load_point)='' then null else trim(sh.load_point) end, 'n/a') as port_of_lading_id ,coalesce(case when trim(pc1.place_name)='' then null else trim(pc1.place_name) end, 'n/a') as port_of_lading_name ,coalesce(case when trim(sh.state_province)='' then null else trim(sh.state_province) end, 'n/a') as port_of_discharge_id ,coalesce(case when trim(pc2.place_name)='' then null else trim(pc2.place_name) end, 'n/a') as port_of_discharge_name ,coalesce(case when trim(sh.final_dest)='' then null else trim(sh.final_dest) end, 'n/a') as destination_id ,coalesce(case when trim(pc3.place_name)='' then null else trim(pc3.place_name) end, 'n/a') as destination_name ,coalesce(case when trim(sd.measurement_val)='' then null else trim(sd.measurement_val) end, 0.00) as dim_wgt  ,coalesce(case when trim(sd.equip_meas_um)='' then null else trim(sd.equip_meas_um) end, 'n/a') as dim_wgt_uom ,coalesce(case when trim(sd.equip_weight_val)='' then null else trim(sd.equip_weight_val) end, 0.00) as gross_wgt ,coalesce(case when trim(sd.equip_weight_um)='' then null else trim(sd.equip_weight_um) end, 'n/a') as gross_wgt_uom ,coalesce(case when trim(p1.qty_per_pack)='' then null else trim(p1.qty_per_pack) end, 0.00) as total_cartons ,coalesce(to_utc_timestamp(from_unixtime(sh.export_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as actual_depart_dtm ,coalesce(to_utc_timestamp(from_unixtime(sh.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as transmission_dtm ,coalesce(to_utc_timestamp(from_unixtime(sh.act_arrive_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as eta_dtm ,coalesce(to_utc_timestamp(from_unixtime(dd1.recd_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as cargo_receipt_dtm ,coalesce(to_utc_timestamp(from_unixtime(dd2.last_delivery_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as docs_available_dtm ,coalesce(case when trim(sd.status)='' then null else trim(sd.status) end, 'n/a') as brand ,coalesce(case when trim(sd.deliver_to)='' then null else trim(sd.deliver_to) end, 'n/a') as deliver_to ,coalesce(coalesce(sd.contract_no,sd.order_no), 'n/a') as po_nbr ,coalesce(case when trim(sd.contract_no)='' then null else trim(sd.contract_no) end, 'n/a') as contract_nbr ,coalesce(case when trim(sd.order_no)='' then null else trim(sd.order_no) end, 'n/a') as order_nbr ,coalesce(case when trim(mh.matrix_total)='' then null else trim(mh.matrix_total) end, 0.00) as po_unit  ,coalesce(case when trim(p2.pack_id_qty)='' then null else trim(p2.pack_id_qty) end, 0.00) as po_cartons_qty  ,coalesce(case when trim(p2.total_wgt_pack_id)='' then null else trim(p2.total_wgt_pack_id) end, 0.00) as po_gross_wgt  ,coalesce(case when trim(p2.total_wgt_um)='' then null else trim(p2.total_wgt_um)end, 'n/a') as po_gross_wgt_uom  ,coalesce(case when trim(p2.line_wgt)='' then null else trim(p2.line_wgt) end, 0.00) as po_dim_wgt  ,coalesce(case when trim(p2.line_wgt_um)='' then null else trim(p2.line_wgt_um) end, 'n/a') as po_dim_wgt_uom  ,coalesce(case when trim(p2.net_wgt_unit)='' then null else trim(p2.net_wgt_unit) end, 0.00) as po_chargeable_wgt  ,coalesce(case when trim(p2.net_wgt_unit_um)='' then null else trim(p2.net_wgt_unit_um)end, 'n/a') as po_chargeable_wgt_uom  ,coalesce(case when trim(p2.pkg_type)='' then null else trim(p2.pkg_type) end, 'n/a') as garment_pack ,coalesce(case when trim(p3.sample_carton)='' then null else trim(p3.sample_carton) end, 'n/a') as pre_tkt ,coalesce(to_utc_timestamp(from_unixtime(sh.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(from_unixtime(sd.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm from rockport_stage0.trader_shipping_hdr sh left join rockport_stage0.trader_shipping_dtl sd on sh.owner=sd.owner and sh.bill_of_lading_no=sd.bill_of_lading_no left join rockport_stage0.trader_party pa1 on pa1.party_id=sh.owner left join scct_work_db.trader_plci3225_work pc1 on pc1.place_code=sh.load_point left join scct_work_db.trader_plci3225_work pc2 on pc2.place_code=sh.state_province left join scct_work_db.trader_plci3225_work pc3 on pc3.place_code=sh.final_dest left join rockport_stage0.trader_packing p1 on p1.owner=sh.owner and p1.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and p1.pack_id=sd.equip_id left join rockport_stage0.trader_packing p2 on p2.owner=sh.owner and p2.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and p2.pack_id=coalesce(sd.contract_no,sd.order_no) left join rockport_stage0.trader_packing p3 on p3.owner=sh.owner and p3.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no,' + ',sd.item,' + ',sd.item) and p3.pack_id=sd.item left join rockport_stage0.trader_delivery_dtl dd1 on dd1.owner=sh.owner and dd1.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and dd1.delivery_id=sd.equip_id and dd1.delivery_no='e1' left join rockport_stage0.trader_delivery_dtl dd2 on dd2.owner=sh.owner and dd2.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no) left join rockport_stage0.trader_matrix_hdr mh on mh.owner=sd.owner and mh.link_key_val=concat(sd.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no,' + ',sd.item,' + ',sd.item,' + ',sd.item) where sh.transport_mode='a' and sh.owner not like 'cfs%'
! echo completed loading into scct_work_db.rockport_air_shipment_work;
! echo started loading into scct_work_db.rockport_air_shipment_work1;
! echo completed loading into scct_work_db.rockport_air_shipment_work1;
! echo started loading into scct_db.rockport_air_shipment;
! echo completed loading into scct_db.rockport_air_shipment;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_dc -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2923 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ----------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_dc_intra -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-3287 ssoma dc to dc intra initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ----------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_store -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2922 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  -- 01.00.00.04 17jan21 scctp-601 kaali m replaced handling_master table with handling_master_poso  ----------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_store_intra -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-3287 ssoma dc to store intra initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  -- 01.00.00.04 17jan21 scctp-601 kaali m replaced handling_master table with handling_master_poso  ----------------------------------------------------------------------------   ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_gpom -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.03 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.04 04may20 scctp4-3331 ssoma hql optimization  ----------------------------------------------------------------------------  -------------------------  ------------------------- ---loading po line kpis data into po_so_dd_hu_details table for gpom model -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_mbp_nb -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 16oct19 scctp4-2523 ssoma changed partition columns and po for so model -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.04 05nov20 scctp-456 fyuan add fg filter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpis data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details for mast beauty production;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_mbp_vsd_gs -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master,location_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2931 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_tkvsd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, inventory_movement ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 27dec19 scctp4-3287 ssoma turnkey production to vsd initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_ven_rfc -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master,location_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2931 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_vendor_to_dc -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, inventory_movement ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 27dec19 scctp4-2996 ssoma component inflow initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_vsdinflow -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 06jan20 scctp4-3287 ssoma vsd inflow initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ----------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_vss_vsd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 06jan20 scctp4-2924 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  ----------------------------------------------------------------------------   ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_vtptobdc_nb -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, inventory_movement ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 27dec19 scctp4-2901 ssoma turnkey production to brand initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpis data into po_so_dd_hu_details table for vendor turnkey production -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_zdtd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug20 scctp5-327 fyuan zdtd initial version ---------------------------------------------------------------------------- ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_kpi_details_po -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_kpi_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.04 05nov20 scctp-456 fyuan add component filter  --------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_kpi_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_kpi_details;
! echo completed po_so_dd_hu_kpi_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_kpi_details_podd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_kpi_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 20aug20 scctp5-327 fyuan add zdtd  --------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_kpi_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_kpi_details;
! echo completed po_so_dd_hu_kpi_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_kpi_details_posodd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_kpi_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter --------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_kpi_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_kpi_details;
! echo completed po_so_dd_hu_kpi_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_kpi_details_sodd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_kpi_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter --------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_kpi_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_kpi_details;
! echo completed po_so_dd_hu_kpi_details data load;
---jobname:scct-e2e_dashboard-hive-stg1-scct_db.prepack_component -------------------------------------------------------------------------- ---target: stage1 table: scct_db.prepack_component  ---source: scct_db table : bom_item, bom_detail, analytics_view table : item ---load type: full ---back posting: no ---author: ryadav ---last modified date: 12/18/2018 --------------------------------------------------------------------------  ------------------------- ---loading prepack_component stage 1 base data -------------------------  ! echo started loading into scct_db.prepack_component ;
! echo completed loading into scct_db.prepack_component ;
---jobname:scct-e2e_outbound_visibility-hive-stg1-scct_db.purge_wms_outbound_e2e -------------------------------------------------------------------------- ---target: stage1 table: scct_db.wms_outbound_e2e ---source: scct_db table : scct_db.wms_outbound_e2e and operations_db.purge_tables  ---load type: incrimental ---back posting: no ---author: ssoma ---created date: 12/02/2019 --------------------------------------------------------------------------  ------------------------- ---loading worker table without str rows  -------------------------   insert overwrite table scct_work_db.wms_retail_warehouse_shipping_link_work select rs.retail_warehouse ,rs.retail_distro_nbr ,rs.retail_store_nbr ,rs.retail_season_nbr ,rs.retail_season_year_nbr ,rs.retail_style_nbr ,rs.retail_style_sfx_nbr ,rs.retail_sector ,rs.retail_sap_style ,rs.retail_sap_choice ,rs.retail_sap_size ,rs.retail_ticket_typ ,rs.retail_instore_dt ,rs.retail_distro_total_qty ,rs.retail_distro_allocated_qty ,rs.retail_distro_remaining_qty ,rs.retail_dtstor_status_flag ,rs.retail_record_expansion_fld ,rs.retail_delv_doc_nbr ,rs.retail_delv_doc_itm_nbr ,rs.retail_distro_last_modified_datetime ,rs.retail_distro_create_datetime ,rs.retail_pickticket_control_nbr ,rs.retail_pdpick_pkt_line_nbr ,rs.retail_pdpick_pick_wave_nbr ,rs.retail_wave_processing_typ ,rs.retail_inv_allocation_typ ,rs.retail_pick_determination_typ ,rs.retail_pick_loc_assignment_typ ,rs.retail_pickticket_pick_location ,rs.retail_original_pick_order_qty ,rs.retail_original_pick_qty ,rs.retail_pick_qty ,rs.retail_pick_shortage_qty ,rs.retail_pick_cancelled_qty ,rs.retail_pick_packed_qty ,rs.retail_pdpick_status_flg ,rs.retail_specl_instr_cd_1 ,rs.retail_pickticket_last_modified_datetime ,rs.retail_pdpick_user_id ,rs.retail_district ,rs.retail_shipto_name ,rs.retail_shipto_state ,rs.retail_shipto_zip ,rs.retail_shipto_country ,rs.retail_pickticket_header_created_datetime ,rs.retail_pickticket_header_last_modified_datetime ,rs.retail_phpick_user_id ,rs.retail_carton_nbr ,rs.retail_carton_line_nbr ,rs.retail_package_barcd ,rs.retail_cdcart_pkt_line_nbr ,rs.retail_cdcart_pick_wave_nbr ,rs.retail_carton_qty_to_be_packed ,rs.retail_carton_qty_packed ,rs.retail_carton_delivered_qty ,rs.retail_carton_cancelled_qty ,rs.retail_carton_pick_location ,rs.retail_cdcart_status_flag ,rs.retail_packer_id ,rs.retail_carton_line_create_datetime ,rs.retail_carton_line_last_modified_datetime ,rs.retail_cdcart_user_id ,rs.retail_misc_nbr_1 ,rs.retail_chcart_pick_wave_nbr ,rs.retail_chcart_status_flg ,rs.retail_pack_cd ,rs.retail_pack_typ ,rs.retail_single_sku_flg ,rs.retail_first_pick_location ,rs.retail_carton_typ ,rs.retail_carton_sz ,rs.retail_carton_volume ,rs.retail_estimated_weight ,rs.retail_actual_weight ,rs.retail_pallet_id ,rs.retail_product_value ,rs.retail_bill_of_lading ,rs.retail_shipment_nbr ,rs.retail_load_nbr ,rs.retail_path_nbr ,rs.retail_ship_via ,rs.retail_special_ins_cd_1 ,rs.retail_special_ins_cd_2 ,rs.retail_special_ins_cd_3 ,rs.retail_misc_10_byte_1 ,rs.retail_misc_20_byte_1 ,rs.retail_misc_20_byte_2 ,rs.retail_misc_20_byte_4 ,rs.retail_misc_20_byte_5 ,rs.retail_reference_case_nbr ,rs.retail_carton_nbr_x_of_y ,rs.retail_audit_status ,rs.retail_tms_parcel_nbr ,rs.retail_carton_length ,rs.retail_carton_width ,rs.retail_carton_height ,rs.retail_recipient_first_name ,rs.retail_carton_last_modified_datetime ,rs.retail_chcart_user_id ,rs.retail_pickticket_create_datetime ,rs.retail_carton_create_datetime ,rs.retail_carton_invoiced_datetime ,rs.retail_distro_to_wave_time_duration ,rs.retail_wave_to_invoiced_duration ,rs.retail_distro_total_reaches ,rs.retail_distro_allocated_reaches ,rs.retail_distro_remaining_reaches ,rs.retail_original_pick_order_reaches ,rs.retail_original_pick_reaches ,rs.retail_pick_reaches ,rs.retail_pick_shortage_reaches ,rs.retail_pick_cancelled_reaches ,rs.retail_pick_packed_reaches ,rs.retail_carton_reaches_to_be_packed ,rs.retail_carton_reaches_packed ,rs.retail_carton_delivered_reaches ,rs.retail_carton_cancelled_reaches ,rs.retail_fc_ltfc ,rs.retail_processing_area ,rs.shipping_misc_20_byte_3 ,rs.shipping_carton_nbr ,rs.shipping_warehouse ,rs.shipping_load_nbr ,rs.shipping_destination_typ ,rs.shipping_ship_via ,rs.shipping_master_bill_of_lading ,rs.shipping_trailer_nbr ,rs.shipping_tractor_nbr ,rs.shipping_driver ,rs.shipping_dock ,rs.shipping_door ,rs.shipping_dock_door_locn_brcd ,rs.shipping_tms_plan_nbr ,rs.shipping_status_flg ,rs.shipping_status_dt ,rs.shipping_load_closed_dt ,rs.shipping_load_closed_ts ,rs.shipping_tc_shipment_id ,rs.shipping_tpe_created_load ,rs.shipping_tpe_processing_status ,rs.shipping_misc_instruction_1 ,rs.shipping_created_dt ,rs.shipping_created_ts ,rs.shipping_last_modified_dt ,rs.shipping_last_modified_ts ,rs.shipping_user_id ,rs.shipping_record_type ,rs.shipping_trip_nbr ,rs.shipping_trip_type ,rs.shipping_dispatch_dt ,rs.shipping_dispatch_ts ,rs.shipping_carton_limit ,rs.shipping_run_nbr ,rs.shipping_thtrip_ship_via ,rs.shipping_thtrip_status_flg ,rs.shipping_delay_code ,rs.shipping_cartons_loaded ,rs.shipping_seal_nbr ,rs.shipping_date_billed ,rs.shipping_time_billed ,rs.shipping_thtrip_seal_nbr ,rs.shipping_misc1_numeric_fld ,rs.shipping_miscellaneous_20 ,rs.shipping_thtrip_created_dt ,rs.shipping_thtrip_created_ts ,rs.shipping_thtrip_last_modified_dt ,rs.shipping_thtrip_last_modified_ts ,rs.shipping_thtrip_user_id ,rs.shipping_load_create_dt_ts ,rs.shipping_load_closed_dt_ts ,rs.shipping_load_create_to_closed_duration ,rs.distro_create_date ,rs.batch_code from scct_db.wms_outbound_e2e rs join (select purge_min_dt, purge_max_dt from operations_db.purge_tables p join  (select date_sub(min(to_date(distro_create_datetime)),1) purge_max_dt from scct_db.wms_outbound_retail) r on 1=1 where p.run_ind='n') pt on 1=1 where rs.distro_create_date between pt.purge_min_dt and pt.purge_max_dt and rs.retail_pickticket_control_nbr not like 'str%';
! echo worker table load is completed;
------------------------- ---insert back to base table only not str retail_pickticket_control_nbr rows -------------------------   insert overwrite table scct_db.wms_outbound_e2e partition(distro_create_date) select retail_warehouse ,retail_distro_nbr ,retail_store_nbr ,retail_season_nbr ,retail_season_year_nbr ,retail_style_nbr ,retail_style_sfx_nbr ,retail_sector ,retail_sap_style ,retail_sap_choice ,retail_sap_size ,retail_ticket_typ ,retail_instore_dt ,retail_distro_total_qty ,retail_distro_allocated_qty ,retail_distro_remaining_qty ,retail_dtstor_status_flag ,retail_record_expansion_fld ,retail_delv_doc_nbr ,retail_delv_doc_itm_nbr ,retail_distro_last_modified_datetime ,retail_distro_create_datetime ,retail_pickticket_control_nbr ,retail_pdpick_pkt_line_nbr ,retail_pdpick_pick_wave_nbr ,retail_wave_processing_typ ,retail_inv_allocation_typ ,retail_pick_determination_typ ,retail_pick_loc_assignment_typ ,retail_pickticket_pick_location ,retail_original_pick_order_qty ,retail_original_pick_qty ,retail_pick_qty ,retail_pick_shortage_qty ,retail_pick_cancelled_qty ,retail_pick_packed_qty ,retail_pdpick_status_flg ,retail_specl_instr_cd_1 ,retail_pickticket_last_modified_datetime ,retail_pdpick_user_id ,retail_district ,retail_shipto_name ,retail_shipto_state ,retail_shipto_zip ,retail_shipto_country ,retail_pickticket_header_created_datetime ,retail_pickticket_header_last_modified_datetime ,retail_phpick_user_id ,retail_carton_nbr ,retail_carton_line_nbr ,retail_package_barcd ,retail_cdcart_pkt_line_nbr ,retail_cdcart_pick_wave_nbr ,retail_carton_qty_to_be_packed ,retail_carton_qty_packed ,retail_carton_delivered_qty ,retail_carton_cancelled_qty ,retail_carton_pick_location ,retail_cdcart_status_flag ,retail_packer_id ,retail_carton_line_create_datetime ,retail_carton_line_last_modified_datetime ,retail_cdcart_user_id ,retail_misc_nbr_1 ,retail_chcart_pick_wave_nbr ,retail_chcart_status_flg ,retail_pack_cd ,retail_pack_typ ,retail_single_sku_flg ,retail_first_pick_location ,retail_carton_typ ,retail_carton_sz ,retail_carton_volume ,retail_estimated_weight ,retail_actual_weight ,retail_pallet_id ,retail_product_value ,retail_bill_of_lading ,retail_shipment_nbr ,retail_load_nbr ,retail_path_nbr ,retail_ship_via ,retail_special_ins_cd_1 ,retail_special_ins_cd_2 ,retail_special_ins_cd_3 ,retail_misc_10_byte_1 ,retail_misc_20_byte_1 ,retail_misc_20_byte_2 ,retail_misc_20_byte_4 ,retail_misc_20_byte_5 ,retail_reference_case_nbr ,retail_carton_nbr_x_of_y ,retail_audit_status ,retail_tms_parcel_nbr ,retail_carton_length ,retail_carton_width ,retail_carton_height ,retail_recipient_first_name ,retail_carton_last_modified_datetime ,retail_chcart_user_id ,retail_pickticket_create_datetime ,retail_carton_create_datetime ,retail_carton_invoiced_datetime ,retail_distro_to_wave_time_duration ,retail_wave_to_invoiced_duration ,retail_distro_total_reaches ,retail_distro_allocated_reaches ,retail_distro_remaining_reaches ,retail_original_pick_order_reaches ,retail_original_pick_reaches ,retail_pick_reaches ,retail_pick_shortage_reaches ,retail_pick_cancelled_reaches ,retail_pick_packed_reaches ,retail_carton_reaches_to_be_packed ,retail_carton_reaches_packed ,retail_carton_delivered_reaches ,retail_carton_cancelled_reaches ,retail_fc_ltfc ,retail_processing_area ,shipping_misc_20_byte_3 ,shipping_carton_nbr ,shipping_warehouse ,shipping_load_nbr ,shipping_destination_typ ,shipping_ship_via ,shipping_master_bill_of_lading ,shipping_trailer_nbr ,shipping_tractor_nbr ,shipping_driver ,shipping_dock ,shipping_door ,shipping_dock_door_locn_brcd ,shipping_tms_plan_nbr ,shipping_status_flg ,shipping_status_dt ,shipping_load_closed_dt ,shipping_load_closed_ts ,shipping_tc_shipment_id ,shipping_tpe_created_load ,shipping_tpe_processing_status ,shipping_misc_instruction_1 ,shipping_created_dt ,shipping_created_ts ,shipping_last_modified_dt ,shipping_last_modified_ts ,shipping_user_id ,shipping_record_type ,shipping_trip_nbr ,shipping_trip_type ,shipping_dispatch_dt ,shipping_dispatch_ts ,shipping_carton_limit ,shipping_run_nbr ,shipping_thtrip_ship_via ,shipping_thtrip_status_flg ,shipping_delay_code ,shipping_cartons_loaded ,shipping_seal_nbr ,shipping_date_billed ,shipping_time_billed ,shipping_thtrip_seal_nbr ,shipping_misc1_numeric_fld ,shipping_miscellaneous_20 ,shipping_thtrip_created_dt ,shipping_thtrip_created_ts ,shipping_thtrip_last_modified_dt ,shipping_thtrip_last_modified_ts ,shipping_thtrip_user_id ,shipping_load_create_dt_ts ,shipping_load_closed_dt_ts ,shipping_load_create_to_closed_duration ,batch_code ,distro_create_date from scct_work_db.wms_retail_warehouse_shipping_link_work;
! echo purge str rows completed;
------------------------- ---update record into control table to purge str rows -------------------------   ! echo started entry into job control table;
------------------------- ---insert record into control table to purge str rows -------------------------  ! echo started entry into job control table;
! echo entry into job control table completed;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_air_shipment -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_air_shipment ---source: rockport_stage0 table : trader_shipping_hdr, trader_shipping_dtl, trader_party, trader_plci3225 --- trader_packing, trader_delivery_dtl and trader_matrix_hdr;
---load type: full ---back posting: no ---author: ssoma ---created date: 02/05/2019 --------------------------------------------------------------------------  ------------------------- ---loading work table scct_db.trader_plci3225_work  -------------------------   ! echo started loading into scct_work_db.trader_plci3225_work;
! echo completed loading into scct_work_db.trader_plci3225_work;
------------------------- ---loading stage1 table scct_db.rockport_air_shipment  -------------------------  ! echo started loading into scct_work_db.rockport_air_shipment_work;
insert overwrite table scct_work_db.rockport_air_shipment_work select coalesce(case when trim(sh.bill_of_lading_no)='' then null else trim(sh.bill_of_lading_no) end, 'n/a') as mawb_nbr ,coalesce(case when trim(sd.equip_id)='' then null else trim(sd.equip_id) end, 'n/a') as hawb_nbr ,coalesce(case when trim(sd.ref_no)='' then null else trim(sd.ref_no) end, 'n/a') as ref_nbr ,coalesce(case when trim(sd.item)='' then null else trim(sd.item) end, 'n/a') as itm_nbr ,coalesce(case when trim(sh.transport_mode)='' then null else trim(sh.transport_mode) end, 'n/a') as shipping_method ,coalesce(case when trim(sh.id_means_of_transp)='' then null else trim(sh.id_means_of_transp) end, 'n/a') as flight_nbr ,coalesce(case when trim(sh.owner)='' then null else trim(sh.owner) end, 'n/a') as forwarder_id ,coalesce(case when trim(pa1.party_name_line1)='' then null else trim(pa1.party_name_line1) end, 'n/a') as forwarder_name ,coalesce(case when trim(sh.carrier)='' then null else trim(sh.carrier) end, 'n/a') as carrier_cd ,coalesce(case when trim(sh.load_point)='' then null else trim(sh.load_point) end, 'n/a') as port_of_lading_id ,coalesce(case when trim(pc1.place_name)='' then null else trim(pc1.place_name) end, 'n/a') as port_of_lading_name ,coalesce(case when trim(sh.state_province)='' then null else trim(sh.state_province) end, 'n/a') as port_of_discharge_id ,coalesce(case when trim(pc2.place_name)='' then null else trim(pc2.place_name) end, 'n/a') as port_of_discharge_name ,coalesce(case when trim(sh.final_dest)='' then null else trim(sh.final_dest) end, 'n/a') as destination_id ,coalesce(case when trim(pc3.place_name)='' then null else trim(pc3.place_name) end, 'n/a') as destination_name ,coalesce(case when trim(sd.measurement_val)='' then null else trim(sd.measurement_val) end, 0.00) as dim_wgt  ,coalesce(case when trim(sd.equip_meas_um)='' then null else trim(sd.equip_meas_um) end, 'n/a') as dim_wgt_uom ,coalesce(case when trim(sd.equip_weight_val)='' then null else trim(sd.equip_weight_val) end, 0.00) as gross_wgt ,coalesce(case when trim(sd.equip_weight_um)='' then null else trim(sd.equip_weight_um) end, 'n/a') as gross_wgt_uom ,coalesce(case when trim(p1.qty_per_pack)='' then null else trim(p1.qty_per_pack) end, 0.00) as total_cartons ,coalesce(to_utc_timestamp(from_unixtime(sh.export_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as actual_depart_dtm ,coalesce(to_utc_timestamp(from_unixtime(sh.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as transmission_dtm ,coalesce(to_utc_timestamp(from_unixtime(sh.act_arrive_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as eta_dtm ,coalesce(to_utc_timestamp(from_unixtime(dd1.recd_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as cargo_receipt_dtm ,coalesce(to_utc_timestamp(from_unixtime(dd2.last_delivery_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as docs_available_dtm ,coalesce(case when trim(sd.status)='' then null else trim(sd.status) end, 'n/a') as brand ,coalesce(case when trim(sd.deliver_to)='' then null else trim(sd.deliver_to) end, 'n/a') as deliver_to ,coalesce(coalesce(sd.contract_no,sd.order_no), 'n/a') as po_nbr ,coalesce(case when trim(sd.contract_no)='' then null else trim(sd.contract_no) end, 'n/a') as contract_nbr ,coalesce(case when trim(sd.order_no)='' then null else trim(sd.order_no) end, 'n/a') as order_nbr ,coalesce(case when trim(mh.matrix_total)='' then null else trim(mh.matrix_total) end, 0.00) as po_unit  ,coalesce(case when trim(p2.pack_id_qty)='' then null else trim(p2.pack_id_qty) end, 0.00) as po_cartons_qty  ,coalesce(case when trim(p2.total_wgt_pack_id)='' then null else trim(p2.total_wgt_pack_id) end, 0.00) as po_gross_wgt  ,coalesce(case when trim(p2.total_wgt_um)='' then null else trim(p2.total_wgt_um)end, 'n/a') as po_gross_wgt_uom  ,coalesce(case when trim(p2.line_wgt)='' then null else trim(p2.line_wgt) end, 0.00) as po_dim_wgt  ,coalesce(case when trim(p2.line_wgt_um)='' then null else trim(p2.line_wgt_um) end, 'n/a') as po_dim_wgt_uom  ,coalesce(case when trim(p2.net_wgt_unit)='' then null else trim(p2.net_wgt_unit) end, 0.00) as po_chargeable_wgt  ,coalesce(case when trim(p2.net_wgt_unit_um)='' then null else trim(p2.net_wgt_unit_um)end, 'n/a') as po_chargeable_wgt_uom  ,coalesce(case when trim(p2.pkg_type)='' then null else trim(p2.pkg_type) end, 'n/a') as garment_pack ,coalesce(case when trim(p3.sample_carton)='' then null else trim(p3.sample_carton) end, 'n/a') as pre_tkt ,coalesce(to_utc_timestamp(from_unixtime(sh.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(from_unixtime(sd.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm from rockport_stage0.trader_shipping_hdr sh left join rockport_stage0.trader_shipping_dtl sd on sh.owner=sd.owner and sh.bill_of_lading_no=sd.bill_of_lading_no left join rockport_stage0.trader_party pa1 on pa1.party_id=sh.owner left join scct_work_db.trader_plci3225_work pc1 on pc1.place_code=sh.load_point left join scct_work_db.trader_plci3225_work pc2 on pc2.place_code=sh.state_province left join scct_work_db.trader_plci3225_work pc3 on pc3.place_code=sh.final_dest left join rockport_stage0.trader_packing p1 on p1.owner=sh.owner and p1.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and p1.pack_id=sd.equip_id left join rockport_stage0.trader_packing p2 on p2.owner=sh.owner and p2.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and p2.pack_id=coalesce(sd.contract_no,sd.order_no) left join rockport_stage0.trader_packing p3 on p3.owner=sh.owner and p3.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no,' + ',sd.item,' + ',sd.item) and p3.pack_id=sd.item left join rockport_stage0.trader_delivery_dtl dd1 on dd1.owner=sh.owner and dd1.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and dd1.delivery_id=sd.equip_id and dd1.delivery_no='e1' left join rockport_stage0.trader_delivery_dtl dd2 on dd2.owner=sh.owner and dd2.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no) left join rockport_stage0.trader_matrix_hdr mh on mh.owner=sd.owner and mh.link_key_val=concat(sd.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no,' + ',sd.item,' + ',sd.item,' + ',sd.item) where sh.transport_mode='a' and sh.owner not like 'cfs%'
! echo completed loading into scct_work_db.rockport_air_shipment_work;
! echo started loading into scct_work_db.rockport_air_shipment_work1;
! echo completed loading into scct_work_db.rockport_air_shipment_work1;
! echo started loading into scct_db.rockport_air_shipment;
! echo completed loading into scct_db.rockport_air_shipment;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_dc -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2923 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ----------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_dc_intra -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-3287 ssoma dc to dc intra initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ----------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_store -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2922 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  -- 01.00.00.04 17jan21 scctp-601 kaali m replaced handling_master table with handling_master_poso  ----------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_dc_to_store_intra -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-3287 ssoma dc to store intra initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  -- 01.00.00.04 17jan21 scctp-601 kaali m replaced handling_master table with handling_master_poso  ----------------------------------------------------------------------------   ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_gpom -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.03 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.04 04may20 scctp4-3331 ssoma hql optimization  ----------------------------------------------------------------------------  -------------------------  ------------------------- ---loading po line kpis data into po_so_dd_hu_details table for gpom model -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_mbp_nb -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 16oct19 scctp4-2523 ssoma changed partition columns and po for so model -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.04 05nov20 scctp-456 fyuan add fg filter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpis data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details for mast beauty production;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_mbp_vsd_gs -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master,location_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2931 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_tkvsd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, inventory_movement ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 27dec19 scctp4-3287 ssoma turnkey production to vsd initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_ven_rfc -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master,location_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2931 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_vendor_to_dc -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, inventory_movement ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 27dec19 scctp4-2996 ssoma component inflow initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_vsdinflow -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 06jan20 scctp4-3287 ssoma vsd inflow initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ----------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_vss_vsd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 06jan20 scctp4-2924 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  ----------------------------------------------------------------------------   ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_vtptobdc_nb -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, inventory_movement ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 27dec19 scctp4-2901 ssoma turnkey production to brand initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter ---------------------------------------------------------------------------  ------------------------- ---loading po line kpis data into po_so_dd_hu_details table for vendor turnkey production -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_details_zdtd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug20 scctp5-327 fyuan zdtd initial version ---------------------------------------------------------------------------- ------------------------- ---loading po line kpi's data into po_so_dd_hu_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_details;
! echo completed po_so_dd_hu_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_kpi_details_po -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_kpi_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.04 05nov20 scctp-456 fyuan add component filter  --------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_kpi_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_kpi_details;
! echo completed po_so_dd_hu_kpi_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_kpi_details_podd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_kpi_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 20aug20 scctp5-327 fyuan add zdtd  --------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_kpi_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_kpi_details;
! echo completed po_so_dd_hu_kpi_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_kpi_details_posodd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_kpi_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter --------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_kpi_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_kpi_details;
! echo completed po_so_dd_hu_kpi_details data load;
---jobname:scct-ufposo-hive-stg1-po_so_dd_hu_kpi_details_sodd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_so_dd_hu_kpi_details  ---source: tms_stage0 table : po_master, delivery_master, inventory_movement,  ---handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 20aug19 scctp4-2276 ssoma initial version -- 01.00.00.02 09oct19 scctp4-2523 ssoma changed partition columns and added new column -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter --------------------------------------------------------------------------  ------------------------- ---loading po line kpi's data into po_so_dd_hu_kpi_details table -------------------------  ! echo started loading into scct_db.po_so_dd_hu_kpi_details;
! echo completed po_so_dd_hu_kpi_details data load;
---jobname:scct-e2e_dashboard-hive-stg1-scct_db.prepack_component -------------------------------------------------------------------------- ---target: stage1 table: scct_db.prepack_component  ---source: scct_db table : bom_item, bom_detail, analytics_view table : item ---load type: full ---back posting: no ---author: ryadav ---last modified date: 12/18/2018 --------------------------------------------------------------------------  ------------------------- ---loading prepack_component stage 1 base data -------------------------  ! echo started loading into scct_db.prepack_component ;
! echo completed loading into scct_db.prepack_component ;
---jobname:scct-e2e_outbound_visibility-hive-stg1-scct_db.purge_wms_outbound_e2e -------------------------------------------------------------------------- ---target: stage1 table: scct_db.wms_outbound_e2e ---source: scct_db table : scct_db.wms_outbound_e2e and operations_db.purge_tables  ---load type: incrimental ---back posting: no ---author: ssoma ---created date: 12/02/2019 --------------------------------------------------------------------------  ------------------------- ---loading worker table without str rows  -------------------------   insert overwrite table scct_work_db.wms_retail_warehouse_shipping_link_work select rs.retail_warehouse ,rs.retail_distro_nbr ,rs.retail_store_nbr ,rs.retail_season_nbr ,rs.retail_season_year_nbr ,rs.retail_style_nbr ,rs.retail_style_sfx_nbr ,rs.retail_sector ,rs.retail_sap_style ,rs.retail_sap_choice ,rs.retail_sap_size ,rs.retail_ticket_typ ,rs.retail_instore_dt ,rs.retail_distro_total_qty ,rs.retail_distro_allocated_qty ,rs.retail_distro_remaining_qty ,rs.retail_dtstor_status_flag ,rs.retail_record_expansion_fld ,rs.retail_delv_doc_nbr ,rs.retail_delv_doc_itm_nbr ,rs.retail_distro_last_modified_datetime ,rs.retail_distro_create_datetime ,rs.retail_pickticket_control_nbr ,rs.retail_pdpick_pkt_line_nbr ,rs.retail_pdpick_pick_wave_nbr ,rs.retail_wave_processing_typ ,rs.retail_inv_allocation_typ ,rs.retail_pick_determination_typ ,rs.retail_pick_loc_assignment_typ ,rs.retail_pickticket_pick_location ,rs.retail_original_pick_order_qty ,rs.retail_original_pick_qty ,rs.retail_pick_qty ,rs.retail_pick_shortage_qty ,rs.retail_pick_cancelled_qty ,rs.retail_pick_packed_qty ,rs.retail_pdpick_status_flg ,rs.retail_specl_instr_cd_1 ,rs.retail_pickticket_last_modified_datetime ,rs.retail_pdpick_user_id ,rs.retail_district ,rs.retail_shipto_name ,rs.retail_shipto_state ,rs.retail_shipto_zip ,rs.retail_shipto_country ,rs.retail_pickticket_header_created_datetime ,rs.retail_pickticket_header_last_modified_datetime ,rs.retail_phpick_user_id ,rs.retail_carton_nbr ,rs.retail_carton_line_nbr ,rs.retail_package_barcd ,rs.retail_cdcart_pkt_line_nbr ,rs.retail_cdcart_pick_wave_nbr ,rs.retail_carton_qty_to_be_packed ,rs.retail_carton_qty_packed ,rs.retail_carton_delivered_qty ,rs.retail_carton_cancelled_qty ,rs.retail_carton_pick_location ,rs.retail_cdcart_status_flag ,rs.retail_packer_id ,rs.retail_carton_line_create_datetime ,rs.retail_carton_line_last_modified_datetime ,rs.retail_cdcart_user_id ,rs.retail_misc_nbr_1 ,rs.retail_chcart_pick_wave_nbr ,rs.retail_chcart_status_flg ,rs.retail_pack_cd ,rs.retail_pack_typ ,rs.retail_single_sku_flg ,rs.retail_first_pick_location ,rs.retail_carton_typ ,rs.retail_carton_sz ,rs.retail_carton_volume ,rs.retail_estimated_weight ,rs.retail_actual_weight ,rs.retail_pallet_id ,rs.retail_product_value ,rs.retail_bill_of_lading ,rs.retail_shipment_nbr ,rs.retail_load_nbr ,rs.retail_path_nbr ,rs.retail_ship_via ,rs.retail_special_ins_cd_1 ,rs.retail_special_ins_cd_2 ,rs.retail_special_ins_cd_3 ,rs.retail_misc_10_byte_1 ,rs.retail_misc_20_byte_1 ,rs.retail_misc_20_byte_2 ,rs.retail_misc_20_byte_4 ,rs.retail_misc_20_byte_5 ,rs.retail_reference_case_nbr ,rs.retail_carton_nbr_x_of_y ,rs.retail_audit_status ,rs.retail_tms_parcel_nbr ,rs.retail_carton_length ,rs.retail_carton_width ,rs.retail_carton_height ,rs.retail_recipient_first_name ,rs.retail_carton_last_modified_datetime ,rs.retail_chcart_user_id ,rs.retail_pickticket_create_datetime ,rs.retail_carton_create_datetime ,rs.retail_carton_invoiced_datetime ,rs.retail_distro_to_wave_time_duration ,rs.retail_wave_to_invoiced_duration ,rs.retail_distro_total_reaches ,rs.retail_distro_allocated_reaches ,rs.retail_distro_remaining_reaches ,rs.retail_original_pick_order_reaches ,rs.retail_original_pick_reaches ,rs.retail_pick_reaches ,rs.retail_pick_shortage_reaches ,rs.retail_pick_cancelled_reaches ,rs.retail_pick_packed_reaches ,rs.retail_carton_reaches_to_be_packed ,rs.retail_carton_reaches_packed ,rs.retail_carton_delivered_reaches ,rs.retail_carton_cancelled_reaches ,rs.retail_fc_ltfc ,rs.retail_processing_area ,rs.shipping_misc_20_byte_3 ,rs.shipping_carton_nbr ,rs.shipping_warehouse ,rs.shipping_load_nbr ,rs.shipping_destination_typ ,rs.shipping_ship_via ,rs.shipping_master_bill_of_lading ,rs.shipping_trailer_nbr ,rs.shipping_tractor_nbr ,rs.shipping_driver ,rs.shipping_dock ,rs.shipping_door ,rs.shipping_dock_door_locn_brcd ,rs.shipping_tms_plan_nbr ,rs.shipping_status_flg ,rs.shipping_status_dt ,rs.shipping_load_closed_dt ,rs.shipping_load_closed_ts ,rs.shipping_tc_shipment_id ,rs.shipping_tpe_created_load ,rs.shipping_tpe_processing_status ,rs.shipping_misc_instruction_1 ,rs.shipping_created_dt ,rs.shipping_created_ts ,rs.shipping_last_modified_dt ,rs.shipping_last_modified_ts ,rs.shipping_user_id ,rs.shipping_record_type ,rs.shipping_trip_nbr ,rs.shipping_trip_type ,rs.shipping_dispatch_dt ,rs.shipping_dispatch_ts ,rs.shipping_carton_limit ,rs.shipping_run_nbr ,rs.shipping_thtrip_ship_via ,rs.shipping_thtrip_status_flg ,rs.shipping_delay_code ,rs.shipping_cartons_loaded ,rs.shipping_seal_nbr ,rs.shipping_date_billed ,rs.shipping_time_billed ,rs.shipping_thtrip_seal_nbr ,rs.shipping_misc1_numeric_fld ,rs.shipping_miscellaneous_20 ,rs.shipping_thtrip_created_dt ,rs.shipping_thtrip_created_ts ,rs.shipping_thtrip_last_modified_dt ,rs.shipping_thtrip_last_modified_ts ,rs.shipping_thtrip_user_id ,rs.shipping_load_create_dt_ts ,rs.shipping_load_closed_dt_ts ,rs.shipping_load_create_to_closed_duration ,rs.distro_create_date ,rs.batch_code from scct_db.wms_outbound_e2e rs join (select purge_min_dt, purge_max_dt from operations_db.purge_tables p join  (select date_sub(min(to_date(distro_create_datetime)),1) purge_max_dt from scct_db.wms_outbound_retail) r on 1=1 where p.run_ind='n') pt on 1=1 where rs.distro_create_date between pt.purge_min_dt and pt.purge_max_dt and rs.retail_pickticket_control_nbr not like 'str%';
! echo worker table load is completed;
------------------------- ---insert back to base table only not str retail_pickticket_control_nbr rows -------------------------   insert overwrite table scct_db.wms_outbound_e2e partition(distro_create_date) select retail_warehouse ,retail_distro_nbr ,retail_store_nbr ,retail_season_nbr ,retail_season_year_nbr ,retail_style_nbr ,retail_style_sfx_nbr ,retail_sector ,retail_sap_style ,retail_sap_choice ,retail_sap_size ,retail_ticket_typ ,retail_instore_dt ,retail_distro_total_qty ,retail_distro_allocated_qty ,retail_distro_remaining_qty ,retail_dtstor_status_flag ,retail_record_expansion_fld ,retail_delv_doc_nbr ,retail_delv_doc_itm_nbr ,retail_distro_last_modified_datetime ,retail_distro_create_datetime ,retail_pickticket_control_nbr ,retail_pdpick_pkt_line_nbr ,retail_pdpick_pick_wave_nbr ,retail_wave_processing_typ ,retail_inv_allocation_typ ,retail_pick_determination_typ ,retail_pick_loc_assignment_typ ,retail_pickticket_pick_location ,retail_original_pick_order_qty ,retail_original_pick_qty ,retail_pick_qty ,retail_pick_shortage_qty ,retail_pick_cancelled_qty ,retail_pick_packed_qty ,retail_pdpick_status_flg ,retail_specl_instr_cd_1 ,retail_pickticket_last_modified_datetime ,retail_pdpick_user_id ,retail_district ,retail_shipto_name ,retail_shipto_state ,retail_shipto_zip ,retail_shipto_country ,retail_pickticket_header_created_datetime ,retail_pickticket_header_last_modified_datetime ,retail_phpick_user_id ,retail_carton_nbr ,retail_carton_line_nbr ,retail_package_barcd ,retail_cdcart_pkt_line_nbr ,retail_cdcart_pick_wave_nbr ,retail_carton_qty_to_be_packed ,retail_carton_qty_packed ,retail_carton_delivered_qty ,retail_carton_cancelled_qty ,retail_carton_pick_location ,retail_cdcart_status_flag ,retail_packer_id ,retail_carton_line_create_datetime ,retail_carton_line_last_modified_datetime ,retail_cdcart_user_id ,retail_misc_nbr_1 ,retail_chcart_pick_wave_nbr ,retail_chcart_status_flg ,retail_pack_cd ,retail_pack_typ ,retail_single_sku_flg ,retail_first_pick_location ,retail_carton_typ ,retail_carton_sz ,retail_carton_volume ,retail_estimated_weight ,retail_actual_weight ,retail_pallet_id ,retail_product_value ,retail_bill_of_lading ,retail_shipment_nbr ,retail_load_nbr ,retail_path_nbr ,retail_ship_via ,retail_special_ins_cd_1 ,retail_special_ins_cd_2 ,retail_special_ins_cd_3 ,retail_misc_10_byte_1 ,retail_misc_20_byte_1 ,retail_misc_20_byte_2 ,retail_misc_20_byte_4 ,retail_misc_20_byte_5 ,retail_reference_case_nbr ,retail_carton_nbr_x_of_y ,retail_audit_status ,retail_tms_parcel_nbr ,retail_carton_length ,retail_carton_width ,retail_carton_height ,retail_recipient_first_name ,retail_carton_last_modified_datetime ,retail_chcart_user_id ,retail_pickticket_create_datetime ,retail_carton_create_datetime ,retail_carton_invoiced_datetime ,retail_distro_to_wave_time_duration ,retail_wave_to_invoiced_duration ,retail_distro_total_reaches ,retail_distro_allocated_reaches ,retail_distro_remaining_reaches ,retail_original_pick_order_reaches ,retail_original_pick_reaches ,retail_pick_reaches ,retail_pick_shortage_reaches ,retail_pick_cancelled_reaches ,retail_pick_packed_reaches ,retail_carton_reaches_to_be_packed ,retail_carton_reaches_packed ,retail_carton_delivered_reaches ,retail_carton_cancelled_reaches ,retail_fc_ltfc ,retail_processing_area ,shipping_misc_20_byte_3 ,shipping_carton_nbr ,shipping_warehouse ,shipping_load_nbr ,shipping_destination_typ ,shipping_ship_via ,shipping_master_bill_of_lading ,shipping_trailer_nbr ,shipping_tractor_nbr ,shipping_driver ,shipping_dock ,shipping_door ,shipping_dock_door_locn_brcd ,shipping_tms_plan_nbr ,shipping_status_flg ,shipping_status_dt ,shipping_load_closed_dt ,shipping_load_closed_ts ,shipping_tc_shipment_id ,shipping_tpe_created_load ,shipping_tpe_processing_status ,shipping_misc_instruction_1 ,shipping_created_dt ,shipping_created_ts ,shipping_last_modified_dt ,shipping_last_modified_ts ,shipping_user_id ,shipping_record_type ,shipping_trip_nbr ,shipping_trip_type ,shipping_dispatch_dt ,shipping_dispatch_ts ,shipping_carton_limit ,shipping_run_nbr ,shipping_thtrip_ship_via ,shipping_thtrip_status_flg ,shipping_delay_code ,shipping_cartons_loaded ,shipping_seal_nbr ,shipping_date_billed ,shipping_time_billed ,shipping_thtrip_seal_nbr ,shipping_misc1_numeric_fld ,shipping_miscellaneous_20 ,shipping_thtrip_created_dt ,shipping_thtrip_created_ts ,shipping_thtrip_last_modified_dt ,shipping_thtrip_last_modified_ts ,shipping_thtrip_user_id ,shipping_load_create_dt_ts ,shipping_load_closed_dt_ts ,shipping_load_create_to_closed_duration ,batch_code ,distro_create_date from scct_work_db.wms_retail_warehouse_shipping_link_work;
! echo purge str rows completed;
------------------------- ---update record into control table to purge str rows -------------------------   ! echo started entry into job control table;
------------------------- ---insert record into control table to purge str rows -------------------------  ! echo started entry into job control table;
! echo entry into job control table completed;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_air_shipment -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_air_shipment ---source: rockport_stage0 table : trader_shipping_hdr, trader_shipping_dtl, trader_party, trader_plci3225 --- trader_packing, trader_delivery_dtl and trader_matrix_hdr;
---load type: full ---back posting: no ---author: ssoma ---created date: 02/05/2019 --------------------------------------------------------------------------  ------------------------- ---loading work table scct_db.trader_plci3225_work  -------------------------   ! echo started loading into scct_work_db.trader_plci3225_work;
! echo completed loading into scct_work_db.trader_plci3225_work;
------------------------- ---loading stage1 table scct_db.rockport_air_shipment  -------------------------  ! echo started loading into scct_work_db.rockport_air_shipment_work;
insert overwrite table scct_work_db.rockport_air_shipment_work select coalesce(case when trim(sh.bill_of_lading_no)='' then null else trim(sh.bill_of_lading_no) end, 'n/a') as mawb_nbr ,coalesce(case when trim(sd.equip_id)='' then null else trim(sd.equip_id) end, 'n/a') as hawb_nbr ,coalesce(case when trim(sd.ref_no)='' then null else trim(sd.ref_no) end, 'n/a') as ref_nbr ,coalesce(case when trim(sd.item)='' then null else trim(sd.item) end, 'n/a') as itm_nbr ,coalesce(case when trim(sh.transport_mode)='' then null else trim(sh.transport_mode) end, 'n/a') as shipping_method ,coalesce(case when trim(sh.id_means_of_transp)='' then null else trim(sh.id_means_of_transp) end, 'n/a') as flight_nbr ,coalesce(case when trim(sh.owner)='' then null else trim(sh.owner) end, 'n/a') as forwarder_id ,coalesce(case when trim(pa1.party_name_line1)='' then null else trim(pa1.party_name_line1) end, 'n/a') as forwarder_name ,coalesce(case when trim(sh.carrier)='' then null else trim(sh.carrier) end, 'n/a') as carrier_cd ,coalesce(case when trim(sh.load_point)='' then null else trim(sh.load_point) end, 'n/a') as port_of_lading_id ,coalesce(case when trim(pc1.place_name)='' then null else trim(pc1.place_name) end, 'n/a') as port_of_lading_name ,coalesce(case when trim(sh.state_province)='' then null else trim(sh.state_province) end, 'n/a') as port_of_discharge_id ,coalesce(case when trim(pc2.place_name)='' then null else trim(pc2.place_name) end, 'n/a') as port_of_discharge_name ,coalesce(case when trim(sh.final_dest)='' then null else trim(sh.final_dest) end, 'n/a') as destination_id ,coalesce(case when trim(pc3.place_name)='' then null else trim(pc3.place_name) end, 'n/a') as destination_name ,coalesce(case when trim(sd.measurement_val)='' then null else trim(sd.measurement_val) end, 0.00) as dim_wgt  ,coalesce(case when trim(sd.equip_meas_um)='' then null else trim(sd.equip_meas_um) end, 'n/a') as dim_wgt_uom ,coalesce(case when trim(sd.equip_weight_val)='' then null else trim(sd.equip_weight_val) end, 0.00) as gross_wgt ,coalesce(case when trim(sd.equip_weight_um)='' then null else trim(sd.equip_weight_um) end, 'n/a') as gross_wgt_uom ,coalesce(case when trim(p1.qty_per_pack)='' then null else trim(p1.qty_per_pack) end, 0.00) as total_cartons ,coalesce(to_utc_timestamp(from_unixtime(sh.export_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as actual_depart_dtm ,coalesce(to_utc_timestamp(from_unixtime(sh.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as transmission_dtm ,coalesce(to_utc_timestamp(from_unixtime(sh.act_arrive_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as eta_dtm ,coalesce(to_utc_timestamp(from_unixtime(dd1.recd_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as cargo_receipt_dtm ,coalesce(to_utc_timestamp(from_unixtime(dd2.last_delivery_date div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as docs_available_dtm ,coalesce(case when trim(sd.status)='' then null else trim(sd.status) end, 'n/a') as brand ,coalesce(case when trim(sd.deliver_to)='' then null else trim(sd.deliver_to) end, 'n/a') as deliver_to ,coalesce(coalesce(sd.contract_no,sd.order_no), 'n/a') as po_nbr ,coalesce(case when trim(sd.contract_no)='' then null else trim(sd.contract_no) end, 'n/a') as contract_nbr ,coalesce(case when trim(sd.order_no)='' then null else trim(sd.order_no) end, 'n/a') as order_nbr ,coalesce(case when trim(mh.matrix_total)='' then null else trim(mh.matrix_total) end, 0.00) as po_unit  ,coalesce(case when trim(p2.pack_id_qty)='' then null else trim(p2.pack_id_qty) end, 0.00) as po_cartons_qty  ,coalesce(case when trim(p2.total_wgt_pack_id)='' then null else trim(p2.total_wgt_pack_id) end, 0.00) as po_gross_wgt  ,coalesce(case when trim(p2.total_wgt_um)='' then null else trim(p2.total_wgt_um)end, 'n/a') as po_gross_wgt_uom  ,coalesce(case when trim(p2.line_wgt)='' then null else trim(p2.line_wgt) end, 0.00) as po_dim_wgt  ,coalesce(case when trim(p2.line_wgt_um)='' then null else trim(p2.line_wgt_um) end, 'n/a') as po_dim_wgt_uom  ,coalesce(case when trim(p2.net_wgt_unit)='' then null else trim(p2.net_wgt_unit) end, 0.00) as po_chargeable_wgt  ,coalesce(case when trim(p2.net_wgt_unit_um)='' then null else trim(p2.net_wgt_unit_um)end, 'n/a') as po_chargeable_wgt_uom  ,coalesce(case when trim(p2.pkg_type)='' then null else trim(p2.pkg_type) end, 'n/a') as garment_pack ,coalesce(case when trim(p3.sample_carton)='' then null else trim(p3.sample_carton) end, 'n/a') as pre_tkt ,coalesce(to_utc_timestamp(from_unixtime(sh.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(from_unixtime(sd.last_update div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm from rockport_stage0.trader_shipping_hdr sh left join rockport_stage0.trader_shipping_dtl sd on sh.owner=sd.owner and sh.bill_of_lading_no=sd.bill_of_lading_no left join rockport_stage0.trader_party pa1 on pa1.party_id=sh.owner left join scct_work_db.trader_plci3225_work pc1 on pc1.place_code=sh.load_point left join scct_work_db.trader_plci3225_work pc2 on pc2.place_code=sh.state_province left join scct_work_db.trader_plci3225_work pc3 on pc3.place_code=sh.final_dest left join rockport_stage0.trader_packing p1 on p1.owner=sh.owner and p1.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and p1.pack_id=sd.equip_id left join rockport_stage0.trader_packing p2 on p2.owner=sh.owner and p2.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and p2.pack_id=coalesce(sd.contract_no,sd.order_no) left join rockport_stage0.trader_packing p3 on p3.owner=sh.owner and p3.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no,' + ',sd.item,' + ',sd.item) and p3.pack_id=sd.item left join rockport_stage0.trader_delivery_dtl dd1 on dd1.owner=sh.owner and dd1.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id) and dd1.delivery_id=sd.equip_id and dd1.delivery_no='e1' left join rockport_stage0.trader_delivery_dtl dd2 on dd2.owner=sh.owner and dd2.link_key_val=concat(sh.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no) left join rockport_stage0.trader_matrix_hdr mh on mh.owner=sd.owner and mh.link_key_val=concat(sd.bill_of_lading_no,' + ',sd.equip_id,' + ',sd.item,' + ',sd.ref_no,' + ',sd.item,' + ',sd.item,' + ',sd.item) where sh.transport_mode='a' and sh.owner not like 'cfs%'
! echo completed loading into scct_work_db.rockport_air_shipment_work;
! echo started loading into scct_work_db.rockport_air_shipment_work1;
! echo completed loading into scct_work_db.rockport_air_shipment_work1;
! echo started loading into scct_db.rockport_air_shipment;
! echo completed loading into scct_db.rockport_air_shipment;
