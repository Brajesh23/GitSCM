--! echo completed loading into scct_work_db.dy_pyrl_pos_audited_unaudited_merge ;
---jobname:scct-aces-hive-stg1-scct_work_db.dy_pyrl_pos_audited_unaudited_tmp2 -------------------------------------------------------------------------- ---target: stage1 table: scct_work_db.dy_pyrl_pos_audited_unaudited_tmp2 ---source: scct_work_db.dy_pyrl_pos_audited_unaudited_master ---load type: full load ---back posting: yes --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 10feb20 scctp4-3096 ryadav initial version   ------------------------- ---loading scct_work_db.dy_pyrl_pos_audited_unaudited_tmp2 work table data -------------------------  --set tez.job.name=stage1_scct_db:dy_pyrl_pos_audited_unaudited_tmp2 :load work table dy_pyrl_pos_audited_unaudited_tmp2 ;
--! echo started loading into scct_work_db.dy_pyrl_pos_audited_unaudited_tmp2 ;
insert overwrite into scct_work_db.dy_pyrl_pos_audited_unaudited_tmp2 select 2 as process_id ,lgcy_sto_nbr ,brnd_cd ,assc_ssn_nbr ,from_unixtime(strtdt+(pe.pos*60*60)) strtdt ,substr(from_unixtime(strtdt+(pe.pos*60*60)),12,2) hr_nbr ,from_unixtime(strtdt+((pe.pos+1)*60*60)) enddt , 1 as pyrl_hr_amt ,pos_pyrl_cd ,trxn_post_dt ,clk_pnch_evnt_id ,lst_mod_dttm ,lst_mod_pty_id_val ,pyrl_tme_typ_nme ,prod_pyrl_ind ,tplh_flg_ind from (select lgcy_sto_nbr ,brnd_cd ,assc_ssn_nbr ,strtdt ,enddt ,pyrl_hr_amt ,pos_pyrl_cd ,trxn_post_dt ,clk_pnch_evnt_id ,lst_mod_dttm ,lst_mod_pty_id_val ,pyrl_tme_typ_nme ,prod_pyrl_ind ,tplh_flg_ind from ( select lgcy_sto_nbr ,brnd_cd ,assc_ssn_nbr ,strtdt ,enddt ,pyrl_hr_amt ,pos_pyrl_cd ,trxn_post_dt ,clk_pnch_evnt_id ,lst_mod_dttm ,lst_mod_pty_id_val ,pyrl_tme_typ_nme ,prod_pyrl_ind ,tplh_flg_ind from (select lgcy_sto_nbr ,brnd_cd ,assc_ssn_nbr ,unix_timestamp(strtdt)+ (60*60)-strttm_sec%(60*60) as strtdt ,unix_timestamp(enddt)- endtm_sec%(60*60) as enddt ,pyrl_hr_amt ,pos_pyrl_cd ,trxn_post_dt ,clk_pnch_evnt_id ,lst_mod_dttm ,lst_mod_pty_id_val ,pyrl_tme_typ_nme ,prod_pyrl_ind ,tplh_flg_ind from ( select lgcy_sto_nbr ,brnd_cd ,assc_ssn_nbr ,clk_pnch_in_dttm strtdt --,hr_nbr ,clk_pnch_out_dttm enddt ,pyrl_hr_amt ,pos_pyrl_cd ,trxn_post_dt ,clk_pnch_evnt_id ,lst_mod_dttm ,lst_mod_pty_id_val ,pyrl_tme_typ_nme ,prod_pyrl_ind ,tplh_flg_ind ,substr(clk_pnch_in_dttm,12,8) as strttm ,substr(clk_pnch_out_dttm,12,8) as endtm ,(hour(concat('1900-01-01 ',trim(substr(clk_pnch_in_dttm,12,8)))::timestamp)*60*60 +minute(concat('1900-01-01 ',trim(substr(clk_pnch_in_dttm,12,8)))::timestamp)*60 +second(concat('1900-01-01 ',trim(substr(clk_pnch_in_dttm,12,8)))::timestamp)) as strttm_sec  ,(hour(concat('1900-01-01 ',trim(substr(clk_pnch_out_dttm,12,8)))::timestamp)*60*60 +minute(concat('1900-01-01 ',trim(substr(clk_pnch_out_dttm,12,8)))::timestamp)*60 +second(concat('1900-01-01 ',trim(substr(clk_pnch_out_dttm,12,8)))::timestamp)) as endtm_sec ,(((unix_timestamp(clk_pnch_out_dttm)-unix_timestamp(clk_pnch_in_dttm))/60) -(case when substr(clk_pnch_in_dttm,15,5)='00:00' then 0 else (60*60-(hour(concat('1900-01-01 ',trim(substr(clk_pnch_in_dttm,12,8)))::timestamp)*60*60  +minute(concat('1900-01-01 ',trim(substr(clk_pnch_in_dttm,12,8)))::timestamp)*60  +second(concat('1900-01-01 ',trim(substr(clk_pnch_in_dttm,12,8)))::timestamp))) end)/60 )as chk from scct_work_db.dy_pyrl_pos_audited_unaudited_master where (unix_timestamp(clk_pnch_out_dttm)-unix_timestamp(clk_pnch_in_dttm)>=60*60) )t1 where chk>=60)t2 where strtdt<>enddt )t3 ) ,lateral  (select  (div0(enddt,(60*60)) - div0(strtdt,(60*60))) :: int -1 as pos) pe
--posexplode(split(space((div(enddt,(60*60)) - div(strtdt,(60*60)))::int-1),' ')) pe;
--! echo completed loading into scct_work_db.dy_pyrl_pos_audited_unaudited_tmp2 ;
