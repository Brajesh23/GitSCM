! echo completed loading into scct_db.supply_chain_summary_node_wk_loc_cat ;
---jobname:scct-tms-hive-stg1-scct_db.tms_accessorial_master -------------------------------------------------------------------------- ---target: stage1 table: scct_db.tms_accessorial_master ---source: tms_stage0 table : ca2015_accessorial_code, ca2015_accessorial_type and ca2015_accessorial_rate ---load type: incremental ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07nov19 scctp4-2485 mgohain initial version -- 01.00.00.02 11nov19 scctp4-2660 mgohain primary key changed to accessorial_id,accessorial_param_set_id,accessorial_rate_id and accessorial_type -- 01.00.00.03 11nov19 scctp4-2740 mgohain source datatype changed for last_updated_dttm in table ca2015_accessorial_code -- 01.00.00.04 10dec19 scctp4-2740 mgohain target date columns converted to est --------------------------------------------------------------------------  ------------------------- ---job related hive settings -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading stage0 data into staging table -------------------------  set tez.job.name=staging:tms_accessorial_master_tmp :load target from ca2015_accessorial_code, ca2015_accessorial_type and ca2015_accessorial_rate;
! echo started loading into scct_work_db.tms_accessorial_master_tmp;
insert overwrite table scct_work_db.tms_accessorial_master_tmp select distinct coalesce(case when trim(acc_type.description)='' then null else trim(acc_type.description) end, 'n/a') as accessorial_type_description, coalesce(acc_cd.tc_company_id, 0) as tc_company_id, coalesce(case when trim(acc_cd.accessorial_code)='' then null else trim(acc_cd.accessorial_code) end, 'n/a') as accessorial_cd, coalesce(case when trim(acc_cd.accessorial_type)='' then null else trim(acc_cd.accessorial_type) end, 'n/a') as accessorial_type, coalesce(case when trim(acc_cd.data_source)='' then null else trim(acc_cd.data_source) end, 'n/a') as data_source, coalesce(case when trim(acc_cd.distance_uom)='' then null else trim(acc_cd.distance_uom) end, 'n/a') as distance_uom, coalesce(case when trim(acc_cd.description)='' then null else trim(acc_cd.description) end, 'n/a') as accessorial_description, coalesce(to_utc_timestamp(from_unixtime(acc_cd.last_updated_dttm div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as last_updated_dttm, coalesce(acc_cd.is_hazmat, 0) as is_hazmat, coalesce(acc_cd.is_default_for_invoice, 0) as is_default_for_invoice, coalesce(acc_cd.is_fuel_accessorial, 0) as is_fuel_accessorial, coalesce(acc_cd.accessorial_id , 0) as accessorial_id, coalesce(acc_cd.is_tax_accessorial, 0) as is_tax_accessorial, coalesce(acc_cd.is_add_to_spot_charge, 0) as is_add_to_spot_charge, coalesce(acc_cd.is_add_stop_off_charge, 0) as is_add_stop_off_charge, coalesce(acc_cd.calculation_option_level, 0) as calculation_option_level, coalesce(acc_cd.delivery_level, 0) as delivery_level, coalesce(acc_cd.is_requested, 0) as is_requested, coalesce(acc_cd.is_ship_via, 0) as is_ship_via, coalesce(acc_cd.calculation_factor, 0) as calculation_factor, coalesce(acc_cd.is_oversize, 0) as is_oversize, coalesce(acc_cd.is_apply_once_per_ship, 0) as is_apply_once_per_ship, coalesce(acc_cd.fuel_index_id, 0) as fuel_index_id, coalesce(acc_cd.is_cost_plus_accessorial, 0) as is_cost_plus_accessorial, coalesce(acc_rate.accessorial_param_set_id, 0) as accessorial_param_set_id, coalesce(acc_rate.accessorial_rate_id, 0) as accessorial_rate_id, coalesce(acc_rate.rate, 0.0) as rate, coalesce(acc_rate.minimum_rate, 0.0) as minimum_rate, coalesce(case when trim(acc_rate.currency_code)='' then null else trim(acc_rate.currency_code) end, 'n/a') as currency_cd, coalesce(acc_rate.is_auto_approve, 0) as is_auto_approve, coalesce(to_date(to_utc_timestamp(from_unixtime(acc_rate.effective_dt div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt")), '9999-12-31') as effective_dt, coalesce(to_date(to_utc_timestamp(from_unixtime(acc_rate.expiration_dt div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt")), '9999-12-31') as expiration_dt, coalesce(acc_rate.effective_seq, 0) as effective_seq, coalesce(acc_rate.is_shipment_accessorial, 0) as is_shipment_accessorial, coalesce(acc_rate.mot_id, 0) as mot_id, coalesce(acc_rate.equipment_id, 0) as equipment_id, coalesce(acc_rate.service_level_id, 0) as service_level_id, coalesce(acc_rate.protection_level_id, 0) as protection_level_id from tms_stage0.ca2015_accessorial_code acc_cd left outer join tms_stage0.ca2015_accessorial_type acc_type on acc_cd.accessorial_type=acc_type.accessorial_type left outer join tms_stage0.ca2015_accessorial_rate acc_rate on acc_cd.accessorial_id=acc_rate.accessorial_id
------------------------- ---loading staging data into final staging table -------------------------  set tez.job.name=staging:tms_accessorial_master_tmp1 :load target table from tms_accessorial_master_tmp;
! echo started loading into scct_work_db.tms_accessorial_master_tmp1;
insert overwrite table scct_work_db.tms_accessorial_master_tmp1 select coalesce(tmp.accessorial_type_description, t.accessorial_type_description), coalesce(tmp.tc_company_id, t.tc_company_id), coalesce(tmp.accessorial_cd, t.accessorial_cd), coalesce(tmp.accessorial_type, t.accessorial_type), coalesce(tmp.data_source, t.data_source), coalesce(tmp.distance_uom, t.distance_uom), coalesce(tmp.accessorial_description, t.accessorial_description), coalesce(tmp.last_updated_dttm, t.last_updated_dttm), coalesce(tmp.is_hazmat, t.is_hazmat), coalesce(tmp.is_default_for_invoice, t.is_default_for_invoice), coalesce(tmp.is_fuel_accessorial, t.is_fuel_accessorial), coalesce(tmp.accessorial_id, t.accessorial_id), coalesce(tmp.is_tax_accessorial, t.is_tax_accessorial), coalesce(tmp.is_add_to_spot_charge, t.is_add_to_spot_charge), coalesce(tmp.is_add_stop_off_charge, t.is_add_stop_off_charge), coalesce(tmp.calculation_option_level, t.calculation_option_level), coalesce(tmp.delivery_level, t.delivery_level), coalesce(tmp.is_requested, t.is_requested), coalesce(tmp.is_ship_via, t.is_ship_via), coalesce(tmp.calculation_factor, t.calculation_factor), coalesce(tmp.is_oversize, t.is_oversize), coalesce(tmp.is_apply_once_per_ship, t.is_apply_once_per_ship), coalesce(tmp.fuel_index_id, t.fuel_index_id), coalesce(tmp.is_cost_plus_accessorial, t.is_cost_plus_accessorial), coalesce(tmp.accessorial_param_set_id, t.accessorial_param_set_id), coalesce(tmp.accessorial_rate_id, t.accessorial_rate_id), coalesce(tmp.rate, t.rate), coalesce(tmp.minimum_rate, t.minimum_rate), coalesce(tmp.currency_cd, t.currency_cd), coalesce(tmp.is_auto_approve, t.is_auto_approve), coalesce(tmp.effective_dt, t.effective_dt), coalesce(tmp.expiration_dt, t.expiration_dt), coalesce(tmp.effective_seq, t.effective_seq), coalesce(tmp.is_shipment_accessorial, t.is_shipment_accessorial), coalesce(tmp.mot_id, t.mot_id), coalesce(tmp.equipment_id, t.equipment_id), coalesce(tmp.service_level_id, t.service_level_id), coalesce(tmp.protection_level_id, t.protection_level_id) from scct_db.tms_accessorial_master t full outer join scct_work_db.tms_accessorial_master_tmp tmp on t.accessorial_id=tmp.accessorial_id and t.accessorial_param_set_id=tmp.accessorial_param_set_id and t.accessorial_rate_id=tmp.accessorial_rate_id and t.accessorial_type=tmp.accessorial_type
------------------------- ---loading staging data into target table -------------------------  set tez.job.name=staging:tms_accessorial_master :load target table from tms_accessorial_master_tmp1;
! echo started loading into scct_db.tms_accessorial_master;
insert overwrite table scct_db.tms_accessorial_master select accessorial_type_description, tc_company_id, accessorial_cd, accessorial_type, data_source, distance_uom, accessorial_description, last_updated_dttm, is_hazmat, is_default_for_invoice, is_fuel_accessorial, accessorial_id, is_tax_accessorial, is_add_to_spot_charge, is_add_stop_off_charge, calculation_option_level, delivery_level, is_requested, is_ship_via, calculation_factor, is_oversize, is_apply_once_per_ship, fuel_index_id, is_cost_plus_accessorial, accessorial_param_set_id, accessorial_rate_id, rate, minimum_rate, currency_cd, is_auto_approve, effective_dt, expiration_dt, effective_seq, is_shipment_accessorial, mot_id, equipment_id, service_level_id, protection_level_id from scct_work_db.tms_accessorial_master_tmp1
! echo data load is completed;
! echo completed loading into scct_db.supply_chain_summary_node_wk_loc_cat ;
---jobname:scct-tms-hive-stg1-scct_db.tms_accessorial_master -------------------------------------------------------------------------- ---target: stage1 table: scct_db.tms_accessorial_master ---source: tms_stage0 table : ca2015_accessorial_code, ca2015_accessorial_type and ca2015_accessorial_rate ---load type: incremental ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07nov19 scctp4-2485 mgohain initial version -- 01.00.00.02 11nov19 scctp4-2660 mgohain primary key changed to accessorial_id,accessorial_param_set_id,accessorial_rate_id and accessorial_type -- 01.00.00.03 11nov19 scctp4-2740 mgohain source datatype changed for last_updated_dttm in table ca2015_accessorial_code -- 01.00.00.04 10dec19 scctp4-2740 mgohain target date columns converted to est --------------------------------------------------------------------------  ------------------------- ---job related hive settings -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading stage0 data into staging table -------------------------  set tez.job.name=staging:tms_accessorial_master_tmp :load target from ca2015_accessorial_code, ca2015_accessorial_type and ca2015_accessorial_rate;
! echo started loading into scct_work_db.tms_accessorial_master_tmp;
insert overwrite table scct_work_db.tms_accessorial_master_tmp select distinct coalesce(case when trim(acc_type.description)='' then null else trim(acc_type.description) end, 'n/a') as accessorial_type_description, coalesce(acc_cd.tc_company_id, 0) as tc_company_id, coalesce(case when trim(acc_cd.accessorial_code)='' then null else trim(acc_cd.accessorial_code) end, 'n/a') as accessorial_cd, coalesce(case when trim(acc_cd.accessorial_type)='' then null else trim(acc_cd.accessorial_type) end, 'n/a') as accessorial_type, coalesce(case when trim(acc_cd.data_source)='' then null else trim(acc_cd.data_source) end, 'n/a') as data_source, coalesce(case when trim(acc_cd.distance_uom)='' then null else trim(acc_cd.distance_uom) end, 'n/a') as distance_uom, coalesce(case when trim(acc_cd.description)='' then null else trim(acc_cd.description) end, 'n/a') as accessorial_description, coalesce(to_utc_timestamp(from_unixtime(acc_cd.last_updated_dttm div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as last_updated_dttm, coalesce(acc_cd.is_hazmat, 0) as is_hazmat, coalesce(acc_cd.is_default_for_invoice, 0) as is_default_for_invoice, coalesce(acc_cd.is_fuel_accessorial, 0) as is_fuel_accessorial, coalesce(acc_cd.accessorial_id , 0) as accessorial_id, coalesce(acc_cd.is_tax_accessorial, 0) as is_tax_accessorial, coalesce(acc_cd.is_add_to_spot_charge, 0) as is_add_to_spot_charge, coalesce(acc_cd.is_add_stop_off_charge, 0) as is_add_stop_off_charge, coalesce(acc_cd.calculation_option_level, 0) as calculation_option_level, coalesce(acc_cd.delivery_level, 0) as delivery_level, coalesce(acc_cd.is_requested, 0) as is_requested, coalesce(acc_cd.is_ship_via, 0) as is_ship_via, coalesce(acc_cd.calculation_factor, 0) as calculation_factor, coalesce(acc_cd.is_oversize, 0) as is_oversize, coalesce(acc_cd.is_apply_once_per_ship, 0) as is_apply_once_per_ship, coalesce(acc_cd.fuel_index_id, 0) as fuel_index_id, coalesce(acc_cd.is_cost_plus_accessorial, 0) as is_cost_plus_accessorial, coalesce(acc_rate.accessorial_param_set_id, 0) as accessorial_param_set_id, coalesce(acc_rate.accessorial_rate_id, 0) as accessorial_rate_id, coalesce(acc_rate.rate, 0.0) as rate, coalesce(acc_rate.minimum_rate, 0.0) as minimum_rate, coalesce(case when trim(acc_rate.currency_code)='' then null else trim(acc_rate.currency_code) end, 'n/a') as currency_cd, coalesce(acc_rate.is_auto_approve, 0) as is_auto_approve, coalesce(to_date(to_utc_timestamp(from_unixtime(acc_rate.effective_dt div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt")), '9999-12-31') as effective_dt, coalesce(to_date(to_utc_timestamp(from_unixtime(acc_rate.expiration_dt div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt")), '9999-12-31') as expiration_dt, coalesce(acc_rate.effective_seq, 0) as effective_seq, coalesce(acc_rate.is_shipment_accessorial, 0) as is_shipment_accessorial, coalesce(acc_rate.mot_id, 0) as mot_id, coalesce(acc_rate.equipment_id, 0) as equipment_id, coalesce(acc_rate.service_level_id, 0) as service_level_id, coalesce(acc_rate.protection_level_id, 0) as protection_level_id from tms_stage0.ca2015_accessorial_code acc_cd left outer join tms_stage0.ca2015_accessorial_type acc_type on acc_cd.accessorial_type=acc_type.accessorial_type left outer join tms_stage0.ca2015_accessorial_rate acc_rate on acc_cd.accessorial_id=acc_rate.accessorial_id
------------------------- ---loading staging data into final staging table -------------------------  set tez.job.name=staging:tms_accessorial_master_tmp1 :load target table from tms_accessorial_master_tmp;
! echo started loading into scct_work_db.tms_accessorial_master_tmp1;
insert overwrite table scct_work_db.tms_accessorial_master_tmp1 select coalesce(tmp.accessorial_type_description, t.accessorial_type_description), coalesce(tmp.tc_company_id, t.tc_company_id), coalesce(tmp.accessorial_cd, t.accessorial_cd), coalesce(tmp.accessorial_type, t.accessorial_type), coalesce(tmp.data_source, t.data_source), coalesce(tmp.distance_uom, t.distance_uom), coalesce(tmp.accessorial_description, t.accessorial_description), coalesce(tmp.last_updated_dttm, t.last_updated_dttm), coalesce(tmp.is_hazmat, t.is_hazmat), coalesce(tmp.is_default_for_invoice, t.is_default_for_invoice), coalesce(tmp.is_fuel_accessorial, t.is_fuel_accessorial), coalesce(tmp.accessorial_id, t.accessorial_id), coalesce(tmp.is_tax_accessorial, t.is_tax_accessorial), coalesce(tmp.is_add_to_spot_charge, t.is_add_to_spot_charge), coalesce(tmp.is_add_stop_off_charge, t.is_add_stop_off_charge), coalesce(tmp.calculation_option_level, t.calculation_option_level), coalesce(tmp.delivery_level, t.delivery_level), coalesce(tmp.is_requested, t.is_requested), coalesce(tmp.is_ship_via, t.is_ship_via), coalesce(tmp.calculation_factor, t.calculation_factor), coalesce(tmp.is_oversize, t.is_oversize), coalesce(tmp.is_apply_once_per_ship, t.is_apply_once_per_ship), coalesce(tmp.fuel_index_id, t.fuel_index_id), coalesce(tmp.is_cost_plus_accessorial, t.is_cost_plus_accessorial), coalesce(tmp.accessorial_param_set_id, t.accessorial_param_set_id), coalesce(tmp.accessorial_rate_id, t.accessorial_rate_id), coalesce(tmp.rate, t.rate), coalesce(tmp.minimum_rate, t.minimum_rate), coalesce(tmp.currency_cd, t.currency_cd), coalesce(tmp.is_auto_approve, t.is_auto_approve), coalesce(tmp.effective_dt, t.effective_dt), coalesce(tmp.expiration_dt, t.expiration_dt), coalesce(tmp.effective_seq, t.effective_seq), coalesce(tmp.is_shipment_accessorial, t.is_shipment_accessorial), coalesce(tmp.mot_id, t.mot_id), coalesce(tmp.equipment_id, t.equipment_id), coalesce(tmp.service_level_id, t.service_level_id), coalesce(tmp.protection_level_id, t.protection_level_id) from scct_db.tms_accessorial_master t full outer join scct_work_db.tms_accessorial_master_tmp tmp on t.accessorial_id=tmp.accessorial_id and t.accessorial_param_set_id=tmp.accessorial_param_set_id and t.accessorial_rate_id=tmp.accessorial_rate_id and t.accessorial_type=tmp.accessorial_type
------------------------- ---loading staging data into target table -------------------------  set tez.job.name=staging:tms_accessorial_master :load target table from tms_accessorial_master_tmp1;
! echo started loading into scct_db.tms_accessorial_master;
insert overwrite table scct_db.tms_accessorial_master select accessorial_type_description, tc_company_id, accessorial_cd, accessorial_type, data_source, distance_uom, accessorial_description, last_updated_dttm, is_hazmat, is_default_for_invoice, is_fuel_accessorial, accessorial_id, is_tax_accessorial, is_add_to_spot_charge, is_add_stop_off_charge, calculation_option_level, delivery_level, is_requested, is_ship_via, calculation_factor, is_oversize, is_apply_once_per_ship, fuel_index_id, is_cost_plus_accessorial, accessorial_param_set_id, accessorial_rate_id, rate, minimum_rate, currency_cd, is_auto_approve, effective_dt, expiration_dt, effective_seq, is_shipment_accessorial, mot_id, equipment_id, service_level_id, protection_level_id from scct_work_db.tms_accessorial_master_tmp1
! echo data load is completed;
! echo completed loading into scct_db.supply_chain_summary_node_wk_loc_cat ;
---jobname:scct-tms-hive-stg1-scct_db.tms_accessorial_master -------------------------------------------------------------------------- ---target: stage1 table: scct_db.tms_accessorial_master ---source: tms_stage0 table : ca2015_accessorial_code, ca2015_accessorial_type and ca2015_accessorial_rate ---load type: incremental ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07nov19 scctp4-2485 mgohain initial version -- 01.00.00.02 11nov19 scctp4-2660 mgohain primary key changed to accessorial_id,accessorial_param_set_id,accessorial_rate_id and accessorial_type -- 01.00.00.03 11nov19 scctp4-2740 mgohain source datatype changed for last_updated_dttm in table ca2015_accessorial_code -- 01.00.00.04 10dec19 scctp4-2740 mgohain target date columns converted to est --------------------------------------------------------------------------  ------------------------- ---job related hive settings -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading stage0 data into staging table -------------------------  set tez.job.name=staging:tms_accessorial_master_tmp :load target from ca2015_accessorial_code, ca2015_accessorial_type and ca2015_accessorial_rate;
! echo started loading into scct_work_db.tms_accessorial_master_tmp;
insert overwrite table scct_work_db.tms_accessorial_master_tmp select distinct coalesce(case when trim(acc_type.description)='' then null else trim(acc_type.description) end, 'n/a') as accessorial_type_description, coalesce(acc_cd.tc_company_id, 0) as tc_company_id, coalesce(case when trim(acc_cd.accessorial_code)='' then null else trim(acc_cd.accessorial_code) end, 'n/a') as accessorial_cd, coalesce(case when trim(acc_cd.accessorial_type)='' then null else trim(acc_cd.accessorial_type) end, 'n/a') as accessorial_type, coalesce(case when trim(acc_cd.data_source)='' then null else trim(acc_cd.data_source) end, 'n/a') as data_source, coalesce(case when trim(acc_cd.distance_uom)='' then null else trim(acc_cd.distance_uom) end, 'n/a') as distance_uom, coalesce(case when trim(acc_cd.description)='' then null else trim(acc_cd.description) end, 'n/a') as accessorial_description, coalesce(to_utc_timestamp(from_unixtime(acc_cd.last_updated_dttm div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as last_updated_dttm, coalesce(acc_cd.is_hazmat, 0) as is_hazmat, coalesce(acc_cd.is_default_for_invoice, 0) as is_default_for_invoice, coalesce(acc_cd.is_fuel_accessorial, 0) as is_fuel_accessorial, coalesce(acc_cd.accessorial_id , 0) as accessorial_id, coalesce(acc_cd.is_tax_accessorial, 0) as is_tax_accessorial, coalesce(acc_cd.is_add_to_spot_charge, 0) as is_add_to_spot_charge, coalesce(acc_cd.is_add_stop_off_charge, 0) as is_add_stop_off_charge, coalesce(acc_cd.calculation_option_level, 0) as calculation_option_level, coalesce(acc_cd.delivery_level, 0) as delivery_level, coalesce(acc_cd.is_requested, 0) as is_requested, coalesce(acc_cd.is_ship_via, 0) as is_ship_via, coalesce(acc_cd.calculation_factor, 0) as calculation_factor, coalesce(acc_cd.is_oversize, 0) as is_oversize, coalesce(acc_cd.is_apply_once_per_ship, 0) as is_apply_once_per_ship, coalesce(acc_cd.fuel_index_id, 0) as fuel_index_id, coalesce(acc_cd.is_cost_plus_accessorial, 0) as is_cost_plus_accessorial, coalesce(acc_rate.accessorial_param_set_id, 0) as accessorial_param_set_id, coalesce(acc_rate.accessorial_rate_id, 0) as accessorial_rate_id, coalesce(acc_rate.rate, 0.0) as rate, coalesce(acc_rate.minimum_rate, 0.0) as minimum_rate, coalesce(case when trim(acc_rate.currency_code)='' then null else trim(acc_rate.currency_code) end, 'n/a') as currency_cd, coalesce(acc_rate.is_auto_approve, 0) as is_auto_approve, coalesce(to_date(to_utc_timestamp(from_unixtime(acc_rate.effective_dt div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt")), '9999-12-31') as effective_dt, coalesce(to_date(to_utc_timestamp(from_unixtime(acc_rate.expiration_dt div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt")), '9999-12-31') as expiration_dt, coalesce(acc_rate.effective_seq, 0) as effective_seq, coalesce(acc_rate.is_shipment_accessorial, 0) as is_shipment_accessorial, coalesce(acc_rate.mot_id, 0) as mot_id, coalesce(acc_rate.equipment_id, 0) as equipment_id, coalesce(acc_rate.service_level_id, 0) as service_level_id, coalesce(acc_rate.protection_level_id, 0) as protection_level_id from tms_stage0.ca2015_accessorial_code acc_cd left outer join tms_stage0.ca2015_accessorial_type acc_type on acc_cd.accessorial_type=acc_type.accessorial_type left outer join tms_stage0.ca2015_accessorial_rate acc_rate on acc_cd.accessorial_id=acc_rate.accessorial_id
------------------------- ---loading staging data into final staging table -------------------------  set tez.job.name=staging:tms_accessorial_master_tmp1 :load target table from tms_accessorial_master_tmp;
! echo started loading into scct_work_db.tms_accessorial_master_tmp1;
insert overwrite table scct_work_db.tms_accessorial_master_tmp1 select coalesce(tmp.accessorial_type_description, t.accessorial_type_description), coalesce(tmp.tc_company_id, t.tc_company_id), coalesce(tmp.accessorial_cd, t.accessorial_cd), coalesce(tmp.accessorial_type, t.accessorial_type), coalesce(tmp.data_source, t.data_source), coalesce(tmp.distance_uom, t.distance_uom), coalesce(tmp.accessorial_description, t.accessorial_description), coalesce(tmp.last_updated_dttm, t.last_updated_dttm), coalesce(tmp.is_hazmat, t.is_hazmat), coalesce(tmp.is_default_for_invoice, t.is_default_for_invoice), coalesce(tmp.is_fuel_accessorial, t.is_fuel_accessorial), coalesce(tmp.accessorial_id, t.accessorial_id), coalesce(tmp.is_tax_accessorial, t.is_tax_accessorial), coalesce(tmp.is_add_to_spot_charge, t.is_add_to_spot_charge), coalesce(tmp.is_add_stop_off_charge, t.is_add_stop_off_charge), coalesce(tmp.calculation_option_level, t.calculation_option_level), coalesce(tmp.delivery_level, t.delivery_level), coalesce(tmp.is_requested, t.is_requested), coalesce(tmp.is_ship_via, t.is_ship_via), coalesce(tmp.calculation_factor, t.calculation_factor), coalesce(tmp.is_oversize, t.is_oversize), coalesce(tmp.is_apply_once_per_ship, t.is_apply_once_per_ship), coalesce(tmp.fuel_index_id, t.fuel_index_id), coalesce(tmp.is_cost_plus_accessorial, t.is_cost_plus_accessorial), coalesce(tmp.accessorial_param_set_id, t.accessorial_param_set_id), coalesce(tmp.accessorial_rate_id, t.accessorial_rate_id), coalesce(tmp.rate, t.rate), coalesce(tmp.minimum_rate, t.minimum_rate), coalesce(tmp.currency_cd, t.currency_cd), coalesce(tmp.is_auto_approve, t.is_auto_approve), coalesce(tmp.effective_dt, t.effective_dt), coalesce(tmp.expiration_dt, t.expiration_dt), coalesce(tmp.effective_seq, t.effective_seq), coalesce(tmp.is_shipment_accessorial, t.is_shipment_accessorial), coalesce(tmp.mot_id, t.mot_id), coalesce(tmp.equipment_id, t.equipment_id), coalesce(tmp.service_level_id, t.service_level_id), coalesce(tmp.protection_level_id, t.protection_level_id) from scct_db.tms_accessorial_master t full outer join scct_work_db.tms_accessorial_master_tmp tmp on t.accessorial_id=tmp.accessorial_id and t.accessorial_param_set_id=tmp.accessorial_param_set_id and t.accessorial_rate_id=tmp.accessorial_rate_id and t.accessorial_type=tmp.accessorial_type
------------------------- ---loading staging data into target table -------------------------  set tez.job.name=staging:tms_accessorial_master :load target table from tms_accessorial_master_tmp1;
! echo started loading into scct_db.tms_accessorial_master;
insert overwrite table scct_db.tms_accessorial_master select accessorial_type_description, tc_company_id, accessorial_cd, accessorial_type, data_source, distance_uom, accessorial_description, last_updated_dttm, is_hazmat, is_default_for_invoice, is_fuel_accessorial, accessorial_id, is_tax_accessorial, is_add_to_spot_charge, is_add_stop_off_charge, calculation_option_level, delivery_level, is_requested, is_ship_via, calculation_factor, is_oversize, is_apply_once_per_ship, fuel_index_id, is_cost_plus_accessorial, accessorial_param_set_id, accessorial_rate_id, rate, minimum_rate, currency_cd, is_auto_approve, effective_dt, expiration_dt, effective_seq, is_shipment_accessorial, mot_id, equipment_id, service_level_id, protection_level_id from scct_work_db.tms_accessorial_master_tmp1
! echo data load is completed;
! echo completed loading into scct_db.supply_chain_summary_node_wk_loc_cat ;
---jobname:scct-tms-hive-stg1-scct_db.tms_accessorial_master -------------------------------------------------------------------------- ---target: stage1 table: scct_db.tms_accessorial_master ---source: tms_stage0 table : ca2015_accessorial_code, ca2015_accessorial_type and ca2015_accessorial_rate ---load type: incremental ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07nov19 scctp4-2485 mgohain initial version -- 01.00.00.02 11nov19 scctp4-2660 mgohain primary key changed to accessorial_id,accessorial_param_set_id,accessorial_rate_id and accessorial_type -- 01.00.00.03 11nov19 scctp4-2740 mgohain source datatype changed for last_updated_dttm in table ca2015_accessorial_code -- 01.00.00.04 10dec19 scctp4-2740 mgohain target date columns converted to est --------------------------------------------------------------------------  ------------------------- ---job related hive settings -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading stage0 data into staging table -------------------------  set tez.job.name=staging:tms_accessorial_master_tmp :load target from ca2015_accessorial_code, ca2015_accessorial_type and ca2015_accessorial_rate;
! echo started loading into scct_work_db.tms_accessorial_master_tmp;
insert overwrite table scct_work_db.tms_accessorial_master_tmp select distinct coalesce(case when trim(acc_type.description)='' then null else trim(acc_type.description) end, 'n/a') as accessorial_type_description, coalesce(acc_cd.tc_company_id, 0) as tc_company_id, coalesce(case when trim(acc_cd.accessorial_code)='' then null else trim(acc_cd.accessorial_code) end, 'n/a') as accessorial_cd, coalesce(case when trim(acc_cd.accessorial_type)='' then null else trim(acc_cd.accessorial_type) end, 'n/a') as accessorial_type, coalesce(case when trim(acc_cd.data_source)='' then null else trim(acc_cd.data_source) end, 'n/a') as data_source, coalesce(case when trim(acc_cd.distance_uom)='' then null else trim(acc_cd.distance_uom) end, 'n/a') as distance_uom, coalesce(case when trim(acc_cd.description)='' then null else trim(acc_cd.description) end, 'n/a') as accessorial_description, coalesce(to_utc_timestamp(from_unixtime(acc_cd.last_updated_dttm div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as last_updated_dttm, coalesce(acc_cd.is_hazmat, 0) as is_hazmat, coalesce(acc_cd.is_default_for_invoice, 0) as is_default_for_invoice, coalesce(acc_cd.is_fuel_accessorial, 0) as is_fuel_accessorial, coalesce(acc_cd.accessorial_id , 0) as accessorial_id, coalesce(acc_cd.is_tax_accessorial, 0) as is_tax_accessorial, coalesce(acc_cd.is_add_to_spot_charge, 0) as is_add_to_spot_charge, coalesce(acc_cd.is_add_stop_off_charge, 0) as is_add_stop_off_charge, coalesce(acc_cd.calculation_option_level, 0) as calculation_option_level, coalesce(acc_cd.delivery_level, 0) as delivery_level, coalesce(acc_cd.is_requested, 0) as is_requested, coalesce(acc_cd.is_ship_via, 0) as is_ship_via, coalesce(acc_cd.calculation_factor, 0) as calculation_factor, coalesce(acc_cd.is_oversize, 0) as is_oversize, coalesce(acc_cd.is_apply_once_per_ship, 0) as is_apply_once_per_ship, coalesce(acc_cd.fuel_index_id, 0) as fuel_index_id, coalesce(acc_cd.is_cost_plus_accessorial, 0) as is_cost_plus_accessorial, coalesce(acc_rate.accessorial_param_set_id, 0) as accessorial_param_set_id, coalesce(acc_rate.accessorial_rate_id, 0) as accessorial_rate_id, coalesce(acc_rate.rate, 0.0) as rate, coalesce(acc_rate.minimum_rate, 0.0) as minimum_rate, coalesce(case when trim(acc_rate.currency_code)='' then null else trim(acc_rate.currency_code) end, 'n/a') as currency_cd, coalesce(acc_rate.is_auto_approve, 0) as is_auto_approve, coalesce(to_date(to_utc_timestamp(from_unixtime(acc_rate.effective_dt div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt")), '9999-12-31') as effective_dt, coalesce(to_date(to_utc_timestamp(from_unixtime(acc_rate.expiration_dt div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt")), '9999-12-31') as expiration_dt, coalesce(acc_rate.effective_seq, 0) as effective_seq, coalesce(acc_rate.is_shipment_accessorial, 0) as is_shipment_accessorial, coalesce(acc_rate.mot_id, 0) as mot_id, coalesce(acc_rate.equipment_id, 0) as equipment_id, coalesce(acc_rate.service_level_id, 0) as service_level_id, coalesce(acc_rate.protection_level_id, 0) as protection_level_id from tms_stage0.ca2015_accessorial_code acc_cd left outer join tms_stage0.ca2015_accessorial_type acc_type on acc_cd.accessorial_type=acc_type.accessorial_type left outer join tms_stage0.ca2015_accessorial_rate acc_rate on acc_cd.accessorial_id=acc_rate.accessorial_id
------------------------- ---loading staging data into final staging table -------------------------  set tez.job.name=staging:tms_accessorial_master_tmp1 :load target table from tms_accessorial_master_tmp;
! echo started loading into scct_work_db.tms_accessorial_master_tmp1;
insert overwrite table scct_work_db.tms_accessorial_master_tmp1 select coalesce(tmp.accessorial_type_description, t.accessorial_type_description), coalesce(tmp.tc_company_id, t.tc_company_id), coalesce(tmp.accessorial_cd, t.accessorial_cd), coalesce(tmp.accessorial_type, t.accessorial_type), coalesce(tmp.data_source, t.data_source), coalesce(tmp.distance_uom, t.distance_uom), coalesce(tmp.accessorial_description, t.accessorial_description), coalesce(tmp.last_updated_dttm, t.last_updated_dttm), coalesce(tmp.is_hazmat, t.is_hazmat), coalesce(tmp.is_default_for_invoice, t.is_default_for_invoice), coalesce(tmp.is_fuel_accessorial, t.is_fuel_accessorial), coalesce(tmp.accessorial_id, t.accessorial_id), coalesce(tmp.is_tax_accessorial, t.is_tax_accessorial), coalesce(tmp.is_add_to_spot_charge, t.is_add_to_spot_charge), coalesce(tmp.is_add_stop_off_charge, t.is_add_stop_off_charge), coalesce(tmp.calculation_option_level, t.calculation_option_level), coalesce(tmp.delivery_level, t.delivery_level), coalesce(tmp.is_requested, t.is_requested), coalesce(tmp.is_ship_via, t.is_ship_via), coalesce(tmp.calculation_factor, t.calculation_factor), coalesce(tmp.is_oversize, t.is_oversize), coalesce(tmp.is_apply_once_per_ship, t.is_apply_once_per_ship), coalesce(tmp.fuel_index_id, t.fuel_index_id), coalesce(tmp.is_cost_plus_accessorial, t.is_cost_plus_accessorial), coalesce(tmp.accessorial_param_set_id, t.accessorial_param_set_id), coalesce(tmp.accessorial_rate_id, t.accessorial_rate_id), coalesce(tmp.rate, t.rate), coalesce(tmp.minimum_rate, t.minimum_rate), coalesce(tmp.currency_cd, t.currency_cd), coalesce(tmp.is_auto_approve, t.is_auto_approve), coalesce(tmp.effective_dt, t.effective_dt), coalesce(tmp.expiration_dt, t.expiration_dt), coalesce(tmp.effective_seq, t.effective_seq), coalesce(tmp.is_shipment_accessorial, t.is_shipment_accessorial), coalesce(tmp.mot_id, t.mot_id), coalesce(tmp.equipment_id, t.equipment_id), coalesce(tmp.service_level_id, t.service_level_id), coalesce(tmp.protection_level_id, t.protection_level_id) from scct_db.tms_accessorial_master t full outer join scct_work_db.tms_accessorial_master_tmp tmp on t.accessorial_id=tmp.accessorial_id and t.accessorial_param_set_id=tmp.accessorial_param_set_id and t.accessorial_rate_id=tmp.accessorial_rate_id and t.accessorial_type=tmp.accessorial_type
------------------------- ---loading staging data into target table -------------------------  set tez.job.name=staging:tms_accessorial_master :load target table from tms_accessorial_master_tmp1;
! echo started loading into scct_db.tms_accessorial_master;
insert overwrite table scct_db.tms_accessorial_master select accessorial_type_description, tc_company_id, accessorial_cd, accessorial_type, data_source, distance_uom, accessorial_description, last_updated_dttm, is_hazmat, is_default_for_invoice, is_fuel_accessorial, accessorial_id, is_tax_accessorial, is_add_to_spot_charge, is_add_stop_off_charge, calculation_option_level, delivery_level, is_requested, is_ship_via, calculation_factor, is_oversize, is_apply_once_per_ship, fuel_index_id, is_cost_plus_accessorial, accessorial_param_set_id, accessorial_rate_id, rate, minimum_rate, currency_cd, is_auto_approve, effective_dt, expiration_dt, effective_seq, is_shipment_accessorial, mot_id, equipment_id, service_level_id, protection_level_id from scct_work_db.tms_accessorial_master_tmp1
! echo data load is completed;
! echo completed loading into scct_db.scem_expected_events;
---jobname:scct-scem-hive-stg1-scct_db.scem_tracking_events -------------------------------------------------------------------------- ---target: stage1 table: scct_db.scem_tracking_events  ---source: sap_stage0 table : scem_tracking_events_tmp ---description: this script will load the delta data to target table scct_db.scem_tracking_events ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 23jul19 sdhal initial version -- 01.00.00.02 06sep19 scctp4-2187 akoti changed patition key to eh_created_date and added logic to ignore records where di_operation_type <> 'd' -- 01.00.00.03 29nov19 scctp4-2623 akoti removed partition column & settings, changed di_operation_type logic --  ------------------------- ---job related hive settings to merge files for target table ------------------------- set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scem_tracking_events target table data -------------------------  set tez.job.name=stage2:scem_tracking_events :load target table scem_tracking_events ;
! echo started loading into scct_db.scem_tracking_events ;
! echo completed loading into scct_db.scem_tracking_events ;
---jobname:scct-scem-hive-stg1-scct_db.scem_tracking_objects -------------------------------------------------------------------------- ---target: stage1 table: scct_db.scem_tracking_objects  ---source: scct_work_db table : scem_tracking_objects_tmp ---description: this script will load the delta data to target table scct_db.scem_tracking_objects ---load type: full ---back posting: no ---author: sdhal ---created date: 29/07/2019 -------------------------------------------------------------------------- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 29jul19 sdhal initial version -- 01.00.00.02 06sep19 scctp4-2187 akoti added logic to ignore records where di_operation_type <> 'd' -- 01.00.00.03 19sep19 scctp4-2460 ryadav increased tez container size -- 01.00.00.04 29nov19 scctp4-2623 akoti removed partition column & settings, changed di_operation_type logic -- 01.00.00.05 21jan20 scctp4-2988 akoti changed column name from act_po_gr_date to act_gac_date --  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scem_tracking_objects target table data -------------------------  set tez.job.name=stage2:scem_tracking_objects :load target table scem_tracking_objects ;
! echo started loading into scct_db.scem_tracking_objects ;
! echo completed loading into scct_db.scem_tracking_objects ;
---jobname:scct-scem-hive-stg1-scct_db.scem_tracking_types -------------------------------------------------------------------------- ---target: stage1 table: scct_db.scem_tracking_types  ---source: scct_work_db table : scem_tracking_types_temp, scct_db table : scem_tracking_types ---load type: full ---back posting: no ---author: ryadav ---created date: 03/14/2019 --------------------------------------------------------------------------   ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scem_tracking_types target table data -------------------------  set tez.job.name=stage1:scem_tracking_types :load target table scem_tracking_types ;
! echo started loading into scct_db.scem_tracking_types ;
! echo completed loading into scct_db.scem_tracking_types ;
---jobname:scct-ufposo-hive-stg1-so_line_kpi_dcb_to_dcm_aprl -------------------------------------------------------------------------- ---target: stage1 table: scct_db.so_line_kpi  ---source: tms_stage0 table : delivery_master, handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07jan20 scctp4-2924 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter --------------------------------------------------------------------------  ------------------------- ---job related hive settings  -------------------------   set hive.auto.convert.join.noconditionaltask.size=200000000;
------------------------- ---loading dd line kpi's data into so_line_kpi table -------------------------  set tez.job.name=load dd line kpis:so_line_kpi :load target from delivery_master ;
! echo started loading into scct_db.so_line_kpi;
! echo completed so_line_kpi data load;
---jobname:scct-usposo-hive-stg1-so_line_kpi_dcoutboundso -------------------------------------------------------------------------- ---target: stage1 table: scct_db.so_line_kpi  ---source: tms_stage0 table : delivery_master, handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07jan20 scctp4-2924 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter --------------------------------------------------------------------------  ------------------------- ---job related hive settings  -------------------------   set hive.auto.convert.join.noconditionaltask.size=200000000;
------------------------- ---loading dd line kpi's data into so_line_kpi table -------------------------  set tez.job.name=load dd line kpis:so_line_kpi :load target from delivery_master ;
! echo started loading into scct_db.so_line_kpi;
! echo completed so_line_kpi data load;
---jobname:scct-ufposo-hive-stg1-so_line_kpi_final -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_line_kpi  ---source: tms_stage0 table : so_line_kpi_work and so_line_kpi_work1 ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 04may20 scctp4-2922 ssoma initial version ---------------------------------------------------------------------------  ------------------------- ---job related hive settings  -------------------------  set mapreduce.job.reduces=200;
------------------------- ---loading po line kpi's data into dd_line_kpi table -------------------------  set tez.job.name=load po line kpis:so_line_kpi:load target from po_master ;
! echo started loading scct_work_db.so_line_kpi_work1 for all the modules;
! echo started loading scct_work_db.so_line_kpi_work for all the modules;
! echo completed so_line_kpi data load;
---jobname:scct-ufposo-hive-stg1-so_line_kpi_vss_to_vsd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.so_line_kpi  ---source: tms_stage0 table : delivery_master, handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07jan20 scctp4-2924 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  --------------------------------------------------------------------------  ------------------------- ---job related hive settings  -------------------------    set hive.auto.convert.join.noconditionaltask.size=200000000;
------------------------- ---loading dd line kpi's data into so_line_kpi table -------------------------  set tez.job.name=load dd line kpis:so_line_kpi :load target from delivery_master ;
! echo started loading into scct_db.so_line_kpi;
! echo completed so_line_kpi data load;
---jobname:scct-masterdata-hive-stg1-scct_db.so_master -------------------------------------------------------------------------- ---target: stage1 table: so_master ---source: scct_raw_db.maprdb_vbak_raw, scct_raw_db.vbpa_raw, scct_raw_db.maprdb_vbap_raw ---load type: delta ---back posting: no -------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 23may19 ssoma initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length -- 01.00.00.03 26sep19 scctp4-2481 ryadav added lpad in location join -- 01.00.00.04 04nov19 scctp4-2638 ssoma added cust_prch_itm_nbr(posex) column into so_master -- 01.00.00.05 03jun20 scctp4-1777 ashettap added chngind column into so_master -- 01.00.00.06 03jul20 scctp5-217 ashettap added 9 columns from sls_distr_doc_nbr through overall_sls_ord_blk_stat to so_master  ------------------------- ---job related hive settings to read huge dataset and merge files for target table -------------------------  set hive.auto.convert.join.noconditionaltask.size=3000000000;
------------------------- ---loading so_master stage 1 base table -------------------------  set tez.job.name=stage1:load_so_master:load_so_master;
! echo started loading into scct_db.so_master;
! echo completed loading into scct_db.so_master;
------------------------- ---cocatenate files for target table so_master -------------------------  set tez.job.name=stage1:so_master:cocatenate files on so_master;
! echo started cocatenate files;
alter table scct_db.so_master concatenate;
! echo completed cocatenate files;
---jobname:scct-ikb-hive-stg2-scct_db.spc_plng_day_item_location_presentation_qty --------------------------------------------------------------------------- ---target: stage1 table: scct_db.spc_plng_day_item_location_presentation_qty  ---source: scct_work_db table : spc_presentation_temp2 ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 20nov18 ryadav initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---loading spc_plng_day_item_location_presentation_qty stage 1 base data -------------------------  set tez.job.name=stage1:spc_plng_day_item_location_presentation_qty :load target table spc_plng_day_item_location_presentation_qty ;
! echo started loading into scct_db.spc_plng_day_item_location_presentation_qty ;
! echo completed loading into scct_db.spc_plng_day_item_location_presentation_qty ;
---jobname:scct-ikb-hive-stg1-scct_db.spc_plng_item_location_date_assortment_plan --------------------------------------------------------------------------- ---target: stage1 table: scct_db.spc_plng_item_location_date_assortment_plan ---source: pkms_stage0 table : ltsmstr_lbi_reporting ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 20nov18 ssoma initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length   ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading stage1 table spc_plng_item_location_date_assortment_plan from source table ltsmstr_lbi_reporting -------------------------  insert overwrite table scct_db.spc_plng_item_location_date_assortment_plan partition(snapshot_dt) select distinct coalesce((case when trim(productid)='' then null else lpad(trim(productid),18,0) end),'n/a') as itm_nbr ,coalesce((case when trim(storenumber)='' then null else coalesce(l.location_number,storenumber) end),'n/a') as loc_nbr ,coalesce((case when trim(mpq)='' then null else trim(mpq ) end),0.00) as minimum_presentation_qty ,coalesce((case when trim(startdate)='' then null else from_unixtime(unix_timestamp(startdate,'yyyymmdd'),'yyyy-mm-dd') end), '9999-12-31') as effective_dt ,coalesce((case when trim(enddate)='' then null else from_unixtime(unix_timestamp(enddate,'yyyymmdd'),'yyyy-mm-dd') end), '9999-12-31') as discontinue_dt ,coalesce((case when trim(poglocation)='' then null else trim(poglocation) end),'n/a') as pog_location ,coalesce((case when trim(pogkey)='' then null else trim(pogkey) end),'n/a') as pog_key ,coalesce((case when trim(pogname)='' then null else trim(pogname) end),'n/a') as pog_name ,date_sub(current_date,1) as snapshot_dt from ikb_stage0.ltsmstr_lbi_reporting llr left outer join (select location_number from analytics_db.location where location_type_code = '04')l  on lpad(llr.storenumber,10,0) = l.location_number distribute by snapshot_dt;
---jobname:scct-e2e_dashboard-hive-stg2-scct_db.store_inventory -------------------------------------------------------------------------- ---target: stage2 table: scct_db.supply_chain_node_day_loc_item ---source: manu_stage1 table : scct_db.inventory_history, and prepack_component, scct_job_control, analytics_view table : item, location ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 19dec18 ssoma initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---job related hive settings to merge files for target table -------------------------  ------------------------- ---loading store_inventory work table -------------------------  ! echo started loading into scct_db.supply_chain_node_day_loc_item;
! echo completed loading into scct_db.supply_chain_node_day_loc_item;
---jobname:scct-e2e_dashboard-hive-stg1-scct_db.store_outflow -------------------------------------------------------------------------- ---target: stage1 table: scct_db.supply_chain_node_day_loc_item  ---source: scct_db table : inventory_movement, analytics_view table : item, location ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 04jan19 ryadav initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading supply_chain_node_day_loc_item work table data -------------------------  set tez.job.name=stage1:supply_chain_node_day_loc_item :load target table for store_outflow ;
! echo started loading into scct_db.supply_chain_node_day_loc_item ;
! echo completed loading into scct_db.supply_chain_node_day_loc_item ;
---jobname:scct-sap-hive-stg1-scct_db.str_rcpt_proc_labr_stds -------------------------------------------------------------------------- ---target: stage1 table: scct_db.str_rcpt_proc_labr_stds ---source: sap_stage0.zzlsmaint ---load type: new snapshot insert ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 03nov19 scctp4-2797 akoti initial version -- 01.00.00.02 05dec19 scctp4-2797 akoti added new column proc_tm_sec as per user request  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scct_db.str_rcpt_proc_labr_stds work table data -------------------------  set tez.job.name=stage1_scct_db:str_rcpt_proc_labr_stds :load target table str_rcpt_proc_labr_stds ;
! echo started loading into scct_db.str_rcpt_proc_labr_stds ;
! echo completed loading into scct_db.str_rcpt_proc_labr_stds ;
---jobname:scct-sap-hive-stg1-scct_db.str_shp_vis_intrnst_crtn_proc_tm -------------------------------------------------------------------------- ---target: stage1 table: scct_db.str_shp_vis_intrnst_crtn_proc_tm ---source: scct_work_db.str_shp_vis_crtn_proc_tm_tmp ---load type: new snapshot insert ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 16dec19 scctp4-2817 ryadav initial version -- 01.00.00.02 20jan20 scctp4-2971 ryadav updated delta process logic  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scct_db.str_shp_vis_intrnst_crtn_proc_tm table data -------------------------  set tez.job.name=stage1_scct_db:str_shp_vis_intrnst_crtn_proc_tm :load target table str_shp_vis_intrnst_crtn_proc_tm ;
! echo started loading into scct_db.str_shp_vis_intrnst_crtn_proc_tm ;
! echo completed loading into scct_db.str_shp_vis_intrnst_crtn_proc_tm ;
---jobname:scct-sap-hive-stg1-scct_db.str_shp_vis_rcvd_crtn_proc_tm -------------------------------------------------------------------------- ---target: stage1 table: scct_db.str_shp_vis_rcvd_crtn_proc_tm ---source: scct_work_db.str_shp_vis_rcvd_crtn_proc_tmp ---load type: upsert ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 16dec19 scctp4-2817 ryadav initial version -- 01.00.00.02 20jan20 scctp4-2971 ryadav updated delta process logic  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scct_db.str_shp_vis_rcvd_crtn_proc_tm table data -------------------------  set tez.job.name=stage1_scct_db:str_shp_vis_rcvd_crtn_proc_tm :load target table str_shp_vis_rcvd_crtn_proc_tm ;
! echo started loading into scct_db.str_shp_vis_rcvd_crtn_proc_tm ;
! echo completed loading into scct_db.str_shp_vis_rcvd_crtn_proc_tm ;
---jobname:scct-e2e_dashboard-hive-stg1-scct_db.sup_chn_summary_roll_mth_prodcat -------------------------------------------------------------------------- ---target: stage1 table: scct_db.supply_chain_summary_roll_mth_prodcat  ---source: scct_work_db table : stg_supchn_roll_mth_prodcat,operations_db table : enterprise_calendar ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 09jan19 ryadav initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading supply_chain_summary_roll_mth_prodcat target table data -------------------------  set tez.job.name=stage1:supply_chain_summary_roll_mth_prodcat :load target table supply_chain_summary_roll_mth_prodcat ;
! echo started loading into scct_db.supply_chain_summary_roll_mth_prodcat ;
! echo completed loading into scct_db.supply_chain_summary_roll_mth_prodcat ;
-------------------------------------------------------------------------- ---target: stage1 table: scct_db.supply_chain_summary_node_wk_loc_cat  ---source: scct_work_db table : supply_chain_summary_node_wk_loc_prod_ty, supply_chain_summary_node_wk_loc_prod_ly ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 15jun19 ryadav initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading supply_chain_summary_node_wk_loc_cat target table data -------------------------  set tez.job.name=scct-e2e_dashboard-hive-stg1-scct_db.supply_chain_summary_node_wk_loc_cat ;
! echo started loading into scct_db.supply_chain_summary_node_wk_loc_cat ;
! echo completed loading into scct_db.supply_chain_summary_node_wk_loc_cat ;
---jobname:scct-tms-hive-stg1-scct_db.tms_accessorial_master -------------------------------------------------------------------------- ---target: stage1 table: scct_db.tms_accessorial_master ---source: tms_stage0 table : ca2015_accessorial_code, ca2015_accessorial_type and ca2015_accessorial_rate ---load type: incremental ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07nov19 scctp4-2485 mgohain initial version -- 01.00.00.02 11nov19 scctp4-2660 mgohain primary key changed to accessorial_id,accessorial_param_set_id,accessorial_rate_id and accessorial_type -- 01.00.00.03 11nov19 scctp4-2740 mgohain source datatype changed for last_updated_dttm in table ca2015_accessorial_code -- 01.00.00.04 10dec19 scctp4-2740 mgohain target date columns converted to est --------------------------------------------------------------------------  ------------------------- ---job related hive settings -------------------------  ------------------------- ---loading stage0 data into staging table -------------------------  ! echo started loading into scct_work_db.tms_accessorial_master_tmp;
insert overwrite table scct_work_db.tms_accessorial_master_tmp select distinct coalesce(case when trim(acc_type.description)='' then null else trim(acc_type.description) end, 'n/a') as accessorial_type_description, coalesce(acc_cd.tc_company_id, 0) as tc_company_id, coalesce(case when trim(acc_cd.accessorial_code)='' then null else trim(acc_cd.accessorial_code) end, 'n/a') as accessorial_cd, coalesce(case when trim(acc_cd.accessorial_type)='' then null else trim(acc_cd.accessorial_type) end, 'n/a') as accessorial_type, coalesce(case when trim(acc_cd.data_source)='' then null else trim(acc_cd.data_source) end, 'n/a') as data_source, coalesce(case when trim(acc_cd.distance_uom)='' then null else trim(acc_cd.distance_uom) end, 'n/a') as distance_uom, coalesce(case when trim(acc_cd.description)='' then null else trim(acc_cd.description) end, 'n/a') as accessorial_description, coalesce(to_utc_timestamp(from_unixtime(acc_cd.last_updated_dttm div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as last_updated_dttm, coalesce(acc_cd.is_hazmat, 0) as is_hazmat, coalesce(acc_cd.is_default_for_invoice, 0) as is_default_for_invoice, coalesce(acc_cd.is_fuel_accessorial, 0) as is_fuel_accessorial, coalesce(acc_cd.accessorial_id , 0) as accessorial_id, coalesce(acc_cd.is_tax_accessorial, 0) as is_tax_accessorial, coalesce(acc_cd.is_add_to_spot_charge, 0) as is_add_to_spot_charge, coalesce(acc_cd.is_add_stop_off_charge, 0) as is_add_stop_off_charge, coalesce(acc_cd.calculation_option_level, 0) as calculation_option_level, coalesce(acc_cd.delivery_level, 0) as delivery_level, coalesce(acc_cd.is_requested, 0) as is_requested, coalesce(acc_cd.is_ship_via, 0) as is_ship_via, coalesce(acc_cd.calculation_factor, 0) as calculation_factor, coalesce(acc_cd.is_oversize, 0) as is_oversize, coalesce(acc_cd.is_apply_once_per_ship, 0) as is_apply_once_per_ship, coalesce(acc_cd.fuel_index_id, 0) as fuel_index_id, coalesce(acc_cd.is_cost_plus_accessorial, 0) as is_cost_plus_accessorial, coalesce(acc_rate.accessorial_param_set_id, 0) as accessorial_param_set_id, coalesce(acc_rate.accessorial_rate_id, 0) as accessorial_rate_id, coalesce(acc_rate.rate, 0.0) as rate, coalesce(acc_rate.minimum_rate, 0.0) as minimum_rate, coalesce(case when trim(acc_rate.currency_code)='' then null else trim(acc_rate.currency_code) end, 'n/a') as currency_cd, coalesce(acc_rate.is_auto_approve, 0) as is_auto_approve, coalesce(to_date(to_utc_timestamp(from_unixtime(acc_rate.effective_dt div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt")), '9999-12-31') as effective_dt, coalesce(to_date(to_utc_timestamp(from_unixtime(acc_rate.expiration_dt div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt")), '9999-12-31') as expiration_dt, coalesce(acc_rate.effective_seq, 0) as effective_seq, coalesce(acc_rate.is_shipment_accessorial, 0) as is_shipment_accessorial, coalesce(acc_rate.mot_id, 0) as mot_id, coalesce(acc_rate.equipment_id, 0) as equipment_id, coalesce(acc_rate.service_level_id, 0) as service_level_id, coalesce(acc_rate.protection_level_id, 0) as protection_level_id from tms_stage0.ca2015_accessorial_code acc_cd left outer join tms_stage0.ca2015_accessorial_type acc_type on acc_cd.accessorial_type=acc_type.accessorial_type left outer join tms_stage0.ca2015_accessorial_rate acc_rate on acc_cd.accessorial_id=acc_rate.accessorial_id
------------------------- ---loading staging data into final staging table -------------------------  set tez.job.name=staging:tms_accessorial_master_tmp1 :load target table from tms_accessorial_master_tmp;
! echo started loading into scct_work_db.tms_accessorial_master_tmp1;
------------------------- ---loading staging data into target table -------------------------  set tez.job.name=staging:tms_accessorial_master :load target table from tms_accessorial_master_tmp1;
! echo started loading into scct_db.tms_accessorial_master;
! echo data load is completed;
! echo completed loading into scct_db.scem_expected_events;
---jobname:scct-scem-hive-stg1-scct_db.scem_tracking_events -------------------------------------------------------------------------- ---target: stage1 table: scct_db.scem_tracking_events  ---source: sap_stage0 table : scem_tracking_events_tmp ---description: this script will load the delta data to target table scct_db.scem_tracking_events ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 23jul19 sdhal initial version -- 01.00.00.02 06sep19 scctp4-2187 akoti changed patition key to eh_created_date and added logic to ignore records where di_operation_type <> 'd' -- 01.00.00.03 29nov19 scctp4-2623 akoti removed partition column & settings, changed di_operation_type logic --  ------------------------- ---job related hive settings to merge files for target table ------------------------- set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scem_tracking_events target table data -------------------------  set tez.job.name=stage2:scem_tracking_events :load target table scem_tracking_events ;
! echo started loading into scct_db.scem_tracking_events ;
! echo completed loading into scct_db.scem_tracking_events ;
---jobname:scct-scem-hive-stg1-scct_db.scem_tracking_objects -------------------------------------------------------------------------- ---target: stage1 table: scct_db.scem_tracking_objects  ---source: scct_work_db table : scem_tracking_objects_tmp ---description: this script will load the delta data to target table scct_db.scem_tracking_objects ---load type: full ---back posting: no ---author: sdhal ---created date: 29/07/2019 -------------------------------------------------------------------------- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 29jul19 sdhal initial version -- 01.00.00.02 06sep19 scctp4-2187 akoti added logic to ignore records where di_operation_type <> 'd' -- 01.00.00.03 19sep19 scctp4-2460 ryadav increased tez container size -- 01.00.00.04 29nov19 scctp4-2623 akoti removed partition column & settings, changed di_operation_type logic -- 01.00.00.05 21jan20 scctp4-2988 akoti changed column name from act_po_gr_date to act_gac_date --  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scem_tracking_objects target table data -------------------------  set tez.job.name=stage2:scem_tracking_objects :load target table scem_tracking_objects ;
! echo started loading into scct_db.scem_tracking_objects ;
! echo completed loading into scct_db.scem_tracking_objects ;
---jobname:scct-scem-hive-stg1-scct_db.scem_tracking_types -------------------------------------------------------------------------- ---target: stage1 table: scct_db.scem_tracking_types  ---source: scct_work_db table : scem_tracking_types_temp, scct_db table : scem_tracking_types ---load type: full ---back posting: no ---author: ryadav ---created date: 03/14/2019 --------------------------------------------------------------------------   ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scem_tracking_types target table data -------------------------  set tez.job.name=stage1:scem_tracking_types :load target table scem_tracking_types ;
! echo started loading into scct_db.scem_tracking_types ;
! echo completed loading into scct_db.scem_tracking_types ;
---jobname:scct-ufposo-hive-stg1-so_line_kpi_dcb_to_dcm_aprl -------------------------------------------------------------------------- ---target: stage1 table: scct_db.so_line_kpi  ---source: tms_stage0 table : delivery_master, handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07jan20 scctp4-2924 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter --------------------------------------------------------------------------  ------------------------- ---job related hive settings  -------------------------   set hive.auto.convert.join.noconditionaltask.size=200000000;
------------------------- ---loading dd line kpi's data into so_line_kpi table -------------------------  set tez.job.name=load dd line kpis:so_line_kpi :load target from delivery_master ;
! echo started loading into scct_db.so_line_kpi;
! echo completed so_line_kpi data load;
---jobname:scct-usposo-hive-stg1-so_line_kpi_dcoutboundso -------------------------------------------------------------------------- ---target: stage1 table: scct_db.so_line_kpi  ---source: tms_stage0 table : delivery_master, handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07jan20 scctp4-2924 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter --------------------------------------------------------------------------  ------------------------- ---job related hive settings  -------------------------   set hive.auto.convert.join.noconditionaltask.size=200000000;
------------------------- ---loading dd line kpi's data into so_line_kpi table -------------------------  set tez.job.name=load dd line kpis:so_line_kpi :load target from delivery_master ;
! echo started loading into scct_db.so_line_kpi;
! echo completed so_line_kpi data load;
---jobname:scct-ufposo-hive-stg1-so_line_kpi_final -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_line_kpi  ---source: tms_stage0 table : so_line_kpi_work and so_line_kpi_work1 ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 04may20 scctp4-2922 ssoma initial version ---------------------------------------------------------------------------  ------------------------- ---job related hive settings  -------------------------  set mapreduce.job.reduces=200;
------------------------- ---loading po line kpi's data into dd_line_kpi table -------------------------  set tez.job.name=load po line kpis:so_line_kpi:load target from po_master ;
! echo started loading scct_work_db.so_line_kpi_work1 for all the modules;
! echo started loading scct_work_db.so_line_kpi_work for all the modules;
! echo completed so_line_kpi data load;
---jobname:scct-ufposo-hive-stg1-so_line_kpi_vss_to_vsd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.so_line_kpi  ---source: tms_stage0 table : delivery_master, handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07jan20 scctp4-2924 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  --------------------------------------------------------------------------  ------------------------- ---job related hive settings  -------------------------    set hive.auto.convert.join.noconditionaltask.size=200000000;
------------------------- ---loading dd line kpi's data into so_line_kpi table -------------------------  set tez.job.name=load dd line kpis:so_line_kpi :load target from delivery_master ;
! echo started loading into scct_db.so_line_kpi;
! echo completed so_line_kpi data load;
---jobname:scct-masterdata-hive-stg1-scct_db.so_master -------------------------------------------------------------------------- ---target: stage1 table: so_master ---source: scct_raw_db.maprdb_vbak_raw, scct_raw_db.vbpa_raw, scct_raw_db.maprdb_vbap_raw ---load type: delta ---back posting: no -------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 23may19 ssoma initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length -- 01.00.00.03 26sep19 scctp4-2481 ryadav added lpad in location join -- 01.00.00.04 04nov19 scctp4-2638 ssoma added cust_prch_itm_nbr(posex) column into so_master -- 01.00.00.05 03jun20 scctp4-1777 ashettap added chngind column into so_master -- 01.00.00.06 03jul20 scctp5-217 ashettap added 9 columns from sls_distr_doc_nbr through overall_sls_ord_blk_stat to so_master  ------------------------- ---job related hive settings to read huge dataset and merge files for target table -------------------------  set hive.auto.convert.join.noconditionaltask.size=3000000000;
------------------------- ---loading so_master stage 1 base table -------------------------  set tez.job.name=stage1:load_so_master:load_so_master;
! echo started loading into scct_db.so_master;
! echo completed loading into scct_db.so_master;
------------------------- ---cocatenate files for target table so_master -------------------------  set tez.job.name=stage1:so_master:cocatenate files on so_master;
! echo started cocatenate files;
alter table scct_db.so_master concatenate;
! echo completed cocatenate files;
---jobname:scct-ikb-hive-stg2-scct_db.spc_plng_day_item_location_presentation_qty --------------------------------------------------------------------------- ---target: stage1 table: scct_db.spc_plng_day_item_location_presentation_qty  ---source: scct_work_db table : spc_presentation_temp2 ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 20nov18 ryadav initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---loading spc_plng_day_item_location_presentation_qty stage 1 base data -------------------------  set tez.job.name=stage1:spc_plng_day_item_location_presentation_qty :load target table spc_plng_day_item_location_presentation_qty ;
! echo started loading into scct_db.spc_plng_day_item_location_presentation_qty ;
! echo completed loading into scct_db.spc_plng_day_item_location_presentation_qty ;
---jobname:scct-ikb-hive-stg1-scct_db.spc_plng_item_location_date_assortment_plan --------------------------------------------------------------------------- ---target: stage1 table: scct_db.spc_plng_item_location_date_assortment_plan ---source: pkms_stage0 table : ltsmstr_lbi_reporting ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 20nov18 ssoma initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length   ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading stage1 table spc_plng_item_location_date_assortment_plan from source table ltsmstr_lbi_reporting -------------------------  insert overwrite table scct_db.spc_plng_item_location_date_assortment_plan partition(snapshot_dt) select distinct coalesce((case when trim(productid)='' then null else lpad(trim(productid),18,0) end),'n/a') as itm_nbr ,coalesce((case when trim(storenumber)='' then null else coalesce(l.location_number,storenumber) end),'n/a') as loc_nbr ,coalesce((case when trim(mpq)='' then null else trim(mpq ) end),0.00) as minimum_presentation_qty ,coalesce((case when trim(startdate)='' then null else from_unixtime(unix_timestamp(startdate,'yyyymmdd'),'yyyy-mm-dd') end), '9999-12-31') as effective_dt ,coalesce((case when trim(enddate)='' then null else from_unixtime(unix_timestamp(enddate,'yyyymmdd'),'yyyy-mm-dd') end), '9999-12-31') as discontinue_dt ,coalesce((case when trim(poglocation)='' then null else trim(poglocation) end),'n/a') as pog_location ,coalesce((case when trim(pogkey)='' then null else trim(pogkey) end),'n/a') as pog_key ,coalesce((case when trim(pogname)='' then null else trim(pogname) end),'n/a') as pog_name ,date_sub(current_date,1) as snapshot_dt from ikb_stage0.ltsmstr_lbi_reporting llr left outer join (select location_number from analytics_db.location where location_type_code = '04')l  on lpad(llr.storenumber,10,0) = l.location_number distribute by snapshot_dt;
---jobname:scct-e2e_dashboard-hive-stg2-scct_db.store_inventory -------------------------------------------------------------------------- ---target: stage2 table: scct_db.supply_chain_node_day_loc_item ---source: manu_stage1 table : scct_db.inventory_history, and prepack_component, scct_job_control, analytics_view table : item, location ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 19dec18 ssoma initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---job related hive settings to merge files for target table -------------------------  ------------------------- ---loading store_inventory work table -------------------------  ! echo started loading into scct_db.supply_chain_node_day_loc_item;
! echo completed loading into scct_db.supply_chain_node_day_loc_item;
---jobname:scct-e2e_dashboard-hive-stg1-scct_db.store_outflow -------------------------------------------------------------------------- ---target: stage1 table: scct_db.supply_chain_node_day_loc_item  ---source: scct_db table : inventory_movement, analytics_view table : item, location ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 04jan19 ryadav initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading supply_chain_node_day_loc_item work table data -------------------------  set tez.job.name=stage1:supply_chain_node_day_loc_item :load target table for store_outflow ;
! echo started loading into scct_db.supply_chain_node_day_loc_item ;
! echo completed loading into scct_db.supply_chain_node_day_loc_item ;
---jobname:scct-sap-hive-stg1-scct_db.str_rcpt_proc_labr_stds -------------------------------------------------------------------------- ---target: stage1 table: scct_db.str_rcpt_proc_labr_stds ---source: sap_stage0.zzlsmaint ---load type: new snapshot insert ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 03nov19 scctp4-2797 akoti initial version -- 01.00.00.02 05dec19 scctp4-2797 akoti added new column proc_tm_sec as per user request  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scct_db.str_rcpt_proc_labr_stds work table data -------------------------  set tez.job.name=stage1_scct_db:str_rcpt_proc_labr_stds :load target table str_rcpt_proc_labr_stds ;
! echo started loading into scct_db.str_rcpt_proc_labr_stds ;
! echo completed loading into scct_db.str_rcpt_proc_labr_stds ;
---jobname:scct-sap-hive-stg1-scct_db.str_shp_vis_intrnst_crtn_proc_tm -------------------------------------------------------------------------- ---target: stage1 table: scct_db.str_shp_vis_intrnst_crtn_proc_tm ---source: scct_work_db.str_shp_vis_crtn_proc_tm_tmp ---load type: new snapshot insert ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 16dec19 scctp4-2817 ryadav initial version -- 01.00.00.02 20jan20 scctp4-2971 ryadav updated delta process logic  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scct_db.str_shp_vis_intrnst_crtn_proc_tm table data -------------------------  set tez.job.name=stage1_scct_db:str_shp_vis_intrnst_crtn_proc_tm :load target table str_shp_vis_intrnst_crtn_proc_tm ;
! echo started loading into scct_db.str_shp_vis_intrnst_crtn_proc_tm ;
! echo completed loading into scct_db.str_shp_vis_intrnst_crtn_proc_tm ;
---jobname:scct-sap-hive-stg1-scct_db.str_shp_vis_rcvd_crtn_proc_tm -------------------------------------------------------------------------- ---target: stage1 table: scct_db.str_shp_vis_rcvd_crtn_proc_tm ---source: scct_work_db.str_shp_vis_rcvd_crtn_proc_tmp ---load type: upsert ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 16dec19 scctp4-2817 ryadav initial version -- 01.00.00.02 20jan20 scctp4-2971 ryadav updated delta process logic  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scct_db.str_shp_vis_rcvd_crtn_proc_tm table data -------------------------  set tez.job.name=stage1_scct_db:str_shp_vis_rcvd_crtn_proc_tm :load target table str_shp_vis_rcvd_crtn_proc_tm ;
! echo started loading into scct_db.str_shp_vis_rcvd_crtn_proc_tm ;
! echo completed loading into scct_db.str_shp_vis_rcvd_crtn_proc_tm ;
---jobname:scct-e2e_dashboard-hive-stg1-scct_db.sup_chn_summary_roll_mth_prodcat -------------------------------------------------------------------------- ---target: stage1 table: scct_db.supply_chain_summary_roll_mth_prodcat  ---source: scct_work_db table : stg_supchn_roll_mth_prodcat,operations_db table : enterprise_calendar ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 09jan19 ryadav initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading supply_chain_summary_roll_mth_prodcat target table data -------------------------  set tez.job.name=stage1:supply_chain_summary_roll_mth_prodcat :load target table supply_chain_summary_roll_mth_prodcat ;
! echo started loading into scct_db.supply_chain_summary_roll_mth_prodcat ;
! echo completed loading into scct_db.supply_chain_summary_roll_mth_prodcat ;
-------------------------------------------------------------------------- ---target: stage1 table: scct_db.supply_chain_summary_node_wk_loc_cat  ---source: scct_work_db table : supply_chain_summary_node_wk_loc_prod_ty, supply_chain_summary_node_wk_loc_prod_ly ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 15jun19 ryadav initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading supply_chain_summary_node_wk_loc_cat target table data -------------------------  set tez.job.name=scct-e2e_dashboard-hive-stg1-scct_db.supply_chain_summary_node_wk_loc_cat ;
! echo started loading into scct_db.supply_chain_summary_node_wk_loc_cat ;
! echo completed loading into scct_db.supply_chain_summary_node_wk_loc_cat ;
---jobname:scct-tms-hive-stg1-scct_db.tms_accessorial_master -------------------------------------------------------------------------- ---target: stage1 table: scct_db.tms_accessorial_master ---source: tms_stage0 table : ca2015_accessorial_code, ca2015_accessorial_type and ca2015_accessorial_rate ---load type: incremental ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07nov19 scctp4-2485 mgohain initial version -- 01.00.00.02 11nov19 scctp4-2660 mgohain primary key changed to accessorial_id,accessorial_param_set_id,accessorial_rate_id and accessorial_type -- 01.00.00.03 11nov19 scctp4-2740 mgohain source datatype changed for last_updated_dttm in table ca2015_accessorial_code -- 01.00.00.04 10dec19 scctp4-2740 mgohain target date columns converted to est --------------------------------------------------------------------------  ------------------------- ---job related hive settings -------------------------  ------------------------- ---loading stage0 data into staging table -------------------------  ! echo started loading into scct_work_db.tms_accessorial_master_tmp;
insert overwrite table scct_work_db.tms_accessorial_master_tmp select distinct coalesce(case when trim(acc_type.description)='' then null else trim(acc_type.description) end, 'n/a') as accessorial_type_description, coalesce(acc_cd.tc_company_id, 0) as tc_company_id, coalesce(case when trim(acc_cd.accessorial_code)='' then null else trim(acc_cd.accessorial_code) end, 'n/a') as accessorial_cd, coalesce(case when trim(acc_cd.accessorial_type)='' then null else trim(acc_cd.accessorial_type) end, 'n/a') as accessorial_type, coalesce(case when trim(acc_cd.data_source)='' then null else trim(acc_cd.data_source) end, 'n/a') as data_source, coalesce(case when trim(acc_cd.distance_uom)='' then null else trim(acc_cd.distance_uom) end, 'n/a') as distance_uom, coalesce(case when trim(acc_cd.description)='' then null else trim(acc_cd.description) end, 'n/a') as accessorial_description, coalesce(to_utc_timestamp(from_unixtime(acc_cd.last_updated_dttm div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as last_updated_dttm, coalesce(acc_cd.is_hazmat, 0) as is_hazmat, coalesce(acc_cd.is_default_for_invoice, 0) as is_default_for_invoice, coalesce(acc_cd.is_fuel_accessorial, 0) as is_fuel_accessorial, coalesce(acc_cd.accessorial_id , 0) as accessorial_id, coalesce(acc_cd.is_tax_accessorial, 0) as is_tax_accessorial, coalesce(acc_cd.is_add_to_spot_charge, 0) as is_add_to_spot_charge, coalesce(acc_cd.is_add_stop_off_charge, 0) as is_add_stop_off_charge, coalesce(acc_cd.calculation_option_level, 0) as calculation_option_level, coalesce(acc_cd.delivery_level, 0) as delivery_level, coalesce(acc_cd.is_requested, 0) as is_requested, coalesce(acc_cd.is_ship_via, 0) as is_ship_via, coalesce(acc_cd.calculation_factor, 0) as calculation_factor, coalesce(acc_cd.is_oversize, 0) as is_oversize, coalesce(acc_cd.is_apply_once_per_ship, 0) as is_apply_once_per_ship, coalesce(acc_cd.fuel_index_id, 0) as fuel_index_id, coalesce(acc_cd.is_cost_plus_accessorial, 0) as is_cost_plus_accessorial, coalesce(acc_rate.accessorial_param_set_id, 0) as accessorial_param_set_id, coalesce(acc_rate.accessorial_rate_id, 0) as accessorial_rate_id, coalesce(acc_rate.rate, 0.0) as rate, coalesce(acc_rate.minimum_rate, 0.0) as minimum_rate, coalesce(case when trim(acc_rate.currency_code)='' then null else trim(acc_rate.currency_code) end, 'n/a') as currency_cd, coalesce(acc_rate.is_auto_approve, 0) as is_auto_approve, coalesce(to_date(to_utc_timestamp(from_unixtime(acc_rate.effective_dt div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt")), '9999-12-31') as effective_dt, coalesce(to_date(to_utc_timestamp(from_unixtime(acc_rate.expiration_dt div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt")), '9999-12-31') as expiration_dt, coalesce(acc_rate.effective_seq, 0) as effective_seq, coalesce(acc_rate.is_shipment_accessorial, 0) as is_shipment_accessorial, coalesce(acc_rate.mot_id, 0) as mot_id, coalesce(acc_rate.equipment_id, 0) as equipment_id, coalesce(acc_rate.service_level_id, 0) as service_level_id, coalesce(acc_rate.protection_level_id, 0) as protection_level_id from tms_stage0.ca2015_accessorial_code acc_cd left outer join tms_stage0.ca2015_accessorial_type acc_type on acc_cd.accessorial_type=acc_type.accessorial_type left outer join tms_stage0.ca2015_accessorial_rate acc_rate on acc_cd.accessorial_id=acc_rate.accessorial_id
------------------------- ---loading staging data into final staging table -------------------------  set tez.job.name=staging:tms_accessorial_master_tmp1 :load target table from tms_accessorial_master_tmp;
! echo started loading into scct_work_db.tms_accessorial_master_tmp1;
------------------------- ---loading staging data into target table -------------------------  set tez.job.name=staging:tms_accessorial_master :load target table from tms_accessorial_master_tmp1;
! echo started loading into scct_db.tms_accessorial_master;
! echo data load is completed;
! echo completed loading into scct_db.scem_expected_events;
---jobname:scct-scem-hive-stg1-scct_db.scem_tracking_events -------------------------------------------------------------------------- ---target: stage1 table: scct_db.scem_tracking_events  ---source: sap_stage0 table : scem_tracking_events_tmp ---description: this script will load the delta data to target table scct_db.scem_tracking_events ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 23jul19 sdhal initial version -- 01.00.00.02 06sep19 scctp4-2187 akoti changed patition key to eh_created_date and added logic to ignore records where di_operation_type <> 'd' -- 01.00.00.03 29nov19 scctp4-2623 akoti removed partition column & settings, changed di_operation_type logic --  ------------------------- ---job related hive settings to merge files for target table ------------------------- set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scem_tracking_events target table data -------------------------  set tez.job.name=stage2:scem_tracking_events :load target table scem_tracking_events ;
! echo started loading into scct_db.scem_tracking_events ;
! echo completed loading into scct_db.scem_tracking_events ;
---jobname:scct-scem-hive-stg1-scct_db.scem_tracking_objects -------------------------------------------------------------------------- ---target: stage1 table: scct_db.scem_tracking_objects  ---source: scct_work_db table : scem_tracking_objects_tmp ---description: this script will load the delta data to target table scct_db.scem_tracking_objects ---load type: full ---back posting: no ---author: sdhal ---created date: 29/07/2019 -------------------------------------------------------------------------- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 29jul19 sdhal initial version -- 01.00.00.02 06sep19 scctp4-2187 akoti added logic to ignore records where di_operation_type <> 'd' -- 01.00.00.03 19sep19 scctp4-2460 ryadav increased tez container size -- 01.00.00.04 29nov19 scctp4-2623 akoti removed partition column & settings, changed di_operation_type logic -- 01.00.00.05 21jan20 scctp4-2988 akoti changed column name from act_po_gr_date to act_gac_date --  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scem_tracking_objects target table data -------------------------  set tez.job.name=stage2:scem_tracking_objects :load target table scem_tracking_objects ;
! echo started loading into scct_db.scem_tracking_objects ;
! echo completed loading into scct_db.scem_tracking_objects ;
---jobname:scct-scem-hive-stg1-scct_db.scem_tracking_types -------------------------------------------------------------------------- ---target: stage1 table: scct_db.scem_tracking_types  ---source: scct_work_db table : scem_tracking_types_temp, scct_db table : scem_tracking_types ---load type: full ---back posting: no ---author: ryadav ---created date: 03/14/2019 --------------------------------------------------------------------------   ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scem_tracking_types target table data -------------------------  set tez.job.name=stage1:scem_tracking_types :load target table scem_tracking_types ;
! echo started loading into scct_db.scem_tracking_types ;
! echo completed loading into scct_db.scem_tracking_types ;
---jobname:scct-ufposo-hive-stg1-so_line_kpi_dcb_to_dcm_aprl -------------------------------------------------------------------------- ---target: stage1 table: scct_db.so_line_kpi  ---source: tms_stage0 table : delivery_master, handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07jan20 scctp4-2924 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter --------------------------------------------------------------------------  ------------------------- ---job related hive settings  -------------------------   set hive.auto.convert.join.noconditionaltask.size=200000000;
------------------------- ---loading dd line kpi's data into so_line_kpi table -------------------------  set tez.job.name=load dd line kpis:so_line_kpi :load target from delivery_master ;
! echo started loading into scct_db.so_line_kpi;
! echo completed so_line_kpi data load;
---jobname:scct-usposo-hive-stg1-so_line_kpi_dcoutboundso -------------------------------------------------------------------------- ---target: stage1 table: scct_db.so_line_kpi  ---source: tms_stage0 table : delivery_master, handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07jan20 scctp4-2924 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter --------------------------------------------------------------------------  ------------------------- ---job related hive settings  -------------------------   set hive.auto.convert.join.noconditionaltask.size=200000000;
------------------------- ---loading dd line kpi's data into so_line_kpi table -------------------------  set tez.job.name=load dd line kpis:so_line_kpi :load target from delivery_master ;
! echo started loading into scct_db.so_line_kpi;
! echo completed so_line_kpi data load;
---jobname:scct-ufposo-hive-stg1-so_line_kpi_final -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_line_kpi  ---source: tms_stage0 table : so_line_kpi_work and so_line_kpi_work1 ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 04may20 scctp4-2922 ssoma initial version ---------------------------------------------------------------------------  ------------------------- ---job related hive settings  -------------------------  set mapreduce.job.reduces=200;
------------------------- ---loading po line kpi's data into dd_line_kpi table -------------------------  set tez.job.name=load po line kpis:so_line_kpi:load target from po_master ;
! echo started loading scct_work_db.so_line_kpi_work1 for all the modules;
! echo started loading scct_work_db.so_line_kpi_work for all the modules;
! echo completed so_line_kpi data load;
---jobname:scct-ufposo-hive-stg1-so_line_kpi_vss_to_vsd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.so_line_kpi  ---source: tms_stage0 table : delivery_master, handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07jan20 scctp4-2924 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  --------------------------------------------------------------------------  ------------------------- ---job related hive settings  -------------------------    set hive.auto.convert.join.noconditionaltask.size=200000000;
------------------------- ---loading dd line kpi's data into so_line_kpi table -------------------------  set tez.job.name=load dd line kpis:so_line_kpi :load target from delivery_master ;
! echo started loading into scct_db.so_line_kpi;
! echo completed so_line_kpi data load;
---jobname:scct-masterdata-hive-stg1-scct_db.so_master -------------------------------------------------------------------------- ---target: stage1 table: so_master ---source: scct_raw_db.maprdb_vbak_raw, scct_raw_db.vbpa_raw, scct_raw_db.maprdb_vbap_raw ---load type: delta ---back posting: no -------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 23may19 ssoma initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length -- 01.00.00.03 26sep19 scctp4-2481 ryadav added lpad in location join -- 01.00.00.04 04nov19 scctp4-2638 ssoma added cust_prch_itm_nbr(posex) column into so_master -- 01.00.00.05 03jun20 scctp4-1777 ashettap added chngind column into so_master -- 01.00.00.06 03jul20 scctp5-217 ashettap added 9 columns from sls_distr_doc_nbr through overall_sls_ord_blk_stat to so_master  ------------------------- ---job related hive settings to read huge dataset and merge files for target table -------------------------  set hive.auto.convert.join.noconditionaltask.size=3000000000;
------------------------- ---loading so_master stage 1 base table -------------------------  set tez.job.name=stage1:load_so_master:load_so_master;
! echo started loading into scct_db.so_master;
! echo completed loading into scct_db.so_master;
------------------------- ---cocatenate files for target table so_master -------------------------  set tez.job.name=stage1:so_master:cocatenate files on so_master;
! echo started cocatenate files;
alter table scct_db.so_master concatenate;
! echo completed cocatenate files;
---jobname:scct-ikb-hive-stg2-scct_db.spc_plng_day_item_location_presentation_qty --------------------------------------------------------------------------- ---target: stage1 table: scct_db.spc_plng_day_item_location_presentation_qty  ---source: scct_work_db table : spc_presentation_temp2 ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 20nov18 ryadav initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---loading spc_plng_day_item_location_presentation_qty stage 1 base data -------------------------  set tez.job.name=stage1:spc_plng_day_item_location_presentation_qty :load target table spc_plng_day_item_location_presentation_qty ;
! echo started loading into scct_db.spc_plng_day_item_location_presentation_qty ;
! echo completed loading into scct_db.spc_plng_day_item_location_presentation_qty ;
---jobname:scct-ikb-hive-stg1-scct_db.spc_plng_item_location_date_assortment_plan --------------------------------------------------------------------------- ---target: stage1 table: scct_db.spc_plng_item_location_date_assortment_plan ---source: pkms_stage0 table : ltsmstr_lbi_reporting ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 20nov18 ssoma initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length   ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading stage1 table spc_plng_item_location_date_assortment_plan from source table ltsmstr_lbi_reporting -------------------------  insert overwrite table scct_db.spc_plng_item_location_date_assortment_plan partition(snapshot_dt) select distinct coalesce((case when trim(productid)='' then null else lpad(trim(productid),18,0) end),'n/a') as itm_nbr ,coalesce((case when trim(storenumber)='' then null else coalesce(l.location_number,storenumber) end),'n/a') as loc_nbr ,coalesce((case when trim(mpq)='' then null else trim(mpq ) end),0.00) as minimum_presentation_qty ,coalesce((case when trim(startdate)='' then null else from_unixtime(unix_timestamp(startdate,'yyyymmdd'),'yyyy-mm-dd') end), '9999-12-31') as effective_dt ,coalesce((case when trim(enddate)='' then null else from_unixtime(unix_timestamp(enddate,'yyyymmdd'),'yyyy-mm-dd') end), '9999-12-31') as discontinue_dt ,coalesce((case when trim(poglocation)='' then null else trim(poglocation) end),'n/a') as pog_location ,coalesce((case when trim(pogkey)='' then null else trim(pogkey) end),'n/a') as pog_key ,coalesce((case when trim(pogname)='' then null else trim(pogname) end),'n/a') as pog_name ,date_sub(current_date,1) as snapshot_dt from ikb_stage0.ltsmstr_lbi_reporting llr left outer join (select location_number from analytics_db.location where location_type_code = '04')l  on lpad(llr.storenumber,10,0) = l.location_number distribute by snapshot_dt;
---jobname:scct-e2e_dashboard-hive-stg2-scct_db.store_inventory -------------------------------------------------------------------------- ---target: stage2 table: scct_db.supply_chain_node_day_loc_item ---source: manu_stage1 table : scct_db.inventory_history, and prepack_component, scct_job_control, analytics_view table : item, location ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 19dec18 ssoma initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---job related hive settings to merge files for target table -------------------------  ------------------------- ---loading store_inventory work table -------------------------  ! echo started loading into scct_db.supply_chain_node_day_loc_item;
! echo completed loading into scct_db.supply_chain_node_day_loc_item;
---jobname:scct-e2e_dashboard-hive-stg1-scct_db.store_outflow -------------------------------------------------------------------------- ---target: stage1 table: scct_db.supply_chain_node_day_loc_item  ---source: scct_db table : inventory_movement, analytics_view table : item, location ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 04jan19 ryadav initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading supply_chain_node_day_loc_item work table data -------------------------  set tez.job.name=stage1:supply_chain_node_day_loc_item :load target table for store_outflow ;
! echo started loading into scct_db.supply_chain_node_day_loc_item ;
! echo completed loading into scct_db.supply_chain_node_day_loc_item ;
---jobname:scct-sap-hive-stg1-scct_db.str_rcpt_proc_labr_stds -------------------------------------------------------------------------- ---target: stage1 table: scct_db.str_rcpt_proc_labr_stds ---source: sap_stage0.zzlsmaint ---load type: new snapshot insert ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 03nov19 scctp4-2797 akoti initial version -- 01.00.00.02 05dec19 scctp4-2797 akoti added new column proc_tm_sec as per user request  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scct_db.str_rcpt_proc_labr_stds work table data -------------------------  set tez.job.name=stage1_scct_db:str_rcpt_proc_labr_stds :load target table str_rcpt_proc_labr_stds ;
! echo started loading into scct_db.str_rcpt_proc_labr_stds ;
! echo completed loading into scct_db.str_rcpt_proc_labr_stds ;
---jobname:scct-sap-hive-stg1-scct_db.str_shp_vis_intrnst_crtn_proc_tm -------------------------------------------------------------------------- ---target: stage1 table: scct_db.str_shp_vis_intrnst_crtn_proc_tm ---source: scct_work_db.str_shp_vis_crtn_proc_tm_tmp ---load type: new snapshot insert ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 16dec19 scctp4-2817 ryadav initial version -- 01.00.00.02 20jan20 scctp4-2971 ryadav updated delta process logic  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scct_db.str_shp_vis_intrnst_crtn_proc_tm table data -------------------------  set tez.job.name=stage1_scct_db:str_shp_vis_intrnst_crtn_proc_tm :load target table str_shp_vis_intrnst_crtn_proc_tm ;
! echo started loading into scct_db.str_shp_vis_intrnst_crtn_proc_tm ;
! echo completed loading into scct_db.str_shp_vis_intrnst_crtn_proc_tm ;
---jobname:scct-sap-hive-stg1-scct_db.str_shp_vis_rcvd_crtn_proc_tm -------------------------------------------------------------------------- ---target: stage1 table: scct_db.str_shp_vis_rcvd_crtn_proc_tm ---source: scct_work_db.str_shp_vis_rcvd_crtn_proc_tmp ---load type: upsert ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 16dec19 scctp4-2817 ryadav initial version -- 01.00.00.02 20jan20 scctp4-2971 ryadav updated delta process logic  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scct_db.str_shp_vis_rcvd_crtn_proc_tm table data -------------------------  set tez.job.name=stage1_scct_db:str_shp_vis_rcvd_crtn_proc_tm :load target table str_shp_vis_rcvd_crtn_proc_tm ;
! echo started loading into scct_db.str_shp_vis_rcvd_crtn_proc_tm ;
! echo completed loading into scct_db.str_shp_vis_rcvd_crtn_proc_tm ;
---jobname:scct-e2e_dashboard-hive-stg1-scct_db.sup_chn_summary_roll_mth_prodcat -------------------------------------------------------------------------- ---target: stage1 table: scct_db.supply_chain_summary_roll_mth_prodcat  ---source: scct_work_db table : stg_supchn_roll_mth_prodcat,operations_db table : enterprise_calendar ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 09jan19 ryadav initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading supply_chain_summary_roll_mth_prodcat target table data -------------------------  set tez.job.name=stage1:supply_chain_summary_roll_mth_prodcat :load target table supply_chain_summary_roll_mth_prodcat ;
! echo started loading into scct_db.supply_chain_summary_roll_mth_prodcat ;
! echo completed loading into scct_db.supply_chain_summary_roll_mth_prodcat ;
-------------------------------------------------------------------------- ---target: stage1 table: scct_db.supply_chain_summary_node_wk_loc_cat  ---source: scct_work_db table : supply_chain_summary_node_wk_loc_prod_ty, supply_chain_summary_node_wk_loc_prod_ly ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 15jun19 ryadav initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading supply_chain_summary_node_wk_loc_cat target table data -------------------------  set tez.job.name=scct-e2e_dashboard-hive-stg1-scct_db.supply_chain_summary_node_wk_loc_cat ;
! echo started loading into scct_db.supply_chain_summary_node_wk_loc_cat ;
! echo completed loading into scct_db.supply_chain_summary_node_wk_loc_cat ;
---jobname:scct-tms-hive-stg1-scct_db.tms_accessorial_master -------------------------------------------------------------------------- ---target: stage1 table: scct_db.tms_accessorial_master ---source: tms_stage0 table : ca2015_accessorial_code, ca2015_accessorial_type and ca2015_accessorial_rate ---load type: incremental ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07nov19 scctp4-2485 mgohain initial version -- 01.00.00.02 11nov19 scctp4-2660 mgohain primary key changed to accessorial_id,accessorial_param_set_id,accessorial_rate_id and accessorial_type -- 01.00.00.03 11nov19 scctp4-2740 mgohain source datatype changed for last_updated_dttm in table ca2015_accessorial_code -- 01.00.00.04 10dec19 scctp4-2740 mgohain target date columns converted to est --------------------------------------------------------------------------  ------------------------- ---job related hive settings -------------------------  ------------------------- ---loading stage0 data into staging table -------------------------  ! echo started loading into scct_work_db.tms_accessorial_master_tmp;
insert overwrite table scct_work_db.tms_accessorial_master_tmp select distinct coalesce(case when trim(acc_type.description)='' then null else trim(acc_type.description) end, 'n/a') as accessorial_type_description, coalesce(acc_cd.tc_company_id, 0) as tc_company_id, coalesce(case when trim(acc_cd.accessorial_code)='' then null else trim(acc_cd.accessorial_code) end, 'n/a') as accessorial_cd, coalesce(case when trim(acc_cd.accessorial_type)='' then null else trim(acc_cd.accessorial_type) end, 'n/a') as accessorial_type, coalesce(case when trim(acc_cd.data_source)='' then null else trim(acc_cd.data_source) end, 'n/a') as data_source, coalesce(case when trim(acc_cd.distance_uom)='' then null else trim(acc_cd.distance_uom) end, 'n/a') as distance_uom, coalesce(case when trim(acc_cd.description)='' then null else trim(acc_cd.description) end, 'n/a') as accessorial_description, coalesce(to_utc_timestamp(from_unixtime(acc_cd.last_updated_dttm div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as last_updated_dttm, coalesce(acc_cd.is_hazmat, 0) as is_hazmat, coalesce(acc_cd.is_default_for_invoice, 0) as is_default_for_invoice, coalesce(acc_cd.is_fuel_accessorial, 0) as is_fuel_accessorial, coalesce(acc_cd.accessorial_id , 0) as accessorial_id, coalesce(acc_cd.is_tax_accessorial, 0) as is_tax_accessorial, coalesce(acc_cd.is_add_to_spot_charge, 0) as is_add_to_spot_charge, coalesce(acc_cd.is_add_stop_off_charge, 0) as is_add_stop_off_charge, coalesce(acc_cd.calculation_option_level, 0) as calculation_option_level, coalesce(acc_cd.delivery_level, 0) as delivery_level, coalesce(acc_cd.is_requested, 0) as is_requested, coalesce(acc_cd.is_ship_via, 0) as is_ship_via, coalesce(acc_cd.calculation_factor, 0) as calculation_factor, coalesce(acc_cd.is_oversize, 0) as is_oversize, coalesce(acc_cd.is_apply_once_per_ship, 0) as is_apply_once_per_ship, coalesce(acc_cd.fuel_index_id, 0) as fuel_index_id, coalesce(acc_cd.is_cost_plus_accessorial, 0) as is_cost_plus_accessorial, coalesce(acc_rate.accessorial_param_set_id, 0) as accessorial_param_set_id, coalesce(acc_rate.accessorial_rate_id, 0) as accessorial_rate_id, coalesce(acc_rate.rate, 0.0) as rate, coalesce(acc_rate.minimum_rate, 0.0) as minimum_rate, coalesce(case when trim(acc_rate.currency_code)='' then null else trim(acc_rate.currency_code) end, 'n/a') as currency_cd, coalesce(acc_rate.is_auto_approve, 0) as is_auto_approve, coalesce(to_date(to_utc_timestamp(from_unixtime(acc_rate.effective_dt div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt")), '9999-12-31') as effective_dt, coalesce(to_date(to_utc_timestamp(from_unixtime(acc_rate.expiration_dt div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt")), '9999-12-31') as expiration_dt, coalesce(acc_rate.effective_seq, 0) as effective_seq, coalesce(acc_rate.is_shipment_accessorial, 0) as is_shipment_accessorial, coalesce(acc_rate.mot_id, 0) as mot_id, coalesce(acc_rate.equipment_id, 0) as equipment_id, coalesce(acc_rate.service_level_id, 0) as service_level_id, coalesce(acc_rate.protection_level_id, 0) as protection_level_id from tms_stage0.ca2015_accessorial_code acc_cd left outer join tms_stage0.ca2015_accessorial_type acc_type on acc_cd.accessorial_type=acc_type.accessorial_type left outer join tms_stage0.ca2015_accessorial_rate acc_rate on acc_cd.accessorial_id=acc_rate.accessorial_id
------------------------- ---loading staging data into final staging table -------------------------  set tez.job.name=staging:tms_accessorial_master_tmp1 :load target table from tms_accessorial_master_tmp;
! echo started loading into scct_work_db.tms_accessorial_master_tmp1;
------------------------- ---loading staging data into target table -------------------------  set tez.job.name=staging:tms_accessorial_master :load target table from tms_accessorial_master_tmp1;
! echo started loading into scct_db.tms_accessorial_master;
! echo data load is completed;
! echo completed loading into scct_db.scem_expected_events;
---jobname:scct-scem-hive-stg1-scct_db.scem_tracking_events -------------------------------------------------------------------------- ---target: stage1 table: scct_db.scem_tracking_events  ---source: sap_stage0 table : scem_tracking_events_tmp ---description: this script will load the delta data to target table scct_db.scem_tracking_events ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 23jul19 sdhal initial version -- 01.00.00.02 06sep19 scctp4-2187 akoti changed patition key to eh_created_date and added logic to ignore records where di_operation_type <> 'd' -- 01.00.00.03 29nov19 scctp4-2623 akoti removed partition column & settings, changed di_operation_type logic --  ------------------------- ---job related hive settings to merge files for target table ------------------------- set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scem_tracking_events target table data -------------------------  set tez.job.name=stage2:scem_tracking_events :load target table scem_tracking_events ;
! echo started loading into scct_db.scem_tracking_events ;
! echo completed loading into scct_db.scem_tracking_events ;
---jobname:scct-scem-hive-stg1-scct_db.scem_tracking_objects -------------------------------------------------------------------------- ---target: stage1 table: scct_db.scem_tracking_objects  ---source: scct_work_db table : scem_tracking_objects_tmp ---description: this script will load the delta data to target table scct_db.scem_tracking_objects ---load type: full ---back posting: no ---author: sdhal ---created date: 29/07/2019 -------------------------------------------------------------------------- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 29jul19 sdhal initial version -- 01.00.00.02 06sep19 scctp4-2187 akoti added logic to ignore records where di_operation_type <> 'd' -- 01.00.00.03 19sep19 scctp4-2460 ryadav increased tez container size -- 01.00.00.04 29nov19 scctp4-2623 akoti removed partition column & settings, changed di_operation_type logic -- 01.00.00.05 21jan20 scctp4-2988 akoti changed column name from act_po_gr_date to act_gac_date --  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scem_tracking_objects target table data -------------------------  set tez.job.name=stage2:scem_tracking_objects :load target table scem_tracking_objects ;
! echo started loading into scct_db.scem_tracking_objects ;
! echo completed loading into scct_db.scem_tracking_objects ;
---jobname:scct-scem-hive-stg1-scct_db.scem_tracking_types -------------------------------------------------------------------------- ---target: stage1 table: scct_db.scem_tracking_types  ---source: scct_work_db table : scem_tracking_types_temp, scct_db table : scem_tracking_types ---load type: full ---back posting: no ---author: ryadav ---created date: 03/14/2019 --------------------------------------------------------------------------   ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scem_tracking_types target table data -------------------------  set tez.job.name=stage1:scem_tracking_types :load target table scem_tracking_types ;
! echo started loading into scct_db.scem_tracking_types ;
! echo completed loading into scct_db.scem_tracking_types ;
---jobname:scct-ufposo-hive-stg1-so_line_kpi_dcb_to_dcm_aprl -------------------------------------------------------------------------- ---target: stage1 table: scct_db.so_line_kpi  ---source: tms_stage0 table : delivery_master, handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07jan20 scctp4-2924 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter --------------------------------------------------------------------------  ------------------------- ---job related hive settings  -------------------------   set hive.auto.convert.join.noconditionaltask.size=200000000;
------------------------- ---loading dd line kpi's data into so_line_kpi table -------------------------  set tez.job.name=load dd line kpis:so_line_kpi :load target from delivery_master ;
! echo started loading into scct_db.so_line_kpi;
! echo completed so_line_kpi data load;
---jobname:scct-usposo-hive-stg1-so_line_kpi_dcoutboundso -------------------------------------------------------------------------- ---target: stage1 table: scct_db.so_line_kpi  ---source: tms_stage0 table : delivery_master, handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07jan20 scctp4-2924 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter --------------------------------------------------------------------------  ------------------------- ---job related hive settings  -------------------------   set hive.auto.convert.join.noconditionaltask.size=200000000;
------------------------- ---loading dd line kpi's data into so_line_kpi table -------------------------  set tez.job.name=load dd line kpis:so_line_kpi :load target from delivery_master ;
! echo started loading into scct_db.so_line_kpi;
! echo completed so_line_kpi data load;
---jobname:scct-ufposo-hive-stg1-so_line_kpi_final -------------------------------------------------------------------------- ---target: stage1 table: scct_db.po_line_kpi  ---source: tms_stage0 table : so_line_kpi_work and so_line_kpi_work1 ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 04may20 scctp4-2922 ssoma initial version ---------------------------------------------------------------------------  ------------------------- ---job related hive settings  -------------------------  set mapreduce.job.reduces=200;
------------------------- ---loading po line kpi's data into dd_line_kpi table -------------------------  set tez.job.name=load po line kpis:so_line_kpi:load target from po_master ;
! echo started loading scct_work_db.so_line_kpi_work1 for all the modules;
! echo started loading scct_work_db.so_line_kpi_work for all the modules;
! echo completed so_line_kpi data load;
---jobname:scct-ufposo-hive-stg1-so_line_kpi_vss_to_vsd -------------------------------------------------------------------------- ---target: stage1 table: scct_db.so_line_kpi  ---source: tms_stage0 table : delivery_master, handling_master and item_unit_measure_master ---load type: full ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07jan20 scctp4-2924 ssoma initial version -- 01.00.00.02 06mar20 scctp4-3316 ssoma remove reducer parameter -- 01.00.00.03 04may20 scctp4-3331 ssoma hql optimization  --------------------------------------------------------------------------  ------------------------- ---job related hive settings  -------------------------    set hive.auto.convert.join.noconditionaltask.size=200000000;
------------------------- ---loading dd line kpi's data into so_line_kpi table -------------------------  set tez.job.name=load dd line kpis:so_line_kpi :load target from delivery_master ;
! echo started loading into scct_db.so_line_kpi;
! echo completed so_line_kpi data load;
---jobname:scct-masterdata-hive-stg1-scct_db.so_master -------------------------------------------------------------------------- ---target: stage1 table: so_master ---source: scct_raw_db.maprdb_vbak_raw, scct_raw_db.vbpa_raw, scct_raw_db.maprdb_vbap_raw ---load type: delta ---back posting: no -------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 23may19 ssoma initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length -- 01.00.00.03 26sep19 scctp4-2481 ryadav added lpad in location join -- 01.00.00.04 04nov19 scctp4-2638 ssoma added cust_prch_itm_nbr(posex) column into so_master -- 01.00.00.05 03jun20 scctp4-1777 ashettap added chngind column into so_master -- 01.00.00.06 03jul20 scctp5-217 ashettap added 9 columns from sls_distr_doc_nbr through overall_sls_ord_blk_stat to so_master  ------------------------- ---job related hive settings to read huge dataset and merge files for target table -------------------------  set hive.auto.convert.join.noconditionaltask.size=3000000000;
------------------------- ---loading so_master stage 1 base table -------------------------  set tez.job.name=stage1:load_so_master:load_so_master;
! echo started loading into scct_db.so_master;
! echo completed loading into scct_db.so_master;
------------------------- ---cocatenate files for target table so_master -------------------------  set tez.job.name=stage1:so_master:cocatenate files on so_master;
! echo started cocatenate files;
alter table scct_db.so_master concatenate;
! echo completed cocatenate files;
---jobname:scct-ikb-hive-stg2-scct_db.spc_plng_day_item_location_presentation_qty --------------------------------------------------------------------------- ---target: stage1 table: scct_db.spc_plng_day_item_location_presentation_qty  ---source: scct_work_db table : spc_presentation_temp2 ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 20nov18 ryadav initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---loading spc_plng_day_item_location_presentation_qty stage 1 base data -------------------------  set tez.job.name=stage1:spc_plng_day_item_location_presentation_qty :load target table spc_plng_day_item_location_presentation_qty ;
! echo started loading into scct_db.spc_plng_day_item_location_presentation_qty ;
! echo completed loading into scct_db.spc_plng_day_item_location_presentation_qty ;
---jobname:scct-ikb-hive-stg1-scct_db.spc_plng_item_location_date_assortment_plan --------------------------------------------------------------------------- ---target: stage1 table: scct_db.spc_plng_item_location_date_assortment_plan ---source: pkms_stage0 table : ltsmstr_lbi_reporting ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 20nov18 ssoma initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length   ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading stage1 table spc_plng_item_location_date_assortment_plan from source table ltsmstr_lbi_reporting -------------------------  insert overwrite table scct_db.spc_plng_item_location_date_assortment_plan partition(snapshot_dt) select distinct coalesce((case when trim(productid)='' then null else lpad(trim(productid),18,0) end),'n/a') as itm_nbr ,coalesce((case when trim(storenumber)='' then null else coalesce(l.location_number,storenumber) end),'n/a') as loc_nbr ,coalesce((case when trim(mpq)='' then null else trim(mpq ) end),0.00) as minimum_presentation_qty ,coalesce((case when trim(startdate)='' then null else from_unixtime(unix_timestamp(startdate,'yyyymmdd'),'yyyy-mm-dd') end), '9999-12-31') as effective_dt ,coalesce((case when trim(enddate)='' then null else from_unixtime(unix_timestamp(enddate,'yyyymmdd'),'yyyy-mm-dd') end), '9999-12-31') as discontinue_dt ,coalesce((case when trim(poglocation)='' then null else trim(poglocation) end),'n/a') as pog_location ,coalesce((case when trim(pogkey)='' then null else trim(pogkey) end),'n/a') as pog_key ,coalesce((case when trim(pogname)='' then null else trim(pogname) end),'n/a') as pog_name ,date_sub(current_date,1) as snapshot_dt from ikb_stage0.ltsmstr_lbi_reporting llr left outer join (select location_number from analytics_db.location where location_type_code = '04')l  on lpad(llr.storenumber,10,0) = l.location_number distribute by snapshot_dt;
---jobname:scct-e2e_dashboard-hive-stg2-scct_db.store_inventory -------------------------------------------------------------------------- ---target: stage2 table: scct_db.supply_chain_node_day_loc_item ---source: manu_stage1 table : scct_db.inventory_history, and prepack_component, scct_job_control, analytics_view table : item, location ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 19dec18 ssoma initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---job related hive settings to merge files for target table -------------------------  ------------------------- ---loading store_inventory work table -------------------------  ! echo started loading into scct_db.supply_chain_node_day_loc_item;
! echo completed loading into scct_db.supply_chain_node_day_loc_item;
---jobname:scct-e2e_dashboard-hive-stg1-scct_db.store_outflow -------------------------------------------------------------------------- ---target: stage1 table: scct_db.supply_chain_node_day_loc_item  ---source: scct_db table : inventory_movement, analytics_view table : item, location ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 04jan19 ryadav initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading supply_chain_node_day_loc_item work table data -------------------------  set tez.job.name=stage1:supply_chain_node_day_loc_item :load target table for store_outflow ;
! echo started loading into scct_db.supply_chain_node_day_loc_item ;
! echo completed loading into scct_db.supply_chain_node_day_loc_item ;
---jobname:scct-sap-hive-stg1-scct_db.str_rcpt_proc_labr_stds -------------------------------------------------------------------------- ---target: stage1 table: scct_db.str_rcpt_proc_labr_stds ---source: sap_stage0.zzlsmaint ---load type: new snapshot insert ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 03nov19 scctp4-2797 akoti initial version -- 01.00.00.02 05dec19 scctp4-2797 akoti added new column proc_tm_sec as per user request  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scct_db.str_rcpt_proc_labr_stds work table data -------------------------  set tez.job.name=stage1_scct_db:str_rcpt_proc_labr_stds :load target table str_rcpt_proc_labr_stds ;
! echo started loading into scct_db.str_rcpt_proc_labr_stds ;
! echo completed loading into scct_db.str_rcpt_proc_labr_stds ;
---jobname:scct-sap-hive-stg1-scct_db.str_shp_vis_intrnst_crtn_proc_tm -------------------------------------------------------------------------- ---target: stage1 table: scct_db.str_shp_vis_intrnst_crtn_proc_tm ---source: scct_work_db.str_shp_vis_crtn_proc_tm_tmp ---load type: new snapshot insert ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 16dec19 scctp4-2817 ryadav initial version -- 01.00.00.02 20jan20 scctp4-2971 ryadav updated delta process logic  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scct_db.str_shp_vis_intrnst_crtn_proc_tm table data -------------------------  set tez.job.name=stage1_scct_db:str_shp_vis_intrnst_crtn_proc_tm :load target table str_shp_vis_intrnst_crtn_proc_tm ;
! echo started loading into scct_db.str_shp_vis_intrnst_crtn_proc_tm ;
! echo completed loading into scct_db.str_shp_vis_intrnst_crtn_proc_tm ;
---jobname:scct-sap-hive-stg1-scct_db.str_shp_vis_rcvd_crtn_proc_tm -------------------------------------------------------------------------- ---target: stage1 table: scct_db.str_shp_vis_rcvd_crtn_proc_tm ---source: scct_work_db.str_shp_vis_rcvd_crtn_proc_tmp ---load type: upsert ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 16dec19 scctp4-2817 ryadav initial version -- 01.00.00.02 20jan20 scctp4-2971 ryadav updated delta process logic  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading scct_db.str_shp_vis_rcvd_crtn_proc_tm table data -------------------------  set tez.job.name=stage1_scct_db:str_shp_vis_rcvd_crtn_proc_tm :load target table str_shp_vis_rcvd_crtn_proc_tm ;
! echo started loading into scct_db.str_shp_vis_rcvd_crtn_proc_tm ;
! echo completed loading into scct_db.str_shp_vis_rcvd_crtn_proc_tm ;
---jobname:scct-e2e_dashboard-hive-stg1-scct_db.sup_chn_summary_roll_mth_prodcat -------------------------------------------------------------------------- ---target: stage1 table: scct_db.supply_chain_summary_roll_mth_prodcat  ---source: scct_work_db table : stg_supchn_roll_mth_prodcat,operations_db table : enterprise_calendar ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 09jan19 ryadav initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading supply_chain_summary_roll_mth_prodcat target table data -------------------------  set tez.job.name=stage1:supply_chain_summary_roll_mth_prodcat :load target table supply_chain_summary_roll_mth_prodcat ;
! echo started loading into scct_db.supply_chain_summary_roll_mth_prodcat ;
! echo completed loading into scct_db.supply_chain_summary_roll_mth_prodcat ;
-------------------------------------------------------------------------- ---target: stage1 table: scct_db.supply_chain_summary_node_wk_loc_cat  ---source: scct_work_db table : supply_chain_summary_node_wk_loc_prod_ty, supply_chain_summary_node_wk_loc_prod_ly ---load type: full ---back posting: no --------------------------------------------------------------------------  -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ ---------------------------- -- 01.00.00.01 15jun19 ryadav initial version -- 01.00.00.02 23sep19 scctp4-2471 ryadav mapr remediation changes for column names, item and location length  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading supply_chain_summary_node_wk_loc_cat target table data -------------------------  set tez.job.name=scct-e2e_dashboard-hive-stg1-scct_db.supply_chain_summary_node_wk_loc_cat ;
! echo started loading into scct_db.supply_chain_summary_node_wk_loc_cat ;
! echo completed loading into scct_db.supply_chain_summary_node_wk_loc_cat ;
---jobname:scct-tms-hive-stg1-scct_db.tms_accessorial_master -------------------------------------------------------------------------- ---target: stage1 table: scct_db.tms_accessorial_master ---source: tms_stage0 table : ca2015_accessorial_code, ca2015_accessorial_type and ca2015_accessorial_rate ---load type: incremental ---back posting: no -- -- history information -- -- revision date jira developer-id comments -- ----------- ------- ---------- ------------ -------------------- -- 01.00.00.01 07nov19 scctp4-2485 mgohain initial version -- 01.00.00.02 11nov19 scctp4-2660 mgohain primary key changed to accessorial_id,accessorial_param_set_id,accessorial_rate_id and accessorial_type -- 01.00.00.03 11nov19 scctp4-2740 mgohain source datatype changed for last_updated_dttm in table ca2015_accessorial_code -- 01.00.00.04 10dec19 scctp4-2740 mgohain target date columns converted to est --------------------------------------------------------------------------  ------------------------- ---job related hive settings -------------------------  ------------------------- ---loading stage0 data into staging table -------------------------  ! echo started loading into scct_work_db.tms_accessorial_master_tmp;
insert overwrite table scct_work_db.tms_accessorial_master_tmp select distinct coalesce(case when trim(acc_type.description)='' then null else trim(acc_type.description) end, 'n/a') as accessorial_type_description, coalesce(acc_cd.tc_company_id, 0) as tc_company_id, coalesce(case when trim(acc_cd.accessorial_code)='' then null else trim(acc_cd.accessorial_code) end, 'n/a') as accessorial_cd, coalesce(case when trim(acc_cd.accessorial_type)='' then null else trim(acc_cd.accessorial_type) end, 'n/a') as accessorial_type, coalesce(case when trim(acc_cd.data_source)='' then null else trim(acc_cd.data_source) end, 'n/a') as data_source, coalesce(case when trim(acc_cd.distance_uom)='' then null else trim(acc_cd.distance_uom) end, 'n/a') as distance_uom, coalesce(case when trim(acc_cd.description)='' then null else trim(acc_cd.description) end, 'n/a') as accessorial_description, coalesce(to_utc_timestamp(from_unixtime(acc_cd.last_updated_dttm div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt"), '9999-12-31 00:00:00') as last_updated_dttm, coalesce(acc_cd.is_hazmat, 0) as is_hazmat, coalesce(acc_cd.is_default_for_invoice, 0) as is_default_for_invoice, coalesce(acc_cd.is_fuel_accessorial, 0) as is_fuel_accessorial, coalesce(acc_cd.accessorial_id , 0) as accessorial_id, coalesce(acc_cd.is_tax_accessorial, 0) as is_tax_accessorial, coalesce(acc_cd.is_add_to_spot_charge, 0) as is_add_to_spot_charge, coalesce(acc_cd.is_add_stop_off_charge, 0) as is_add_stop_off_charge, coalesce(acc_cd.calculation_option_level, 0) as calculation_option_level, coalesce(acc_cd.delivery_level, 0) as delivery_level, coalesce(acc_cd.is_requested, 0) as is_requested, coalesce(acc_cd.is_ship_via, 0) as is_ship_via, coalesce(acc_cd.calculation_factor, 0) as calculation_factor, coalesce(acc_cd.is_oversize, 0) as is_oversize, coalesce(acc_cd.is_apply_once_per_ship, 0) as is_apply_once_per_ship, coalesce(acc_cd.fuel_index_id, 0) as fuel_index_id, coalesce(acc_cd.is_cost_plus_accessorial, 0) as is_cost_plus_accessorial, coalesce(acc_rate.accessorial_param_set_id, 0) as accessorial_param_set_id, coalesce(acc_rate.accessorial_rate_id, 0) as accessorial_rate_id, coalesce(acc_rate.rate, 0.0) as rate, coalesce(acc_rate.minimum_rate, 0.0) as minimum_rate, coalesce(case when trim(acc_rate.currency_code)='' then null else trim(acc_rate.currency_code) end, 'n/a') as currency_cd, coalesce(acc_rate.is_auto_approve, 0) as is_auto_approve, coalesce(to_date(to_utc_timestamp(from_unixtime(acc_rate.effective_dt div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt")), '9999-12-31') as effective_dt, coalesce(to_date(to_utc_timestamp(from_unixtime(acc_rate.expiration_dt div 1000, 'yyyy-mm-dd hh:mm:ss'), "est5edt")), '9999-12-31') as expiration_dt, coalesce(acc_rate.effective_seq, 0) as effective_seq, coalesce(acc_rate.is_shipment_accessorial, 0) as is_shipment_accessorial, coalesce(acc_rate.mot_id, 0) as mot_id, coalesce(acc_rate.equipment_id, 0) as equipment_id, coalesce(acc_rate.service_level_id, 0) as service_level_id, coalesce(acc_rate.protection_level_id, 0) as protection_level_id from tms_stage0.ca2015_accessorial_code acc_cd left outer join tms_stage0.ca2015_accessorial_type acc_type on acc_cd.accessorial_type=acc_type.accessorial_type left outer join tms_stage0.ca2015_accessorial_rate acc_rate on acc_cd.accessorial_id=acc_rate.accessorial_id
------------------------- ---loading staging data into final staging table -------------------------  set tez.job.name=staging:tms_accessorial_master_tmp1 :load target table from tms_accessorial_master_tmp;
! echo started loading into scct_work_db.tms_accessorial_master_tmp1;
------------------------- ---loading staging data into target table -------------------------  set tez.job.name=staging:tms_accessorial_master :load target table from tms_accessorial_master_tmp1;
! echo started loading into scct_db.tms_accessorial_master;
! echo data load is completed;
