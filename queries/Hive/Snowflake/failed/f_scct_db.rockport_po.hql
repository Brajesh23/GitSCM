! echo completed loading into scct_db.rockport_ocean_shipment ;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_po -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_po ---source: rockport_stage0 table : trader_contract_dtl,trader_contract_hdr,trader_delivery_dtl,trader_plci3225, ---trader_order_dtl,trader_delivery_dtl,trader_order_hdr,trader_party,trader_costing_hdr,trader_packing, ---load type: full ---back posting: no ---author - created/updated date - jira ticket ---ssoma - 06/05/2019 -  ---ssoma - 14/06/2019 - scctp4-2006/07/08 --------------------------------------------------------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading stage1 table scct_db.rockport_po  -------------------------  set tez.job.name=stage1:rockport_po_work:load work table rockport_po_work;
! echo started loading into scct_work_db.rockport_po_work;
insert overwrite table scct_work_db.rockport_po_work select 'contract' as po_type ,coalesce(case when trim(ch.owner)='' then null else trim(ch.owner) end , 'n/a') as owner ,coalesce(case when trim(cd.contract_no)='' then null else trim(cd.contract_no) end , 'n/a') as po_nbr ,coalesce(case when trim(cd.item)='' then null when length(trim(cd.item))=8 then lpad(trim(cd.item),18,0) else trim(cd.item) end , '0') as itm_nbr ,coalesce(case when trim(cd.line_no)='' then null else trim(cd.line_no) end , 'n/a') as line_nbr ,coalesce(case when trim(ch.dept)='' then null else trim(ch.dept) end , 'n/a') as department ,coalesce(case when trim(dd.proof_of_del_no)='' then null else trim(dd.proof_of_del_no) end , 'n/a') as inco_terms ,coalesce(case when trim(cd.qty_ordered)='' then null else trim(cd.qty_ordered) end , 0.00) as qty_ordered ,coalesce(case when trim(dd.transport_mode)='' then null else trim(dd.transport_mode) end , 'n/a') as shipping_method ,coalesce(case when trim(cd.origin_country)='' then null else trim(cd.origin_country) end , 'n/a') as origin_country ,coalesce(case when trim(dd.status)='' then null else trim(dd.status) end , 'n/a') as port ,coalesce(case when trim(pc.place_name)='' then null else trim(pc.place_name) end , 'n/a') as port_name ,coalesce(case when trim(pc.country)='' then null else trim(pc.country) end , 'n/a') as export_country ,coalesce(to_date(to_utc_timestamp(cd.order_date, "est5edt")), '9999-12-31') as order_dt ,coalesce(case when trim(cd.manufacturer)='' then null else trim(cd.manufacturer) end , 'n/a') as factory_id ,coalesce(case when trim(pa.party_name_line1)='' then null else trim(pa.party_name_line1) end , 'n/a') as factory_name ,coalesce(case when trim(pa.city_name_1)='' then null else trim(pa.city_name_1) end , 'n/a') as factory_city ,coalesce(case when trim(pa.country_1)='' then null else trim(pa.country_1) end , 'n/a') as factory_country ,coalesce(case when trim(cd.secondary_owner)='' then null else trim(cd.secondary_owner) end , 'n/a') as brand ,coalesce(to_date(to_utc_timestamp(cd.latest_ship_date, "est5edt")), '9999-12-31') as plan_gac_dt ,coalesce(to_date(to_utc_timestamp(dd.last_delivery_date, "est5edt")), '9999-12-31') as plan_ndc_dt ,coalesce(case when trim(dd.deliver_to)='' then null else trim(dd.deliver_to) end , 'n/a') as deliver_to ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as deliver_to_name ,coalesce(case when trim(pa2.city_name_1)='' then null else trim(pa2.city_name_1) end , 'n/a') as deliver_to_city ,coalesce(case when trim(pa2.country_1)='' then null else trim(pa2.country_1) end , 'n/a') as deliver_to_country ,coalesce(case when trim(cd.order_no)='' then null else trim(cd.order_no) end , 'n/a') as cpo ,coalesce(case when trim(ch.seller)='' then null else trim(ch.seller) end , 'n/a') as seller_id ,coalesce(case when trim(pa3.party_name_line1)='' then null else trim(pa3.party_name_line1) end , 'n/a') as seller_name ,coalesce(case when trim(pa3.city_name_1)='' then null else trim(pa3.city_name_1) end , 'n/a') as seller_city ,coalesce(case when trim(pa3.country_1)='' then null else trim(pa3.country_1) end , 'n/a') as seller_country ,coalesce(case when trim(coh.dim_factor)='' then null else trim(coh.dim_factor) end , 0.00) as dim_factor ,coalesce(case when trim(coh.price)='' then null else trim(coh.price) end , 0.00) as price ,coalesce(case when trim(coh.currency)='' then null else trim(coh.currency) end , 'n/a') as currency ,coalesce(case when trim(p.gross_wgt_unit)='' then null else trim(p.gross_wgt_unit) end , 0.00) as gross_wgt_unit ,coalesce(case when trim(p.gross_wgt_unit_um)='' then null else trim(p.gross_wgt_unit_um) end , 'n/a') as gross_wgt_uom ,coalesce(to_utc_timestamp(ch.last_update, "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(cd.last_update, "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm ,coalesce(to_utc_timestamp(dd.last_update, "est5edt"), '9999-12-31 00:00:00') as delivery_last_upd_dtm ,coalesce(to_utc_timestamp(p.last_update, "est5edt"), '9999-12-31 00:00:00') as packing_last_upd_dtm ,coalesce(to_utc_timestamp(coh.last_update, "est5edt"), '9999-12-31 00:00:00') as costing_last_upd_dtm from rockport_stage0.trader_contract_dtl cd left join rockport_stage0.trader_contract_hdr ch on ch.owner=cd.owner and ch.contract_no=cd.contract_no left join rockport_stage0.trader_delivery_dtl dd on dd.link_key_val=concat(cd.contract_no,' + ',cd.contract_no,' + ',cd.item,' + ',cd.line_no) and dd.owner=ch.owner left join rockport_stage0.trader_plci3225 pc on pc.place_code=dd.status left join rockport_stage0.trader_party pa on pa.party_id=cd.manufacturer left join rockport_stage0.trader_party pa2 on pa2.party_id=dd.deliver_to left join rockport_stage0.trader_party pa3 on pa3.party_id=ch.seller left join rockport_stage0.trader_costing_hdr coh on coh.owner=cd.owner and coh.link_key_val=concat(cd.contract_no,' + ',cd.contract_no,' + ',cd.item,' + ',cd.line_no) left join rockport_stage0.trader_packing p on p.owner=coh.owner and p.link_key_val=coh.link_key_val  union all select 'order' as po_type ,coalesce(case when trim(oh.owner)='' then null else trim(oh.owner) end , 'n/a') as owner ,coalesce(case when trim(od.order_no)='' then null else trim(od.order_no) end , 'n/a') as po_nbr ,coalesce(case when trim(od.item)='' then null when length(trim(od.item))=8 then lpad(trim(od.item),18,0) else trim(od.item) end , '0') as itm_nbr ,coalesce(case when trim(od.line_no)='' then null else trim(od.line_no) end , 'n/a') as line_nbr ,coalesce(case when trim(oh.dept)='' then null else trim(oh.dept) end , 'n/a') as department ,coalesce(case when trim(dd.proof_of_del_no)='' then null else trim(dd.proof_of_del_no) end , 'n/a') as inco_terms ,coalesce(case when trim(od.qty_ordered)='' then null else trim(od.qty_ordered) end , 0.00) as qty_ordered ,coalesce(case when trim(dd.transport_mode)='' then null else trim(dd.transport_mode) end , 'n/a') as shipping_method ,coalesce(case when trim(od.origin_country)='' then null else trim(od.origin_country) end , 'n/a') as origin_country ,coalesce(case when trim(dd.status)='' then null else trim(dd.status) end , 'n/a') as port ,coalesce(case when trim(replace(pc.place_name,',',''))='' then null else trim(replace(pc.place_name,',','')) end , 'n/a') as port_name ,coalesce(case when trim(pc.country)='' then null else trim(pc.country) end , 'n/a') as export_country ,coalesce(to_date(to_utc_timestamp(oh.order_date, "est5edt")), '9999-12-31') as order_dt ,coalesce(case when trim(od.manufacturer)='' then null else trim(od.manufacturer) end , 'n/a') as factory_id ,coalesce(case when trim(pa.party_name_line1)='' then null else trim(pa.party_name_line1) end , 'n/a') as factory_name ,coalesce(case when trim(pa.city_name_1)='' then null else trim(pa.city_name_1) end , 'n/a') as factory_city ,coalesce(case when trim(pa.country_1)='' then null else trim(pa.country_1) end , 'n/a') as factory_country ,coalesce(case when trim(od.deliver_to)='' then null else trim(od.deliver_to) end , 'n/a') as brand ,coalesce(to_date(to_utc_timestamp(od.latest_ship_date, "est5edt")), '9999-12-31') as plan_gac_dt ,coalesce(to_date(to_utc_timestamp(dd.last_delivery_date, "est5edt")), '9999-12-31') as plan_ndc_dt ,coalesce(case when trim(dd.deliver_to)='' then null else trim(dd.deliver_to) end , 'n/a') as deliver_to ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as deliver_to_name ,coalesce(case when trim(pa2.city_name_1)='' then null else trim(pa2.city_name_1) end , 'n/a') as deliver_to_city ,coalesce(case when trim(pa2.country_1)='' then null else trim(pa2.country_1) end , 'n/a') as deliver_to_country ,'n/a' as cpo ,coalesce(case when trim(oh.seller)='' then null else trim(oh.seller) end , 'n/a') as seller_id ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as seller_name ,coalesce(case when trim(pa3.city_name_1)='' then null else trim(pa3.city_name_1) end , 'n/a') as seller_city ,coalesce(case when trim(pa3.country_1)='' then null else trim(pa3.country_1) end , 'n/a') as seller_country ,coalesce(case when trim(coh.dim_factor)='' then null else trim(coh.dim_factor) end , 0.00) as dim_factor ,coalesce(case when trim(coh.price)='' then null else trim(coh.price) end , 0.00) as price ,coalesce(case when trim(coh.currency)='' then null else trim(coh.currency) end , 'n/a') as currency ,coalesce(case when trim(p.gross_wgt_unit)='' then null else trim(p.gross_wgt_unit) end , 0.00) as gross_wgt_unit ,coalesce(case when trim(p.gross_wgt_unit_um)='' then null else trim(p.gross_wgt_unit_um) end , 'n/a') as gross_wgt_uom ,coalesce(to_utc_timestamp(oh.last_update, "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(od.last_update, "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm ,coalesce(to_utc_timestamp(dd.last_update, "est5edt"), '9999-12-31 00:00:00') as delivery_last_upd_dtm ,coalesce(to_utc_timestamp(p.last_update, "est5edt"), '9999-12-31 00:00:00') as packing_last_upd_dtm ,coalesce(to_utc_timestamp(coh.last_update, "est5edt"), '9999-12-31 00:00:00') as costing_last_upd_dtm from rockport_stage0.trader_order_dtl od left join rockport_stage0.trader_delivery_dtl dd on dd.link_key_val=concat(od.order_no,' + ',od.item,' + ',od.line_no) left join rockport_stage0.trader_plci3225 pc on pc.place_code=dd.status left join rockport_stage0.trader_party pa on pa.party_id=od.manufacturer left join rockport_stage0.trader_party pa2 on pa2.party_id=dd.deliver_to join rockport_stage0.trader_order_hdr oh on oh.order_no=od.order_no and oh.owner=od.owner left join rockport_stage0.trader_party pa3 on pa3.party_id=oh.seller left join rockport_stage0.trader_costing_hdr coh on coh.owner=od.owner and coh.link_key_val=concat(od.order_no,' + ',od.item,' + ',od.line_no) left join rockport_stage0.trader_packing p on p.owner=coh.owner and p.link_key_val=coh.link_key_val
! echo completed loading into scct_work_db.rockport_po_work;
! echo started loading into scct_db.rockport_po;
insert overwrite table scct_db.rockport_po select coalesce(rpw.po_type, rp.po_type) ,coalesce(rpw.owner, rp.owner) ,coalesce(rpw.po_nbr, rp.po_nbr) ,coalesce(i.item_number, rpw.itm_nbr, rp.itm_nbr) ,coalesce(rpw.line_nbr, rp.line_nbr) ,coalesce(rpw.department, rp.department) ,coalesce(rpw.inco_terms, rp.inco_terms) ,coalesce(rpw.qty_ordered, rp.qty_ordered) ,coalesce(rpw.shipping_method, rp.shipping_method) ,coalesce(rpw.origin_country, rp.origin_country) ,coalesce(rpw.port, rp.port) ,coalesce(rpw.port_name, rp.port_name) ,coalesce(rpw.export_country, rp.export_country) ,coalesce(rpw.order_dt, rp.order_dt) ,coalesce(rpw.factory_id, rp.factory_id) ,coalesce(rpw.factory_name, rp.factory_name) ,coalesce(rpw.factory_city, rp.factory_city) ,coalesce(rpw.factory_country, rp.factory_country) ,coalesce(rpw.brand, rp.brand) ,coalesce(rpw.plan_gac_dt, rp.plan_gac_dt) ,coalesce(rpw.plan_ndc_dt, rp.plan_ndc_dt) ,coalesce(rpw.deliver_to, rp.deliver_to) ,coalesce(rpw.deliver_to_name, rp.deliver_to_name) ,coalesce(rpw.deliver_to_city, rp.deliver_to_city) ,coalesce(rpw.deliver_to_country, rp.deliver_to_country) ,coalesce(rpw.cpo, rp.cpo) ,coalesce(rpw.seller_id, rp.seller_id) ,coalesce(rpw.seller_name, rp.seller_name) ,coalesce(rpw.seller_city, rp.seller_city) ,coalesce(rpw.seller_country, rp.seller_country) ,coalesce(rpw.dim_factor, rp.dim_factor) ,coalesce(rpw.price, rp.price) ,coalesce(rpw.currency, rp.currency) ,coalesce(rpw.gross_wgt_unit, rp.gross_wgt_unit) ,coalesce(rpw.gross_wgt_uom, rp.gross_wgt_uom) ,coalesce(rpw.header_last_upd_dtm, rp.header_last_upd_dtm) ,coalesce(rpw.detail_last_upd_dtm, rp.detail_last_upd_dtm) ,coalesce(rpw.delivery_last_upd_dtm, rp.delivery_last_upd_dtm) ,coalesce(rpw.packing_last_upd_dtm, rp.packing_last_upd_dtm) ,coalesce(rpw.costing_last_upd_dtm, rp.costing_last_upd_dtm) from scct_work_db.rockport_po_work rpw  full join scct_db.rockport_po rp  on rpw.owner=rp.owner and rpw.po_type=rp.po_type and rpw.po_nbr=rp.po_nbr and rpw.line_nbr=rp.line_nbr and rpw.itm_nbr = rp.itm_nbr left outer join analytics_view.item i on rpw.itm_nbr = i.item_number
! echo completed loading into scct_db.rockport_po;
! echo completed loading into scct_db.rockport_ocean_shipment ;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_po -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_po ---source: rockport_stage0 table : trader_contract_dtl,trader_contract_hdr,trader_delivery_dtl,trader_plci3225, ---trader_order_dtl,trader_delivery_dtl,trader_order_hdr,trader_party,trader_costing_hdr,trader_packing, ---load type: full ---back posting: no ---author - created/updated date - jira ticket ---ssoma - 06/05/2019 -  ---ssoma - 14/06/2019 - scctp4-2006/07/08 --------------------------------------------------------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading stage1 table scct_db.rockport_po  -------------------------  set tez.job.name=stage1:rockport_po_work:load work table rockport_po_work;
! echo started loading into scct_work_db.rockport_po_work;
insert overwrite table scct_work_db.rockport_po_work select 'contract' as po_type ,coalesce(case when trim(ch.owner)='' then null else trim(ch.owner) end , 'n/a') as owner ,coalesce(case when trim(cd.contract_no)='' then null else trim(cd.contract_no) end , 'n/a') as po_nbr ,coalesce(case when trim(cd.item)='' then null when length(trim(cd.item))=8 then lpad(trim(cd.item),18,0) else trim(cd.item) end , '0') as itm_nbr ,coalesce(case when trim(cd.line_no)='' then null else trim(cd.line_no) end , 'n/a') as line_nbr ,coalesce(case when trim(ch.dept)='' then null else trim(ch.dept) end , 'n/a') as department ,coalesce(case when trim(dd.proof_of_del_no)='' then null else trim(dd.proof_of_del_no) end , 'n/a') as inco_terms ,coalesce(case when trim(cd.qty_ordered)='' then null else trim(cd.qty_ordered) end , 0.00) as qty_ordered ,coalesce(case when trim(dd.transport_mode)='' then null else trim(dd.transport_mode) end , 'n/a') as shipping_method ,coalesce(case when trim(cd.origin_country)='' then null else trim(cd.origin_country) end , 'n/a') as origin_country ,coalesce(case when trim(dd.status)='' then null else trim(dd.status) end , 'n/a') as port ,coalesce(case when trim(pc.place_name)='' then null else trim(pc.place_name) end , 'n/a') as port_name ,coalesce(case when trim(pc.country)='' then null else trim(pc.country) end , 'n/a') as export_country ,coalesce(to_date(to_utc_timestamp(cd.order_date, "est5edt")), '9999-12-31') as order_dt ,coalesce(case when trim(cd.manufacturer)='' then null else trim(cd.manufacturer) end , 'n/a') as factory_id ,coalesce(case when trim(pa.party_name_line1)='' then null else trim(pa.party_name_line1) end , 'n/a') as factory_name ,coalesce(case when trim(pa.city_name_1)='' then null else trim(pa.city_name_1) end , 'n/a') as factory_city ,coalesce(case when trim(pa.country_1)='' then null else trim(pa.country_1) end , 'n/a') as factory_country ,coalesce(case when trim(cd.secondary_owner)='' then null else trim(cd.secondary_owner) end , 'n/a') as brand ,coalesce(to_date(to_utc_timestamp(cd.latest_ship_date, "est5edt")), '9999-12-31') as plan_gac_dt ,coalesce(to_date(to_utc_timestamp(dd.last_delivery_date, "est5edt")), '9999-12-31') as plan_ndc_dt ,coalesce(case when trim(dd.deliver_to)='' then null else trim(dd.deliver_to) end , 'n/a') as deliver_to ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as deliver_to_name ,coalesce(case when trim(pa2.city_name_1)='' then null else trim(pa2.city_name_1) end , 'n/a') as deliver_to_city ,coalesce(case when trim(pa2.country_1)='' then null else trim(pa2.country_1) end , 'n/a') as deliver_to_country ,coalesce(case when trim(cd.order_no)='' then null else trim(cd.order_no) end , 'n/a') as cpo ,coalesce(case when trim(ch.seller)='' then null else trim(ch.seller) end , 'n/a') as seller_id ,coalesce(case when trim(pa3.party_name_line1)='' then null else trim(pa3.party_name_line1) end , 'n/a') as seller_name ,coalesce(case when trim(pa3.city_name_1)='' then null else trim(pa3.city_name_1) end , 'n/a') as seller_city ,coalesce(case when trim(pa3.country_1)='' then null else trim(pa3.country_1) end , 'n/a') as seller_country ,coalesce(case when trim(coh.dim_factor)='' then null else trim(coh.dim_factor) end , 0.00) as dim_factor ,coalesce(case when trim(coh.price)='' then null else trim(coh.price) end , 0.00) as price ,coalesce(case when trim(coh.currency)='' then null else trim(coh.currency) end , 'n/a') as currency ,coalesce(case when trim(p.gross_wgt_unit)='' then null else trim(p.gross_wgt_unit) end , 0.00) as gross_wgt_unit ,coalesce(case when trim(p.gross_wgt_unit_um)='' then null else trim(p.gross_wgt_unit_um) end , 'n/a') as gross_wgt_uom ,coalesce(to_utc_timestamp(ch.last_update, "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(cd.last_update, "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm ,coalesce(to_utc_timestamp(dd.last_update, "est5edt"), '9999-12-31 00:00:00') as delivery_last_upd_dtm ,coalesce(to_utc_timestamp(p.last_update, "est5edt"), '9999-12-31 00:00:00') as packing_last_upd_dtm ,coalesce(to_utc_timestamp(coh.last_update, "est5edt"), '9999-12-31 00:00:00') as costing_last_upd_dtm from rockport_stage0.trader_contract_dtl cd left join rockport_stage0.trader_contract_hdr ch on ch.owner=cd.owner and ch.contract_no=cd.contract_no left join rockport_stage0.trader_delivery_dtl dd on dd.link_key_val=concat(cd.contract_no,' + ',cd.contract_no,' + ',cd.item,' + ',cd.line_no) and dd.owner=ch.owner left join rockport_stage0.trader_plci3225 pc on pc.place_code=dd.status left join rockport_stage0.trader_party pa on pa.party_id=cd.manufacturer left join rockport_stage0.trader_party pa2 on pa2.party_id=dd.deliver_to left join rockport_stage0.trader_party pa3 on pa3.party_id=ch.seller left join rockport_stage0.trader_costing_hdr coh on coh.owner=cd.owner and coh.link_key_val=concat(cd.contract_no,' + ',cd.contract_no,' + ',cd.item,' + ',cd.line_no) left join rockport_stage0.trader_packing p on p.owner=coh.owner and p.link_key_val=coh.link_key_val  union all select 'order' as po_type ,coalesce(case when trim(oh.owner)='' then null else trim(oh.owner) end , 'n/a') as owner ,coalesce(case when trim(od.order_no)='' then null else trim(od.order_no) end , 'n/a') as po_nbr ,coalesce(case when trim(od.item)='' then null when length(trim(od.item))=8 then lpad(trim(od.item),18,0) else trim(od.item) end , '0') as itm_nbr ,coalesce(case when trim(od.line_no)='' then null else trim(od.line_no) end , 'n/a') as line_nbr ,coalesce(case when trim(oh.dept)='' then null else trim(oh.dept) end , 'n/a') as department ,coalesce(case when trim(dd.proof_of_del_no)='' then null else trim(dd.proof_of_del_no) end , 'n/a') as inco_terms ,coalesce(case when trim(od.qty_ordered)='' then null else trim(od.qty_ordered) end , 0.00) as qty_ordered ,coalesce(case when trim(dd.transport_mode)='' then null else trim(dd.transport_mode) end , 'n/a') as shipping_method ,coalesce(case when trim(od.origin_country)='' then null else trim(od.origin_country) end , 'n/a') as origin_country ,coalesce(case when trim(dd.status)='' then null else trim(dd.status) end , 'n/a') as port ,coalesce(case when trim(replace(pc.place_name,',',''))='' then null else trim(replace(pc.place_name,',','')) end , 'n/a') as port_name ,coalesce(case when trim(pc.country)='' then null else trim(pc.country) end , 'n/a') as export_country ,coalesce(to_date(to_utc_timestamp(oh.order_date, "est5edt")), '9999-12-31') as order_dt ,coalesce(case when trim(od.manufacturer)='' then null else trim(od.manufacturer) end , 'n/a') as factory_id ,coalesce(case when trim(pa.party_name_line1)='' then null else trim(pa.party_name_line1) end , 'n/a') as factory_name ,coalesce(case when trim(pa.city_name_1)='' then null else trim(pa.city_name_1) end , 'n/a') as factory_city ,coalesce(case when trim(pa.country_1)='' then null else trim(pa.country_1) end , 'n/a') as factory_country ,coalesce(case when trim(od.deliver_to)='' then null else trim(od.deliver_to) end , 'n/a') as brand ,coalesce(to_date(to_utc_timestamp(od.latest_ship_date, "est5edt")), '9999-12-31') as plan_gac_dt ,coalesce(to_date(to_utc_timestamp(dd.last_delivery_date, "est5edt")), '9999-12-31') as plan_ndc_dt ,coalesce(case when trim(dd.deliver_to)='' then null else trim(dd.deliver_to) end , 'n/a') as deliver_to ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as deliver_to_name ,coalesce(case when trim(pa2.city_name_1)='' then null else trim(pa2.city_name_1) end , 'n/a') as deliver_to_city ,coalesce(case when trim(pa2.country_1)='' then null else trim(pa2.country_1) end , 'n/a') as deliver_to_country ,'n/a' as cpo ,coalesce(case when trim(oh.seller)='' then null else trim(oh.seller) end , 'n/a') as seller_id ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as seller_name ,coalesce(case when trim(pa3.city_name_1)='' then null else trim(pa3.city_name_1) end , 'n/a') as seller_city ,coalesce(case when trim(pa3.country_1)='' then null else trim(pa3.country_1) end , 'n/a') as seller_country ,coalesce(case when trim(coh.dim_factor)='' then null else trim(coh.dim_factor) end , 0.00) as dim_factor ,coalesce(case when trim(coh.price)='' then null else trim(coh.price) end , 0.00) as price ,coalesce(case when trim(coh.currency)='' then null else trim(coh.currency) end , 'n/a') as currency ,coalesce(case when trim(p.gross_wgt_unit)='' then null else trim(p.gross_wgt_unit) end , 0.00) as gross_wgt_unit ,coalesce(case when trim(p.gross_wgt_unit_um)='' then null else trim(p.gross_wgt_unit_um) end , 'n/a') as gross_wgt_uom ,coalesce(to_utc_timestamp(oh.last_update, "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(od.last_update, "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm ,coalesce(to_utc_timestamp(dd.last_update, "est5edt"), '9999-12-31 00:00:00') as delivery_last_upd_dtm ,coalesce(to_utc_timestamp(p.last_update, "est5edt"), '9999-12-31 00:00:00') as packing_last_upd_dtm ,coalesce(to_utc_timestamp(coh.last_update, "est5edt"), '9999-12-31 00:00:00') as costing_last_upd_dtm from rockport_stage0.trader_order_dtl od left join rockport_stage0.trader_delivery_dtl dd on dd.link_key_val=concat(od.order_no,' + ',od.item,' + ',od.line_no) left join rockport_stage0.trader_plci3225 pc on pc.place_code=dd.status left join rockport_stage0.trader_party pa on pa.party_id=od.manufacturer left join rockport_stage0.trader_party pa2 on pa2.party_id=dd.deliver_to join rockport_stage0.trader_order_hdr oh on oh.order_no=od.order_no and oh.owner=od.owner left join rockport_stage0.trader_party pa3 on pa3.party_id=oh.seller left join rockport_stage0.trader_costing_hdr coh on coh.owner=od.owner and coh.link_key_val=concat(od.order_no,' + ',od.item,' + ',od.line_no) left join rockport_stage0.trader_packing p on p.owner=coh.owner and p.link_key_val=coh.link_key_val
! echo completed loading into scct_work_db.rockport_po_work;
! echo started loading into scct_db.rockport_po;
insert overwrite table scct_db.rockport_po select coalesce(rpw.po_type, rp.po_type) ,coalesce(rpw.owner, rp.owner) ,coalesce(rpw.po_nbr, rp.po_nbr) ,coalesce(i.item_number, rpw.itm_nbr, rp.itm_nbr) ,coalesce(rpw.line_nbr, rp.line_nbr) ,coalesce(rpw.department, rp.department) ,coalesce(rpw.inco_terms, rp.inco_terms) ,coalesce(rpw.qty_ordered, rp.qty_ordered) ,coalesce(rpw.shipping_method, rp.shipping_method) ,coalesce(rpw.origin_country, rp.origin_country) ,coalesce(rpw.port, rp.port) ,coalesce(rpw.port_name, rp.port_name) ,coalesce(rpw.export_country, rp.export_country) ,coalesce(rpw.order_dt, rp.order_dt) ,coalesce(rpw.factory_id, rp.factory_id) ,coalesce(rpw.factory_name, rp.factory_name) ,coalesce(rpw.factory_city, rp.factory_city) ,coalesce(rpw.factory_country, rp.factory_country) ,coalesce(rpw.brand, rp.brand) ,coalesce(rpw.plan_gac_dt, rp.plan_gac_dt) ,coalesce(rpw.plan_ndc_dt, rp.plan_ndc_dt) ,coalesce(rpw.deliver_to, rp.deliver_to) ,coalesce(rpw.deliver_to_name, rp.deliver_to_name) ,coalesce(rpw.deliver_to_city, rp.deliver_to_city) ,coalesce(rpw.deliver_to_country, rp.deliver_to_country) ,coalesce(rpw.cpo, rp.cpo) ,coalesce(rpw.seller_id, rp.seller_id) ,coalesce(rpw.seller_name, rp.seller_name) ,coalesce(rpw.seller_city, rp.seller_city) ,coalesce(rpw.seller_country, rp.seller_country) ,coalesce(rpw.dim_factor, rp.dim_factor) ,coalesce(rpw.price, rp.price) ,coalesce(rpw.currency, rp.currency) ,coalesce(rpw.gross_wgt_unit, rp.gross_wgt_unit) ,coalesce(rpw.gross_wgt_uom, rp.gross_wgt_uom) ,coalesce(rpw.header_last_upd_dtm, rp.header_last_upd_dtm) ,coalesce(rpw.detail_last_upd_dtm, rp.detail_last_upd_dtm) ,coalesce(rpw.delivery_last_upd_dtm, rp.delivery_last_upd_dtm) ,coalesce(rpw.packing_last_upd_dtm, rp.packing_last_upd_dtm) ,coalesce(rpw.costing_last_upd_dtm, rp.costing_last_upd_dtm) from scct_work_db.rockport_po_work rpw  full join scct_db.rockport_po rp  on rpw.owner=rp.owner and rpw.po_type=rp.po_type and rpw.po_nbr=rp.po_nbr and rpw.line_nbr=rp.line_nbr and rpw.itm_nbr = rp.itm_nbr left outer join analytics_view.item i on rpw.itm_nbr = i.item_number
! echo completed loading into scct_db.rockport_po;
! echo completed loading into scct_db.rockport_ocean_shipment ;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_po -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_po ---source: rockport_stage0 table : trader_contract_dtl,trader_contract_hdr,trader_delivery_dtl,trader_plci3225, ---trader_order_dtl,trader_delivery_dtl,trader_order_hdr,trader_party,trader_costing_hdr,trader_packing, ---load type: full ---back posting: no ---author - created/updated date - jira ticket ---ssoma - 06/05/2019 -  ---ssoma - 14/06/2019 - scctp4-2006/07/08 --------------------------------------------------------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading stage1 table scct_db.rockport_po  -------------------------  set tez.job.name=stage1:rockport_po_work:load work table rockport_po_work;
! echo started loading into scct_work_db.rockport_po_work;
insert overwrite table scct_work_db.rockport_po_work select 'contract' as po_type ,coalesce(case when trim(ch.owner)='' then null else trim(ch.owner) end , 'n/a') as owner ,coalesce(case when trim(cd.contract_no)='' then null else trim(cd.contract_no) end , 'n/a') as po_nbr ,coalesce(case when trim(cd.item)='' then null when length(trim(cd.item))=8 then lpad(trim(cd.item),18,0) else trim(cd.item) end , '0') as itm_nbr ,coalesce(case when trim(cd.line_no)='' then null else trim(cd.line_no) end , 'n/a') as line_nbr ,coalesce(case when trim(ch.dept)='' then null else trim(ch.dept) end , 'n/a') as department ,coalesce(case when trim(dd.proof_of_del_no)='' then null else trim(dd.proof_of_del_no) end , 'n/a') as inco_terms ,coalesce(case when trim(cd.qty_ordered)='' then null else trim(cd.qty_ordered) end , 0.00) as qty_ordered ,coalesce(case when trim(dd.transport_mode)='' then null else trim(dd.transport_mode) end , 'n/a') as shipping_method ,coalesce(case when trim(cd.origin_country)='' then null else trim(cd.origin_country) end , 'n/a') as origin_country ,coalesce(case when trim(dd.status)='' then null else trim(dd.status) end , 'n/a') as port ,coalesce(case when trim(pc.place_name)='' then null else trim(pc.place_name) end , 'n/a') as port_name ,coalesce(case when trim(pc.country)='' then null else trim(pc.country) end , 'n/a') as export_country ,coalesce(to_date(to_utc_timestamp(cd.order_date, "est5edt")), '9999-12-31') as order_dt ,coalesce(case when trim(cd.manufacturer)='' then null else trim(cd.manufacturer) end , 'n/a') as factory_id ,coalesce(case when trim(pa.party_name_line1)='' then null else trim(pa.party_name_line1) end , 'n/a') as factory_name ,coalesce(case when trim(pa.city_name_1)='' then null else trim(pa.city_name_1) end , 'n/a') as factory_city ,coalesce(case when trim(pa.country_1)='' then null else trim(pa.country_1) end , 'n/a') as factory_country ,coalesce(case when trim(cd.secondary_owner)='' then null else trim(cd.secondary_owner) end , 'n/a') as brand ,coalesce(to_date(to_utc_timestamp(cd.latest_ship_date, "est5edt")), '9999-12-31') as plan_gac_dt ,coalesce(to_date(to_utc_timestamp(dd.last_delivery_date, "est5edt")), '9999-12-31') as plan_ndc_dt ,coalesce(case when trim(dd.deliver_to)='' then null else trim(dd.deliver_to) end , 'n/a') as deliver_to ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as deliver_to_name ,coalesce(case when trim(pa2.city_name_1)='' then null else trim(pa2.city_name_1) end , 'n/a') as deliver_to_city ,coalesce(case when trim(pa2.country_1)='' then null else trim(pa2.country_1) end , 'n/a') as deliver_to_country ,coalesce(case when trim(cd.order_no)='' then null else trim(cd.order_no) end , 'n/a') as cpo ,coalesce(case when trim(ch.seller)='' then null else trim(ch.seller) end , 'n/a') as seller_id ,coalesce(case when trim(pa3.party_name_line1)='' then null else trim(pa3.party_name_line1) end , 'n/a') as seller_name ,coalesce(case when trim(pa3.city_name_1)='' then null else trim(pa3.city_name_1) end , 'n/a') as seller_city ,coalesce(case when trim(pa3.country_1)='' then null else trim(pa3.country_1) end , 'n/a') as seller_country ,coalesce(case when trim(coh.dim_factor)='' then null else trim(coh.dim_factor) end , 0.00) as dim_factor ,coalesce(case when trim(coh.price)='' then null else trim(coh.price) end , 0.00) as price ,coalesce(case when trim(coh.currency)='' then null else trim(coh.currency) end , 'n/a') as currency ,coalesce(case when trim(p.gross_wgt_unit)='' then null else trim(p.gross_wgt_unit) end , 0.00) as gross_wgt_unit ,coalesce(case when trim(p.gross_wgt_unit_um)='' then null else trim(p.gross_wgt_unit_um) end , 'n/a') as gross_wgt_uom ,coalesce(to_utc_timestamp(ch.last_update, "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(cd.last_update, "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm ,coalesce(to_utc_timestamp(dd.last_update, "est5edt"), '9999-12-31 00:00:00') as delivery_last_upd_dtm ,coalesce(to_utc_timestamp(p.last_update, "est5edt"), '9999-12-31 00:00:00') as packing_last_upd_dtm ,coalesce(to_utc_timestamp(coh.last_update, "est5edt"), '9999-12-31 00:00:00') as costing_last_upd_dtm from rockport_stage0.trader_contract_dtl cd left join rockport_stage0.trader_contract_hdr ch on ch.owner=cd.owner and ch.contract_no=cd.contract_no left join rockport_stage0.trader_delivery_dtl dd on dd.link_key_val=concat(cd.contract_no,' + ',cd.contract_no,' + ',cd.item,' + ',cd.line_no) and dd.owner=ch.owner left join rockport_stage0.trader_plci3225 pc on pc.place_code=dd.status left join rockport_stage0.trader_party pa on pa.party_id=cd.manufacturer left join rockport_stage0.trader_party pa2 on pa2.party_id=dd.deliver_to left join rockport_stage0.trader_party pa3 on pa3.party_id=ch.seller left join rockport_stage0.trader_costing_hdr coh on coh.owner=cd.owner and coh.link_key_val=concat(cd.contract_no,' + ',cd.contract_no,' + ',cd.item,' + ',cd.line_no) left join rockport_stage0.trader_packing p on p.owner=coh.owner and p.link_key_val=coh.link_key_val  union all select 'order' as po_type ,coalesce(case when trim(oh.owner)='' then null else trim(oh.owner) end , 'n/a') as owner ,coalesce(case when trim(od.order_no)='' then null else trim(od.order_no) end , 'n/a') as po_nbr ,coalesce(case when trim(od.item)='' then null when length(trim(od.item))=8 then lpad(trim(od.item),18,0) else trim(od.item) end , '0') as itm_nbr ,coalesce(case when trim(od.line_no)='' then null else trim(od.line_no) end , 'n/a') as line_nbr ,coalesce(case when trim(oh.dept)='' then null else trim(oh.dept) end , 'n/a') as department ,coalesce(case when trim(dd.proof_of_del_no)='' then null else trim(dd.proof_of_del_no) end , 'n/a') as inco_terms ,coalesce(case when trim(od.qty_ordered)='' then null else trim(od.qty_ordered) end , 0.00) as qty_ordered ,coalesce(case when trim(dd.transport_mode)='' then null else trim(dd.transport_mode) end , 'n/a') as shipping_method ,coalesce(case when trim(od.origin_country)='' then null else trim(od.origin_country) end , 'n/a') as origin_country ,coalesce(case when trim(dd.status)='' then null else trim(dd.status) end , 'n/a') as port ,coalesce(case when trim(replace(pc.place_name,',',''))='' then null else trim(replace(pc.place_name,',','')) end , 'n/a') as port_name ,coalesce(case when trim(pc.country)='' then null else trim(pc.country) end , 'n/a') as export_country ,coalesce(to_date(to_utc_timestamp(oh.order_date, "est5edt")), '9999-12-31') as order_dt ,coalesce(case when trim(od.manufacturer)='' then null else trim(od.manufacturer) end , 'n/a') as factory_id ,coalesce(case when trim(pa.party_name_line1)='' then null else trim(pa.party_name_line1) end , 'n/a') as factory_name ,coalesce(case when trim(pa.city_name_1)='' then null else trim(pa.city_name_1) end , 'n/a') as factory_city ,coalesce(case when trim(pa.country_1)='' then null else trim(pa.country_1) end , 'n/a') as factory_country ,coalesce(case when trim(od.deliver_to)='' then null else trim(od.deliver_to) end , 'n/a') as brand ,coalesce(to_date(to_utc_timestamp(od.latest_ship_date, "est5edt")), '9999-12-31') as plan_gac_dt ,coalesce(to_date(to_utc_timestamp(dd.last_delivery_date, "est5edt")), '9999-12-31') as plan_ndc_dt ,coalesce(case when trim(dd.deliver_to)='' then null else trim(dd.deliver_to) end , 'n/a') as deliver_to ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as deliver_to_name ,coalesce(case when trim(pa2.city_name_1)='' then null else trim(pa2.city_name_1) end , 'n/a') as deliver_to_city ,coalesce(case when trim(pa2.country_1)='' then null else trim(pa2.country_1) end , 'n/a') as deliver_to_country ,'n/a' as cpo ,coalesce(case when trim(oh.seller)='' then null else trim(oh.seller) end , 'n/a') as seller_id ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as seller_name ,coalesce(case when trim(pa3.city_name_1)='' then null else trim(pa3.city_name_1) end , 'n/a') as seller_city ,coalesce(case when trim(pa3.country_1)='' then null else trim(pa3.country_1) end , 'n/a') as seller_country ,coalesce(case when trim(coh.dim_factor)='' then null else trim(coh.dim_factor) end , 0.00) as dim_factor ,coalesce(case when trim(coh.price)='' then null else trim(coh.price) end , 0.00) as price ,coalesce(case when trim(coh.currency)='' then null else trim(coh.currency) end , 'n/a') as currency ,coalesce(case when trim(p.gross_wgt_unit)='' then null else trim(p.gross_wgt_unit) end , 0.00) as gross_wgt_unit ,coalesce(case when trim(p.gross_wgt_unit_um)='' then null else trim(p.gross_wgt_unit_um) end , 'n/a') as gross_wgt_uom ,coalesce(to_utc_timestamp(oh.last_update, "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(od.last_update, "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm ,coalesce(to_utc_timestamp(dd.last_update, "est5edt"), '9999-12-31 00:00:00') as delivery_last_upd_dtm ,coalesce(to_utc_timestamp(p.last_update, "est5edt"), '9999-12-31 00:00:00') as packing_last_upd_dtm ,coalesce(to_utc_timestamp(coh.last_update, "est5edt"), '9999-12-31 00:00:00') as costing_last_upd_dtm from rockport_stage0.trader_order_dtl od left join rockport_stage0.trader_delivery_dtl dd on dd.link_key_val=concat(od.order_no,' + ',od.item,' + ',od.line_no) left join rockport_stage0.trader_plci3225 pc on pc.place_code=dd.status left join rockport_stage0.trader_party pa on pa.party_id=od.manufacturer left join rockport_stage0.trader_party pa2 on pa2.party_id=dd.deliver_to join rockport_stage0.trader_order_hdr oh on oh.order_no=od.order_no and oh.owner=od.owner left join rockport_stage0.trader_party pa3 on pa3.party_id=oh.seller left join rockport_stage0.trader_costing_hdr coh on coh.owner=od.owner and coh.link_key_val=concat(od.order_no,' + ',od.item,' + ',od.line_no) left join rockport_stage0.trader_packing p on p.owner=coh.owner and p.link_key_val=coh.link_key_val
! echo completed loading into scct_work_db.rockport_po_work;
! echo started loading into scct_db.rockport_po;
insert overwrite table scct_db.rockport_po select coalesce(rpw.po_type, rp.po_type) ,coalesce(rpw.owner, rp.owner) ,coalesce(rpw.po_nbr, rp.po_nbr) ,coalesce(i.item_number, rpw.itm_nbr, rp.itm_nbr) ,coalesce(rpw.line_nbr, rp.line_nbr) ,coalesce(rpw.department, rp.department) ,coalesce(rpw.inco_terms, rp.inco_terms) ,coalesce(rpw.qty_ordered, rp.qty_ordered) ,coalesce(rpw.shipping_method, rp.shipping_method) ,coalesce(rpw.origin_country, rp.origin_country) ,coalesce(rpw.port, rp.port) ,coalesce(rpw.port_name, rp.port_name) ,coalesce(rpw.export_country, rp.export_country) ,coalesce(rpw.order_dt, rp.order_dt) ,coalesce(rpw.factory_id, rp.factory_id) ,coalesce(rpw.factory_name, rp.factory_name) ,coalesce(rpw.factory_city, rp.factory_city) ,coalesce(rpw.factory_country, rp.factory_country) ,coalesce(rpw.brand, rp.brand) ,coalesce(rpw.plan_gac_dt, rp.plan_gac_dt) ,coalesce(rpw.plan_ndc_dt, rp.plan_ndc_dt) ,coalesce(rpw.deliver_to, rp.deliver_to) ,coalesce(rpw.deliver_to_name, rp.deliver_to_name) ,coalesce(rpw.deliver_to_city, rp.deliver_to_city) ,coalesce(rpw.deliver_to_country, rp.deliver_to_country) ,coalesce(rpw.cpo, rp.cpo) ,coalesce(rpw.seller_id, rp.seller_id) ,coalesce(rpw.seller_name, rp.seller_name) ,coalesce(rpw.seller_city, rp.seller_city) ,coalesce(rpw.seller_country, rp.seller_country) ,coalesce(rpw.dim_factor, rp.dim_factor) ,coalesce(rpw.price, rp.price) ,coalesce(rpw.currency, rp.currency) ,coalesce(rpw.gross_wgt_unit, rp.gross_wgt_unit) ,coalesce(rpw.gross_wgt_uom, rp.gross_wgt_uom) ,coalesce(rpw.header_last_upd_dtm, rp.header_last_upd_dtm) ,coalesce(rpw.detail_last_upd_dtm, rp.detail_last_upd_dtm) ,coalesce(rpw.delivery_last_upd_dtm, rp.delivery_last_upd_dtm) ,coalesce(rpw.packing_last_upd_dtm, rp.packing_last_upd_dtm) ,coalesce(rpw.costing_last_upd_dtm, rp.costing_last_upd_dtm) from scct_work_db.rockport_po_work rpw  full join scct_db.rockport_po rp  on rpw.owner=rp.owner and rpw.po_type=rp.po_type and rpw.po_nbr=rp.po_nbr and rpw.line_nbr=rp.line_nbr and rpw.itm_nbr = rp.itm_nbr left outer join analytics_view.item i on rpw.itm_nbr = i.item_number
! echo completed loading into scct_db.rockport_po;
! echo completed loading into scct_db.rockport_ocean_shipment ;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_po -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_po ---source: rockport_stage0 table : trader_contract_dtl,trader_contract_hdr,trader_delivery_dtl,trader_plci3225, ---trader_order_dtl,trader_delivery_dtl,trader_order_hdr,trader_party,trader_costing_hdr,trader_packing, ---load type: full ---back posting: no ---author - created/updated date - jira ticket ---ssoma - 06/05/2019 -  ---ssoma - 14/06/2019 - scctp4-2006/07/08 --------------------------------------------------------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading stage1 table scct_db.rockport_po  -------------------------  set tez.job.name=stage1:rockport_po_work:load work table rockport_po_work;
! echo started loading into scct_work_db.rockport_po_work;
insert overwrite table scct_work_db.rockport_po_work select 'contract' as po_type ,coalesce(case when trim(ch.owner)='' then null else trim(ch.owner) end , 'n/a') as owner ,coalesce(case when trim(cd.contract_no)='' then null else trim(cd.contract_no) end , 'n/a') as po_nbr ,coalesce(case when trim(cd.item)='' then null when length(trim(cd.item))=8 then lpad(trim(cd.item),18,0) else trim(cd.item) end , '0') as itm_nbr ,coalesce(case when trim(cd.line_no)='' then null else trim(cd.line_no) end , 'n/a') as line_nbr ,coalesce(case when trim(ch.dept)='' then null else trim(ch.dept) end , 'n/a') as department ,coalesce(case when trim(dd.proof_of_del_no)='' then null else trim(dd.proof_of_del_no) end , 'n/a') as inco_terms ,coalesce(case when trim(cd.qty_ordered)='' then null else trim(cd.qty_ordered) end , 0.00) as qty_ordered ,coalesce(case when trim(dd.transport_mode)='' then null else trim(dd.transport_mode) end , 'n/a') as shipping_method ,coalesce(case when trim(cd.origin_country)='' then null else trim(cd.origin_country) end , 'n/a') as origin_country ,coalesce(case when trim(dd.status)='' then null else trim(dd.status) end , 'n/a') as port ,coalesce(case when trim(pc.place_name)='' then null else trim(pc.place_name) end , 'n/a') as port_name ,coalesce(case when trim(pc.country)='' then null else trim(pc.country) end , 'n/a') as export_country ,coalesce(to_date(to_utc_timestamp(cd.order_date, "est5edt")), '9999-12-31') as order_dt ,coalesce(case when trim(cd.manufacturer)='' then null else trim(cd.manufacturer) end , 'n/a') as factory_id ,coalesce(case when trim(pa.party_name_line1)='' then null else trim(pa.party_name_line1) end , 'n/a') as factory_name ,coalesce(case when trim(pa.city_name_1)='' then null else trim(pa.city_name_1) end , 'n/a') as factory_city ,coalesce(case when trim(pa.country_1)='' then null else trim(pa.country_1) end , 'n/a') as factory_country ,coalesce(case when trim(cd.secondary_owner)='' then null else trim(cd.secondary_owner) end , 'n/a') as brand ,coalesce(to_date(to_utc_timestamp(cd.latest_ship_date, "est5edt")), '9999-12-31') as plan_gac_dt ,coalesce(to_date(to_utc_timestamp(dd.last_delivery_date, "est5edt")), '9999-12-31') as plan_ndc_dt ,coalesce(case when trim(dd.deliver_to)='' then null else trim(dd.deliver_to) end , 'n/a') as deliver_to ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as deliver_to_name ,coalesce(case when trim(pa2.city_name_1)='' then null else trim(pa2.city_name_1) end , 'n/a') as deliver_to_city ,coalesce(case when trim(pa2.country_1)='' then null else trim(pa2.country_1) end , 'n/a') as deliver_to_country ,coalesce(case when trim(cd.order_no)='' then null else trim(cd.order_no) end , 'n/a') as cpo ,coalesce(case when trim(ch.seller)='' then null else trim(ch.seller) end , 'n/a') as seller_id ,coalesce(case when trim(pa3.party_name_line1)='' then null else trim(pa3.party_name_line1) end , 'n/a') as seller_name ,coalesce(case when trim(pa3.city_name_1)='' then null else trim(pa3.city_name_1) end , 'n/a') as seller_city ,coalesce(case when trim(pa3.country_1)='' then null else trim(pa3.country_1) end , 'n/a') as seller_country ,coalesce(case when trim(coh.dim_factor)='' then null else trim(coh.dim_factor) end , 0.00) as dim_factor ,coalesce(case when trim(coh.price)='' then null else trim(coh.price) end , 0.00) as price ,coalesce(case when trim(coh.currency)='' then null else trim(coh.currency) end , 'n/a') as currency ,coalesce(case when trim(p.gross_wgt_unit)='' then null else trim(p.gross_wgt_unit) end , 0.00) as gross_wgt_unit ,coalesce(case when trim(p.gross_wgt_unit_um)='' then null else trim(p.gross_wgt_unit_um) end , 'n/a') as gross_wgt_uom ,coalesce(to_utc_timestamp(ch.last_update, "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(cd.last_update, "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm ,coalesce(to_utc_timestamp(dd.last_update, "est5edt"), '9999-12-31 00:00:00') as delivery_last_upd_dtm ,coalesce(to_utc_timestamp(p.last_update, "est5edt"), '9999-12-31 00:00:00') as packing_last_upd_dtm ,coalesce(to_utc_timestamp(coh.last_update, "est5edt"), '9999-12-31 00:00:00') as costing_last_upd_dtm from rockport_stage0.trader_contract_dtl cd left join rockport_stage0.trader_contract_hdr ch on ch.owner=cd.owner and ch.contract_no=cd.contract_no left join rockport_stage0.trader_delivery_dtl dd on dd.link_key_val=concat(cd.contract_no,' + ',cd.contract_no,' + ',cd.item,' + ',cd.line_no) and dd.owner=ch.owner left join rockport_stage0.trader_plci3225 pc on pc.place_code=dd.status left join rockport_stage0.trader_party pa on pa.party_id=cd.manufacturer left join rockport_stage0.trader_party pa2 on pa2.party_id=dd.deliver_to left join rockport_stage0.trader_party pa3 on pa3.party_id=ch.seller left join rockport_stage0.trader_costing_hdr coh on coh.owner=cd.owner and coh.link_key_val=concat(cd.contract_no,' + ',cd.contract_no,' + ',cd.item,' + ',cd.line_no) left join rockport_stage0.trader_packing p on p.owner=coh.owner and p.link_key_val=coh.link_key_val  union all select 'order' as po_type ,coalesce(case when trim(oh.owner)='' then null else trim(oh.owner) end , 'n/a') as owner ,coalesce(case when trim(od.order_no)='' then null else trim(od.order_no) end , 'n/a') as po_nbr ,coalesce(case when trim(od.item)='' then null when length(trim(od.item))=8 then lpad(trim(od.item),18,0) else trim(od.item) end , '0') as itm_nbr ,coalesce(case when trim(od.line_no)='' then null else trim(od.line_no) end , 'n/a') as line_nbr ,coalesce(case when trim(oh.dept)='' then null else trim(oh.dept) end , 'n/a') as department ,coalesce(case when trim(dd.proof_of_del_no)='' then null else trim(dd.proof_of_del_no) end , 'n/a') as inco_terms ,coalesce(case when trim(od.qty_ordered)='' then null else trim(od.qty_ordered) end , 0.00) as qty_ordered ,coalesce(case when trim(dd.transport_mode)='' then null else trim(dd.transport_mode) end , 'n/a') as shipping_method ,coalesce(case when trim(od.origin_country)='' then null else trim(od.origin_country) end , 'n/a') as origin_country ,coalesce(case when trim(dd.status)='' then null else trim(dd.status) end , 'n/a') as port ,coalesce(case when trim(replace(pc.place_name,',',''))='' then null else trim(replace(pc.place_name,',','')) end , 'n/a') as port_name ,coalesce(case when trim(pc.country)='' then null else trim(pc.country) end , 'n/a') as export_country ,coalesce(to_date(to_utc_timestamp(oh.order_date, "est5edt")), '9999-12-31') as order_dt ,coalesce(case when trim(od.manufacturer)='' then null else trim(od.manufacturer) end , 'n/a') as factory_id ,coalesce(case when trim(pa.party_name_line1)='' then null else trim(pa.party_name_line1) end , 'n/a') as factory_name ,coalesce(case when trim(pa.city_name_1)='' then null else trim(pa.city_name_1) end , 'n/a') as factory_city ,coalesce(case when trim(pa.country_1)='' then null else trim(pa.country_1) end , 'n/a') as factory_country ,coalesce(case when trim(od.deliver_to)='' then null else trim(od.deliver_to) end , 'n/a') as brand ,coalesce(to_date(to_utc_timestamp(od.latest_ship_date, "est5edt")), '9999-12-31') as plan_gac_dt ,coalesce(to_date(to_utc_timestamp(dd.last_delivery_date, "est5edt")), '9999-12-31') as plan_ndc_dt ,coalesce(case when trim(dd.deliver_to)='' then null else trim(dd.deliver_to) end , 'n/a') as deliver_to ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as deliver_to_name ,coalesce(case when trim(pa2.city_name_1)='' then null else trim(pa2.city_name_1) end , 'n/a') as deliver_to_city ,coalesce(case when trim(pa2.country_1)='' then null else trim(pa2.country_1) end , 'n/a') as deliver_to_country ,'n/a' as cpo ,coalesce(case when trim(oh.seller)='' then null else trim(oh.seller) end , 'n/a') as seller_id ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as seller_name ,coalesce(case when trim(pa3.city_name_1)='' then null else trim(pa3.city_name_1) end , 'n/a') as seller_city ,coalesce(case when trim(pa3.country_1)='' then null else trim(pa3.country_1) end , 'n/a') as seller_country ,coalesce(case when trim(coh.dim_factor)='' then null else trim(coh.dim_factor) end , 0.00) as dim_factor ,coalesce(case when trim(coh.price)='' then null else trim(coh.price) end , 0.00) as price ,coalesce(case when trim(coh.currency)='' then null else trim(coh.currency) end , 'n/a') as currency ,coalesce(case when trim(p.gross_wgt_unit)='' then null else trim(p.gross_wgt_unit) end , 0.00) as gross_wgt_unit ,coalesce(case when trim(p.gross_wgt_unit_um)='' then null else trim(p.gross_wgt_unit_um) end , 'n/a') as gross_wgt_uom ,coalesce(to_utc_timestamp(oh.last_update, "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(od.last_update, "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm ,coalesce(to_utc_timestamp(dd.last_update, "est5edt"), '9999-12-31 00:00:00') as delivery_last_upd_dtm ,coalesce(to_utc_timestamp(p.last_update, "est5edt"), '9999-12-31 00:00:00') as packing_last_upd_dtm ,coalesce(to_utc_timestamp(coh.last_update, "est5edt"), '9999-12-31 00:00:00') as costing_last_upd_dtm from rockport_stage0.trader_order_dtl od left join rockport_stage0.trader_delivery_dtl dd on dd.link_key_val=concat(od.order_no,' + ',od.item,' + ',od.line_no) left join rockport_stage0.trader_plci3225 pc on pc.place_code=dd.status left join rockport_stage0.trader_party pa on pa.party_id=od.manufacturer left join rockport_stage0.trader_party pa2 on pa2.party_id=dd.deliver_to join rockport_stage0.trader_order_hdr oh on oh.order_no=od.order_no and oh.owner=od.owner left join rockport_stage0.trader_party pa3 on pa3.party_id=oh.seller left join rockport_stage0.trader_costing_hdr coh on coh.owner=od.owner and coh.link_key_val=concat(od.order_no,' + ',od.item,' + ',od.line_no) left join rockport_stage0.trader_packing p on p.owner=coh.owner and p.link_key_val=coh.link_key_val
! echo completed loading into scct_work_db.rockport_po_work;
! echo started loading into scct_db.rockport_po;
insert overwrite table scct_db.rockport_po select coalesce(rpw.po_type, rp.po_type) ,coalesce(rpw.owner, rp.owner) ,coalesce(rpw.po_nbr, rp.po_nbr) ,coalesce(i.item_number, rpw.itm_nbr, rp.itm_nbr) ,coalesce(rpw.line_nbr, rp.line_nbr) ,coalesce(rpw.department, rp.department) ,coalesce(rpw.inco_terms, rp.inco_terms) ,coalesce(rpw.qty_ordered, rp.qty_ordered) ,coalesce(rpw.shipping_method, rp.shipping_method) ,coalesce(rpw.origin_country, rp.origin_country) ,coalesce(rpw.port, rp.port) ,coalesce(rpw.port_name, rp.port_name) ,coalesce(rpw.export_country, rp.export_country) ,coalesce(rpw.order_dt, rp.order_dt) ,coalesce(rpw.factory_id, rp.factory_id) ,coalesce(rpw.factory_name, rp.factory_name) ,coalesce(rpw.factory_city, rp.factory_city) ,coalesce(rpw.factory_country, rp.factory_country) ,coalesce(rpw.brand, rp.brand) ,coalesce(rpw.plan_gac_dt, rp.plan_gac_dt) ,coalesce(rpw.plan_ndc_dt, rp.plan_ndc_dt) ,coalesce(rpw.deliver_to, rp.deliver_to) ,coalesce(rpw.deliver_to_name, rp.deliver_to_name) ,coalesce(rpw.deliver_to_city, rp.deliver_to_city) ,coalesce(rpw.deliver_to_country, rp.deliver_to_country) ,coalesce(rpw.cpo, rp.cpo) ,coalesce(rpw.seller_id, rp.seller_id) ,coalesce(rpw.seller_name, rp.seller_name) ,coalesce(rpw.seller_city, rp.seller_city) ,coalesce(rpw.seller_country, rp.seller_country) ,coalesce(rpw.dim_factor, rp.dim_factor) ,coalesce(rpw.price, rp.price) ,coalesce(rpw.currency, rp.currency) ,coalesce(rpw.gross_wgt_unit, rp.gross_wgt_unit) ,coalesce(rpw.gross_wgt_uom, rp.gross_wgt_uom) ,coalesce(rpw.header_last_upd_dtm, rp.header_last_upd_dtm) ,coalesce(rpw.detail_last_upd_dtm, rp.detail_last_upd_dtm) ,coalesce(rpw.delivery_last_upd_dtm, rp.delivery_last_upd_dtm) ,coalesce(rpw.packing_last_upd_dtm, rp.packing_last_upd_dtm) ,coalesce(rpw.costing_last_upd_dtm, rp.costing_last_upd_dtm) from scct_work_db.rockport_po_work rpw  full join scct_db.rockport_po rp  on rpw.owner=rp.owner and rpw.po_type=rp.po_type and rpw.po_nbr=rp.po_nbr and rpw.line_nbr=rp.line_nbr and rpw.itm_nbr = rp.itm_nbr left outer join analytics_view.item i on rpw.itm_nbr = i.item_number
! echo completed loading into scct_db.rockport_po;
! echo completed loading into scct_db.rockport_ob_shipment_item ;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_ocean_shipment -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_ocean_shipment  ---source: scct_work_db table : rockport_ocean_shipment_temp ---load type: upsert ---back posting: no ---author: ryadav ---last modified date: 05/08/2019 --------------------------------------------------------------------------  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading rockport_ocean_shipment stage 1 base data -------------------------  set tez.job.name=stage1:rockport_ocean_shipment :load target table rockport_ocean_shipment ;
! echo started loading into scct_db.rockport_ocean_shipment ;
! echo completed loading into scct_db.rockport_ocean_shipment ;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_po -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_po ---source: rockport_stage0 table : trader_contract_dtl,trader_contract_hdr,trader_delivery_dtl,trader_plci3225, ---trader_order_dtl,trader_delivery_dtl,trader_order_hdr,trader_party,trader_costing_hdr,trader_packing, ---load type: full ---back posting: no ---author - created/updated date - jira ticket ---ssoma - 06/05/2019 -  ---ssoma - 14/06/2019 - scctp4-2006/07/08 --------------------------------------------------------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading stage1 table scct_db.rockport_po  -------------------------  set tez.job.name=stage1:rockport_po_work:load work table rockport_po_work;
! echo started loading into scct_work_db.rockport_po_work;
insert overwrite table scct_work_db.rockport_po_work select 'contract' as po_type ,coalesce(case when trim(ch.owner)='' then null else trim(ch.owner) end , 'n/a') as owner ,coalesce(case when trim(cd.contract_no)='' then null else trim(cd.contract_no) end , 'n/a') as po_nbr ,coalesce(case when trim(cd.item)='' then null when length(trim(cd.item))=8 then lpad(trim(cd.item),18,0) else trim(cd.item) end , '0') as itm_nbr ,coalesce(case when trim(cd.line_no)='' then null else trim(cd.line_no) end , 'n/a') as line_nbr ,coalesce(case when trim(ch.dept)='' then null else trim(ch.dept) end , 'n/a') as department ,coalesce(case when trim(dd.proof_of_del_no)='' then null else trim(dd.proof_of_del_no) end , 'n/a') as inco_terms ,coalesce(case when trim(cd.qty_ordered)='' then null else trim(cd.qty_ordered) end , 0.00) as qty_ordered ,coalesce(case when trim(dd.transport_mode)='' then null else trim(dd.transport_mode) end , 'n/a') as shipping_method ,coalesce(case when trim(cd.origin_country)='' then null else trim(cd.origin_country) end , 'n/a') as origin_country ,coalesce(case when trim(dd.status)='' then null else trim(dd.status) end , 'n/a') as port ,coalesce(case when trim(pc.place_name)='' then null else trim(pc.place_name) end , 'n/a') as port_name ,coalesce(case when trim(pc.country)='' then null else trim(pc.country) end , 'n/a') as export_country ,coalesce(to_date(to_utc_timestamp(cd.order_date, "est5edt")), '9999-12-31') as order_dt ,coalesce(case when trim(cd.manufacturer)='' then null else trim(cd.manufacturer) end , 'n/a') as factory_id ,coalesce(case when trim(pa.party_name_line1)='' then null else trim(pa.party_name_line1) end , 'n/a') as factory_name ,coalesce(case when trim(pa.city_name_1)='' then null else trim(pa.city_name_1) end , 'n/a') as factory_city ,coalesce(case when trim(pa.country_1)='' then null else trim(pa.country_1) end , 'n/a') as factory_country ,coalesce(case when trim(cd.secondary_owner)='' then null else trim(cd.secondary_owner) end , 'n/a') as brand ,coalesce(to_date(to_utc_timestamp(cd.latest_ship_date, "est5edt")), '9999-12-31') as plan_gac_dt ,coalesce(to_date(to_utc_timestamp(dd.last_delivery_date, "est5edt")), '9999-12-31') as plan_ndc_dt ,coalesce(case when trim(dd.deliver_to)='' then null else trim(dd.deliver_to) end , 'n/a') as deliver_to ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as deliver_to_name ,coalesce(case when trim(pa2.city_name_1)='' then null else trim(pa2.city_name_1) end , 'n/a') as deliver_to_city ,coalesce(case when trim(pa2.country_1)='' then null else trim(pa2.country_1) end , 'n/a') as deliver_to_country ,coalesce(case when trim(cd.order_no)='' then null else trim(cd.order_no) end , 'n/a') as cpo ,coalesce(case when trim(ch.seller)='' then null else trim(ch.seller) end , 'n/a') as seller_id ,coalesce(case when trim(pa3.party_name_line1)='' then null else trim(pa3.party_name_line1) end , 'n/a') as seller_name ,coalesce(case when trim(pa3.city_name_1)='' then null else trim(pa3.city_name_1) end , 'n/a') as seller_city ,coalesce(case when trim(pa3.country_1)='' then null else trim(pa3.country_1) end , 'n/a') as seller_country ,coalesce(case when trim(coh.dim_factor)='' then null else trim(coh.dim_factor) end , 0.00) as dim_factor ,coalesce(case when trim(coh.price)='' then null else trim(coh.price) end , 0.00) as price ,coalesce(case when trim(coh.currency)='' then null else trim(coh.currency) end , 'n/a') as currency ,coalesce(case when trim(p.gross_wgt_unit)='' then null else trim(p.gross_wgt_unit) end , 0.00) as gross_wgt_unit ,coalesce(case when trim(p.gross_wgt_unit_um)='' then null else trim(p.gross_wgt_unit_um) end , 'n/a') as gross_wgt_uom ,coalesce(to_utc_timestamp(ch.last_update, "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(cd.last_update, "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm ,coalesce(to_utc_timestamp(dd.last_update, "est5edt"), '9999-12-31 00:00:00') as delivery_last_upd_dtm ,coalesce(to_utc_timestamp(p.last_update, "est5edt"), '9999-12-31 00:00:00') as packing_last_upd_dtm ,coalesce(to_utc_timestamp(coh.last_update, "est5edt"), '9999-12-31 00:00:00') as costing_last_upd_dtm from rockport_stage0.trader_contract_dtl cd left join rockport_stage0.trader_contract_hdr ch on ch.owner=cd.owner and ch.contract_no=cd.contract_no left join rockport_stage0.trader_delivery_dtl dd on dd.link_key_val=concat(cd.contract_no,' + ',cd.contract_no,' + ',cd.item,' + ',cd.line_no) and dd.owner=ch.owner left join rockport_stage0.trader_plci3225 pc on pc.place_code=dd.status left join rockport_stage0.trader_party pa on pa.party_id=cd.manufacturer left join rockport_stage0.trader_party pa2 on pa2.party_id=dd.deliver_to left join rockport_stage0.trader_party pa3 on pa3.party_id=ch.seller left join rockport_stage0.trader_costing_hdr coh on coh.owner=cd.owner and coh.link_key_val=concat(cd.contract_no,' + ',cd.contract_no,' + ',cd.item,' + ',cd.line_no) left join rockport_stage0.trader_packing p on p.owner=coh.owner and p.link_key_val=coh.link_key_val  union all select 'order' as po_type ,coalesce(case when trim(oh.owner)='' then null else trim(oh.owner) end , 'n/a') as owner ,coalesce(case when trim(od.order_no)='' then null else trim(od.order_no) end , 'n/a') as po_nbr ,coalesce(case when trim(od.item)='' then null when length(trim(od.item))=8 then lpad(trim(od.item),18,0) else trim(od.item) end , '0') as itm_nbr ,coalesce(case when trim(od.line_no)='' then null else trim(od.line_no) end , 'n/a') as line_nbr ,coalesce(case when trim(oh.dept)='' then null else trim(oh.dept) end , 'n/a') as department ,coalesce(case when trim(dd.proof_of_del_no)='' then null else trim(dd.proof_of_del_no) end , 'n/a') as inco_terms ,coalesce(case when trim(od.qty_ordered)='' then null else trim(od.qty_ordered) end , 0.00) as qty_ordered ,coalesce(case when trim(dd.transport_mode)='' then null else trim(dd.transport_mode) end , 'n/a') as shipping_method ,coalesce(case when trim(od.origin_country)='' then null else trim(od.origin_country) end , 'n/a') as origin_country ,coalesce(case when trim(dd.status)='' then null else trim(dd.status) end , 'n/a') as port ,coalesce(case when trim(replace(pc.place_name,',',''))='' then null else trim(replace(pc.place_name,',','')) end , 'n/a') as port_name ,coalesce(case when trim(pc.country)='' then null else trim(pc.country) end , 'n/a') as export_country ,coalesce(to_date(to_utc_timestamp(oh.order_date, "est5edt")), '9999-12-31') as order_dt ,coalesce(case when trim(od.manufacturer)='' then null else trim(od.manufacturer) end , 'n/a') as factory_id ,coalesce(case when trim(pa.party_name_line1)='' then null else trim(pa.party_name_line1) end , 'n/a') as factory_name ,coalesce(case when trim(pa.city_name_1)='' then null else trim(pa.city_name_1) end , 'n/a') as factory_city ,coalesce(case when trim(pa.country_1)='' then null else trim(pa.country_1) end , 'n/a') as factory_country ,coalesce(case when trim(od.deliver_to)='' then null else trim(od.deliver_to) end , 'n/a') as brand ,coalesce(to_date(to_utc_timestamp(od.latest_ship_date, "est5edt")), '9999-12-31') as plan_gac_dt ,coalesce(to_date(to_utc_timestamp(dd.last_delivery_date, "est5edt")), '9999-12-31') as plan_ndc_dt ,coalesce(case when trim(dd.deliver_to)='' then null else trim(dd.deliver_to) end , 'n/a') as deliver_to ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as deliver_to_name ,coalesce(case when trim(pa2.city_name_1)='' then null else trim(pa2.city_name_1) end , 'n/a') as deliver_to_city ,coalesce(case when trim(pa2.country_1)='' then null else trim(pa2.country_1) end , 'n/a') as deliver_to_country ,'n/a' as cpo ,coalesce(case when trim(oh.seller)='' then null else trim(oh.seller) end , 'n/a') as seller_id ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as seller_name ,coalesce(case when trim(pa3.city_name_1)='' then null else trim(pa3.city_name_1) end , 'n/a') as seller_city ,coalesce(case when trim(pa3.country_1)='' then null else trim(pa3.country_1) end , 'n/a') as seller_country ,coalesce(case when trim(coh.dim_factor)='' then null else trim(coh.dim_factor) end , 0.00) as dim_factor ,coalesce(case when trim(coh.price)='' then null else trim(coh.price) end , 0.00) as price ,coalesce(case when trim(coh.currency)='' then null else trim(coh.currency) end , 'n/a') as currency ,coalesce(case when trim(p.gross_wgt_unit)='' then null else trim(p.gross_wgt_unit) end , 0.00) as gross_wgt_unit ,coalesce(case when trim(p.gross_wgt_unit_um)='' then null else trim(p.gross_wgt_unit_um) end , 'n/a') as gross_wgt_uom ,coalesce(to_utc_timestamp(oh.last_update, "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(od.last_update, "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm ,coalesce(to_utc_timestamp(dd.last_update, "est5edt"), '9999-12-31 00:00:00') as delivery_last_upd_dtm ,coalesce(to_utc_timestamp(p.last_update, "est5edt"), '9999-12-31 00:00:00') as packing_last_upd_dtm ,coalesce(to_utc_timestamp(coh.last_update, "est5edt"), '9999-12-31 00:00:00') as costing_last_upd_dtm from rockport_stage0.trader_order_dtl od left join rockport_stage0.trader_delivery_dtl dd on dd.link_key_val=concat(od.order_no,' + ',od.item,' + ',od.line_no) left join rockport_stage0.trader_plci3225 pc on pc.place_code=dd.status left join rockport_stage0.trader_party pa on pa.party_id=od.manufacturer left join rockport_stage0.trader_party pa2 on pa2.party_id=dd.deliver_to join rockport_stage0.trader_order_hdr oh on oh.order_no=od.order_no and oh.owner=od.owner left join rockport_stage0.trader_party pa3 on pa3.party_id=oh.seller left join rockport_stage0.trader_costing_hdr coh on coh.owner=od.owner and coh.link_key_val=concat(od.order_no,' + ',od.item,' + ',od.line_no) left join rockport_stage0.trader_packing p on p.owner=coh.owner and p.link_key_val=coh.link_key_val
! echo completed loading into scct_work_db.rockport_po_work;
! echo started loading into scct_db.rockport_po;
! echo completed loading into scct_db.rockport_po;
! echo completed loading into scct_db.rockport_ob_shipment_item ;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_ocean_shipment -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_ocean_shipment  ---source: scct_work_db table : rockport_ocean_shipment_temp ---load type: upsert ---back posting: no ---author: ryadav ---last modified date: 05/08/2019 --------------------------------------------------------------------------  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading rockport_ocean_shipment stage 1 base data -------------------------  set tez.job.name=stage1:rockport_ocean_shipment :load target table rockport_ocean_shipment ;
! echo started loading into scct_db.rockport_ocean_shipment ;
! echo completed loading into scct_db.rockport_ocean_shipment ;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_po -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_po ---source: rockport_stage0 table : trader_contract_dtl,trader_contract_hdr,trader_delivery_dtl,trader_plci3225, ---trader_order_dtl,trader_delivery_dtl,trader_order_hdr,trader_party,trader_costing_hdr,trader_packing, ---load type: full ---back posting: no ---author - created/updated date - jira ticket ---ssoma - 06/05/2019 -  ---ssoma - 14/06/2019 - scctp4-2006/07/08 --------------------------------------------------------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading stage1 table scct_db.rockport_po  -------------------------  set tez.job.name=stage1:rockport_po_work:load work table rockport_po_work;
! echo started loading into scct_work_db.rockport_po_work;
insert overwrite table scct_work_db.rockport_po_work select 'contract' as po_type ,coalesce(case when trim(ch.owner)='' then null else trim(ch.owner) end , 'n/a') as owner ,coalesce(case when trim(cd.contract_no)='' then null else trim(cd.contract_no) end , 'n/a') as po_nbr ,coalesce(case when trim(cd.item)='' then null when length(trim(cd.item))=8 then lpad(trim(cd.item),18,0) else trim(cd.item) end , '0') as itm_nbr ,coalesce(case when trim(cd.line_no)='' then null else trim(cd.line_no) end , 'n/a') as line_nbr ,coalesce(case when trim(ch.dept)='' then null else trim(ch.dept) end , 'n/a') as department ,coalesce(case when trim(dd.proof_of_del_no)='' then null else trim(dd.proof_of_del_no) end , 'n/a') as inco_terms ,coalesce(case when trim(cd.qty_ordered)='' then null else trim(cd.qty_ordered) end , 0.00) as qty_ordered ,coalesce(case when trim(dd.transport_mode)='' then null else trim(dd.transport_mode) end , 'n/a') as shipping_method ,coalesce(case when trim(cd.origin_country)='' then null else trim(cd.origin_country) end , 'n/a') as origin_country ,coalesce(case when trim(dd.status)='' then null else trim(dd.status) end , 'n/a') as port ,coalesce(case when trim(pc.place_name)='' then null else trim(pc.place_name) end , 'n/a') as port_name ,coalesce(case when trim(pc.country)='' then null else trim(pc.country) end , 'n/a') as export_country ,coalesce(to_date(to_utc_timestamp(cd.order_date, "est5edt")), '9999-12-31') as order_dt ,coalesce(case when trim(cd.manufacturer)='' then null else trim(cd.manufacturer) end , 'n/a') as factory_id ,coalesce(case when trim(pa.party_name_line1)='' then null else trim(pa.party_name_line1) end , 'n/a') as factory_name ,coalesce(case when trim(pa.city_name_1)='' then null else trim(pa.city_name_1) end , 'n/a') as factory_city ,coalesce(case when trim(pa.country_1)='' then null else trim(pa.country_1) end , 'n/a') as factory_country ,coalesce(case when trim(cd.secondary_owner)='' then null else trim(cd.secondary_owner) end , 'n/a') as brand ,coalesce(to_date(to_utc_timestamp(cd.latest_ship_date, "est5edt")), '9999-12-31') as plan_gac_dt ,coalesce(to_date(to_utc_timestamp(dd.last_delivery_date, "est5edt")), '9999-12-31') as plan_ndc_dt ,coalesce(case when trim(dd.deliver_to)='' then null else trim(dd.deliver_to) end , 'n/a') as deliver_to ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as deliver_to_name ,coalesce(case when trim(pa2.city_name_1)='' then null else trim(pa2.city_name_1) end , 'n/a') as deliver_to_city ,coalesce(case when trim(pa2.country_1)='' then null else trim(pa2.country_1) end , 'n/a') as deliver_to_country ,coalesce(case when trim(cd.order_no)='' then null else trim(cd.order_no) end , 'n/a') as cpo ,coalesce(case when trim(ch.seller)='' then null else trim(ch.seller) end , 'n/a') as seller_id ,coalesce(case when trim(pa3.party_name_line1)='' then null else trim(pa3.party_name_line1) end , 'n/a') as seller_name ,coalesce(case when trim(pa3.city_name_1)='' then null else trim(pa3.city_name_1) end , 'n/a') as seller_city ,coalesce(case when trim(pa3.country_1)='' then null else trim(pa3.country_1) end , 'n/a') as seller_country ,coalesce(case when trim(coh.dim_factor)='' then null else trim(coh.dim_factor) end , 0.00) as dim_factor ,coalesce(case when trim(coh.price)='' then null else trim(coh.price) end , 0.00) as price ,coalesce(case when trim(coh.currency)='' then null else trim(coh.currency) end , 'n/a') as currency ,coalesce(case when trim(p.gross_wgt_unit)='' then null else trim(p.gross_wgt_unit) end , 0.00) as gross_wgt_unit ,coalesce(case when trim(p.gross_wgt_unit_um)='' then null else trim(p.gross_wgt_unit_um) end , 'n/a') as gross_wgt_uom ,coalesce(to_utc_timestamp(ch.last_update, "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(cd.last_update, "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm ,coalesce(to_utc_timestamp(dd.last_update, "est5edt"), '9999-12-31 00:00:00') as delivery_last_upd_dtm ,coalesce(to_utc_timestamp(p.last_update, "est5edt"), '9999-12-31 00:00:00') as packing_last_upd_dtm ,coalesce(to_utc_timestamp(coh.last_update, "est5edt"), '9999-12-31 00:00:00') as costing_last_upd_dtm from rockport_stage0.trader_contract_dtl cd left join rockport_stage0.trader_contract_hdr ch on ch.owner=cd.owner and ch.contract_no=cd.contract_no left join rockport_stage0.trader_delivery_dtl dd on dd.link_key_val=concat(cd.contract_no,' + ',cd.contract_no,' + ',cd.item,' + ',cd.line_no) and dd.owner=ch.owner left join rockport_stage0.trader_plci3225 pc on pc.place_code=dd.status left join rockport_stage0.trader_party pa on pa.party_id=cd.manufacturer left join rockport_stage0.trader_party pa2 on pa2.party_id=dd.deliver_to left join rockport_stage0.trader_party pa3 on pa3.party_id=ch.seller left join rockport_stage0.trader_costing_hdr coh on coh.owner=cd.owner and coh.link_key_val=concat(cd.contract_no,' + ',cd.contract_no,' + ',cd.item,' + ',cd.line_no) left join rockport_stage0.trader_packing p on p.owner=coh.owner and p.link_key_val=coh.link_key_val  union all select 'order' as po_type ,coalesce(case when trim(oh.owner)='' then null else trim(oh.owner) end , 'n/a') as owner ,coalesce(case when trim(od.order_no)='' then null else trim(od.order_no) end , 'n/a') as po_nbr ,coalesce(case when trim(od.item)='' then null when length(trim(od.item))=8 then lpad(trim(od.item),18,0) else trim(od.item) end , '0') as itm_nbr ,coalesce(case when trim(od.line_no)='' then null else trim(od.line_no) end , 'n/a') as line_nbr ,coalesce(case when trim(oh.dept)='' then null else trim(oh.dept) end , 'n/a') as department ,coalesce(case when trim(dd.proof_of_del_no)='' then null else trim(dd.proof_of_del_no) end , 'n/a') as inco_terms ,coalesce(case when trim(od.qty_ordered)='' then null else trim(od.qty_ordered) end , 0.00) as qty_ordered ,coalesce(case when trim(dd.transport_mode)='' then null else trim(dd.transport_mode) end , 'n/a') as shipping_method ,coalesce(case when trim(od.origin_country)='' then null else trim(od.origin_country) end , 'n/a') as origin_country ,coalesce(case when trim(dd.status)='' then null else trim(dd.status) end , 'n/a') as port ,coalesce(case when trim(replace(pc.place_name,',',''))='' then null else trim(replace(pc.place_name,',','')) end , 'n/a') as port_name ,coalesce(case when trim(pc.country)='' then null else trim(pc.country) end , 'n/a') as export_country ,coalesce(to_date(to_utc_timestamp(oh.order_date, "est5edt")), '9999-12-31') as order_dt ,coalesce(case when trim(od.manufacturer)='' then null else trim(od.manufacturer) end , 'n/a') as factory_id ,coalesce(case when trim(pa.party_name_line1)='' then null else trim(pa.party_name_line1) end , 'n/a') as factory_name ,coalesce(case when trim(pa.city_name_1)='' then null else trim(pa.city_name_1) end , 'n/a') as factory_city ,coalesce(case when trim(pa.country_1)='' then null else trim(pa.country_1) end , 'n/a') as factory_country ,coalesce(case when trim(od.deliver_to)='' then null else trim(od.deliver_to) end , 'n/a') as brand ,coalesce(to_date(to_utc_timestamp(od.latest_ship_date, "est5edt")), '9999-12-31') as plan_gac_dt ,coalesce(to_date(to_utc_timestamp(dd.last_delivery_date, "est5edt")), '9999-12-31') as plan_ndc_dt ,coalesce(case when trim(dd.deliver_to)='' then null else trim(dd.deliver_to) end , 'n/a') as deliver_to ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as deliver_to_name ,coalesce(case when trim(pa2.city_name_1)='' then null else trim(pa2.city_name_1) end , 'n/a') as deliver_to_city ,coalesce(case when trim(pa2.country_1)='' then null else trim(pa2.country_1) end , 'n/a') as deliver_to_country ,'n/a' as cpo ,coalesce(case when trim(oh.seller)='' then null else trim(oh.seller) end , 'n/a') as seller_id ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as seller_name ,coalesce(case when trim(pa3.city_name_1)='' then null else trim(pa3.city_name_1) end , 'n/a') as seller_city ,coalesce(case when trim(pa3.country_1)='' then null else trim(pa3.country_1) end , 'n/a') as seller_country ,coalesce(case when trim(coh.dim_factor)='' then null else trim(coh.dim_factor) end , 0.00) as dim_factor ,coalesce(case when trim(coh.price)='' then null else trim(coh.price) end , 0.00) as price ,coalesce(case when trim(coh.currency)='' then null else trim(coh.currency) end , 'n/a') as currency ,coalesce(case when trim(p.gross_wgt_unit)='' then null else trim(p.gross_wgt_unit) end , 0.00) as gross_wgt_unit ,coalesce(case when trim(p.gross_wgt_unit_um)='' then null else trim(p.gross_wgt_unit_um) end , 'n/a') as gross_wgt_uom ,coalesce(to_utc_timestamp(oh.last_update, "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(od.last_update, "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm ,coalesce(to_utc_timestamp(dd.last_update, "est5edt"), '9999-12-31 00:00:00') as delivery_last_upd_dtm ,coalesce(to_utc_timestamp(p.last_update, "est5edt"), '9999-12-31 00:00:00') as packing_last_upd_dtm ,coalesce(to_utc_timestamp(coh.last_update, "est5edt"), '9999-12-31 00:00:00') as costing_last_upd_dtm from rockport_stage0.trader_order_dtl od left join rockport_stage0.trader_delivery_dtl dd on dd.link_key_val=concat(od.order_no,' + ',od.item,' + ',od.line_no) left join rockport_stage0.trader_plci3225 pc on pc.place_code=dd.status left join rockport_stage0.trader_party pa on pa.party_id=od.manufacturer left join rockport_stage0.trader_party pa2 on pa2.party_id=dd.deliver_to join rockport_stage0.trader_order_hdr oh on oh.order_no=od.order_no and oh.owner=od.owner left join rockport_stage0.trader_party pa3 on pa3.party_id=oh.seller left join rockport_stage0.trader_costing_hdr coh on coh.owner=od.owner and coh.link_key_val=concat(od.order_no,' + ',od.item,' + ',od.line_no) left join rockport_stage0.trader_packing p on p.owner=coh.owner and p.link_key_val=coh.link_key_val
! echo completed loading into scct_work_db.rockport_po_work;
! echo started loading into scct_db.rockport_po;
! echo completed loading into scct_db.rockport_po;
! echo completed loading into scct_db.rockport_ob_shipment_item ;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_ocean_shipment -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_ocean_shipment  ---source: scct_work_db table : rockport_ocean_shipment_temp ---load type: upsert ---back posting: no ---author: ryadav ---last modified date: 05/08/2019 --------------------------------------------------------------------------  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading rockport_ocean_shipment stage 1 base data -------------------------  set tez.job.name=stage1:rockport_ocean_shipment :load target table rockport_ocean_shipment ;
! echo started loading into scct_db.rockport_ocean_shipment ;
! echo completed loading into scct_db.rockport_ocean_shipment ;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_po -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_po ---source: rockport_stage0 table : trader_contract_dtl,trader_contract_hdr,trader_delivery_dtl,trader_plci3225, ---trader_order_dtl,trader_delivery_dtl,trader_order_hdr,trader_party,trader_costing_hdr,trader_packing, ---load type: full ---back posting: no ---author - created/updated date - jira ticket ---ssoma - 06/05/2019 -  ---ssoma - 14/06/2019 - scctp4-2006/07/08 --------------------------------------------------------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading stage1 table scct_db.rockport_po  -------------------------  set tez.job.name=stage1:rockport_po_work:load work table rockport_po_work;
! echo started loading into scct_work_db.rockport_po_work;
insert overwrite table scct_work_db.rockport_po_work select 'contract' as po_type ,coalesce(case when trim(ch.owner)='' then null else trim(ch.owner) end , 'n/a') as owner ,coalesce(case when trim(cd.contract_no)='' then null else trim(cd.contract_no) end , 'n/a') as po_nbr ,coalesce(case when trim(cd.item)='' then null when length(trim(cd.item))=8 then lpad(trim(cd.item),18,0) else trim(cd.item) end , '0') as itm_nbr ,coalesce(case when trim(cd.line_no)='' then null else trim(cd.line_no) end , 'n/a') as line_nbr ,coalesce(case when trim(ch.dept)='' then null else trim(ch.dept) end , 'n/a') as department ,coalesce(case when trim(dd.proof_of_del_no)='' then null else trim(dd.proof_of_del_no) end , 'n/a') as inco_terms ,coalesce(case when trim(cd.qty_ordered)='' then null else trim(cd.qty_ordered) end , 0.00) as qty_ordered ,coalesce(case when trim(dd.transport_mode)='' then null else trim(dd.transport_mode) end , 'n/a') as shipping_method ,coalesce(case when trim(cd.origin_country)='' then null else trim(cd.origin_country) end , 'n/a') as origin_country ,coalesce(case when trim(dd.status)='' then null else trim(dd.status) end , 'n/a') as port ,coalesce(case when trim(pc.place_name)='' then null else trim(pc.place_name) end , 'n/a') as port_name ,coalesce(case when trim(pc.country)='' then null else trim(pc.country) end , 'n/a') as export_country ,coalesce(to_date(to_utc_timestamp(cd.order_date, "est5edt")), '9999-12-31') as order_dt ,coalesce(case when trim(cd.manufacturer)='' then null else trim(cd.manufacturer) end , 'n/a') as factory_id ,coalesce(case when trim(pa.party_name_line1)='' then null else trim(pa.party_name_line1) end , 'n/a') as factory_name ,coalesce(case when trim(pa.city_name_1)='' then null else trim(pa.city_name_1) end , 'n/a') as factory_city ,coalesce(case when trim(pa.country_1)='' then null else trim(pa.country_1) end , 'n/a') as factory_country ,coalesce(case when trim(cd.secondary_owner)='' then null else trim(cd.secondary_owner) end , 'n/a') as brand ,coalesce(to_date(to_utc_timestamp(cd.latest_ship_date, "est5edt")), '9999-12-31') as plan_gac_dt ,coalesce(to_date(to_utc_timestamp(dd.last_delivery_date, "est5edt")), '9999-12-31') as plan_ndc_dt ,coalesce(case when trim(dd.deliver_to)='' then null else trim(dd.deliver_to) end , 'n/a') as deliver_to ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as deliver_to_name ,coalesce(case when trim(pa2.city_name_1)='' then null else trim(pa2.city_name_1) end , 'n/a') as deliver_to_city ,coalesce(case when trim(pa2.country_1)='' then null else trim(pa2.country_1) end , 'n/a') as deliver_to_country ,coalesce(case when trim(cd.order_no)='' then null else trim(cd.order_no) end , 'n/a') as cpo ,coalesce(case when trim(ch.seller)='' then null else trim(ch.seller) end , 'n/a') as seller_id ,coalesce(case when trim(pa3.party_name_line1)='' then null else trim(pa3.party_name_line1) end , 'n/a') as seller_name ,coalesce(case when trim(pa3.city_name_1)='' then null else trim(pa3.city_name_1) end , 'n/a') as seller_city ,coalesce(case when trim(pa3.country_1)='' then null else trim(pa3.country_1) end , 'n/a') as seller_country ,coalesce(case when trim(coh.dim_factor)='' then null else trim(coh.dim_factor) end , 0.00) as dim_factor ,coalesce(case when trim(coh.price)='' then null else trim(coh.price) end , 0.00) as price ,coalesce(case when trim(coh.currency)='' then null else trim(coh.currency) end , 'n/a') as currency ,coalesce(case when trim(p.gross_wgt_unit)='' then null else trim(p.gross_wgt_unit) end , 0.00) as gross_wgt_unit ,coalesce(case when trim(p.gross_wgt_unit_um)='' then null else trim(p.gross_wgt_unit_um) end , 'n/a') as gross_wgt_uom ,coalesce(to_utc_timestamp(ch.last_update, "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(cd.last_update, "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm ,coalesce(to_utc_timestamp(dd.last_update, "est5edt"), '9999-12-31 00:00:00') as delivery_last_upd_dtm ,coalesce(to_utc_timestamp(p.last_update, "est5edt"), '9999-12-31 00:00:00') as packing_last_upd_dtm ,coalesce(to_utc_timestamp(coh.last_update, "est5edt"), '9999-12-31 00:00:00') as costing_last_upd_dtm from rockport_stage0.trader_contract_dtl cd left join rockport_stage0.trader_contract_hdr ch on ch.owner=cd.owner and ch.contract_no=cd.contract_no left join rockport_stage0.trader_delivery_dtl dd on dd.link_key_val=concat(cd.contract_no,' + ',cd.contract_no,' + ',cd.item,' + ',cd.line_no) and dd.owner=ch.owner left join rockport_stage0.trader_plci3225 pc on pc.place_code=dd.status left join rockport_stage0.trader_party pa on pa.party_id=cd.manufacturer left join rockport_stage0.trader_party pa2 on pa2.party_id=dd.deliver_to left join rockport_stage0.trader_party pa3 on pa3.party_id=ch.seller left join rockport_stage0.trader_costing_hdr coh on coh.owner=cd.owner and coh.link_key_val=concat(cd.contract_no,' + ',cd.contract_no,' + ',cd.item,' + ',cd.line_no) left join rockport_stage0.trader_packing p on p.owner=coh.owner and p.link_key_val=coh.link_key_val  union all select 'order' as po_type ,coalesce(case when trim(oh.owner)='' then null else trim(oh.owner) end , 'n/a') as owner ,coalesce(case when trim(od.order_no)='' then null else trim(od.order_no) end , 'n/a') as po_nbr ,coalesce(case when trim(od.item)='' then null when length(trim(od.item))=8 then lpad(trim(od.item),18,0) else trim(od.item) end , '0') as itm_nbr ,coalesce(case when trim(od.line_no)='' then null else trim(od.line_no) end , 'n/a') as line_nbr ,coalesce(case when trim(oh.dept)='' then null else trim(oh.dept) end , 'n/a') as department ,coalesce(case when trim(dd.proof_of_del_no)='' then null else trim(dd.proof_of_del_no) end , 'n/a') as inco_terms ,coalesce(case when trim(od.qty_ordered)='' then null else trim(od.qty_ordered) end , 0.00) as qty_ordered ,coalesce(case when trim(dd.transport_mode)='' then null else trim(dd.transport_mode) end , 'n/a') as shipping_method ,coalesce(case when trim(od.origin_country)='' then null else trim(od.origin_country) end , 'n/a') as origin_country ,coalesce(case when trim(dd.status)='' then null else trim(dd.status) end , 'n/a') as port ,coalesce(case when trim(replace(pc.place_name,',',''))='' then null else trim(replace(pc.place_name,',','')) end , 'n/a') as port_name ,coalesce(case when trim(pc.country)='' then null else trim(pc.country) end , 'n/a') as export_country ,coalesce(to_date(to_utc_timestamp(oh.order_date, "est5edt")), '9999-12-31') as order_dt ,coalesce(case when trim(od.manufacturer)='' then null else trim(od.manufacturer) end , 'n/a') as factory_id ,coalesce(case when trim(pa.party_name_line1)='' then null else trim(pa.party_name_line1) end , 'n/a') as factory_name ,coalesce(case when trim(pa.city_name_1)='' then null else trim(pa.city_name_1) end , 'n/a') as factory_city ,coalesce(case when trim(pa.country_1)='' then null else trim(pa.country_1) end , 'n/a') as factory_country ,coalesce(case when trim(od.deliver_to)='' then null else trim(od.deliver_to) end , 'n/a') as brand ,coalesce(to_date(to_utc_timestamp(od.latest_ship_date, "est5edt")), '9999-12-31') as plan_gac_dt ,coalesce(to_date(to_utc_timestamp(dd.last_delivery_date, "est5edt")), '9999-12-31') as plan_ndc_dt ,coalesce(case when trim(dd.deliver_to)='' then null else trim(dd.deliver_to) end , 'n/a') as deliver_to ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as deliver_to_name ,coalesce(case when trim(pa2.city_name_1)='' then null else trim(pa2.city_name_1) end , 'n/a') as deliver_to_city ,coalesce(case when trim(pa2.country_1)='' then null else trim(pa2.country_1) end , 'n/a') as deliver_to_country ,'n/a' as cpo ,coalesce(case when trim(oh.seller)='' then null else trim(oh.seller) end , 'n/a') as seller_id ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as seller_name ,coalesce(case when trim(pa3.city_name_1)='' then null else trim(pa3.city_name_1) end , 'n/a') as seller_city ,coalesce(case when trim(pa3.country_1)='' then null else trim(pa3.country_1) end , 'n/a') as seller_country ,coalesce(case when trim(coh.dim_factor)='' then null else trim(coh.dim_factor) end , 0.00) as dim_factor ,coalesce(case when trim(coh.price)='' then null else trim(coh.price) end , 0.00) as price ,coalesce(case when trim(coh.currency)='' then null else trim(coh.currency) end , 'n/a') as currency ,coalesce(case when trim(p.gross_wgt_unit)='' then null else trim(p.gross_wgt_unit) end , 0.00) as gross_wgt_unit ,coalesce(case when trim(p.gross_wgt_unit_um)='' then null else trim(p.gross_wgt_unit_um) end , 'n/a') as gross_wgt_uom ,coalesce(to_utc_timestamp(oh.last_update, "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(od.last_update, "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm ,coalesce(to_utc_timestamp(dd.last_update, "est5edt"), '9999-12-31 00:00:00') as delivery_last_upd_dtm ,coalesce(to_utc_timestamp(p.last_update, "est5edt"), '9999-12-31 00:00:00') as packing_last_upd_dtm ,coalesce(to_utc_timestamp(coh.last_update, "est5edt"), '9999-12-31 00:00:00') as costing_last_upd_dtm from rockport_stage0.trader_order_dtl od left join rockport_stage0.trader_delivery_dtl dd on dd.link_key_val=concat(od.order_no,' + ',od.item,' + ',od.line_no) left join rockport_stage0.trader_plci3225 pc on pc.place_code=dd.status left join rockport_stage0.trader_party pa on pa.party_id=od.manufacturer left join rockport_stage0.trader_party pa2 on pa2.party_id=dd.deliver_to join rockport_stage0.trader_order_hdr oh on oh.order_no=od.order_no and oh.owner=od.owner left join rockport_stage0.trader_party pa3 on pa3.party_id=oh.seller left join rockport_stage0.trader_costing_hdr coh on coh.owner=od.owner and coh.link_key_val=concat(od.order_no,' + ',od.item,' + ',od.line_no) left join rockport_stage0.trader_packing p on p.owner=coh.owner and p.link_key_val=coh.link_key_val
! echo completed loading into scct_work_db.rockport_po_work;
! echo started loading into scct_db.rockport_po;
! echo completed loading into scct_db.rockport_po;
! echo completed loading into scct_db.rockport_ob_shipment_item ;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_ocean_shipment -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_ocean_shipment  ---source: scct_work_db table : rockport_ocean_shipment_temp ---load type: upsert ---back posting: no ---author: ryadav ---last modified date: 05/08/2019 --------------------------------------------------------------------------  ------------------------- ---job related hive settings to merge files for target table -------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading rockport_ocean_shipment stage 1 base data -------------------------  set tez.job.name=stage1:rockport_ocean_shipment :load target table rockport_ocean_shipment ;
! echo started loading into scct_db.rockport_ocean_shipment ;
! echo completed loading into scct_db.rockport_ocean_shipment ;
---jobname:scct-rockport-hive-stg1-scct_db.rockport_po -------------------------------------------------------------------------- ---target: stage1 table: scct_db.rockport_po ---source: rockport_stage0 table : trader_contract_dtl,trader_contract_hdr,trader_delivery_dtl,trader_plci3225, ---trader_order_dtl,trader_delivery_dtl,trader_order_hdr,trader_party,trader_costing_hdr,trader_packing, ---load type: full ---back posting: no ---author - created/updated date - jira ticket ---ssoma - 06/05/2019 -  ---ssoma - 14/06/2019 - scctp4-2006/07/08 --------------------------------------------------------------------------  set hive.merge.orcfile.stripe.level=false;
------------------------- ---loading stage1 table scct_db.rockport_po  -------------------------  set tez.job.name=stage1:rockport_po_work:load work table rockport_po_work;
! echo started loading into scct_work_db.rockport_po_work;
insert overwrite table scct_work_db.rockport_po_work select 'contract' as po_type ,coalesce(case when trim(ch.owner)='' then null else trim(ch.owner) end , 'n/a') as owner ,coalesce(case when trim(cd.contract_no)='' then null else trim(cd.contract_no) end , 'n/a') as po_nbr ,coalesce(case when trim(cd.item)='' then null when length(trim(cd.item))=8 then lpad(trim(cd.item),18,0) else trim(cd.item) end , '0') as itm_nbr ,coalesce(case when trim(cd.line_no)='' then null else trim(cd.line_no) end , 'n/a') as line_nbr ,coalesce(case when trim(ch.dept)='' then null else trim(ch.dept) end , 'n/a') as department ,coalesce(case when trim(dd.proof_of_del_no)='' then null else trim(dd.proof_of_del_no) end , 'n/a') as inco_terms ,coalesce(case when trim(cd.qty_ordered)='' then null else trim(cd.qty_ordered) end , 0.00) as qty_ordered ,coalesce(case when trim(dd.transport_mode)='' then null else trim(dd.transport_mode) end , 'n/a') as shipping_method ,coalesce(case when trim(cd.origin_country)='' then null else trim(cd.origin_country) end , 'n/a') as origin_country ,coalesce(case when trim(dd.status)='' then null else trim(dd.status) end , 'n/a') as port ,coalesce(case when trim(pc.place_name)='' then null else trim(pc.place_name) end , 'n/a') as port_name ,coalesce(case when trim(pc.country)='' then null else trim(pc.country) end , 'n/a') as export_country ,coalesce(to_date(to_utc_timestamp(cd.order_date, "est5edt")), '9999-12-31') as order_dt ,coalesce(case when trim(cd.manufacturer)='' then null else trim(cd.manufacturer) end , 'n/a') as factory_id ,coalesce(case when trim(pa.party_name_line1)='' then null else trim(pa.party_name_line1) end , 'n/a') as factory_name ,coalesce(case when trim(pa.city_name_1)='' then null else trim(pa.city_name_1) end , 'n/a') as factory_city ,coalesce(case when trim(pa.country_1)='' then null else trim(pa.country_1) end , 'n/a') as factory_country ,coalesce(case when trim(cd.secondary_owner)='' then null else trim(cd.secondary_owner) end , 'n/a') as brand ,coalesce(to_date(to_utc_timestamp(cd.latest_ship_date, "est5edt")), '9999-12-31') as plan_gac_dt ,coalesce(to_date(to_utc_timestamp(dd.last_delivery_date, "est5edt")), '9999-12-31') as plan_ndc_dt ,coalesce(case when trim(dd.deliver_to)='' then null else trim(dd.deliver_to) end , 'n/a') as deliver_to ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as deliver_to_name ,coalesce(case when trim(pa2.city_name_1)='' then null else trim(pa2.city_name_1) end , 'n/a') as deliver_to_city ,coalesce(case when trim(pa2.country_1)='' then null else trim(pa2.country_1) end , 'n/a') as deliver_to_country ,coalesce(case when trim(cd.order_no)='' then null else trim(cd.order_no) end , 'n/a') as cpo ,coalesce(case when trim(ch.seller)='' then null else trim(ch.seller) end , 'n/a') as seller_id ,coalesce(case when trim(pa3.party_name_line1)='' then null else trim(pa3.party_name_line1) end , 'n/a') as seller_name ,coalesce(case when trim(pa3.city_name_1)='' then null else trim(pa3.city_name_1) end , 'n/a') as seller_city ,coalesce(case when trim(pa3.country_1)='' then null else trim(pa3.country_1) end , 'n/a') as seller_country ,coalesce(case when trim(coh.dim_factor)='' then null else trim(coh.dim_factor) end , 0.00) as dim_factor ,coalesce(case when trim(coh.price)='' then null else trim(coh.price) end , 0.00) as price ,coalesce(case when trim(coh.currency)='' then null else trim(coh.currency) end , 'n/a') as currency ,coalesce(case when trim(p.gross_wgt_unit)='' then null else trim(p.gross_wgt_unit) end , 0.00) as gross_wgt_unit ,coalesce(case when trim(p.gross_wgt_unit_um)='' then null else trim(p.gross_wgt_unit_um) end , 'n/a') as gross_wgt_uom ,coalesce(to_utc_timestamp(ch.last_update, "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(cd.last_update, "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm ,coalesce(to_utc_timestamp(dd.last_update, "est5edt"), '9999-12-31 00:00:00') as delivery_last_upd_dtm ,coalesce(to_utc_timestamp(p.last_update, "est5edt"), '9999-12-31 00:00:00') as packing_last_upd_dtm ,coalesce(to_utc_timestamp(coh.last_update, "est5edt"), '9999-12-31 00:00:00') as costing_last_upd_dtm from rockport_stage0.trader_contract_dtl cd left join rockport_stage0.trader_contract_hdr ch on ch.owner=cd.owner and ch.contract_no=cd.contract_no left join rockport_stage0.trader_delivery_dtl dd on dd.link_key_val=concat(cd.contract_no,' + ',cd.contract_no,' + ',cd.item,' + ',cd.line_no) and dd.owner=ch.owner left join rockport_stage0.trader_plci3225 pc on pc.place_code=dd.status left join rockport_stage0.trader_party pa on pa.party_id=cd.manufacturer left join rockport_stage0.trader_party pa2 on pa2.party_id=dd.deliver_to left join rockport_stage0.trader_party pa3 on pa3.party_id=ch.seller left join rockport_stage0.trader_costing_hdr coh on coh.owner=cd.owner and coh.link_key_val=concat(cd.contract_no,' + ',cd.contract_no,' + ',cd.item,' + ',cd.line_no) left join rockport_stage0.trader_packing p on p.owner=coh.owner and p.link_key_val=coh.link_key_val  union all select 'order' as po_type ,coalesce(case when trim(oh.owner)='' then null else trim(oh.owner) end , 'n/a') as owner ,coalesce(case when trim(od.order_no)='' then null else trim(od.order_no) end , 'n/a') as po_nbr ,coalesce(case when trim(od.item)='' then null when length(trim(od.item))=8 then lpad(trim(od.item),18,0) else trim(od.item) end , '0') as itm_nbr ,coalesce(case when trim(od.line_no)='' then null else trim(od.line_no) end , 'n/a') as line_nbr ,coalesce(case when trim(oh.dept)='' then null else trim(oh.dept) end , 'n/a') as department ,coalesce(case when trim(dd.proof_of_del_no)='' then null else trim(dd.proof_of_del_no) end , 'n/a') as inco_terms ,coalesce(case when trim(od.qty_ordered)='' then null else trim(od.qty_ordered) end , 0.00) as qty_ordered ,coalesce(case when trim(dd.transport_mode)='' then null else trim(dd.transport_mode) end , 'n/a') as shipping_method ,coalesce(case when trim(od.origin_country)='' then null else trim(od.origin_country) end , 'n/a') as origin_country ,coalesce(case when trim(dd.status)='' then null else trim(dd.status) end , 'n/a') as port ,coalesce(case when trim(replace(pc.place_name,',',''))='' then null else trim(replace(pc.place_name,',','')) end , 'n/a') as port_name ,coalesce(case when trim(pc.country)='' then null else trim(pc.country) end , 'n/a') as export_country ,coalesce(to_date(to_utc_timestamp(oh.order_date, "est5edt")), '9999-12-31') as order_dt ,coalesce(case when trim(od.manufacturer)='' then null else trim(od.manufacturer) end , 'n/a') as factory_id ,coalesce(case when trim(pa.party_name_line1)='' then null else trim(pa.party_name_line1) end , 'n/a') as factory_name ,coalesce(case when trim(pa.city_name_1)='' then null else trim(pa.city_name_1) end , 'n/a') as factory_city ,coalesce(case when trim(pa.country_1)='' then null else trim(pa.country_1) end , 'n/a') as factory_country ,coalesce(case when trim(od.deliver_to)='' then null else trim(od.deliver_to) end , 'n/a') as brand ,coalesce(to_date(to_utc_timestamp(od.latest_ship_date, "est5edt")), '9999-12-31') as plan_gac_dt ,coalesce(to_date(to_utc_timestamp(dd.last_delivery_date, "est5edt")), '9999-12-31') as plan_ndc_dt ,coalesce(case when trim(dd.deliver_to)='' then null else trim(dd.deliver_to) end , 'n/a') as deliver_to ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as deliver_to_name ,coalesce(case when trim(pa2.city_name_1)='' then null else trim(pa2.city_name_1) end , 'n/a') as deliver_to_city ,coalesce(case when trim(pa2.country_1)='' then null else trim(pa2.country_1) end , 'n/a') as deliver_to_country ,'n/a' as cpo ,coalesce(case when trim(oh.seller)='' then null else trim(oh.seller) end , 'n/a') as seller_id ,coalesce(case when trim(pa2.party_name_line1)='' then null else trim(pa2.party_name_line1) end , 'n/a') as seller_name ,coalesce(case when trim(pa3.city_name_1)='' then null else trim(pa3.city_name_1) end , 'n/a') as seller_city ,coalesce(case when trim(pa3.country_1)='' then null else trim(pa3.country_1) end , 'n/a') as seller_country ,coalesce(case when trim(coh.dim_factor)='' then null else trim(coh.dim_factor) end , 0.00) as dim_factor ,coalesce(case when trim(coh.price)='' then null else trim(coh.price) end , 0.00) as price ,coalesce(case when trim(coh.currency)='' then null else trim(coh.currency) end , 'n/a') as currency ,coalesce(case when trim(p.gross_wgt_unit)='' then null else trim(p.gross_wgt_unit) end , 0.00) as gross_wgt_unit ,coalesce(case when trim(p.gross_wgt_unit_um)='' then null else trim(p.gross_wgt_unit_um) end , 'n/a') as gross_wgt_uom ,coalesce(to_utc_timestamp(oh.last_update, "est5edt"), '9999-12-31 00:00:00') as header_last_upd_dtm ,coalesce(to_utc_timestamp(od.last_update, "est5edt"), '9999-12-31 00:00:00') as detail_last_upd_dtm ,coalesce(to_utc_timestamp(dd.last_update, "est5edt"), '9999-12-31 00:00:00') as delivery_last_upd_dtm ,coalesce(to_utc_timestamp(p.last_update, "est5edt"), '9999-12-31 00:00:00') as packing_last_upd_dtm ,coalesce(to_utc_timestamp(coh.last_update, "est5edt"), '9999-12-31 00:00:00') as costing_last_upd_dtm from rockport_stage0.trader_order_dtl od left join rockport_stage0.trader_delivery_dtl dd on dd.link_key_val=concat(od.order_no,' + ',od.item,' + ',od.line_no) left join rockport_stage0.trader_plci3225 pc on pc.place_code=dd.status left join rockport_stage0.trader_party pa on pa.party_id=od.manufacturer left join rockport_stage0.trader_party pa2 on pa2.party_id=dd.deliver_to join rockport_stage0.trader_order_hdr oh on oh.order_no=od.order_no and oh.owner=od.owner left join rockport_stage0.trader_party pa3 on pa3.party_id=oh.seller left join rockport_stage0.trader_costing_hdr coh on coh.owner=od.owner and coh.link_key_val=concat(od.order_no,' + ',od.item,' + ',od.line_no) left join rockport_stage0.trader_packing p on p.owner=coh.owner and p.link_key_val=coh.link_key_val
! echo completed loading into scct_work_db.rockport_po_work;
! echo started loading into scct_db.rockport_po;
! echo completed loading into scct_db.rockport_po;
